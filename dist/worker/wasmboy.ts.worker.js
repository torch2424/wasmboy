'use strict';(function(){function eb(a){return a.data?a.data:a}function ea(a,c){nb?self.postMessage(a,c):Bb.postMessage(a,c)}function fb(a,c){a||console.error("workerapi: No callback was provided to onMessage!");if(c)if(nb)c.onmessage=a;else c.on("message",a);else if(nb)self.onmessage=a;else Bb.on("message",a)}function O(a,c,b){c||(c=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10),ob++,c=`${c}-${ob}`,1E5<ob&&(ob=0));return{workerId:b,messageId:c,message:a}}function xc(a,c){c=eb(c);
switch(c.message.type){case B.GET_CONSTANTS:a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION=a.wasmInstance.exports.FRAME_LOCATION.valueOf(),a.WASMBOY_CURRENT_FRAME_SIZE=a.wasmInstance.exports.FRAME_SIZE.valueOf(),a.graphicsWorkerPort.postMessage(O({type:B.GET_CONSTANTS_DONE,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:a.wasmInstance.exports.FRAME_LOCATION.valueOf()},c.messageId))}}function yc(a,c){c=eb(c);switch(c.message.type){case B.GET_CONSTANTS:a.WASMBOY_SOUND_OUTPUT_LOCATION=a.wasmInstance.exports.AUDIO_BUFFER_LOCATION.valueOf();
a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_1_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_2_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_3_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_4_BUFFER_LOCATION.valueOf();a.audioWorkerPort.postMessage(O({type:B.GET_CONSTANTS_DONE,WASMBOY_SOUND_OUTPUT_LOCATION:a.wasmInstance.exports.AUDIO_BUFFER_LOCATION.valueOf()},
c.messageId));break;case B.AUDIO_LATENCY:a.currentAudioLatencyInSeconds=c.message.latency}}function zc(a,c){c=eb(c);switch(c.message.type){case B.SET_JOYPAD_STATE:a.wasmInstance.exports.setJoypadState.apply(a,c.message.setJoypadStateParamsAsArray)}}function $b(a){if(!a.wasmByteMemory)return new Uint8Array;let c=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327],b=void 0;if(0===c)return new Uint8Array;1<=c&&3>=c?b=32768:5<=c&&6>=c?b=2048:15<=c&&19>=c?b=32768:25<=c&&30>=c&&(b=131072);return b?a.wasmByteMemory.slice(a.WASMBOY_GAME_RAM_BANKS_LOCATION,
a.WASMBOY_GAME_RAM_BANKS_LOCATION+b):new Uint8Array}function ac(a){a.wasmInstance.exports.saveState();return a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_STATE_LOCATION,a.WASMBOY_INTERNAL_STATE_LOCATION+a.WASMBOY_INTERNAL_STATE_SIZE)}function Ac(a,c){c=eb(c);switch(c.message.type){case B.CLEAR_MEMORY:for(var b=0;b<=a.wasmByteMemory.length;b++)a.wasmByteMemory[b]=0;b=a.wasmByteMemory.slice(0);a.memoryWorkerPort.postMessage(O({type:B.CLEAR_MEMORY_DONE,wasmByteMemory:b.buffer},c.messageId),[b.buffer]);
break;case B.GET_CONSTANTS:a.WASMBOY_BOOT_ROM_LOCATION=a.wasmInstance.exports.BOOT_ROM_LOCATION.valueOf();a.WASMBOY_GAME_BYTES_LOCATION=a.wasmInstance.exports.CARTRIDGE_ROM_LOCATION.valueOf();a.WASMBOY_GAME_RAM_BANKS_LOCATION=a.wasmInstance.exports.CARTRIDGE_RAM_LOCATION.valueOf();a.WASMBOY_INTERNAL_STATE_SIZE=a.wasmInstance.exports.WASMBOY_STATE_SIZE.valueOf();a.WASMBOY_INTERNAL_STATE_LOCATION=a.wasmInstance.exports.WASMBOY_STATE_LOCATION.valueOf();a.WASMBOY_INTERNAL_MEMORY_SIZE=a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_SIZE.valueOf();
a.WASMBOY_INTERNAL_MEMORY_LOCATION=a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_LOCATION.valueOf();a.WASMBOY_PALETTE_MEMORY_SIZE=a.wasmInstance.exports.GBC_PALETTE_SIZE.valueOf();a.WASMBOY_PALETTE_MEMORY_LOCATION=a.wasmInstance.exports.GBC_PALETTE_LOCATION.valueOf();a.memoryWorkerPort.postMessage(O({type:B.GET_CONSTANTS_DONE,WASMBOY_BOOT_ROM_LOCATION:a.wasmInstance.exports.BOOT_ROM_LOCATION.valueOf(),WASMBOY_GAME_BYTES_LOCATION:a.wasmInstance.exports.CARTRIDGE_ROM_LOCATION.valueOf(),WASMBOY_GAME_RAM_BANKS_LOCATION:a.wasmInstance.exports.CARTRIDGE_RAM_LOCATION.valueOf(),
WASMBOY_INTERNAL_STATE_SIZE:a.wasmInstance.exports.WASMBOY_STATE_SIZE.valueOf(),WASMBOY_INTERNAL_STATE_LOCATION:a.wasmInstance.exports.WASMBOY_STATE_LOCATION.valueOf(),WASMBOY_INTERNAL_MEMORY_SIZE:a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_SIZE.valueOf(),WASMBOY_INTERNAL_MEMORY_LOCATION:a.wasmInstance.exports.GAMEBOY_INTERNAL_MEMORY_LOCATION.valueOf(),WASMBOY_PALETTE_MEMORY_SIZE:a.wasmInstance.exports.GBC_PALETTE_SIZE.valueOf(),WASMBOY_PALETTE_MEMORY_LOCATION:a.wasmInstance.exports.GBC_PALETTE_LOCATION.valueOf()},
c.messageId));break;case B.SET_MEMORY:b=Object.keys(c.message);b.includes(C.BOOT_ROM)&&a.wasmByteMemory.set(new Uint8Array(c.message[C.BOOT_ROM]),a.WASMBOY_BOOT_ROM_LOCATION);b.includes(C.CARTRIDGE_ROM)&&a.wasmByteMemory.set(new Uint8Array(c.message[C.CARTRIDGE_ROM]),a.WASMBOY_GAME_BYTES_LOCATION);b.includes(C.CARTRIDGE_RAM)&&a.wasmByteMemory.set(new Uint8Array(c.message[C.CARTRIDGE_RAM]),a.WASMBOY_GAME_RAM_BANKS_LOCATION);b.includes(C.GAMEBOY_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(c.message[C.GAMEBOY_MEMORY]),
a.WASMBOY_INTERNAL_MEMORY_LOCATION);b.includes(C.PALETTE_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(c.message[C.PALETTE_MEMORY]),a.WASMBOY_PALETTE_MEMORY_LOCATION);b.includes(C.INTERNAL_STATE)&&(a.wasmByteMemory.set(new Uint8Array(c.message[C.INTERNAL_STATE]),a.WASMBOY_INTERNAL_STATE_LOCATION),a.wasmInstance.exports.loadState());a.memoryWorkerPort.postMessage(O({type:B.SET_MEMORY_DONE},c.messageId));break;case B.GET_MEMORY:{b={type:B.GET_MEMORY};let W=[];var d=c.message.memoryTypes;if(d.includes(C.BOOT_ROM)){if(a.wasmByteMemory){var e=
a.wasmInstance.exports.BOOT_ROM_LOCATION.valueOf();e=a.wasmByteMemory.slice(e,e+a.wasmInstance.exports.BOOT_ROM_SIZE.valueOf())}else e=new Uint8Array;e=e.buffer;b[C.BOOT_ROM]=e;W.push(e)}if(d.includes(C.CARTRIDGE_ROM)){if(a.wasmByteMemory){e=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327];var g=void 0;0===e?g=32768:1<=e&&3>=e?g=2097152:5<=e&&6>=e?g=262144:15<=e&&19>=e?g=2097152:25<=e&&30>=e&&(g=8388608);e=g?a.wasmByteMemory.slice(a.WASMBOY_GAME_BYTES_LOCATION,a.WASMBOY_GAME_BYTES_LOCATION+g):
new Uint8Array}else e=new Uint8Array;e=e.buffer;b[C.CARTRIDGE_ROM]=e;W.push(e)}d.includes(C.CARTRIDGE_RAM)&&(e=$b(a).buffer,b[C.CARTRIDGE_RAM]=e,W.push(e));d.includes(C.CARTRIDGE_HEADER)&&(a.wasmByteMemory?(e=a.WASMBOY_GAME_BYTES_LOCATION+308,e=a.wasmByteMemory.slice(e,e+27)):e=new Uint8Array,e=e.buffer,b[C.CARTRIDGE_HEADER]=e,W.push(e));d.includes(C.GAMEBOY_MEMORY)&&(e=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer,
b[C.GAMEBOY_MEMORY]=e,W.push(e));d.includes(C.PALETTE_MEMORY)&&(e=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer,b[C.PALETTE_MEMORY]=e,W.push(e));d.includes(C.INTERNAL_STATE)&&(a.wasmInstance.exports.saveState(),d=ac(a).buffer,b[C.INTERNAL_STATE]=d,W.push(d));a.memoryWorkerPort.postMessage(O(b,c.messageId),W)}}}function pb(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function A(a){pb(7,
a)}function x(a){pb(6,a)}function K(a){pb(5,a)}function M(a){pb(4,a)}function Sa(){return b.registerF>>7&1}function T(){return b.registerF>>4&1}function R(a,c){0<=c?K(0!==((a&15)+(c&15)&16)):K((Math.abs(c)&15)>(a&15))}function Db(a,c){0<=c?M(a>(a+c&255)):M(Math.abs(c)>a)}function Wa(a,c,b){b?(a=a^c^a+c,K(0!==(a&16)),M(0!==(a&256))):(b=a+c&65535,M(b<a),K(0!==((a^c^b)&4096)))}function bc(a){switch(a){case 0:d.bgWhite=N.bgWhite;d.bgLightGrey=N.bgLightGrey;d.bgDarkGrey=N.bgDarkGrey;d.bgBlack=N.bgBlack;
d.obj0White=N.obj0White;d.obj0LightGrey=N.obj0LightGrey;d.obj0DarkGrey=N.obj0DarkGrey;d.obj0Black=N.obj0Black;d.obj1White=N.obj1White;d.obj1LightGrey=N.obj1LightGrey;d.obj1DarkGrey=N.obj1DarkGrey;d.obj1Black=N.obj1Black;break;case 1:d.bgWhite=ia.bgWhite;d.bgLightGrey=ia.bgLightGrey;d.bgDarkGrey=ia.bgDarkGrey;d.bgBlack=ia.bgBlack;d.obj0White=ia.obj0White;d.obj0LightGrey=ia.obj0LightGrey;d.obj0DarkGrey=ia.obj0DarkGrey;d.obj0Black=ia.obj0Black;d.obj1White=ia.obj1White;d.obj1LightGrey=ia.obj1LightGrey;
d.obj1DarkGrey=ia.obj1DarkGrey;d.obj1Black=ia.obj1Black;break;case 2:d.bgWhite=ja.bgWhite;d.bgLightGrey=ja.bgLightGrey;d.bgDarkGrey=ja.bgDarkGrey;d.bgBlack=ja.bgBlack;d.obj0White=ja.obj0White;d.obj0LightGrey=ja.obj0LightGrey;d.obj0DarkGrey=ja.obj0DarkGrey;d.obj0Black=ja.obj0Black;d.obj1White=ja.obj1White;d.obj1LightGrey=ja.obj1LightGrey;d.obj1DarkGrey=ja.obj1DarkGrey;d.obj1Black=ja.obj1Black;break;case 3:d.bgWhite=ka.bgWhite;d.bgLightGrey=ka.bgLightGrey;d.bgDarkGrey=ka.bgDarkGrey;d.bgBlack=ka.bgBlack;
d.obj0White=ka.obj0White;d.obj0LightGrey=ka.obj0LightGrey;d.obj0DarkGrey=ka.obj0DarkGrey;d.obj0Black=ka.obj0Black;d.obj1White=ka.obj1White;d.obj1LightGrey=ka.obj1LightGrey;d.obj1DarkGrey=ka.obj1DarkGrey;d.obj1Black=ka.obj1Black;break;case 4:d.bgWhite=la.bgWhite;d.bgLightGrey=la.bgLightGrey;d.bgDarkGrey=la.bgDarkGrey;d.bgBlack=la.bgBlack;d.obj0White=la.obj0White;d.obj0LightGrey=la.obj0LightGrey;d.obj0DarkGrey=la.obj0DarkGrey;d.obj0Black=la.obj0Black;d.obj1White=la.obj1White;d.obj1LightGrey=la.obj1LightGrey;
d.obj1DarkGrey=la.obj1DarkGrey;d.obj1Black=la.obj1Black;break;case 5:d.bgWhite=ma.bgWhite;d.bgLightGrey=ma.bgLightGrey;d.bgDarkGrey=ma.bgDarkGrey;d.bgBlack=ma.bgBlack;d.obj0White=ma.obj0White;d.obj0LightGrey=ma.obj0LightGrey;d.obj0DarkGrey=ma.obj0DarkGrey;d.obj0Black=ma.obj0Black;d.obj1White=ma.obj1White;d.obj1LightGrey=ma.obj1LightGrey;d.obj1DarkGrey=ma.obj1DarkGrey;d.obj1Black=ma.obj1Black;break;case 6:d.bgWhite=na.bgWhite;d.bgLightGrey=na.bgLightGrey;d.bgDarkGrey=na.bgDarkGrey;d.bgBlack=na.bgBlack;
d.obj0White=na.obj0White;d.obj0LightGrey=na.obj0LightGrey;d.obj0DarkGrey=na.obj0DarkGrey;d.obj0Black=na.obj0Black;d.obj1White=na.obj1White;d.obj1LightGrey=na.obj1LightGrey;d.obj1DarkGrey=na.obj1DarkGrey;d.obj1Black=na.obj1Black;break;case 7:d.bgWhite=oa.bgWhite;d.bgLightGrey=oa.bgLightGrey;d.bgDarkGrey=oa.bgDarkGrey;d.bgBlack=oa.bgBlack;d.obj0White=oa.obj0White;d.obj0LightGrey=oa.obj0LightGrey;d.obj0DarkGrey=oa.obj0DarkGrey;d.obj0Black=oa.obj0Black;d.obj1White=oa.obj1White;d.obj1LightGrey=oa.obj1LightGrey;
d.obj1DarkGrey=oa.obj1DarkGrey;d.obj1Black=oa.obj1Black;break;case 8:d.bgWhite=pa.bgWhite;d.bgLightGrey=pa.bgLightGrey;d.bgDarkGrey=pa.bgDarkGrey;d.bgBlack=pa.bgBlack;d.obj0White=pa.obj0White;d.obj0LightGrey=pa.obj0LightGrey;d.obj0DarkGrey=pa.obj0DarkGrey;d.obj0Black=pa.obj0Black;d.obj1White=pa.obj1White;d.obj1LightGrey=pa.obj1LightGrey;d.obj1DarkGrey=pa.obj1DarkGrey;d.obj1Black=pa.obj1Black;break;case 9:d.bgWhite=qa.bgWhite;d.bgLightGrey=qa.bgLightGrey;d.bgDarkGrey=qa.bgDarkGrey;d.bgBlack=qa.bgBlack;
d.obj0White=qa.obj0White;d.obj0LightGrey=qa.obj0LightGrey;d.obj0DarkGrey=qa.obj0DarkGrey;d.obj0Black=qa.obj0Black;d.obj1White=qa.obj1White;d.obj1LightGrey=qa.obj1LightGrey;d.obj1DarkGrey=qa.obj1DarkGrey;d.obj1Black=qa.obj1Black;break;case 10:d.bgWhite=ra.bgWhite;d.bgLightGrey=ra.bgLightGrey;d.bgDarkGrey=ra.bgDarkGrey;d.bgBlack=ra.bgBlack;d.obj0White=ra.obj0White;d.obj0LightGrey=ra.obj0LightGrey;d.obj0DarkGrey=ra.obj0DarkGrey;d.obj0Black=ra.obj0Black;d.obj1White=ra.obj1White;d.obj1LightGrey=ra.obj1LightGrey;
d.obj1DarkGrey=ra.obj1DarkGrey;d.obj1Black=ra.obj1Black;break;case 11:d.bgWhite=sa.bgWhite;d.bgLightGrey=sa.bgLightGrey;d.bgDarkGrey=sa.bgDarkGrey;d.bgBlack=sa.bgBlack;d.obj0White=sa.obj0White;d.obj0LightGrey=sa.obj0LightGrey;d.obj0DarkGrey=sa.obj0DarkGrey;d.obj0Black=sa.obj0Black;d.obj1White=sa.obj1White;d.obj1LightGrey=sa.obj1LightGrey;d.obj1DarkGrey=sa.obj1DarkGrey;d.obj1Black=sa.obj1Black;break;case 12:d.bgWhite=ta.bgWhite,d.bgLightGrey=ta.bgLightGrey,d.bgDarkGrey=ta.bgDarkGrey,d.bgBlack=ta.bgBlack,
d.obj0White=ta.obj0White,d.obj0LightGrey=ta.obj0LightGrey,d.obj0DarkGrey=ta.obj0DarkGrey,d.obj0Black=ta.obj0Black,d.obj1White=ta.obj1White,d.obj1LightGrey=ta.obj1LightGrey,d.obj1DarkGrey=ta.obj1DarkGrey,d.obj1Black=ta.obj1Black}}function l(a,c){return(a&255)<<8|c&255}function I(a){return(a&65280)>>8}function H(a,c){return c&~(1<<a)}function g(a,c){return 0!=(c&1<<a)}function qb(a,c){a=v(c)>>2*a&3;if(c===Xa.memoryLocationSpritePaletteOne)switch(c=d.obj0White,a){case 1:c=d.obj0LightGrey;break;case 2:c=
d.obj0DarkGrey;break;case 3:c=d.obj0Black}else if(c===Xa.memoryLocationSpritePaletteTwo)switch(c=d.obj1White,a){case 1:c=d.obj1LightGrey;break;case 2:c=d.obj1DarkGrey;break;case 3:c=d.obj1Black}else switch(c=d.bgWhite,a){case 1:c=d.bgLightGrey;break;case 2:c=d.bgDarkGrey;break;case 3:c=d.bgBlack}return c}function rb(a,c,b){c=8*a+2*c;a=cc(c+1,b);b=cc(c,b);return l(a,b)}function ua(a,c){a*=5;return 8*((c&31<<a)>>a)}function cc(a,c){a&=63;c&&(a+=64);return e[Ya+a]}function sb(a,c,b,d){void 0===b&&(b=
0);void 0===d&&(d=!1);b&=3;d&&(b|=4);e[Za+(160*c+a)]=b}function Eb(a,c,W,d,z,f,n,h,k,p,m,q,l,w){var G=0;c=gb(c,a);a=X(c+2*f,W);W=X(c+2*f+1,W);for(f=d;f<=z;++f)if(c=n+(f-d),c<k){var P=f;if(0>l||!g(5,l))P=7-P;var Va=0;g(P,W)&&(Va+=1,Va<<=1);g(P,a)&&(Va+=1);if(b.GBCEnabled&&(0<=l||0<=w)){P=0<=w;var fa=l&7;P&&(fa=w&7);var ha=rb(fa,Va,P);P=ua(0,ha);fa=ua(1,ha);ha=ua(2,ha)}else if(0>=q&&(q=r.memoryLocationBackgroundPalette),m){fa=Va;ha=m;void 0===ha&&(ha=!1);P=fa;ha||(P=v(q)>>(fa<<1)&3);fa=242;switch(P){case 1:fa=
160;break;case 2:fa=88;break;case 3:fa=8}fa=P=ha=fa}else ha=qb(Va,q),P=(ha&16711680)>>16,fa=(ha&65280)>>8,ha&=255;var Cb=3*(h*k+c);e[p+Cb+0]=P;e[p+Cb+1]=fa;e[p+Cb+2]=ha;P=!1;0<=l&&(P=g(7,l));sb(c,h,Va,P);G++}return G}function gb(a,c){a===r.memoryLocationTileDataSelectZeroStart&&(c=g(7,c)?c-128:c+128);return a+16*c}function dc(a,c){switch(a){case 1:return g(c,129);case 2:return g(c,135);case 3:return g(c,126);default:return g(c,1)}}function Fb(){var a=y.sweepShadowFrequency,c=a>>y.NRx0SweepShift;y.NRx0Negate?
(y.sweepNegateShouldDisableChannelOnClear=!0,c=a-c):c=a+c;return c}function tb(a){switch(a){case y.channelNumber:a=y.isDacEnabled;var c=p.channel1DacEnabled!==a;p.channel1DacEnabled=a;return c;case D.channelNumber:return a=D.isDacEnabled,c=p.channel2DacEnabled!==a,p.channel2DacEnabled=a,c;case t.channelNumber:return a=t.isDacEnabled,c=p.channel3DacEnabled!==a,p.channel3DacEnabled=a,c;case F.channelNumber:return a=F.isDacEnabled,c=p.channel4DacEnabled!==a,p.channel4DacEnabled=a,c}return!1}function hb(){for(var a=
h.batchProcessCycles(),c=h.currentCycles;c>=a;)ec(a),c-=a;h.currentCycles=c}function ec(a){var c=h.maxFrameSequenceCycles();var b=h.frameSequenceCycleCounter+a;if(b>=c){h.frameSequenceCycleCounter=b-c;c=h.frameSequencer+1&7;switch(c){case 0:y.updateLength();D.updateLength();t.updateLength();F.updateLength();break;case 2:y.updateLength();D.updateLength();t.updateLength();F.updateLength();y.updateSweep();break;case 4:y.updateLength();D.updateLength();t.updateLength();F.updateLength();break;case 6:y.updateLength();
D.updateLength();t.updateLength();F.updateLength();y.updateSweep();break;case 7:y.updateEnvelope(),D.updateEnvelope(),F.updateEnvelope()}h.frameSequencer=c;c=!0}else h.frameSequenceCycleCounter=b,c=!1;if(Q.audioAccumulateSamples&&!c){c=y.willChannelUpdate(a)||tb(y.channelNumber);b=D.willChannelUpdate(a)||tb(D.channelNumber);var e=t.willChannelUpdate(a)||tb(t.channelNumber),d=F.willChannelUpdate(a)||tb(F.channelNumber);c&&(p.channel1Sample=y.getSampleFromCycleCounter());b&&(p.channel2Sample=D.getSampleFromCycleCounter());
e&&(p.channel3Sample=t.getSampleFromCycleCounter());d&&(p.channel4Sample=F.getSampleFromCycleCounter());if(c||b||e||d)p.needToRemixSamples=!0;c=h.downSampleCycleCounter;c+=a;a=h.maxDownSampleCycles();c>=a&&(c-=a,p.needToRemixSamples||p.mixerVolumeChanged||p.mixerEnabledChanged?$a(p.channel1Sample,p.channel2Sample,p.channel3Sample,p.channel4Sample):h.downSampleCycleCounter=c,ab(p.leftChannelSampleUnsignedByte+1,p.rightChannelSampleUnsignedByte+1,ub),a=h.audioQueueIndex+1,a>=(h.wasmBoyMemoryMaxBufferSize>>
1|0)-1&&--a,h.audioQueueIndex=a);h.downSampleCycleCounter=c}else{c=y.getSample(a)|0;b=D.getSample(a)|0;e=t.getSample(a)|0;d=F.getSample(a)|0;p.channel1Sample=c;p.channel2Sample=b;p.channel3Sample=e;p.channel4Sample=d;a=h.downSampleCycleCounter+a;if(a>=h.maxDownSampleCycles()){a-=h.maxDownSampleCycles();var g=$a(c,b,e,d),f=I(g);ab(f+1,(g&255)+1,ub);Q.enableAudioDebugging&&(g=$a(c,15,15,15),f=I(g),ab(f+1,(g&255)+1,Gb),g=$a(15,b,15,15),f=I(g),ab(f+1,(g&255)+1,Hb),g=$a(15,15,e,15),f=I(g),ab(f+1,(g&255)+
1,Ib),g=$a(15,15,15,d),f=I(g),ab(f+1,(g&255)+1,Jb));c=h.audioQueueIndex+1;c>=(h.wasmBoyMemoryMaxBufferSize>>1|0)-1&&--c;h.audioQueueIndex=c}h.downSampleCycleCounter=a}}function fc(){return h.audioQueueIndex}function gc(){h.audioQueueIndex=0}function $a(a,c,b,e){void 0===a&&(a=15);void 0===c&&(c=15);void 0===b&&(b=15);void 0===e&&(e=15);p.mixerVolumeChanged=!1;var d=0+(h.NR51IsChannel1EnabledOnLeftOutput?a:15);d+=h.NR51IsChannel2EnabledOnLeftOutput?c:15;d+=h.NR51IsChannel3EnabledOnLeftOutput?b:15;
d+=h.NR51IsChannel4EnabledOnLeftOutput?e:15;a=0+(h.NR51IsChannel1EnabledOnRightOutput?a:15);a+=h.NR51IsChannel2EnabledOnRightOutput?c:15;a+=h.NR51IsChannel3EnabledOnRightOutput?b:15;a+=h.NR51IsChannel4EnabledOnRightOutput?e:15;p.mixerEnabledChanged=!1;p.needToRemixSamples=!1;c=hc(d,h.NR50LeftMixerVolume+1);b=hc(a,h.NR50RightMixerVolume+1);p.leftChannelSampleUnsignedByte=c;p.rightChannelSampleUnsignedByte=b;return l(c,b)}function hc(a,c){if(60===a)return 127;a=1E5*(a-60)*c>>3;a=(a/1E5|0)+60;a=1E5*
a/(12E6/254|0)|0;return a|=0}function ab(a,c,b){b+=h.audioQueueIndex<<1;e[b+0]=a+1;e[b+1]=c+1}function Bc(a){switch(a){case y.memoryLocationNRx0:return a=v(y.memoryLocationNRx0),a|128;case D.memoryLocationNRx0:return a=v(D.memoryLocationNRx0),a|255;case t.memoryLocationNRx0:return a=v(t.memoryLocationNRx0),a|127;case F.memoryLocationNRx0:return a=v(F.memoryLocationNRx0),a|255;case h.memoryLocationNR50:return a=v(h.memoryLocationNR50),a|0;case y.memoryLocationNRx1:return a=v(y.memoryLocationNRx1),
a|63;case D.memoryLocationNRx1:return a=v(D.memoryLocationNRx1),a|63;case t.memoryLocationNRx1:return a=v(t.memoryLocationNRx1),a|255;case F.memoryLocationNRx1:return a=v(F.memoryLocationNRx1),a|255;case h.memoryLocationNR51:return a=v(h.memoryLocationNR51),a|0;case y.memoryLocationNRx2:return a=v(y.memoryLocationNRx2),a|0;case D.memoryLocationNRx2:return a=v(D.memoryLocationNRx2),a|0;case t.memoryLocationNRx2:return a=v(t.memoryLocationNRx2),a|159;case F.memoryLocationNRx2:return a=v(F.memoryLocationNRx2),
a|0;case h.memoryLocationNR52:return a=0,a=h.NR52IsSoundEnabled?a|128:H(7,a),a=y.isEnabled?a|1:H(0,a),a=D.isEnabled?a|2:H(1,a),a=t.isEnabled?a|4:H(2,a),a=F.isEnabled?a|8:H(3,a),a|112;case y.memoryLocationNRx3:return a=v(y.memoryLocationNRx3),a|255;case D.memoryLocationNRx3:return a=v(D.memoryLocationNRx3),a|255;case t.memoryLocationNRx3:return a=v(t.memoryLocationNRx3),a|255;case F.memoryLocationNRx3:return a=v(F.memoryLocationNRx3),a|0;case y.memoryLocationNRx4:return a=v(y.memoryLocationNRx4),a|
191;case D.memoryLocationNRx4:return a=v(D.memoryLocationNRx4),a|191;case t.memoryLocationNRx4:return a=v(t.memoryLocationNRx4),a|191;case F.memoryLocationNRx4:return a=v(F.memoryLocationNRx4),a|191}return-1}function ib(a){vb(!1);var c=v(m.memoryLocationInterruptRequest);c=H(a,c);m.interruptsRequestedValue=c;f(m.memoryLocationInterruptRequest,c);b.stackPointer-=2;b.isHalted();c=b.stackPointer;var e=b.programCounter,d=I(e);f(c+0,e&255);f(c+1,d);switch(a){case m.bitPositionVBlankInterrupt:m.isVBlankInterruptRequested=
!1;b.programCounter=64;break;case m.bitPositionLcdInterrupt:m.isLcdInterruptRequested=!1;b.programCounter=72;break;case m.bitPositionTimerInterrupt:m.isTimerInterruptRequested=!1;b.programCounter=80;break;case m.bitPositionSerialInterrupt:m.isSerialInterruptRequested=!1;b.programCounter=88;break;case m.bitPositionJoypadInterrupt:m.isJoypadInterruptRequested=!1,b.programCounter=96}}function bb(a){var c=v(m.memoryLocationInterruptRequest);c|=1<<a;m.interruptsRequestedValue=c;f(m.memoryLocationInterruptRequest,
c)}function vb(a){a?m.masterInterruptSwitchDelay=!0:m.masterInterruptSwitch=!1}function Kb(a){for(var c=0;c<a;){var b=w.dividerRegister,e=b;c+=4;e+=4;e&=65535;w.dividerRegister=e;if(w.timerEnabled){var d=w.timerCounterWasReset;w.timerCounterOverflowDelay?(w.timerCounter=w.timerModulo,m.isTimerInterruptRequested=!0,bb(m.bitPositionTimerInterrupt),w.timerCounterOverflowDelay=!1,w.timerCounterWasReset=!0):d&&(w.timerCounterWasReset=!1);ic(b,e)&&Lb()}}}function Lb(){var a=w.timerCounter;255<++a&&(w.timerCounterOverflowDelay=
!0,a=0);w.timerCounter=a}function ic(a,c){var b=Mb(w.timerInputClock);return g(b,a)&&!g(b,c)}function Mb(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function Ta(a){var c=b.isStopped=!1;Cc(a)||(c=!0);Ia(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,E.isDpadType&&c&&(a=!0),E.isButtonType&&!c&&(a=!0),a&&(m.isJoypadInterruptRequested=!0,bb(m.bitPositionJoypadInterrupt)))}function Cc(a){switch(a){case 0:return E.up;case 1:return E.right;case 2:return E.down;case 3:return E.left;
case 4:return E.a;case 5:return E.b;case 6:return E.select;case 7:return E.start;default:return!1}}function Ia(a,c){switch(a){case 0:E.up=c;break;case 1:E.right=c;break;case 2:E.down=c;break;case 3:E.left=c;break;case 4:E.a=c;break;case 5:E.b=c;break;case 6:E.select=c;break;case 7:E.start=c}}function jc(a,c,e){for(var d=0;d<e;++d){for(var W=Nb(a+d),g=c+d;40959<g;)g-=8192;Ob(g,W)}n.DMACycles+=(32<<b.GBCDoubleSpeed)*(e>>4)}function Pb(a,c){if(a===b.memoryLocationSpeedSwitch)return f(b.memoryLocationSpeedSwitch,
c&1),!1;if(b.BootROMEnabled&&a===b.memoryLocationBootROMSwitch)return b.BootROMEnabled=!1,b.programCounter=255,!0;var d=n.videoRamLocation,G=n.spriteInformationTableLocation;if(a<d){if(!n.isRomOnly){d=n.isMBC1;var z=n.isMBC2;if(8191>=a){if(!z||g(4,c))c&=15,0===c?n.isRamBankingEnabled=!1:10===c&&(n.isRamBankingEnabled=!0)}else 16383>=a?(G=n.isMBC5,!G||12287>=a?(a=n.currentRomBank,z&&(a=c&15),d?(c&=31,a&=224):n.isMBC3?(c&=127,a&=128):G&&(a&=0),n.currentRomBank=a|c):n.currentRomBank=l(0<c,n.currentRomBank&
255)):!z&&24575>=a?d&&n.isMBC1RomModeEnabled?(a=n.currentRomBank&31,n.currentRomBank=a|c&224):(c=n.isMBC5?c&15:c&3,n.currentRamBank=c):!z&&32767>=a&&d&&(n.isMBC1RomModeEnabled=g(0,c))}return!1}if(a>=d&&a<n.cartridgeRamLocation)return!0;if(a>=n.echoRamLocation&&a<G)return f(a-8192,c),!0;if(a>=G&&a<=n.spriteInformationTableLocationEnd)return 2<=u.currentLcdMode;if(a>=n.unusableMemoryLocation&&a<=n.unusableMemoryEndLocation)return!1;if(a===Z.memoryLocationSerialTransferControl)return Z.updateTransferControl(c);
if(65296<=a&&65318>=a){hb();if(a===h.memoryLocationNR52||h.NR52IsSoundEnabled){switch(a){case y.memoryLocationNRx0:y.updateNRx0(c);break;case t.memoryLocationNRx0:t.updateNRx0(c);break;case y.memoryLocationNRx1:y.updateNRx1(c);break;case D.memoryLocationNRx1:D.updateNRx1(c);break;case t.memoryLocationNRx1:t.updateNRx1(c);break;case F.memoryLocationNRx1:F.updateNRx1(c);break;case y.memoryLocationNRx2:y.updateNRx2(c);break;case D.memoryLocationNRx2:D.updateNRx2(c);break;case t.memoryLocationNRx2:t.volumeCodeChanged=
!0;t.updateNRx2(c);break;case F.memoryLocationNRx2:F.updateNRx2(c);break;case y.memoryLocationNRx3:y.updateNRx3(c);break;case D.memoryLocationNRx3:D.updateNRx3(c);break;case t.memoryLocationNRx3:t.updateNRx3(c);break;case F.memoryLocationNRx3:F.updateNRx3(c);break;case y.memoryLocationNRx4:y.updateNRx4(c);break;case D.memoryLocationNRx4:D.updateNRx4(c);break;case t.memoryLocationNRx4:t.updateNRx4(c);break;case F.memoryLocationNRx4:F.updateNRx4(c);break;case h.memoryLocationNR50:h.updateNR50(c);p.mixerVolumeChanged=
!0;break;case h.memoryLocationNR51:h.updateNR51(c);p.mixerEnabledChanged=!0;break;case h.memoryLocationNR52:a=h.NR52IsSoundEnabled;!a&&g(7,c)&&(h.frameSequencer=7,y.waveFormPositionOnDuty=0,D.waveFormPositionOnDuty=0);if(a&&!g(7,c))for(a=65296;65318>a;++a)Ob(a,0);h.updateNR52(c)}c=!0}else c=!1;return c}if(65328<=a&&65343>=a)return hb(),t.isEnabled?(t.handleWaveRamWrite(c),!1):!0;if(a>=u.memoryLocationLcdControl&&a<=r.memoryLocationWindowX){if(a===u.memoryLocationLcdControl)return u.updateLcdControl(c),
!0;if(a===u.memoryLocationLcdStatus)return u.updateLcdStatus(c),!1;if(a===r.memoryLocationScanlineRegister)return r.scanlineRegister=0,f(a,0),!1;if(a===u.memoryLocationCoincidenceCompare)return u.coincidenceCompare=c,!0;if(a===r.memoryLocationDmaTransfer){c<<=8;for(a=0;159>=a;++a)d=v(c+a),f(n.spriteInformationTableLocation+a,d);n.DMACycles=644;return!0}switch(a){case r.memoryLocationScrollX:r.scrollX=c;break;case r.memoryLocationScrollY:r.scrollY=c;break;case r.memoryLocationWindowX:r.windowX=c;break;
case r.memoryLocationWindowY:r.windowY=c}return!0}if(a===n.memoryLocationHdmaTrigger)return b.GBCEnabled&&(n.isHblankHdmaActive&&!g(7,c)?(n.isHblankHdmaActive=!1,c=v(n.memoryLocationHdmaTrigger),f(n.memoryLocationHdmaTrigger,c|128)):(a=v(n.memoryLocationHdmaSourceHigh),d=v(n.memoryLocationHdmaSourceLow),a=l(a,d)&65520,d=v(n.memoryLocationHdmaDestinationHigh),G=v(n.memoryLocationHdmaDestinationLow),d=l(d,G),d=(d&8176)+n.videoRamLocation,G=H(7,c),G=G+1<<4,g(7,c)?(n.isHblankHdmaActive=!0,n.hblankHdmaTransferLengthRemaining=
G,n.hblankHdmaSource=a,n.hblankHdmaDestination=d,f(n.memoryLocationHdmaTrigger,H(7,c))):(jc(a,d,G),f(n.memoryLocationHdmaTrigger,255)))),!1;if((a===n.memoryLocationGBCWRAMBank||a===n.memoryLocationGBCVRAMBank)&&n.isHblankHdmaActive&&(d=n.hblankHdmaSource,16384<=d&&32767>=d||53248<=d&&57343>=d))return!1;if(a>=Xa.memoryLocationBackgroundPaletteIndex&&a<=Xa.memoryLocationSpritePaletteData){d=Xa.memoryLocationSpritePaletteData;if(a===Xa.memoryLocationBackgroundPaletteData||a===d)G=v(a-1),G=H(6,G),z=G&
63,a===d&&(z+=64),e[Ya+z]=c,c=G,--a,g(7,c)&&f(a,c+1|128);return!0}if(a>=w.memoryLocationDividerRegister&&a<=w.memoryLocationTimerControl){Kb(w.currentCycles);w.currentCycles=0;switch(a){case w.memoryLocationDividerRegister:return w.updateDividerRegister(),!1;case w.memoryLocationTimerCounter:w.updateTimerCounter(c);break;case w.memoryLocationTimerModulo:w.updateTimerModulo(c);break;case w.memoryLocationTimerControl:w.updateTimerControl(c)}return!0}a===E.memoryLocationJoypadRegister&&E.updateJoypad(c);
if(a===m.memoryLocationInterruptRequest)return m.updateInterruptRequested(c),!0;a===m.memoryLocationInterruptEnabled&&m.updateInterruptEnabled(c);return!0}function Qb(a){switch(a>>12){case 0:if(b.BootROMEnabled)if(b.GBCEnabled){if(256>a||511<a&&2304>a)return a+wb}else if(!b.GBCEnabled&&256>a)return a+wb;case 1:case 2:case 3:return a+xb;case 4:case 5:case 6:case 7:var c=n.currentRomBank;n.isMBC5||0!==c||(c=1);return 16384*c+(a-n.switchableCartridgeRomLocation)+xb;case 8:case 9:return c=0,b.GBCEnabled&&
(c=v(n.memoryLocationGBCVRAMBank)&1),a-n.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*n.currentRamBank+(a-n.cartridgeRamLocation)+Rb;case 12:return a-n.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=v(n.memoryLocationGBCWRAMBank)&7),a-n.internalRamBankZeroLocation+18432+4096*((1>c?1:c)-1);default:return a-n.echoRamLocation+51200}}function f(a,c){a=Qb(a);e[a]=c}function Ob(a,c){a===aa.writeGbMemory&&(aa.reachedBreakpoint=!0);Pb(a,c)&&f(a,c)}function kc(a){r.scanlineCycleCounter=
0;r.scanlineRegister=0;f(r.memoryLocationScanlineRegister,0);var c=v(u.memoryLocationLcdStatus);c=H(1,c);c=H(0,c);u.currentLcdMode=0;f(u.memoryLocationLcdStatus,c);if(a)for(a=0;93184>a;++a)e[cb+a]=255}function lc(a,c){0!==a&&1!==a||r.scanlineRegister!==u.coincidenceCompare?c=H(2,c):(c|=4,g(6,c)&&(m.isLcdInterruptRequested=!0,bb(m.bitPositionLcdInterrupt)));return c}function mc(a,c,d,G,f,n){for(var W=G>>3;160>f;++f){var z=f+n;256<=z&&(z-=256);var h=d+(W<<5)+(z>>3),k=X(h,0),p=!1;if(Q.tileCaching){var m=
f;var l=a,q=z,P=h,w=k,u=0,t=db.nextXIndexToPerformCacheCheck;if(0<l&&8<m&&w===db.tileId&&m===t){w=g(5,v(P-1));P=g(5,v(P));for(var x=0;8>x;++x){w!==P&&(x=7-x);var y=m+x;if(160>=y){var A=m-(8-x),B=cb+3*(160*l+y);ca(y,l,0,e[B]);ca(y,l,1,e[B]);ca(y,l,2,e[B]);A=e[Za+(160*l+A)];sb(y,l,H(2,A),g(2,A));u++}}}else db.tileId=w;m>=t&&(t=m+8,l=q&7|0,m<l&&(t+=l));db.nextXIndexToPerformCacheCheck=t;m=u;0<m&&(f+=m-1,p=!0)}Q.tileRendering&&!p?(p=f,m=a,l=z,z=c,u=G&7|0,t=0,0==p&&(t=l-(l>>3<<3)),l=7,160<p+8&&(l=160-
p),q=-1,w=0,b.GBCEnabled&&(q=X(h,1),w=g(3,q)|0,g(6,q)&&(u=7-u)),m=Eb(k,z,w,t,l,u,p,m,160,cb,!1,0,q,-1),0<m&&(f+=m-1)):p||(b.GBCEnabled?(p=f,m=a,t=G,u=gb(c,k),k=X(h,1),t=t&7|0,g(6,k)&&(t=7-t),l=g(3,k)|0,h=X(u+2*t,l),u=X(u+2*t+1,l),t=z&7|0,g(5,k)||(t=7-t),z=0,g(t,u)&&(z=z+1<<1),g(t,h)&&(z+=1),t=rb(k&7,z,!1),h=ua(0,t),u=ua(1,t),t=ua(2,t),ca(p,m,0,h),ca(p,m,1,u),ca(p,m,2,t),sb(p,m,z,g(7,k))):(h=f,p=a,u=G,m=gb(c,k),u=u&7|0,k=X(m+2*u,0),m=X(m+2*u+1,0),u=z&7|0,u=7-u,z=0,g(u,m)&&(z=z+1<<1),g(u,k)&&(z+=1),
k=qb(z,r.memoryLocationBackgroundPalette),ca(h,p,0,(k&16711680)>>16),ca(h,p,1,(k&65280)>>8),ca(h,p,2,k&255),sb(h,p,z)))}}function nc(a){if(u.enabled)for(r.scanlineCycleCounter+=a,a=Q.graphicsDisableScanlineRendering;r.scanlineCycleCounter>=r.MAX_CYCLES_PER_SCANLINE();){r.scanlineCycleCounter-=r.MAX_CYCLES_PER_SCANLINE();var c=r.scanlineRegister;if(144===c){if(a)for(var b=0;144>=b;++b)Sb(b);else Sb(c);for(b=0;144>b;++b)for(var d=0;160>d;++d)e[Za+(160*b+d)]=0;db.tileId=-1;db.nextXIndexToPerformCacheCheck=
-1}else 144>c&&(a||Sb(c));c=153<c?0:c+1;r.scanlineRegister=c}if(u.enabled){c=r.scanlineRegister;b=u.currentLcdMode;a=0;if(144<=c)a=1;else{d=r.scanlineCycleCounter;var z=r.MIN_CYCLES_SPRITES_LCD_MODE();d>=z?a=2:d>=z&&(a=3)}if(b!==a){c=v(u.memoryLocationLcdStatus);u.currentLcdMode=a;b=!1;switch(a){case 0:c=H(0,c);c=H(1,c);b=g(3,c);break;case 1:c=H(1,c);c|=1;b=g(4,c);break;case 2:c=H(0,c);c|=2;b=g(5,c);break;case 3:c|=3}b&&(m.isLcdInterruptRequested=!0,bb(m.bitPositionLcdInterrupt));0===a&&n.isHblankHdmaActive&&
(d=16,b=n.hblankHdmaTransferLengthRemaining,b<d&&(d=b),jc(n.hblankHdmaSource,n.hblankHdmaDestination,d),n.hblankHdmaSource+=d,n.hblankHdmaDestination+=d,b-=d,n.hblankHdmaTransferLengthRemaining=b,d=n.memoryLocationHdmaTrigger,0>=b?(n.isHblankHdmaActive=!1,f(d,255)):f(d,H(7,(b>>4)-1)));1===a&&(m.isVBlankInterruptRequested=!0,bb(m.bitPositionVBlankInterrupt));c=lc(a,c);f(u.memoryLocationLcdStatus,c)}else 153===c&&(c=v(u.memoryLocationLcdStatus),c=lc(a,c),f(u.memoryLocationLcdStatus,c))}}function Sb(a){var c=
r.memoryLocationTileDataSelectZeroStart;u.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);if(b.GBCEnabled||u.bgDisplayEnabled){var d=r.memoryLocationTileMapSelectZeroStart;u.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);mc(a,c,d,a+r.scrollY&255,0,r.scrollX)}if(u.windowDisplayEnabled){d=r.memoryLocationTileMapSelectZeroStart;u.windowTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);var G=r.windowX,z=r.windowY;a<z||(G-=7,mc(a,c,d,a-z,G,-G|0))}if(u.spriteDisplayEnable)for(c=
u.tallSpriteSize,d=39;0<=d;--d){z=4*d;var f=r.memoryLocationSpriteAttributesTable+z,h=v(f+0);G=v(f+1);var n=v(f+2);h-=16;G-=8;var k=8;c&&(k=16,n-=n&1);if(a>=h&&a<h+k){z=v(r.memoryLocationSpriteAttributesTable+z+3);f=g(7,z);var m=g(6,z),p=g(5,z);h=a-h;m&&(h=k-h,--h);h<<=1;n=gb(r.memoryLocationTileDataSelectOneStart,n);n+=h;k=b.GBCEnabled&&g(3,z);h=X(n+0,k);n=X(n+1,k);for(k=7;0<=k;--k){m=k;p&&(m-=7,m=-m);var l=0;g(m,n)&&(l=l+1<<1);g(m,h)&&(l+=1);if(0!==l&&(m=G+(7-k),0<=m&&160>=m)){var t=b.GBCEnabled&&
!u.bgDisplayEnabled,q=!1,w=!1;if(!t){var x=e[Za+(160*a+m)],y=x&3;f&&0<y?q=!0:b.GBCEnabled&&g(2,x)&&0<y&&(w=!0)}if(t||!q&&!w)b.GBCEnabled?(q=rb(z&7,l,!0),l=ua(0,q),t=ua(1,q),q=ua(2,q),ca(m,a,0,l),ca(m,a,1,t),ca(m,a,2,q)):(t=r.memoryLocationSpritePaletteOne,g(4,z)&&(t=r.memoryLocationSpritePaletteTwo),l=qb(l,t),ca(m,a,0,(l&16711680)>>16),ca(m,a,1,(l&65280)>>8),ca(m,a,2,l&255))}}}}}function ca(a,c,b,d){e[cb+3*(160*c+a)+b]=d}function X(a,c){return e[a-n.videoRamLocation+2048+8192*(c&1)]}function Tb(a){var c=
n.videoRamLocation;return a<c||a>=c&&a<n.cartridgeRamLocation?-1:a>=n.echoRamLocation&&a<n.spriteInformationTableLocation?v(a-8192):a>=n.spriteInformationTableLocation&&a<=n.spriteInformationTableLocationEnd?2>u.currentLcdMode?255:-1:a===b.memoryLocationSpeedSwitch?(a=255,c=v(b.memoryLocationSpeedSwitch),g(0,c)||(a=H(0,a)),b.GBCDoubleSpeed||(a=H(7,a)),a):a===r.memoryLocationScanlineRegister?(f(a,r.scanlineRegister),r.scanlineRegister):65296<=a&&65318>=a?(hb(),Bc(a)):65319<=a&&65327>=a?255:65328<=
a&&65343>=a?(hb(),t.isEnabled?t.handleWaveRamRead():-1):a===w.memoryLocationDividerRegister?(c=I(w.dividerRegister),f(a,c),c):a===w.memoryLocationTimerCounter?(f(a,w.timerCounter),w.timerCounter):a===m.memoryLocationInterruptRequest?224|m.interruptsRequestedValue:a===E.memoryLocationJoypadRegister?(a=E.joypadRegisterFlipped,E.isDpadType?(a=E.up?H(2,a):a|4,a=E.right?H(0,a):a|1,a=E.down?H(3,a):a|8,a=E.left?H(1,a):a|2):E.isButtonType&&(a=E.a?H(0,a):a|1,a=E.b?H(1,a):a|2,a=E.select?H(2,a):a|4,a=E.start?
H(3,a):a|8),a|240):-1}function v(a){return e[Qb(a)]}function Nb(a){a===aa.readGbMemory&&(aa.reachedBreakpoint=!0);var c=Tb(a);return-1===c?v(a):c}function k(a){return 0<e[a]}function Ja(a){var c=b.registerA;R(c,a);Db(c,a);c=c+a&255;b.registerA=c;A(0===c);x(0)}function Ka(a){var c=b.registerA,d=c+a+T()&255;K(0!=((c^a^d)&16));a=c+a+T()&65535;M(0<(a&256));b.registerA=d;A(0===d);x(0)}function La(a){var c=-1*a;var d=b.registerA;R(d,c);Db(d,c);d=d-a&255;b.registerA=d;A(0===d);x(1)}function Ma(a){var c=
b.registerA,d=c-a-T()&255;K(0!=((c^a^d)&16));a=c-a-T()&65535;M(0<(a&256));b.registerA=d;A(0===d);x(1)}function Na(a){a&=b.registerA;b.registerA=a;A(0===a);x(0);K(1);M(0)}function Oa(a){a=(b.registerA^a)&255;b.registerA=a;A(0===a);x(0);K(0);M(0)}function Pa(a){a|=b.registerA;b.registerA=a;A(0===a);x(0);K(0);M(0)}function Qa(a){var c=b.registerA;a*=-1;R(c,a);Db(c,a);A(0===c+a);x(1)}function Ua(a,c){A(0===(c&1<<a));x(0);K(1);return c}function ba(a,c,b){return 0<c?b|1<<a:b&~(1<<a)}function jb(a){var c=
b.programCounter;c=(c+(a<<24>>24)&65535)+1&65535;b.programCounter=c}function oc(a){var c=b.programCounter;c=c+1&65535;b.isHaltBug&&(c=c-1&65535);b.programCounter=c;switch((a&240)>>4){case 0:return Dc(a);case 1:return Ec(a);case 2:return Fc(a);case 3:return Gc(a);case 4:return Hc(a);case 5:return Ic(a);case 6:return Jc(a);case 7:return Kc(a);case 8:return Lc(a);case 9:return Mc(a);case 10:return Nc(a);case 11:return Oc(a);case 12:return Pc(a);case 13:return Qc(a);case 14:return Rc(a);default:return Sc(a)}}
function L(a){Ra(4);return Nb(a)}function S(a,c){Ra(4);Ob(a,c)}function Ha(a){Ra(8);var c=Tb(a);c=-1===c?v(a):c;a+=1;var b=Tb(a);a=-1===b?v(a):b;return l(a,c)}function U(a,c){Ra(8);var b=I(c);c&=255;Pb(a,c)&&f(a,c);a+=1;Pb(a,b)&&f(a,b)}function J(){Ra(4);return v(b.programCounter)}function Y(){Ra(4);var a=v(b.programCounter+1&65535);return l(a,J())}function Dc(a){switch(a){case 0:return 4;case 1:return a=Y(),b.registerB=I(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return S(l(b.registerB,
b.registerC),b.registerA),4;case 3:return a=l(b.registerB,b.registerC),a++,b.registerB=I(a),b.registerC=a&255,8;case 4:return a=b.registerB,R(a,1),a=a+1&255,b.registerB=a,A(0===a),x(0),4;case 5:return a=b.registerB,R(a,-1),a=a-1&255,b.registerB=a,A(0===a),x(1),4;case 6:return b.registerB=J(),b.programCounter=b.programCounter+1&65535,4;case 7:return a=b.registerA,M(128===(a&128)),b.registerA=(a<<1|a>>7)&255,A(0),x(0),K(0),4;case 8:return U(Y(),b.stackPointer),b.programCounter=b.programCounter+2&65535,
4;case 9:a=l(b.registerH,b.registerL);var c=l(b.registerB,b.registerC);Wa(a,c,!1);a=a+c&65535;b.registerH=I(a);b.registerL=a&255;x(0);return 8;case 10:return b.registerA=L(l(b.registerB,b.registerC)),4;case 11:return a=l(b.registerB,b.registerC),a=a-1&65535,b.registerB=I(a),b.registerC=a&255,8;case 12:return a=b.registerC,R(a,1),a=a+1&255,b.registerC=a,A(0===a),x(0),4;case 13:return a=b.registerC,R(a,-1),a=a-1&255,b.registerC=a,A(0===a),x(1),4;case 14:return b.registerC=J(),b.programCounter=b.programCounter+
1&65535,4;case 15:return a=b.registerA,M(0<(a&1)),b.registerA=(a>>1|a<<7)&255,A(0),x(0),K(0),4}return-1}function Ec(a){switch(a){case 16:if(b.GBCEnabled&&(a=L(b.memoryLocationSpeedSwitch),g(0,a)))return a=H(0,a),g(7,a)?(b.GBCDoubleSpeed=!1,a=H(7,a)):(b.GBCDoubleSpeed=!0,a|=128),S(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=Y(),b.registerD=I(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;case 18:return S(l(b.registerD,
b.registerE),b.registerA),4;case 19:return a=l(b.registerD,b.registerE),a=a+1&65535,b.registerD=I(a),b.registerE=a&255,8;case 20:return a=b.registerD,R(a,1),b.registerD=a+1&255,A(0===b.registerD),x(0),4;case 21:return a=b.registerD,R(a,-1),b.registerD=a-1&255,A(0===b.registerD),x(1),4;case 22:return b.registerD=J(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=128===(b.registerA&128),b.registerA=(b.registerA<<1|T())&255,M(a),A(0),x(0),K(0),4;case 24:return jb(J()),8;case 25:a=l(b.registerH,
b.registerL);var c=l(b.registerD,b.registerE);Wa(a,c,!1);a=a+c&65535;b.registerH=I(a);b.registerL=a&255;x(0);return 8;case 26:return a=l(b.registerD,b.registerE),b.registerA=L(a),4;case 27:return a=l(b.registerD,b.registerE),a=a-1&65535,b.registerD=I(a),b.registerE=a&255,8;case 28:return a=b.registerE,R(a,1),a=a+1&255,b.registerE=a,A(0===a),x(0),4;case 29:return a=b.registerE,R(a,-1),a=a-1&255,b.registerE=a,A(0===a),x(1),4;case 30:return b.registerE=J(),b.programCounter=b.programCounter+1&65535,4;
case 31:return a=1===(b.registerA&1),b.registerA=(b.registerA>>1|T()<<7)&255,M(a),A(0),x(0),K(0),4}return-1}function Fc(a){switch(a){case 32:return 0===Sa()?jb(J()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=Y(),b.registerH=I(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=l(b.registerH,b.registerL),S(a,b.registerA),a=a+1&65535,b.registerH=I(a),b.registerL=a&255,4;case 35:return a=l(b.registerH,b.registerL),a=a+1&65535,b.registerH=I(a),b.registerL=
a&255,8;case 36:return a=b.registerH,R(a,1),a=a+1&255,b.registerH=a,A(0===a),x(0),4;case 37:return a=b.registerH,R(a,-1),a=a-1&255,b.registerH=a,A(0===a),x(1),4;case 38:return b.registerH=J(),b.programCounter=b.programCounter+1&65535,4;case 39:a=0;0<(b.registerF>>5&1)&&(a|=6);0<T()&&(a|=96);var c=b.registerA;0<(b.registerF>>6&1)?c=c-a&255:(9<(c&15)&&(a|=6),153<c&&(a|=96),c=c+a&255);A(0===c);M(0!==(a&96));K(0);b.registerA=c;return 4;case 40:return 0<Sa()?jb(J()):b.programCounter=b.programCounter+1&
65535,8;case 41:return a=l(b.registerH,b.registerL),Wa(a,a,!1),a=2*a&65535,b.registerH=I(a),b.registerL=a&255,x(0),8;case 42:return a=l(b.registerH,b.registerL),b.registerA=L(a),a=a+1&65535,b.registerH=I(a),b.registerL=a&255,4;case 43:return a=l(b.registerH,b.registerL),a=a-1&65535,b.registerH=I(a),b.registerL=a&255,8;case 44:return a=b.registerL,R(a,1),a=a+1&255,b.registerL=a,A(0===a),x(0),4;case 45:return a=b.registerL,R(a,-1),a=a-1&255,b.registerL=a,A(0===a),x(1),4;case 46:return b.registerL=J(),
b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=~b.registerA,x(1),K(1),4}return-1}function Gc(a){switch(a){case 48:return 0===T()?jb(J()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=Y(),b.programCounter=b.programCounter+2&65535,4;case 50:return a=l(b.registerH,b.registerL),S(a,b.registerA),a=a-1&65535,b.registerH=I(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+1&65535,8;case 52:a=l(b.registerH,b.registerL);var c=L(a);R(c,1);
c=c+1&255;A(0===c);x(0);S(a,c);return 4;case 53:return a=l(b.registerH,b.registerL),c=L(a),R(c,-1),c=c-1&255,A(0===c),x(1),S(a,c),4;case 54:return S(l(b.registerH,b.registerL),J()),b.programCounter=b.programCounter+1&65535,4;case 55:return x(0),K(0),M(1),4;case 56:return 1===T()?jb(J()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=l(b.registerH,b.registerL),Wa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,b.registerH=I(a),b.registerL=a&255,x(0),8;case 58:return a=l(b.registerH,b.registerL),
b.registerA=L(a),a=a-1&65535,b.registerH=I(a),b.registerL=a&255,4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return a=b.registerA,R(a,1),a=a+1&255,b.registerA=a,A(0===a),x(0),4;case 61:return a=b.registerA,R(a,-1),a=a-1&255,b.registerA=a,A(0===a),x(1),4;case 62:return b.registerA=J(),b.programCounter=b.programCounter+1&65535,4;case 63:return x(0),K(0),M(0>=T()),4}return-1}function Hc(a){switch(a){case 64:return 4;case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=
b.registerD,4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=L(l(b.registerH,b.registerL)),4;case 71:return b.registerB=b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=b.registerL,4;case 78:return b.registerC=L(l(b.registerH,
b.registerL)),4;case 79:return b.registerC=b.registerA,4}return-1}function Ic(a){switch(a){case 80:return b.registerD=b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=L(l(b.registerH,b.registerL)),4;case 87:return b.registerD=b.registerA,4;case 88:return b.registerE=b.registerB,4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=
b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=b.registerL,4;case 94:return b.registerE=L(l(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,4}return-1}function Jc(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=b.registerE,4;case 100:return b.registerH=b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=
L(l(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=L(l(b.registerH,b.registerL)),4;case 111:return b.registerL=b.registerA,4}return-1}function Kc(a){switch(a){case 112:return S(l(b.registerH,b.registerL),
b.registerB),4;case 113:return S(l(b.registerH,b.registerL),b.registerC),4;case 114:return S(l(b.registerH,b.registerL),b.registerD),4;case 115:return S(l(b.registerH,b.registerL),b.registerE),4;case 116:return S(l(b.registerH,b.registerL),b.registerH),4;case 117:return S(l(b.registerH,b.registerL),b.registerL),4;case 118:return n.isHblankHdmaActive||b.enableHalt(),4;case 119:return S(l(b.registerH,b.registerL),b.registerA),4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,
4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=L(l(b.registerH,b.registerL)),4;case 127:return 4}return-1}function Lc(a){switch(a){case 128:return Ja(b.registerB),4;case 129:return Ja(b.registerC),4;case 130:return Ja(b.registerD),4;case 131:return Ja(b.registerE),4;case 132:return Ja(b.registerH),4;case 133:return Ja(b.registerL),4;case 134:return a=
L(l(b.registerH,b.registerL)),Ja(a),4;case 135:return Ja(b.registerA),4;case 136:return Ka(b.registerB),4;case 137:return Ka(b.registerC),4;case 138:return Ka(b.registerD),4;case 139:return Ka(b.registerE),4;case 140:return Ka(b.registerH),4;case 141:return Ka(b.registerL),4;case 142:return a=L(l(b.registerH,b.registerL)),Ka(a),4;case 143:return Ka(b.registerA),4}return-1}function Mc(a){switch(a){case 144:return La(b.registerB),4;case 145:return La(b.registerC),4;case 146:return La(b.registerD),4;
case 147:return La(b.registerE),4;case 148:return La(b.registerH),4;case 149:return La(b.registerL),4;case 150:return a=L(l(b.registerH,b.registerL)),La(a),4;case 151:return La(b.registerA),4;case 152:return Ma(b.registerB),4;case 153:return Ma(b.registerC),4;case 154:return Ma(b.registerD),4;case 155:return Ma(b.registerE),4;case 156:return Ma(b.registerH),4;case 157:return Ma(b.registerL),4;case 158:return a=L(l(b.registerH,b.registerL)),Ma(a),4;case 159:return Ma(b.registerA),4}return-1}function Nc(a){switch(a){case 160:return Na(b.registerB),
4;case 161:return Na(b.registerC),4;case 162:return Na(b.registerD),4;case 163:return Na(b.registerE),4;case 164:return Na(b.registerH),4;case 165:return Na(b.registerL),4;case 166:return a=L(l(b.registerH,b.registerL)),Na(a),4;case 167:return Na(b.registerA),4;case 168:return Oa(b.registerB),4;case 169:return Oa(b.registerC),4;case 170:return Oa(b.registerD),4;case 171:return Oa(b.registerE),4;case 172:return Oa(b.registerH),4;case 173:return Oa(b.registerL),4;case 174:return a=L(l(b.registerH,b.registerL)),
Oa(a),4;case 175:return Oa(b.registerA),4}return-1}function Oc(a){switch(a){case 176:return Pa(b.registerB),4;case 177:return Pa(b.registerC),4;case 178:return Pa(b.registerD),4;case 179:return Pa(b.registerE),4;case 180:return Pa(b.registerH),4;case 181:return Pa(b.registerL),4;case 182:return a=L(l(b.registerH,b.registerL)),Pa(a),4;case 183:return Pa(b.registerA),4;case 184:return Qa(b.registerB),4;case 185:return Qa(b.registerC),4;case 186:return Qa(b.registerD),4;case 187:return Qa(b.registerE),
4;case 188:return Qa(b.registerH),4;case 189:return Qa(b.registerL),4;case 190:return a=L(l(b.registerH,b.registerL)),Qa(a),4;case 191:return Qa(b.registerA),4}return-1}function Pc(a){switch(a){case 192:return 0===Sa()?(a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 193:return a=Ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=I(a),b.registerC=a&255,4;case 194:if(0===Sa())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;
case 195:return b.programCounter=Y(),8;case 196:if(0===Sa())return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter+2&65535),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 197:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,l(b.registerB,b.registerC)),8;case 198:return Ja(J()),b.programCounter=b.programCounter+1&65535,4;case 199:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=0,8;case 200:return 1===Sa()?(a=
b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 201:return a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,8;case 202:if(1===Sa())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=J();a=-1;var d=!1,e=0,f=0,g=c&7;switch(g){case 0:e=b.registerB;break;case 1:e=b.registerC;break;case 2:e=b.registerD;break;case 3:e=b.registerE;break;case 4:e=b.registerH;break;case 5:e=b.registerL;break;case 6:e=L(l(b.registerH,b.registerL));
break;case 7:e=b.registerA}var h=(c&240)>>4;switch(h){case 0:7>=c?(c=e,M(128===(c&128)),c=(c<<1|c>>7)&255,A(0===c),x(0),K(0),f=c,d=!0):15>=c&&(c=e,M(0<(c&1)),c=(c>>1|c<<7)&255,A(0===c),x(0),K(0),f=c,d=!0);break;case 1:23>=c?(c=e,d=128===(c&128),c=(c<<1|T())&255,M(d),A(0===c),x(0),K(0),f=c,d=!0):31>=c&&(c=e,d=1===(c&1),c=(c>>1|T()<<7)&255,M(d),A(0===c),x(0),K(0),f=c,d=!0);break;case 2:39>=c?(c=e,d=128===(c&128),c=c<<1&255,M(d),A(0===c),x(0),K(0),f=c,d=!0):47>=c&&(c=e,d=128===(c&128),e=1===(c&1),c=
c>>1&255,d&&(c|=128),A(0===c),x(0),K(0),M(e),f=c,d=!0);break;case 3:55>=c?(c=e,c=((c&15)<<4|(c&240)>>4)&255,A(0===c),x(0),K(0),M(0),f=c,d=!0):63>=c&&(c=e,d=1===(c&1),c=c>>1&255,A(0===c),x(0),K(0),M(d),f=c,d=!0);break;case 4:71>=c?(f=Ua(0,e),d=!0):79>=c&&(f=Ua(1,e),d=!0);break;case 5:87>=c?(f=Ua(2,e),d=!0):95>=c&&(f=Ua(3,e),d=!0);break;case 6:103>=c?(f=Ua(4,e),d=!0):111>=c&&(f=Ua(5,e),d=!0);break;case 7:119>=c?(f=Ua(6,e),d=!0):127>=c&&(f=Ua(7,e),d=!0);break;case 8:135>=c?(f=ba(0,0,e),d=!0):143>=c&&
(f=ba(1,0,e),d=!0);break;case 9:151>=c?(f=ba(2,0,e),d=!0):159>=c&&(f=ba(3,0,e),d=!0);break;case 10:167>=c?(f=ba(4,0,e),d=!0):175>=c&&(f=ba(5,0,e),d=!0);break;case 11:183>=c?(f=ba(6,0,e),d=!0):191>=c&&(f=ba(7,0,e),d=!0);break;case 12:199>=c?(f=ba(0,1,e),d=!0):207>=c&&(f=ba(1,1,e),d=!0);break;case 13:215>=c?(f=ba(2,1,e),d=!0):223>=c&&(f=ba(3,1,e),d=!0);break;case 14:231>=c?(f=ba(4,1,e),d=!0):239>=c&&(f=ba(5,1,e),d=!0);break;case 15:247>=c?(f=ba(6,1,e),d=!0):255>=c&&(f=ba(7,1,e),d=!0)}switch(g){case 0:b.registerB=
f;break;case 1:b.registerC=f;break;case 2:b.registerD=f;break;case 3:b.registerE=f;break;case 4:b.registerH=f;break;case 5:b.registerL=f;break;case 6:(4>h||7<h)&&S(l(b.registerH,b.registerL),f);break;case 7:b.registerA=f}d&&(a=4);b.programCounter=b.programCounter+1&65535;return a;case 204:if(1===Sa())return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter+2),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return a=b.stackPointer-2&65535,b.stackPointer=
a,U(a,b.programCounter+2&65535),b.programCounter=Y(),8;case 206:return Ka(J()),b.programCounter=b.programCounter+1&65535,4;case 207:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=8}return-1}function Qc(a){switch(a){case 208:return 0===T()?(a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 209:a=b.stackPointer;var c=Ha(a);b.stackPointer=a+2&65535;b.registerD=I(c);b.registerE=c&255;return 4;case 210:if(0===T())return b.programCounter=
Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===T())return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter+2),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,l(b.registerD,b.registerE)),8;case 214:return La(J()),b.programCounter=b.programCounter+1&65535,4;case 215:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=16,8;case 216:return 1===
T()?(a=b.stackPointer,b.programCounter=Ha(a),b.stackPointer=a+2&65535,12):8;case 217:return a=b.stackPointer,b.programCounter=Ha(a),vb(!0),b.stackPointer=a+2&65535,8;case 218:if(1===T())return b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===T())return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter+2&65535),b.programCounter=Y(),8;b.programCounter=b.programCounter+2&65535;return 12;case 222:return Ma(J()),b.programCounter=b.programCounter+1&
65535,4;case 223:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=24,8}return-1}function Rc(a){switch(a){case 224:return a=J(),S(65280+a,b.registerA),b.programCounter=b.programCounter+1&65535,4;case 225:a=b.stackPointer;var c=Ha(a);b.stackPointer=a+2&65535;b.registerH=I(c);b.registerL=c&255;return 4;case 226:return S(65280+b.registerC,b.registerA),4;case 229:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,l(b.registerH,b.registerL)),8;case 230:return Na(J()),
b.programCounter=b.programCounter+1&65535,4;case 231:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=32,8;case 232:return a=J()<<24>>24,Wa(b.stackPointer,a,!0),b.stackPointer=b.stackPointer+a&65535,A(0),x(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=l(b.registerH,b.registerL),4;case 234:return S(Y(),b.registerA),b.programCounter=b.programCounter+2&65535,4;case 238:return Oa(J()),b.programCounter=b.programCounter+1&65535,4;
case 239:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=40,8}return-1}function Sc(a){switch(a){case 240:return a=J(),b.registerA=L(65280+a)&255,b.programCounter=b.programCounter+1&65535,4;case 241:a=b.stackPointer;var c=Ha(a);b.stackPointer=a+2&65535;b.registerA=I(c);b.registerF=c&255;return 4;case 242:return b.registerA=L(65280+b.registerC)&255,4;case 243:return vb(!1),4;case 245:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,l(b.registerA,b.registerF)),
8;case 246:return Pa(J()),b.programCounter=b.programCounter+1&65535,4;case 247:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=48,8;case 248:return c=J()<<24>>24,a=b.stackPointer,A(0),x(0),Wa(a,c,!0),a=a+c&65535,b.registerH=I(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=l(b.registerH,b.registerL),8;case 250:return b.registerA=L(Y()),b.programCounter=b.programCounter+2&65535,4;case 251:return vb(!0),4;case 254:return Qa(J()),
b.programCounter=b.programCounter+1&65535,4;case 255:return a=b.stackPointer-2&65535,b.stackPointer=a,U(a,b.programCounter),b.programCounter=56,8}return-1}function Ra(a){0<n.DMACycles&&(a+=n.DMACycles,n.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(Q.graphicsBatchProcessing){r.currentCycles+=a;for(var c=r.batchProcessCycles();r.currentCycles>=c;)nc(c),r.currentCycles-=c}else nc(a);Q.audioBatchProcessing?(h.currentCycles+=a,hb()):ec(a);c=a;if(Z.transferStartFlag)for(var d=0;d<c;){var e=Z.currentCycles,
k=e;d+=4;k+=4;65535<k&&(k-=65536);Z.currentCycles=k;var l=Z.isClockSpeedFast?2:7;g(l,e)&&!g(l,k)&&(e=Z.memoryLocationSerialTransferData,k=v(e),k=(k<<1)+1,k&=255,f(e,k),e=Z.numberOfBitsTransferred,8===++e?(Z.numberOfBitsTransferred=0,m.isSerialInterruptRequested=!0,bb(m.bitPositionSerialInterrupt),e=Z.memoryLocationSerialTransferControl,k=v(e),f(e,H(7,k)),Z.transferStartFlag=!1):Z.numberOfBitsTransferred=e)}}Q.timersBatchProcessing?(w.currentCycles+=a,Kb(w.currentCycles),w.currentCycles=0):Kb(a);c=
da.cycles;c+=a;c>=da.cyclesPerCycleSet&&(da.cycleSets+=1,c-=da.cyclesPerCycleSet);da.cycles=c}function pc(){return Ub(!0,-1)}function Ub(a,c){void 0===c&&(c=-1);a=1024;0<c?a=c:0>c&&(a=-1);for(var d=!1,e=!1,f=!1;!(d||e||f||aa.reachedBreakpoint);)c=qc(),0>c?d=!0:b.currentCycles>=b.MAX_CYCLES_PER_FRAME()?e=!0:-1<a&&fc()>=a&&(f=!0);if(e)return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),V.RESPONSE_CONDITION_FRAME;if(f)return V.RESPONSE_CONDITION_AUDIO;if(aa.reachedBreakpoint)return aa.reachedBreakpoint=
!1,V.RESPONSE_CONDITION_BREAKPOINT;b.programCounter=b.programCounter-1&65535;return-1}function qc(){kb=!0;if(b.isHaltBug){var a=v(b.programCounter);a=oc(a);Ra(a);b.exitHaltAndStop()}m.masterInterruptSwitchDelay&&(m.masterInterruptSwitch=!0,m.masterInterruptSwitchDelay=!1);if(0<(m.interruptsEnabledValue&m.interruptsRequestedValue&31)){a=!1;m.masterInterruptSwitch&&!b.isHaltNoJump&&(m.isVBlankInterruptEnabled&&m.isVBlankInterruptRequested?(ib(m.bitPositionVBlankInterrupt),a=!0):m.isLcdInterruptEnabled&&
m.isLcdInterruptRequested?(ib(m.bitPositionLcdInterrupt),a=!0):m.isTimerInterruptEnabled&&m.isTimerInterruptRequested?(ib(m.bitPositionTimerInterrupt),a=!0):m.isSerialInterruptEnabled&&m.isSerialInterruptRequested?(ib(m.bitPositionSerialInterrupt),a=!0):m.isJoypadInterruptEnabled&&m.isJoypadInterruptRequested&&(ib(m.bitPositionJoypadInterrupt),a=!0));var c=0;a&&(c=20,b.isHalted()&&(b.exitHaltAndStop(),c+=4));b.isHalted()&&b.exitHaltAndStop();a=c}else a=0;0<a&&Ra(a);a=4;b.isHalted()||b.isStopped||
(a=v(b.programCounter),a=oc(a));b.registerF&=240;if(0>=a)return a;Ra(a);c=V.steps;c+=1;c>=V.stepsPerStepSet&&(V.stepSets+=1,c-=V.stepsPerStepSet);V.steps=c;b.programCounter===aa.programCounter&&(aa.reachedBreakpoint=!0);return a}function Tc(a){let c="undefined"!==typeof window?performance.now():Date.now();for(;a.fpsTimeStamps[0]<c-1E3;)a.fpsTimeStamps.shift();a.fpsTimeStamps.push(c);a.timeStampsUntilReady--;0>a.timeStampsUntilReady&&(a.timeStampsUntilReady=0);return c}function Vb(a){a.timeStampsUntilReady=
90>=a.options.gameboyFrameRate?1.25*Math.floor(a.options.gameboyFrameRate):120}function rc(a){let c=a.wasmByteMemory.slice(a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION,a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION+a.WASMBOY_CURRENT_FRAME_SIZE).buffer;a.graphicsWorkerPort.postMessage(O({type:B.UPDATED,graphicsFrameBuffer:c}),[c])}function sc(a){var c=("undefined"!==typeof window?performance.now():Date.now())-a.fpsTimeStamps[a.fpsTimeStamps.length-1];c=tc-c;0>c&&(c=0);a.speed&&0<a.speed&&(c/=a.speed);a.updateId=
setTimeout(()=>{uc(a)},Math.floor(c))}function uc(a,c){if(a.paused)return!0;void 0!==c&&(tc=c);lb=a.getFPS();yb=a.options.gameboyFrameRate+1;a.speed&&0<a.speed&&(yb*=a.speed);if(lb>yb)return a.fpsTimeStamps.shift(),sc(a),!0;Tc(a);let b=!a.options.headless&&!a.pauseFpsThrottle&&a.options.isAudioEnabled;(new Promise(c=>{let d;b?Wb(a,c):(d=a.wasmInstance.exports.executeFrame(),c(d))})).then(c=>{if(0<=c){ea(O({type:B.UPDATED,fps:lb}));let b=!1;a.options.frameSkip&&0<a.options.frameSkip&&(a.frameSkipCounter++,
a.frameSkipCounter<=a.options.frameSkip?b=!0:a.frameSkipCounter=0);b||rc(a);let d={type:B.UPDATED};d[C.CARTRIDGE_RAM]=$b(a).buffer;d[C.GAMEBOY_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer;d[C.PALETTE_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer;d[C.INTERNAL_STATE]=ac(a).buffer;Object.keys(d).forEach(a=>{void 0===
d[a]&&(d[a]=(new Uint8Array).buffer)});a.memoryWorkerPort.postMessage(O(d),[d[C.CARTRIDGE_RAM],d[C.GAMEBOY_MEMORY],d[C.PALETTE_MEMORY],d[C.INTERNAL_STATE]]);2===c?ea(O({type:B.BREAKPOINT})):sc(a)}else ea(O({type:B.CRASHED})),a.paused=!0})}function Wb(a,c){var b=-1;b=a.wasmInstance.exports.executeFrameAndCheckAudio(1024);1!==b&&c(b);if(1===b){b=a.wasmInstance.exports.getNumberOfSamplesInAudioBuffer();let d=lb>=yb;.25<a.currentAudioLatencyInSeconds&&d?(vc(a,b),setTimeout(()=>{Vb(a);Wb(a,c)},Math.floor(Math.floor(1E3*
(a.currentAudioLatencyInSeconds-.25))/10))):(vc(a,b),Wb(a,c))}}function vc(a,c){var b=a.wasmByteMemory.slice(a.WASMBOY_SOUND_OUTPUT_LOCATION,a.WASMBOY_SOUND_OUTPUT_LOCATION+2*c).buffer;let d={type:B.UPDATED,audioBuffer:b,numberOfSamples:c,fps:lb,allowFastSpeedStretching:60<a.options.gameboyFrameRate};b=[b];if(a.options&&a.options.enableAudioDebugging){var e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION+2*c).buffer;d.channel1Buffer=e;b.push(e);e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION,
a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION+2*c).buffer;d.channel2Buffer=e;b.push(e);e=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION+2*c).buffer;d.channel3Buffer=e;b.push(e);c=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION+2*c).buffer;d.channel4Buffer=c;b.push(c)}a.audioWorkerPort.postMessage(O(d),b);a.wasmInstance.exports.clearAudioBuffer()}let nb="undefined"!==typeof self,Bb;nb||(Bb=require("worker_threads").parentPort);
let B={CONNECT:"CONNECT",INSTANTIATE_WASM:"INSTANTIATE_WASM",CLEAR_MEMORY:"CLEAR_MEMORY",CLEAR_MEMORY_DONE:"CLEAR_MEMORY_DONE",GET_MEMORY:"GET_MEMORY",SET_MEMORY:"SET_MEMORY",SET_MEMORY_DONE:"SET_MEMORY_DONE",GET_CONSTANTS:"GET_CONSTANTS",GET_CONSTANTS_DONE:"GET_CONSTANTS_DONE",CONFIG:"CONFIG",RESET_AUDIO_QUEUE:"RESET_AUDIO_QUEUE",PLAY:"PLAY",BREAKPOINT:"BREAKPOINT",PAUSE:"PAUSE",UPDATED:"UPDATED",CRASHED:"CRASHED",SET_JOYPAD_STATE:"SET_JOYPAD_STATE",AUDIO_LATENCY:"AUDIO_LATENCY",RUN_WASM_EXPORT:"RUN_WASM_EXPORT",
GET_WASM_MEMORY_SECTION:"GET_WASM_MEMORY_SECTION",GET_WASM_CONSTANT:"GET_WASM_CONSTANT",FORCE_OUTPUT_FRAME:"FORCE_OUTPUT_FRAME",SET_SPEED:"SET_SPEED",IS_GBC:"IS_GBC"},C={BOOT_ROM:"BOOT_ROM",CARTRIDGE_RAM:"CARTRIDGE_RAM",CARTRIDGE_ROM:"CARTRIDGE_ROM",CARTRIDGE_HEADER:"CARTRIDGE_HEADER",GAMEBOY_MEMORY:"GAMEBOY_MEMORY",PALETTE_MEMORY:"PALETTE_MEMORY",INTERNAL_STATE:"INTERNAL_STATE"},ob=0,e=new Uint8ClampedArray(9109504),mb={size:()=>9109504,grow:()=>{},wasmByteMemory:e};var Uc=65536,Ya=67584,Za=Ya+128,
cb=Za+23552,zb=cb+93184,Xb=zb+196608,Ab=Xb+147456,Vc=Ya,Wc=Ab-Ya+15360,Gb=Ab+15360,Hb=Gb+131072,Ib=Hb+131072,Jb=Ib+131072,ub=Jb+131072,Rb=ub+131072,wb=Rb+131072,xb=wb+2560,Yb=xb+8258560,wc=Yb+65535+1,Zb=Math.ceil(wc/1024/64)+1,Q=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=!1;a.enableAudioDebugging=
!1;return a}(),N=function(){function a(){}a.bgWhite=15921906;a.bgLightGrey=10526880;a.bgDarkGrey=5789784;a.bgBlack=526344;a.obj0White=15921906;a.obj0LightGrey=10526880;a.obj0DarkGrey=5789784;a.obj0Black=526344;a.obj1White=15921906;a.obj1LightGrey=10526880;a.obj1DarkGrey=5789784;a.obj1Black=526344;return a}(),la=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=5439232;a.bgDarkGrey=16728576;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=5439232;a.obj0DarkGrey=16728576;a.obj0Black=0;a.obj1White=
16777215;a.obj1LightGrey=5439232;a.obj1DarkGrey=16728576;a.obj1Black=0;return a}(),pa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=16711680;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16776960;a.obj0DarkGrey=16711680;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16776960;a.obj1DarkGrey=16711680;a.obj1Black=0;return a}(),ia=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16756067;a.bgDarkGrey=8663296;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=
16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),na=function(){function a(){}a.bgWhite=0;a.bgLightGrey=33924;a.bgDarkGrey=16768512;a.bgBlack=16777215;a.obj0White=0;a.obj0LightGrey=33924;a.obj0DarkGrey=16768512;a.obj0Black=16777215;a.obj1White=0;a.obj1LightGrey=33924;a.obj1DarkGrey=16768512;a.obj1Black=16777215;return a}(),ta=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=10855845;a.bgDarkGrey=5395026;
a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=10855845;a.obj0DarkGrey=5395026;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=10855845;a.obj1DarkGrey=5395026;a.obj1Black=0;return a}(),oa=function(){function a(){}a.bgWhite=16777125;a.bgLightGrey=16749716;a.bgDarkGrey=9737471;a.bgBlack=0;a.obj0White=16777125;a.obj0LightGrey=16749716;a.obj0DarkGrey=9737471;a.obj0Black=0;a.obj1White=16777125;a.obj1LightGrey=16749716;a.obj1DarkGrey=9737471;a.obj1Black=0;return a}(),ka=function(){function a(){}a.bgWhite=
16770757;a.bgLightGrey=13540484;a.bgDarkGrey=8678185;a.bgBlack=5910792;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),ma=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=8126257;a.bgDarkGrey=25541;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;
a.obj1Black=0;return a}(),sa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=9211102;a.bgDarkGrey=5395084;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),ja=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=
16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),ra=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),qa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=8079872;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=6530559;a.obj0DarkGrey=
255;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),va=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=10853631;a.obj0LightGrey=16776960;a.obj0DarkGrey=25344;a.obj0Black=0;a.obj1White=10853631;a.obj1LightGrey=16776960;a.obj1DarkGrey=25344;a.obj1Black=0;return a}(),wa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;
a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),xa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),ya=function(){function a(){}a.bgWhite=11908607;a.bgLightGrey=16777108;a.bgDarkGrey=
11360834;a.bgBlack=0;a.obj0White=0;a.obj0LightGrey=16777215;a.obj0DarkGrey=16745604;a.obj0Black=9714234;a.obj1White=0;a.obj1LightGrey=16777215;a.obj1DarkGrey=16745604;a.obj1Black=9714234;return a}(),za=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=5946879;a.obj1DarkGrey=16711680;a.obj1Black=255;return a}(),Aa=function(){function a(){}
a.bgWhite=16777116;a.bgLightGrey=9745919;a.bgDarkGrey=6526067;a.bgBlack=14906;a.obj0White=16762178;a.obj0LightGrey=16766464;a.obj0DarkGrey=9714176;a.obj0Black=4849664;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),Ba=function(){function a(){}a.bgWhite=7077632;a.bgLightGrey=16777215;a.bgDarkGrey=16732746;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16777215;a.obj0DarkGrey=6530559;a.obj0Black=255;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=
8663296;a.obj1Black=0;return a}(),Ca=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=16737106;a.obj0LightGrey=14024704;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=255;a.obj1LightGrey=16777215;a.obj1DarkGrey=16777083;a.obj1Black=34047;return a}(),Da=function(){function a(){}a.bgWhite=16777166;a.bgLightGrey=6549487;a.bgDarkGrey=10257457;a.bgBlack=5921370;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=
0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Ea=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=65280;a.obj0DarkGrey=3245056;a.obj0Black=18944;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Fa=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16776960;a.obj0LightGrey=
16711680;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),Ga=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=16756067;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),d=function(){function a(){}a.bgWhite=N.bgWhite;a.bgLightGrey=N.bgLightGrey;a.bgDarkGrey=
N.bgDarkGrey;a.bgBlack=N.bgBlack;a.obj0White=N.obj0White;a.obj0LightGrey=N.obj0LightGrey;a.obj0DarkGrey=N.obj0DarkGrey;a.obj0Black=N.obj0Black;a.obj1White=N.obj1White;a.obj1LightGrey=N.obj1LightGrey;a.obj1DarkGrey=N.obj1DarkGrey;a.obj1Black=N.obj1Black;return a}(),Xa=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;a.memoryLocationBackgroundPalette=65351;
a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;return a}(),db=function(){function a(){}a.tileId=-1;a.horizontalFlip=!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),y=function(){function a(){}a.updateNRx0=function(c){var b=a.NRx0Negate;a.NRx0SweepPeriod=(c&112)>>4;a.NRx0Negate=g(3,c);a.NRx0SweepShift=c&7;b&&!a.NRx0Negate&&a.sweepNegateShouldDisableChannelOnClear&&(a.isEnabled=!1)};a.updateNRx1=function(c){a.NRx1Duty=c>>6&3;a.NRx1LengthLoad=c&63;a.lengthCounter=a.MAX_LENGTH-
a.NRx1LengthLoad};a.updateNRx2=function(c){a.isEnabled&&(0===a.NRx2EnvelopePeriod&&a.isEnvelopeAutomaticUpdating&&(a.volume=a.volume+1&15),a.NRx2EnvelopeAddMode!==g(3,c)&&(a.volume=16-a.volume&15));a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=g(3,c);a.NRx2EnvelopePeriod=c&7;c=0<(c&248);a.isDacEnabled=c;c||(a.isEnabled=!1)};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){var b=c&7;a.NRx4FrequencyMSB=b;a.frequency=b<<8|a.NRx3FrequencyLSB;
b=1===(h.frameSequencer&1);var d=!a.NRx4LengthEnabled&&g(6,c);!b&&0<a.lengthCounter&&d&&(--a.lengthCounter,g(7,c)||0!==a.lengthCounter||(a.isEnabled=!1));a.NRx4LengthEnabled=g(6,c);g(7,c)&&(a.trigger(),!b&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.cycleCounter;e[1028+50*a.saveStateSlot]=a.NRx0SweepPeriod;e[1029+50*a.saveStateSlot]=a.NRx0Negate;e[1030+50*a.saveStateSlot]=a.NRx0SweepShift;e[1031+50*a.saveStateSlot]=a.NRx1Duty;
e[1033+50*a.saveStateSlot]=a.NRx1LengthLoad;e[1034+50*a.saveStateSlot]=a.NRx2StartingVolume;e[1035+50*a.saveStateSlot]=a.NRx2EnvelopeAddMode;e[1036+50*a.saveStateSlot]=a.NRx2EnvelopePeriod;e[1037+50*a.saveStateSlot]=a.NRx3FrequencyLSB;e[1038+50*a.saveStateSlot]=a.NRx4LengthEnabled;e[1039+50*a.saveStateSlot]=a.NRx4FrequencyMSB;e[1040+50*a.saveStateSlot]=a.isEnabled;e[1041+50*a.saveStateSlot]=a.isDacEnabled;e[1042+50*a.saveStateSlot]=a.frequency;e[1046+50*a.saveStateSlot]=a.frequencyTimer;e[1050+50*
a.saveStateSlot]=a.envelopeCounter;e[1054+50*a.saveStateSlot]=a.isEnvelopeAutomaticUpdating;e[1055+50*a.saveStateSlot]=a.lengthCounter;e[1059+50*a.saveStateSlot]=a.volume;e[1063+50*a.saveStateSlot]=a.dutyCycle;e[1064+50*a.saveStateSlot]=a.waveFormPositionOnDuty;e[1065+50*a.saveStateSlot]=a.isSweepEnabled;e[1066+50*a.saveStateSlot]=a.sweepCounter;e[1070+50*a.saveStateSlot]=a.sweepShadowFrequency;e[1073+50*a.saveStateSlot]=a.sweepNegateShouldDisableChannelOnClear};a.loadState=function(){a.cycleCounter=
e[1024+50*a.cycleCounter];a.NRx0SweepPeriod=e[1028+50*a.saveStateSlot];a.NRx0Negate=k(1029+50*a.saveStateSlot);a.NRx0SweepShift=e[1030+50*a.saveStateSlot];a.NRx1Duty=e[1031+50*a.saveStateSlot];a.NRx1LengthLoad=e[1033+50*a.saveStateSlot];a.NRx2StartingVolume=e[1034+50*a.saveStateSlot];a.NRx2EnvelopeAddMode=k(1035+50*a.saveStateSlot);a.NRx2EnvelopePeriod=e[1036+50*a.saveStateSlot];a.NRx3FrequencyLSB=e[1037+50*a.saveStateSlot];a.NRx4LengthEnabled=k(1038+50*a.saveStateSlot);a.NRx4FrequencyMSB=e[1039+
50*a.saveStateSlot];a.isEnabled=k(1040+50*a.saveStateSlot);a.isDacEnabled=k(1041+50*a.saveStateSlot);a.frequency=e[1042+50*a.saveStateSlot];a.frequencyTimer=e[1046+50*a.saveStateSlot];a.envelopeCounter=e[1050+50*a.saveStateSlot];a.isEnvelopeAutomaticUpdating=k(1054+50*a.saveStateSlot);a.lengthCounter=e[1055+50*a.saveStateSlot];a.volume=e[1059+50*a.saveStateSlot];a.dutyCycle=e[1063+50*a.saveStateSlot];a.waveFormPositionOnDuty=e[1064+50*a.saveStateSlot];a.isSweepEnabled=k(1065+50*a.saveStateSlot);a.sweepCounter=
e[1066+50*a.saveStateSlot];a.sweepShadowFrequency=e[1070+50*a.saveStateSlot];a.sweepNegateShouldDisableChannelOnClear=k(1073+50*a.saveStateSlot)};a.initialize=function(){f(a.memoryLocationNRx0,128);f(a.memoryLocationNRx1,191);f(a.memoryLocationNRx2,243);f(a.memoryLocationNRx3,193);f(a.memoryLocationNRx4,191);b.BootROMEnabled&&(f(a.memoryLocationNRx1,63),f(a.memoryLocationNRx2,0),f(a.memoryLocationNRx3,0),f(a.memoryLocationNRx4,184))};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;a.cycleCounter=
0;return a.getSample(c)};a.resetTimer=function(){var c=2048-a.frequency<<2;b.GBCDoubleSpeed&&(c<<=2);a.frequencyTimer=c};a.getSample=function(c){var b=a.frequencyTimer;for(b-=c;0>=b;)c=Math.abs(b),a.resetTimer(),b=a.frequencyTimer,b-=c,a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7;a.frequencyTimer=b;if(a.isEnabled&&a.isDacEnabled)b=a.volume&15;else return 15;c=1;dc(a.NRx1Duty,a.waveFormPositionOnDuty)||(c=-c);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=
a.MAX_LENGTH);a.resetTimer();a.envelopeCounter=0===a.NRx2EnvelopePeriod?8:a.NRx2EnvelopePeriod;a.isEnvelopeAutomaticUpdating=!0;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=0===a.NRx0SweepPeriod?8:a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod||0<a.NRx0SweepShift;a.sweepNegateShouldDisableChannelOnClear=!1;var c;if(c=0<a.NRx0SweepShift)c=2047<Fb()?!0:!1;c&&(a.isEnabled=!1);a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){c=a.cycleCounter+
c;a.cycleCounter=c;return!(0<a.frequencyTimer-c)};a.updateSweep=function(){if(a.isEnabled&&a.isSweepEnabled){var c=a.sweepCounter-1;0>=c?0===a.NRx0SweepPeriod?a.sweepCounter=8:(a.sweepCounter=a.NRx0SweepPeriod,c=Fb(),2047<c&&(a.isEnabled=!1),0<a.NRx0SweepShift&&(a.setFrequency(c),2047<Fb()&&(a.isEnabled=!1))):a.sweepCounter=c}};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&(--c,0===c&&(a.isEnabled=!1));a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-
1;if(0>=c)if(0===a.NRx2EnvelopePeriod)c=8;else if(c=a.NRx2EnvelopePeriod,0!==c&&a.isEnvelopeAutomaticUpdating){var b=a.volume;b=a.NRx2EnvelopeAddMode?b+1:b-1;b&=15;15>b?a.volume=b:a.isEnvelopeAutomaticUpdating=!1}a.envelopeCounter=c};a.setFrequency=function(c){a.sweepShadowFrequency=c;var b=c>>8&7;c&=255;var d=v(a.memoryLocationNRx4)&248|b;f(a.memoryLocationNRx3,c);f(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=c;a.NRx4FrequencyMSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=
0;a.MAX_LENGTH=64;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.isEnvelopeAutomaticUpdating=
!1;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.sweepNegateShouldDisableChannelOnClear=!1;a.saveStateSlot=7;return a}(),D=function(){function a(){}a.updateNRx1=function(c){a.NRx1Duty=c>>6&3;a.NRx1LengthLoad=c&63;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(c){a.isEnabled&&(0===a.NRx2EnvelopePeriod&&a.isEnvelopeAutomaticUpdating&&(a.volume=a.volume+1&15),a.NRx2EnvelopeAddMode!==g(3,c)&&
(a.volume=16-a.volume&15));a.NRx2StartingVolume=c>>4&15;a.NRx2EnvelopeAddMode=g(3,c);a.NRx2EnvelopePeriod=c&7;c=0<(c&248);a.isDacEnabled=c;c||(a.isEnabled=c)};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){var b=c&7;a.NRx4FrequencyMSB=b;a.frequency=b<<8|a.NRx3FrequencyLSB;b=1===(h.frameSequencer&1);var d=!a.NRx4LengthEnabled&&g(6,c);!b&&0<a.lengthCounter&&d&&(--a.lengthCounter,g(7,c)||0!==a.lengthCounter||(a.isEnabled=!1));a.NRx4LengthEnabled=
g(6,c);g(7,c)&&(a.trigger(),!b&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.cycleCounter;e[1031+50*a.saveStateSlot]=a.NRx1Duty;e[1032+50*a.saveStateSlot]=a.NRx1LengthLoad;e[1034+50*a.saveStateSlot]=a.NRx2StartingVolume;e[1035+50*a.saveStateSlot]=a.NRx2EnvelopeAddMode;e[1036+50*a.saveStateSlot]=a.NRx2EnvelopePeriod;e[1037+50*a.saveStateSlot]=a.NRx3FrequencyLSB;e[1038+50*a.saveStateSlot]=a.NRx4LengthEnabled;e[1039+50*a.saveStateSlot]=
a.NRx4FrequencyMSB;e[1040+50*a.saveStateSlot]=a.isEnabled;e[1041+50*a.saveStateSlot]=a.isDacEnabled;e[1042+50*a.saveStateSlot]=a.frequency;e[1046+50*a.saveStateSlot]=a.frequencyTimer;e[1050+50*a.saveStateSlot]=a.envelopeCounter;e[1054+50*a.saveStateSlot]=a.isEnvelopeAutomaticUpdating;e[1055+50*a.saveStateSlot]=a.lengthCounter;e[1059+50*a.saveStateSlot]=a.volume;e[1063+50*a.saveStateSlot]=a.dutyCycle;e[1064+50*a.saveStateSlot]=a.waveFormPositionOnDuty};a.loadState=function(){a.cycleCounter=e[1024+
50*a.cycleCounter];a.NRx1Duty=e[1031+50*a.saveStateSlot];a.NRx1LengthLoad=e[1032+50*a.saveStateSlot];a.NRx2StartingVolume=e[1034+50*a.saveStateSlot];a.NRx2EnvelopeAddMode=k(1035+50*a.saveStateSlot);a.NRx2EnvelopePeriod=e[1036+50*a.saveStateSlot];a.NRx3FrequencyLSB=e[1037+50*a.saveStateSlot];a.NRx4LengthEnabled=k(1038+50*a.saveStateSlot);a.NRx4FrequencyMSB=e[1039+50*a.saveStateSlot];a.isEnabled=k(1040+50*a.saveStateSlot);a.isDacEnabled=k(1041+50*a.saveStateSlot);a.frequency=e[1042+50*a.saveStateSlot];
a.frequencyTimer=e[1046+50*a.saveStateSlot];a.envelopeCounter=e[1050+50*a.saveStateSlot];a.isEnvelopeAutomaticUpdating=k(1054+50*a.saveStateSlot);a.lengthCounter=e[1055+50*a.saveStateSlot];a.volume=e[1059+50*a.saveStateSlot];a.dutyCycle=e[1063+50*a.saveStateSlot];a.waveFormPositionOnDuty=e[1064+50*a.saveStateSlot]};a.initialize=function(){f(a.memoryLocationNRx1-1,255);f(a.memoryLocationNRx1,63);f(a.memoryLocationNRx2,0);f(a.memoryLocationNRx3,0);f(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=
function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<2<<b.GBCDoubleSpeed};a.getSample=function(c){var b=a.frequencyTimer;for(b-=c;0>=b;)c=Math.abs(b),a.resetTimer(),b=a.frequencyTimer,b-=c,a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7;a.frequencyTimer=b;if(a.isEnabled&&a.isDacEnabled)b=a.volume&15;else return 15;c=1;dc(a.NRx1Duty,a.waveFormPositionOnDuty)||(c=-c);return c*b+15};a.trigger=function(){a.isEnabled=!0;
0===a.lengthCounter&&(a.lengthCounter=a.MAX_LENGTH);a.resetTimer();a.envelopeCounter=0===a.NRx2EnvelopePeriod?8:a.NRx2EnvelopePeriod;a.isEnvelopeAutomaticUpdating=!0;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(c){c=a.cycleCounter+c;a.cycleCounter=c;return!(0<a.frequencyTimer-c)};a.updateLength=function(){var c=a.lengthCounter;0<c&&a.NRx4LengthEnabled&&--c;0===c&&(a.isEnabled=!1);a.lengthCounter=c};a.updateEnvelope=function(){var c=a.envelopeCounter-
1;if(0>=c)if(0===a.NRx2EnvelopePeriod)c=8;else if(c=a.NRx2EnvelopePeriod,0!==c&&a.isEnvelopeAutomaticUpdating){var b=a.volume;b=a.NRx2EnvelopeAddMode?b+1:b-1;b&=15;15>b?a.volume=b:a.isEnvelopeAutomaticUpdating=!1}a.envelopeCounter=c};a.setFrequency=function(c){var b=c>>8;c&=255;var d=v(a.memoryLocationNRx4)&248|b;f(a.memoryLocationNRx3,c);f(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=c;a.NRx4FrequencyMSB=b;a.frequency=b<<8|c};a.cycleCounter=0;a.MAX_LENGTH=64;a.memoryLocationNRx0=65301;a.memoryLocationNRx1=
65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.isEnvelopeAutomaticUpdating=!1;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),t=function(){function a(){}
a.updateNRx0=function(c){c=g(7,c);!a.isDacEnabled&&c&&(a.sampleBuffer=0);a.isDacEnabled=c;c||(a.isEnabled=c)};a.updateNRx1=function(c){a.NRx1LengthLoad=c;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(c){a.NRx2VolumeCode=c>>5&15};a.updateNRx3=function(c){a.NRx3FrequencyLSB=c;a.frequency=a.NRx4FrequencyMSB<<8|c};a.updateNRx4=function(c){var b=c&7;a.NRx4FrequencyMSB=b;a.frequency=b<<8|a.NRx3FrequencyLSB;b=1===(h.frameSequencer&1);if(!b){var d=!a.NRx4LengthEnabled&&g(6,c);0<a.lengthCounter&&
d&&(--a.lengthCounter,g(7,c)||0!==a.lengthCounter||(a.isEnabled=!1))}a.NRx4LengthEnabled=g(6,c);g(7,c)&&(a.trigger(),!b&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.cycleCounter;e[1032+50*a.saveStateSlot]=a.NRx1LengthLoad;e[1034+50*a.saveStateSlot]=a.NRx2VolumeCode;e[1036+50*a.saveStateSlot]=a.NRx3FrequencyLSB;e[1037+50*a.saveStateSlot]=a.NRx4LengthEnabled;e[1038+50*a.saveStateSlot]=a.NRx4FrequencyMSB;e[1039+50*a.saveStateSlot]=
a.isEnabled;e[1040+50*a.saveStateSlot]=a.isDacEnabled;e[1041+50*a.saveStateSlot]=a.frequency;e[1045+50*a.saveStateSlot]=a.frequencyTimer;e[1049+50*a.saveStateSlot]=a.lengthCounter;e[1057+50*a.saveStateSlot]=a.waveTablePosition;e[1061+50*a.saveStateSlot]=a.volumeCode;e[1062+50*a.saveStateSlot]=a.volumeCodeChanged;e[1063+50*a.saveStateSlot]=a.sampleBuffer};a.loadState=function(){a.cycleCounter=e[1024+50*a.cycleCounter];a.NRx1LengthLoad=e[1032+50*a.saveStateSlot];a.NRx2VolumeCode=e[1034+50*a.saveStateSlot];
a.NRx3FrequencyLSB=e[1036+50*a.saveStateSlot];a.NRx4LengthEnabled=k(1037+50*a.saveStateSlot);a.NRx4FrequencyMSB=e[1038+50*a.saveStateSlot];a.isEnabled=k(1039+50*a.saveStateSlot);a.isDacEnabled=k(1040+50*a.saveStateSlot);a.frequency=e[1041+50*a.saveStateSlot];a.frequencyTimer=e[1045+50*a.saveStateSlot];a.lengthCounter=e[1049+50*a.saveStateSlot];a.waveTablePosition=e[1057+50*a.saveStateSlot];a.volumeCode=e[1061+50*a.saveStateSlot];a.volumeCodeChanged=k(1062+50*a.saveStateSlot);a.sampleBuffer=e[1063+
50*a.saveStateSlot]};a.handleWaveRamRead=function(){return v(t.memoryLocationWaveTable+(t.waveTablePosition>>1|0))};a.handleWaveRamWrite=function(c){f(a.memoryLocationWaveTable+(a.waveTablePosition>>1|0),c)};a.initialize=function(){f(a.memoryLocationNRx0,127);f(a.memoryLocationNRx1,255);f(a.memoryLocationNRx2,159);f(a.memoryLocationNRx3,0);f(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var c=a.cycleCounter;a.cycleCounter=0;return a.getSample(c)};a.resetTimer=
function(){a.frequencyTimer=2048-a.frequency<<1<<b.GBCDoubleSpeed};a.getSample=function(c){if(!a.isEnabled||!a.isDacEnabled)return 15;var b=a.volumeCode;a.volumeCodeChanged&&(b=v(a.memoryLocationNRx2),b=b>>5&15,a.volumeCode=b,a.volumeCodeChanged=!1);var d=t.sampleBuffer;d>>=(0===(t.waveTablePosition&1))<<2;d&=15;var e=0;switch(b){case 0:d>>=4;break;case 1:e=1;break;case 2:d>>=1;e=2;break;default:d>>=2,e=4}d=(0<e?d/e:0)+15;b=a.frequencyTimer;for(b-=c;0>=b;){c=Math.abs(b);a.resetTimer();b=a.frequencyTimer;
b-=c;c=t.waveTablePosition;for(c+=1;32<=c;)c-=32;t.waveTablePosition=c;t.sampleBuffer=v(t.memoryLocationWaveTable+(t.waveTablePosition>>1|0))}a.frequencyTimer=b;return d};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=a.MAX_LENGTH);a.resetTimer();a.frequencyTimer+=6;a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return!(!a.volumeCodeChanged&&0<a.frequencyTimer-a.cycleCounter)};a.updateLength=function(){var b=a.lengthCounter;
0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.cycleCounter=0;a.MAX_LENGTH=256;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;
a.volumeCode=0;a.volumeCodeChanged=!1;a.sampleBuffer=0;a.saveStateSlot=9;return a}(),F=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(b){a.isEnabled&&(0===a.NRx2EnvelopePeriod&&a.isEnvelopeAutomaticUpdating&&(a.volume=a.volume+1&15),a.NRx2EnvelopeAddMode!==g(3,b)&&(a.volume=16-a.volume&15));a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=g(3,b);a.NRx2EnvelopePeriod=b&7;b=0<(b&248);a.isDacEnabled=b;b||
(a.isEnabled=b)};a.updateNRx3=function(b){var c=b&7;a.NRx3ClockShift=b>>4;a.NRx3WidthMode=g(3,b);a.NRx3DivisorCode=c;c<<=1;1>c&&(c=1);a.divisor=c<<3};a.updateNRx4=function(b){var c=1===(h.frameSequencer&1),d=!a.NRx4LengthEnabled&&g(6,b);!c&&0<a.lengthCounter&&d&&(--a.lengthCounter,g(7,b)||0!==a.lengthCounter||(a.isEnabled=!1));a.NRx4LengthEnabled=g(6,b);g(7,b)&&(a.trigger(),!c&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=function(){e[1024+50*a.saveStateSlot]=
a.cycleCounter;e[1028+50*a.saveStateSlot]=a.NRx1LengthLoad;e[1030+50*a.saveStateSlot]=a.NRx2StartingVolume;e[1031+50*a.saveStateSlot]=a.NRx2EnvelopeAddMode;e[1032+50*a.saveStateSlot]=a.NRx2EnvelopePeriod;e[1033+50*a.saveStateSlot]=a.NRx3ClockShift;e[1034+50*a.saveStateSlot]=a.NRx3WidthMode;e[1035+50*a.saveStateSlot]=a.NRx3DivisorCode;e[1037+50*a.saveStateSlot]=a.NRx4LengthEnabled;e[1039+50*a.saveStateSlot]=a.isEnabled;e[1040+50*a.saveStateSlot]=a.isDacEnabled;e[1045+50*a.saveStateSlot]=a.frequencyTimer;
e[1049+50*a.saveStateSlot]=a.envelopeCounter;e[1053+50*a.saveStateSlot]=a.isEnvelopeAutomaticUpdating;e[1054+50*a.saveStateSlot]=a.lengthCounter;e[1058+50*a.saveStateSlot]=a.volume;e[1062+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};a.loadState=function(){a.cycleCounter=e[1024+50*a.cycleCounter];a.NRx1LengthLoad=e[1028+50*a.saveStateSlot];a.NRx2StartingVolume=e[1030+50*a.saveStateSlot];a.NRx2EnvelopeAddMode=k(1031+50*a.saveStateSlot);a.NRx2EnvelopePeriod=e[1032+50*a.saveStateSlot];a.NRx3ClockShift=
e[1033+50*a.saveStateSlot];a.NRx3WidthMode=k(1034+50*a.saveStateSlot);a.NRx3DivisorCode=e[1035+50*a.saveStateSlot];a.NRx4LengthEnabled=k(1037+50*a.saveStateSlot);a.isEnabled=k(1039+50*a.saveStateSlot);a.isDacEnabled=k(1040+50*a.saveStateSlot);a.frequencyTimer=e[1045+50*a.saveStateSlot];a.envelopeCounter=e[1049+50*a.saveStateSlot];a.isEnvelopeAutomaticUpdating=k(1053+50*a.saveStateSlot);a.lengthCounter=e[1054+50*a.saveStateSlot];a.volume=e[1058+50*a.saveStateSlot];a.linearFeedbackShiftRegister=e[1062+
50*a.saveStateSlot]};a.initialize=function(){f(a.memoryLocationNRx1-1,255);f(a.memoryLocationNRx1,255);f(a.memoryLocationNRx2,0);f(a.memoryLocationNRx3,0);f(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.getSample=function(b){var c=a.frequencyTimer;c-=b;if(0>=c){b=Math.abs(c);c=a.getNoiseChannelFrequencyPeriod();c-=b;b=a.linearFeedbackShiftRegister;var d=b&1^b>>1&1;b=b>>1|d<<14;a.NRx3WidthMode&&(b=b&-65|d<<6);a.linearFeedbackShiftRegister=
b}0>c&&(c=0);a.frequencyTimer=c;if(a.isEnabled&&a.isDacEnabled)c=a.volume&15;else return 15;b=g(0,a.linearFeedbackShiftRegister)?-1:1;return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=a.MAX_LENGTH);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=0===a.NRx2EnvelopePeriod?8:a.NRx2EnvelopePeriod;a.isEnvelopeAutomaticUpdating=!0;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=
function(b){a.cycleCounter+=b;return!(0<a.frequencyTimer-a.cycleCounter)};a.getNoiseChannelFrequencyPeriod=function(){return a.divisor<<a.NRx3ClockShift<<b.GBCDoubleSpeed};a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.updateEnvelope=function(){var b=a.envelopeCounter-1;if(0>=b)if(0===a.NRx2EnvelopePeriod)b=8;else if(b=a.NRx2EnvelopePeriod,0!==b&&a.isEnvelopeAutomaticUpdating){var d=a.volume;d=a.NRx2EnvelopeAddMode?d+1:d-
1;d&=15;15>d?a.volume=d:a.isEnvelopeAutomaticUpdating=!1}a.envelopeCounter=b};a.cycleCounter=0;a.MAX_LENGTH=64;a.memoryLocationNRx0=65311;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=
0;a.isEnvelopeAutomaticUpdating=!1;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),p=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=!1;a.channel2DacEnabled=!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),h=
function(){function a(){}a.batchProcessCycles=function(){return 87<<b.GBCDoubleSpeed};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=g(7,b);a.NR51IsChannel3EnabledOnLeftOutput=g(6,b);a.NR51IsChannel2EnabledOnLeftOutput=g(5,b);a.NR51IsChannel1EnabledOnLeftOutput=g(4,b);a.NR51IsChannel4EnabledOnRightOutput=g(3,b);a.NR51IsChannel3EnabledOnRightOutput=g(2,b);a.NR51IsChannel2EnabledOnRightOutput=g(1,b);a.NR51IsChannel1EnabledOnRightOutput=
g(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=g(7,b)};a.maxFrameSequenceCycles=function(){return 8192<<b.GBCDoubleSpeed};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()/a.sampleRate};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.NR50LeftMixerVolume;e[1028+50*a.saveStateSlot]=a.NR50RightMixerVolume;e[1032+50*a.saveStateSlot]=a.NR51IsChannel1EnabledOnLeftOutput;e[1033+50*a.saveStateSlot]=a.NR51IsChannel2EnabledOnLeftOutput;e[1034+50*a.saveStateSlot]=a.NR51IsChannel3EnabledOnLeftOutput;
e[1035+50*a.saveStateSlot]=a.NR51IsChannel4EnabledOnLeftOutput;e[1036+50*a.saveStateSlot]=a.NR51IsChannel1EnabledOnRightOutput;e[1037+50*a.saveStateSlot]=a.NR51IsChannel2EnabledOnRightOutput;e[1038+50*a.saveStateSlot]=a.NR51IsChannel3EnabledOnRightOutput;e[1039+50*a.saveStateSlot]=a.NR51IsChannel4EnabledOnRightOutput;e[1040+50*a.saveStateSlot]=a.NR52IsSoundEnabled;e[1041+50*a.saveStateSlot]=a.frameSequenceCycleCounter;e[1046+50*a.saveStateSlot]=a.frameSequencer;e[1047+50*a.saveStateSlot]=a.downSampleCycleCounter;
e[1048+50*a.saveStateSlot]=p.channel1Sample;e[1049+50*a.saveStateSlot]=p.channel2Sample;e[1050+50*a.saveStateSlot]=p.channel3Sample;e[1051+50*a.saveStateSlot]=p.channel4Sample;e[1052+50*a.saveStateSlot]=p.channel1DacEnabled;e[1053+50*a.saveStateSlot]=p.channel2DacEnabled;e[1054+50*a.saveStateSlot]=p.channel3DacEnabled;e[1055+50*a.saveStateSlot]=p.channel4DacEnabled;e[1056+50*a.saveStateSlot]=p.leftChannelSampleUnsignedByte;e[1057+50*a.saveStateSlot]=p.rightChannelSampleUnsignedByte;e[1058+50*a.saveStateSlot]=
p.mixerVolumeChanged;e[1059+50*a.saveStateSlot]=p.mixerEnabledChanged};a.loadState=function(){a.NR50LeftMixerVolume=e[1024+50*a.saveStateSlot];a.NR50RightMixerVolume=e[1028+50*a.saveStateSlot];a.NR51IsChannel1EnabledOnLeftOutput=k(1032+50*a.saveStateSlot);a.NR51IsChannel2EnabledOnLeftOutput=k(1033+50*a.saveStateSlot);a.NR51IsChannel3EnabledOnLeftOutput=k(1034+50*a.saveStateSlot);a.NR51IsChannel4EnabledOnLeftOutput=k(1035+50*a.saveStateSlot);a.NR51IsChannel1EnabledOnRightOutput=k(1036+50*a.saveStateSlot);
a.NR51IsChannel2EnabledOnRightOutput=k(1037+50*a.saveStateSlot);a.NR51IsChannel3EnabledOnRightOutput=k(1038+50*a.saveStateSlot);a.NR51IsChannel4EnabledOnRightOutput=k(1039+50*a.saveStateSlot);a.NR52IsSoundEnabled=k(1040+50*a.saveStateSlot);a.frameSequenceCycleCounter=e[1041+50*a.saveStateSlot];a.frameSequencer=e[1046+50*a.saveStateSlot];a.downSampleCycleCounter=e[1047+50*a.saveStateSlot];p.channel1Sample=e[1048+50*a.saveStateSlot];p.channel2Sample=e[1049+50*a.saveStateSlot];p.channel3Sample=e[1050+
50*a.saveStateSlot];p.channel4Sample=e[1051+50*a.saveStateSlot];p.channel1DacEnabled=k(1052+50*a.saveStateSlot);p.channel2DacEnabled=k(1053+50*a.saveStateSlot);p.channel3DacEnabled=k(1054+50*a.saveStateSlot);p.channel4DacEnabled=k(1055+50*a.saveStateSlot);p.leftChannelSampleUnsignedByte=e[1056+50*a.saveStateSlot];p.rightChannelSampleUnsignedByte=e[1057+50*a.saveStateSlot];p.mixerVolumeChanged=k(1058+50*a.saveStateSlot);p.mixerEnabledChanged=k(1059+50*a.saveStateSlot);gc()};a.currentCycles=0;a.memoryLocationNR50=
65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=
0;a.frameSequencer=0;a.downSampleCycleCounter=0;a.sampleRate=44100;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),m=function(){function a(){}a.updateInterruptEnabled=function(b){a.isVBlankInterruptEnabled=g(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=g(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=g(a.bitPositionTimerInterrupt,b);a.isSerialInterruptEnabled=g(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptEnabled=g(a.bitPositionJoypadInterrupt,
b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=g(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=g(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=g(a.bitPositionTimerInterrupt,b);a.isSerialInterruptRequested=g(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptRequested=g(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&
31)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.masterInterruptSwitch;e[1025+50*a.saveStateSlot]=a.masterInterruptSwitchDelay;e[1040+50*a.saveStateSlot]=a.interruptsEnabledValue;e[1041+50*a.saveStateSlot]=a.isVBlankInterruptEnabled;e[1042+50*a.saveStateSlot]=a.isLcdInterruptEnabled;e[1043+50*a.saveStateSlot]=a.isTimerInterruptEnabled;e[1044+50*a.saveStateSlot]=a.isSerialInterruptEnabled;e[1045+50*a.saveStateSlot]=a.isJoypadInterruptEnabled;e[1056+50*a.saveStateSlot]=a.interruptsRequestedValue;
e[1057+50*a.saveStateSlot]=a.isVBlankInterruptRequested;e[1058+50*a.saveStateSlot]=a.isLcdInterruptRequested;e[1059+50*a.saveStateSlot]=a.isTimerInterruptRequested;e[1060+50*a.saveStateSlot]=a.isSerialInterruptRequested;e[1061+50*a.saveStateSlot]=a.isJoypadInterruptRequested};a.loadState=function(){a.masterInterruptSwitch=k(1024+50*a.saveStateSlot);a.masterInterruptSwitchDelay=k(1025+50*a.saveStateSlot);a.interruptsEnabledValue=e[1040+50*a.saveStateSlot];a.isVBlankInterruptEnabled=k(1041+50*a.saveStateSlot);
a.isLcdInterruptEnabled=k(1042+50*a.saveStateSlot);a.isTimerInterruptEnabled=k(1043+50*a.saveStateSlot);a.isSerialInterruptEnabled=k(1044+50*a.saveStateSlot);a.isJoypadInterruptEnabled=k(1045+50*a.saveStateSlot);a.interruptsRequestedValue=e[1056+50*a.saveStateSlot];a.isVBlankInterruptRequested=k(1057+50*a.saveStateSlot);a.isLcdInterruptRequested=k(1058+50*a.saveStateSlot);a.isTimerInterruptRequested=k(1059+50*a.saveStateSlot);a.isSerialInterruptRequested=k(1060+50*a.saveStateSlot);a.isJoypadInterruptRequested=
k(1061+50*a.saveStateSlot)};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionSerialInterrupt=3;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isSerialInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=
0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=!1;a.isSerialInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}(),w=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(){var b=a.dividerRegister;a.dividerRegister=0;f(a.memoryLocationDividerRegister,0);a.timerEnabled&&ic(b,0)&&Lb()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&
(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=b,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=g(2,b);b&=3;if(!c){c=Mb(a.timerInputClock);var d=Mb(b),e=a.dividerRegister;(a.timerEnabled?g(c,e):g(c,e)&&g(d,e))&&Lb()}a.timerInputClock=b};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.currentCycles;e[1028+50*a.saveStateSlot]=a.dividerRegister;
e[1032+50*a.saveStateSlot]=a.timerCounter;e[1036+50*a.saveStateSlot]=a.timerCounterOverflowDelay;e[1037+50*a.saveStateSlot]=a.timerCounterWasReset;e[1038+50*a.saveStateSlot]=a.timerCounterMask;e[1042+50*a.saveStateSlot]=a.timerModulo;e[1046+50*a.saveStateSlot]=a.timerEnabled;e[1047+50*a.saveStateSlot]=a.timerInputClock};a.loadState=function(){a.currentCycles=e[1024+50*a.saveStateSlot];a.dividerRegister=e[1028+50*a.saveStateSlot];a.timerCounter=e[1032+50*a.saveStateSlot];a.timerCounterOverflowDelay=
k(1036+50*a.saveStateSlot);a.timerCounterWasReset=k(1037+50*a.saveStateSlot);a.timerCounterMask=e[1038+50*a.saveStateSlot];a.timerModulo=e[1042+50*a.saveStateSlot];a.timerEnabled=k(1046+50*a.saveStateSlot);a.timerInputClock=e[1047+50*a.saveStateSlot]};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=
0;a.memoryLocationTimerControl=65287;a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),Z=function(){function a(){}a.updateTransferControl=function(b){a.isShiftClockInternal=g(0,b);a.isClockSpeedFast=g(1,b);a.transferStartFlag=g(7,b);return!0};a.currentCycles=0;a.memoryLocationSerialTransferData=65281;a.memoryLocationSerialTransferControl=65282;a.numberOfBitsTransferred=0;a.isShiftClockInternal=!1;a.isClockSpeedFast=!1;a.transferStartFlag=!1;return a}(),E=function(){function a(){}
a.updateJoypad=function(b){a.joypadRegisterFlipped=b^255;a.isDpadType=g(4,a.joypadRegisterFlipped);a.isButtonType=g(5,a.joypadRegisterFlipped)};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.joypadRegisterFlipped;e[1025+50*a.saveStateSlot]=a.isDpadType;e[1026+50*a.saveStateSlot]=a.isButtonType};a.loadState=function(){a.joypadRegisterFlipped=e[1024+50*a.saveStateSlot];a.isDpadType=k(1025+50*a.saveStateSlot);a.isButtonType=k(1026+50*a.saveStateSlot)};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=
!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),aa=function(){function a(){}a.programCounter=-1;a.readGbMemory=-1;a.writeGbMemory=-1;a.reachedBreakpoint=!1;return a}(),u=function(){function a(){}a.updateLcdStatus=function(b){var c=v(a.memoryLocationLcdStatus);b=b&248|c&7|128;f(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){var c=a.enabled;a.enabled=g(7,b);a.windowTileMapDisplaySelect=
g(6,b);a.windowDisplayEnabled=g(5,b);a.bgWindowTileDataSelect=g(4,b);a.bgTileMapDisplaySelect=g(3,b);a.tallSpriteSize=g(2,b);a.spriteDisplayEnable=g(1,b);a.bgDisplayEnabled=g(0,b);c&&!a.enabled&&kc(!0);!c&&a.enabled&&kc(!1)};a.memoryLocationLcdStatus=65345;a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=
!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}(),r=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return 153===a.scanlineRegister?4<<b.GBCDoubleSpeed:456<<b.GBCDoubleSpeed};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return 376<<b.GBCDoubleSpeed};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return 249<<b.GBCDoubleSpeed};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;e[1028+50*a.saveStateSlot]=
a.scanlineRegister;e[1029+50*a.saveStateSlot]=a.scrollX;e[1030+50*a.saveStateSlot]=a.scrollY;e[1031+50*a.saveStateSlot]=a.windowX;e[1032+50*a.saveStateSlot]=a.windowY;e[1033+50*a.saveStateSlot]=u.currentLcdMode;e[1034+50*a.saveStateSlot]=u.coincidenceCompare;e[1035+50*a.saveStateSlot]=u.enabled;e[1036+50*a.saveStateSlot]=u.windowTileMapDisplaySelect;e[1037+50*a.saveStateSlot]=u.windowDisplayEnabled;e[1038+50*a.saveStateSlot]=u.bgWindowTileDataSelect;e[1039+50*a.saveStateSlot]=u.bgTileMapDisplaySelect;
e[1040+50*a.saveStateSlot]=u.tallSpriteSize;e[1041+50*a.saveStateSlot]=u.spriteDisplayEnable;e[1042+50*a.saveStateSlot]=u.bgDisplayEnabled};a.loadState=function(){a.scanlineCycleCounter=e[1024+50*a.saveStateSlot];a.scanlineRegister=e[1028+50*a.scanlineRegister];a.scrollX=e[1029+50*a.saveStateSlot];a.scrollY=e[1030+50*a.saveStateSlot];a.windowX=e[1031+50*a.saveStateSlot];a.windowY=e[1032+50*a.saveStateSlot];u.currentLcdMode=e[1033+50*a.saveStateSlot];u.coincidenceCompare=e[1034+50*a.saveStateSlot];
u.enabled=k(1035+50*a.saveStateSlot);u.windowTileMapDisplaySelect=k(1036+50*a.saveStateSlot);u.windowDisplayEnabled=k(1037+50*a.saveStateSlot);u.bgWindowTileDataSelect=k(1038+50*a.saveStateSlot);u.bgTileMapDisplaySelect=k(1039+50*a.saveStateSlot);u.tallSpriteSize=k(1040+50*a.saveStateSlot);u.spriteDisplayEnable=k(1041+50*a.saveStateSlot);u.bgDisplayEnabled=k(1042+50*a.saveStateSlot)};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=
65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=34816;a.memoryLocationTileDataSelectOneStart=32768;a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=
65353;a.saveStateSlot=1;return a}(),n=function(){function a(){}a.saveState=function(){e[1024+50*a.saveStateSlot]=a.currentRomBank;e[1026+50*a.saveStateSlot]=a.currentRamBank;e[1028+50*a.saveStateSlot]=a.isRamBankingEnabled;e[1029+50*a.saveStateSlot]=a.isMBC1RomModeEnabled;e[1030+50*a.saveStateSlot]=a.isRomOnly;e[1031+50*a.saveStateSlot]=a.isMBC1;e[1032+50*a.saveStateSlot]=a.isMBC2;e[1033+50*a.saveStateSlot]=a.isMBC3;e[1034+50*a.saveStateSlot]=a.isMBC5;e[1035+50*a.saveStateSlot]=a.DMACycles;e[1039+
50*a.saveStateSlot]=a.isHblankHdmaActive;e[1040+50*a.saveStateSlot]=a.hblankHdmaTransferLengthRemaining;e[1044+50*a.saveStateSlot]=a.hblankHdmaSource;e[1048+50*a.saveStateSlot]=a.hblankHdmaDestination};a.loadState=function(){a.currentRomBank=e[1024+50*a.saveStateSlot];a.currentRamBank=e[1026+50*a.saveStateSlot];a.isRamBankingEnabled=k(1028+50*a.saveStateSlot);a.isMBC1RomModeEnabled=k(1029+50*a.saveStateSlot);a.isRomOnly=k(1030+50*a.saveStateSlot);a.isMBC1=k(1031+50*a.saveStateSlot);a.isMBC2=k(1032+
50*a.saveStateSlot);a.isMBC3=k(1033+50*a.saveStateSlot);a.isMBC5=k(1034+50*a.saveStateSlot);a.DMACycles=e[1035+50*a.saveStateSlot];a.isHblankHdmaActive=k(1039+50*a.saveStateSlot);a.hblankHdmaTransferLengthRemaining=e[1040+50*a.saveStateSlot];a.hblankHdmaSource=e[1044+50*a.saveStateSlot];a.hblankHdmaDestination=e[1048+50*a.saveStateSlot]};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=
53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=
65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return 4194304<<a.GBCDoubleSpeed};a.MAX_CYCLES_PER_FRAME=function(){return 70224<<a.GBCDoubleSpeed};a.enableHalt=function(){m.masterInterruptSwitch?a.isHaltNormal=!0:0===(m.interruptsEnabledValue&m.interruptsRequestedValue&
31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=!1;a.isHaltBug=!1;a.isStopped=!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump};a.saveState=function(){e[1024+50*a.saveStateSlot]=a.registerA;e[1025+50*a.saveStateSlot]=a.registerB;e[1026+50*a.saveStateSlot]=a.registerC;e[1027+50*a.saveStateSlot]=a.registerD;e[1028+50*a.saveStateSlot]=a.registerE;e[1029+50*a.saveStateSlot]=a.registerH;e[1030+50*a.saveStateSlot]=a.registerL;e[1031+50*
a.saveStateSlot]=a.registerF;e[1032+50*a.saveStateSlot]=a.stackPointer;e[1034+50*a.saveStateSlot]=a.programCounter;e[1036+50*a.saveStateSlot]=a.currentCycles;e[1041+50*a.saveStateSlot]=a.isHaltNormal;e[1042+50*a.saveStateSlot]=a.isHaltNoJump;e[1043+50*a.saveStateSlot]=a.isHaltBug;e[1044+50*a.saveStateSlot]=a.isStopped;e[1045+50*a.saveStateSlot]=a.BootROMEnabled;e[1046+50*a.saveStateSlot]=a.GBCEnabled;e[1047+50*a.saveStateSlot]=a.GBCDoubleSpeed};a.loadState=function(){a.registerA=e[1024+50*a.saveStateSlot];
a.registerB=e[1025+50*a.saveStateSlot];a.registerC=e[1026+50*a.saveStateSlot];a.registerD=e[1027+50*a.saveStateSlot];a.registerE=e[1028+50*a.saveStateSlot];a.registerH=e[1029+50*a.saveStateSlot];a.registerL=e[1030+50*a.saveStateSlot];a.registerF=e[1031+50*a.saveStateSlot];a.stackPointer=e[1032+50*a.saveStateSlot];a.programCounter=e[1034+50*a.saveStateSlot];a.currentCycles=e[1036+50*a.saveStateSlot];a.isHaltNormal=k(1041+50*a.saveStateSlot);a.isHaltNoJump=k(1042+50*a.saveStateSlot);a.isHaltBug=k(1043+
50*a.saveStateSlot);a.isStopped=k(1044+50*a.saveStateSlot);a.BootROMEnabled=k(1045+50*a.saveStateSlot);a.GBCEnabled=k(1046+50*a.saveStateSlot);a.GBCDoubleSpeed=k(1047+50*a.saveStateSlot)};a.memoryLocationBootROMSwitch=65360;a.BootROMEnabled=!1;a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=
!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}(),da=function(){function a(){}a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=0;return a}(),V=function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;a.RESPONSE_CONDITION_ERROR=-1;a.RESPONSE_CONDITION_FRAME=0;a.RESPONSE_CONDITION_AUDIO=1;a.RESPONSE_CONDITION_BREAKPOINT=2;return a}();mb.size()<Zb&&mb.grow(Zb-mb.size());var kb=!1,Xc=Object.freeze({memory:mb,config:function(a,c,e,g,k,l,q,u,x,A){Q.enableBootRom=0<a;Q.useGbcWhenAvailable=
0<c;Q.audioBatchProcessing=0<e;Q.graphicsBatchProcessing=0<g;Q.timersBatchProcessing=0<k;Q.graphicsDisableScanlineRendering=0<l;Q.audioAccumulateSamples=0<q;Q.tileRendering=0<u;Q.tileCaching=0<x;Q.enableAudioDebugging=0<A;a=v(323);b.GBCEnabled=192===a||Q.useGbcWhenAvailable&&128===a?!0:!1;kb=!1;da.cyclesPerCycleSet=2E9;da.cycleSets=0;da.cycles=0;V.stepsPerStepSet=2E9;V.stepSets=0;V.steps=0;b.BootROMEnabled=Q.enableBootRom?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=
0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=0;b.currentCycles=0;b.isHaltNormal=!1;b.isHaltNoJump=!1;b.isHaltBug=!1;b.isStopped=!1;b.BootROMEnabled||(b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77),b.programCounter=256,b.stackPointer=65534);n.isRamBankingEnabled=
!1;n.isMBC1RomModeEnabled=!0;a=v(327);n.isRomOnly=0===a;n.isMBC1=1<=a&&3>=a;n.isMBC2=5<=a&&6>=a;n.isMBC3=15<=a&&19>=a;n.isMBC5=25<=a&&30>=a;n.currentRomBank=1;n.currentRamBank=0;f(n.memoryLocationGBCVRAMBank,0);f(n.memoryLocationGBCWRAMBank,1);f(65361,255);f(65362,255);f(65363,255);f(65364,255);f(65365,255);r.currentCycles=0;r.scanlineCycleCounter=0;r.scanlineRegister=0;r.scrollX=0;r.scrollY=0;r.windowX=0;r.windowY=0;r.scanlineRegister=144;b.GBCEnabled?(f(65345,129),f(65348,144),f(65351,252)):(f(65345,
133),f(65350,255),f(65351,252),f(65352,255),f(65353,255));r.scanlineRegister=144;f(65344,145);f(65359,0);f(65392,1);b.BootROMEnabled&&(b.GBCEnabled?(r.scanlineRegister=0,f(65344,0),f(65345,128),f(65348,0)):(r.scanlineRegister=0,f(65344,0),f(65345,132)));bc(0);if(!b.GBCEnabled&&(!b.BootROMEnabled||b.GBCEnabled)){a=0;for(c=308;323>=c;c++)a+=v(c);switch(a&255){case 136:d.bgWhite=va.bgWhite;d.bgLightGrey=va.bgLightGrey;d.bgDarkGrey=va.bgDarkGrey;d.bgBlack=va.bgBlack;d.obj0White=va.obj0White;d.obj0LightGrey=
va.obj0LightGrey;d.obj0DarkGrey=va.obj0DarkGrey;d.obj0Black=va.obj0Black;d.obj1White=va.obj1White;d.obj1LightGrey=va.obj1LightGrey;d.obj1DarkGrey=va.obj1DarkGrey;d.obj1Black=va.obj1Black;break;case 97:d.bgWhite=wa.bgWhite;d.bgLightGrey=wa.bgLightGrey;d.bgDarkGrey=wa.bgDarkGrey;d.bgBlack=wa.bgBlack;d.obj0White=wa.obj0White;d.obj0LightGrey=wa.obj0LightGrey;d.obj0DarkGrey=wa.obj0DarkGrey;d.obj0Black=wa.obj0Black;d.obj1White=wa.obj1White;d.obj1LightGrey=wa.obj1LightGrey;d.obj1DarkGrey=wa.obj1DarkGrey;
d.obj1Black=wa.obj1Black;break;case 20:d.bgWhite=xa.bgWhite;d.bgLightGrey=xa.bgLightGrey;d.bgDarkGrey=xa.bgDarkGrey;d.bgBlack=xa.bgBlack;d.obj0White=xa.obj0White;d.obj0LightGrey=xa.obj0LightGrey;d.obj0DarkGrey=xa.obj0DarkGrey;d.obj0Black=xa.obj0Black;d.obj1White=xa.obj1White;d.obj1LightGrey=xa.obj1LightGrey;d.obj1DarkGrey=xa.obj1DarkGrey;d.obj1Black=xa.obj1Black;break;case 70:d.bgWhite=ya.bgWhite;d.bgLightGrey=ya.bgLightGrey;d.bgDarkGrey=ya.bgDarkGrey;d.bgBlack=ya.bgBlack;d.obj0White=ya.obj0White;
d.obj0LightGrey=ya.obj0LightGrey;d.obj0DarkGrey=ya.obj0DarkGrey;d.obj0Black=ya.obj0Black;d.obj1White=ya.obj1White;d.obj1LightGrey=ya.obj1LightGrey;d.obj1DarkGrey=ya.obj1DarkGrey;d.obj1Black=ya.obj1Black;break;case 89:case 198:d.bgWhite=za.bgWhite;d.bgLightGrey=za.bgLightGrey;d.bgDarkGrey=za.bgDarkGrey;d.bgBlack=za.bgBlack;d.obj0White=za.obj0White;d.obj0LightGrey=za.obj0LightGrey;d.obj0DarkGrey=za.obj0DarkGrey;d.obj0Black=za.obj0Black;d.obj1White=za.obj1White;d.obj1LightGrey=za.obj1LightGrey;d.obj1DarkGrey=
za.obj1DarkGrey;d.obj1Black=za.obj1Black;break;case 134:case 168:d.bgWhite=Aa.bgWhite;d.bgLightGrey=Aa.bgLightGrey;d.bgDarkGrey=Aa.bgDarkGrey;d.bgBlack=Aa.bgBlack;d.obj0White=Aa.obj0White;d.obj0LightGrey=Aa.obj0LightGrey;d.obj0DarkGrey=Aa.obj0DarkGrey;d.obj0Black=Aa.obj0Black;d.obj1White=Aa.obj1White;d.obj1LightGrey=Aa.obj1LightGrey;d.obj1DarkGrey=Aa.obj1DarkGrey;d.obj1Black=Aa.obj1Black;break;case 191:case 206:case 209:case 240:d.bgWhite=Ba.bgWhite;d.bgLightGrey=Ba.bgLightGrey;d.bgDarkGrey=Ba.bgDarkGrey;
d.bgBlack=Ba.bgBlack;d.obj0White=Ba.obj0White;d.obj0LightGrey=Ba.obj0LightGrey;d.obj0DarkGrey=Ba.obj0DarkGrey;d.obj0Black=Ba.obj0Black;d.obj1White=Ba.obj1White;d.obj1LightGrey=Ba.obj1LightGrey;d.obj1DarkGrey=Ba.obj1DarkGrey;d.obj1Black=Ba.obj1Black;break;case 39:case 73:case 92:case 179:d.bgWhite=Ca.bgWhite;d.bgLightGrey=Ca.bgLightGrey;d.bgDarkGrey=Ca.bgDarkGrey;d.bgBlack=Ca.bgBlack;d.obj0White=Ca.obj0White;d.obj0LightGrey=Ca.obj0LightGrey;d.obj0DarkGrey=Ca.obj0DarkGrey;d.obj0Black=Ca.obj0Black;d.obj1White=
Ca.obj1White;d.obj1LightGrey=Ca.obj1LightGrey;d.obj1DarkGrey=Ca.obj1DarkGrey;d.obj1Black=Ca.obj1Black;break;case 201:d.bgWhite=Da.bgWhite;d.bgLightGrey=Da.bgLightGrey;d.bgDarkGrey=Da.bgDarkGrey;d.bgBlack=Da.bgBlack;d.obj0White=Da.obj0White;d.obj0LightGrey=Da.obj0LightGrey;d.obj0DarkGrey=Da.obj0DarkGrey;d.obj0Black=Da.obj0Black;d.obj1White=Da.obj1White;d.obj1LightGrey=Da.obj1LightGrey;d.obj1DarkGrey=Da.obj1DarkGrey;d.obj1Black=Da.obj1Black;break;case 112:d.bgWhite=Ea.bgWhite;d.bgLightGrey=Ea.bgLightGrey;
d.bgDarkGrey=Ea.bgDarkGrey;d.bgBlack=Ea.bgBlack;d.obj0White=Ea.obj0White;d.obj0LightGrey=Ea.obj0LightGrey;d.obj0DarkGrey=Ea.obj0DarkGrey;d.obj0Black=Ea.obj0Black;d.obj1White=Ea.obj1White;d.obj1LightGrey=Ea.obj1LightGrey;d.obj1DarkGrey=Ea.obj1DarkGrey;d.obj1Black=Ea.obj1Black;break;case 70:d.bgWhite=Fa.bgWhite;d.bgLightGrey=Fa.bgLightGrey;d.bgDarkGrey=Fa.bgDarkGrey;d.bgBlack=Fa.bgBlack;d.obj0White=Fa.obj0White;d.obj0LightGrey=Fa.obj0LightGrey;d.obj0DarkGrey=Fa.obj0DarkGrey;d.obj0Black=Fa.obj0Black;
d.obj1White=Fa.obj1White;d.obj1LightGrey=Fa.obj1LightGrey;d.obj1DarkGrey=Fa.obj1DarkGrey;d.obj1Black=Fa.obj1Black;break;case 211:d.bgWhite=Ga.bgWhite,d.bgLightGrey=Ga.bgLightGrey,d.bgDarkGrey=Ga.bgDarkGrey,d.bgBlack=Ga.bgBlack,d.obj0White=Ga.obj0White,d.obj0LightGrey=Ga.obj0LightGrey,d.obj0DarkGrey=Ga.obj0DarkGrey,d.obj0Black=Ga.obj0Black,d.obj1White=Ga.obj1White,d.obj1LightGrey=Ga.obj1LightGrey,d.obj1DarkGrey=Ga.obj1DarkGrey,d.obj1Black=Ga.obj1Black}}b.GBCEnabled?(f(65384,192),f(65385,255),f(65386,
193),f(65387,13)):(f(65384,255),f(65385,255),f(65386,255),f(65387,255));b.BootROMEnabled&&b.GBCEnabled&&(f(65385,32),f(65387,138));h.currentCycles=0;h.NR50LeftMixerVolume=0;h.NR50RightMixerVolume=0;h.NR51IsChannel1EnabledOnLeftOutput=!0;h.NR51IsChannel2EnabledOnLeftOutput=!0;h.NR51IsChannel3EnabledOnLeftOutput=!0;h.NR51IsChannel4EnabledOnLeftOutput=!0;h.NR51IsChannel1EnabledOnRightOutput=!0;h.NR51IsChannel2EnabledOnRightOutput=!0;h.NR51IsChannel3EnabledOnRightOutput=!0;h.NR51IsChannel4EnabledOnRightOutput=
!0;h.NR52IsSoundEnabled=!0;h.frameSequenceCycleCounter=0;h.downSampleCycleCounter=0;h.frameSequencer=0;h.audioQueueIndex=0;y.initialize();D.initialize();t.initialize();F.initialize();f(h.memoryLocationNR50,119);h.updateNR50(119);f(h.memoryLocationNR51,243);h.updateNR51(243);f(h.memoryLocationNR52,241);h.updateNR52(241);b.BootROMEnabled&&(f(h.memoryLocationNR50,0),h.updateNR50(0),f(h.memoryLocationNR51,0),h.updateNR51(0),f(h.memoryLocationNR52,112),h.updateNR52(112));p.channel1Sample=15;p.channel2Sample=
15;p.channel3Sample=15;p.channel4Sample=15;p.channel1DacEnabled=!1;p.channel2DacEnabled=!1;p.channel3DacEnabled=!1;p.channel4DacEnabled=!1;p.leftChannelSampleUnsignedByte=127;p.rightChannelSampleUnsignedByte=127;p.mixerVolumeChanged=!0;p.mixerEnabledChanged=!0;p.needToRemixSamples=!1;m.updateInterruptEnabled(0);f(m.memoryLocationInterruptEnabled,m.interruptsEnabledValue);m.updateInterruptRequested(225);f(m.memoryLocationInterruptRequest,m.interruptsRequestedValue);w.currentCycles=0;w.dividerRegister=
0;w.timerCounter=0;w.timerModulo=0;w.timerEnabled=!1;w.timerInputClock=0;w.timerCounterOverflowDelay=!1;w.timerCounterWasReset=!1;b.GBCEnabled?(f(65284,30),w.dividerRegister=7840):(f(65284,171),w.dividerRegister=43980);f(65287,248);w.timerInputClock=248;b.BootROMEnabled&&!b.GBCEnabled&&(f(65284,0),w.dividerRegister=4);Z.currentCycles=0;Z.numberOfBitsTransferred=0;b.GBCEnabled?(f(65282,124),Z.updateTransferControl(124)):(f(65282,126),Z.updateTransferControl(126));b.GBCEnabled?(f(65392,248),f(65359,
254),f(65357,126),f(65280,207),f(65295,225),f(65388,254),f(65397,143)):(f(65392,255),f(65359,255),f(65357,255),f(65280,207),f(65295,225))},hasCoreStarted:function(){return kb},saveState:function(){b.saveState();r.saveState();m.saveState();E.saveState();n.saveState();w.saveState();h.saveState();y.saveState();D.saveState();t.saveState();F.saveState();kb=!1},loadState:function(){b.loadState();r.loadState();m.loadState();E.loadState();n.loadState();w.loadState();h.loadState();y.loadState();D.loadState();
t.loadState();F.loadState();kb=!1;da.cyclesPerCycleSet=2E9;da.cycleSets=0;da.cycles=0;V.stepsPerStepSet=2E9;V.stepSets=0;V.steps=0},isGBC:function(){return b.GBCEnabled},getStepsPerStepSet:function(){return V.stepsPerStepSet},getStepSets:function(){return V.stepSets},getSteps:function(){return V.steps},executeMultipleFrames:function(a){for(var b=0,d=0;d<a&&0<=b;)b=pc(),d+=1;return 0>b?b:0},executeFrame:pc,executeFrameAndCheckAudio:function(a){void 0===a&&(a=0);return Ub(!0,a)},executeUntilCondition:Ub,
executeStep:qc,getCyclesPerCycleSet:function(){return da.cyclesPerCycleSet},getCycleSets:function(){return da.cycleSets},getCycles:function(){return da.cycles},setJoypadState:function(a,b,d,e,f,g,k,h){0<a?Ta(0):Ia(0,!1);0<b?Ta(1):Ia(1,!1);0<d?Ta(2):Ia(2,!1);0<e?Ta(3):Ia(3,!1);0<f?Ta(4):Ia(4,!1);0<g?Ta(5):Ia(5,!1);0<k?Ta(6):Ia(6,!1);0<h?Ta(7):Ia(7,!1)},getNumberOfSamplesInAudioBuffer:fc,clearAudioBuffer:gc,setManualColorizationPalette:bc,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:wc,WASMBOY_WASM_PAGES:Zb,
ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,GAMEBOY_INTERNAL_MEMORY_SIZE:Uc,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,GRAPHICS_OUTPUT_LOCATION:Vc,GRAPHICS_OUTPUT_SIZE:Wc,GBC_PALETTE_LOCATION:Ya,GBC_PALETTE_SIZE:128,BG_PRIORITY_MAP_LOCATION:Za,BG_PRIORITY_MAP_SIZE:23552,
FRAME_LOCATION:cb,FRAME_SIZE:93184,BACKGROUND_MAP_LOCATION:zb,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:Xb,TILE_DATA_SIZE:147456,OAM_TILES_LOCATION:Ab,OAM_TILES_SIZE:15360,AUDIO_BUFFER_LOCATION:ub,AUDIO_BUFFER_SIZE:131072,CHANNEL_1_BUFFER_LOCATION:Gb,CHANNEL_1_BUFFER_SIZE:131072,CHANNEL_2_BUFFER_LOCATION:Hb,CHANNEL_2_BUFFER_SIZE:131072,CHANNEL_3_BUFFER_LOCATION:Ib,CHANNEL_3_BUFFER_SIZE:131072,CHANNEL_4_BUFFER_LOCATION:Jb,CHANNEL_4_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:Rb,CARTRIDGE_RAM_SIZE:131072,
BOOT_ROM_LOCATION:wb,BOOT_ROM_SIZE:2560,CARTRIDGE_ROM_LOCATION:xb,CARTRIDGE_ROM_SIZE:8258560,DEBUG_GAMEBOY_MEMORY_LOCATION:Yb,DEBUG_GAMEBOY_MEMORY_SIZE:65535,getWasmBoyOffsetFromGameBoyOffset:Qb,setProgramCounterBreakpoint:function(a){aa.programCounter=a},resetProgramCounterBreakpoint:function(){aa.programCounter=-1},setReadGbMemoryBreakpoint:function(a){aa.readGbMemory=a},resetReadGbMemoryBreakpoint:function(){aa.readGbMemory=-1},setWriteGbMemoryBreakpoint:function(a){aa.writeGbMemory=a},resetWriteGbMemoryBreakpoint:function(){aa.writeGbMemory=
-1},getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},getRegisterD:function(){return b.registerD},getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},getStackPointer:function(){return b.stackPointer},getOpcodeAtProgramCounter:function(){return v(b.programCounter)},
getLY:function(){return r.scanlineRegister},getScrollX:function(){return r.scrollX},getScrollY:function(){return r.scrollY},getWindowX:function(){return r.windowX},getWindowY:function(){return r.windowY},drawBackgroundMapToWasmMemory:function(a){var c=r.memoryLocationTileDataSelectZeroStart;u.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);var d=r.memoryLocationTileMapSelectZeroStart;u.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);for(var f=0;256>f;f++)for(var k=
0;256>k;k++){var h=f,m=k,n=d+32*(h>>3)+(m>>3),l=X(n,0);l=gb(c,l);var p=h%8;h=m%8;h=7-h;m=0;b.GBCEnabled&&0<a&&(m=X(n,1));g(6,m)&&(p=7-p);var q=0;g(3,m)&&(q=1);n=X(l+2*p,q);l=X(l+2*p+1,q);p=0;g(h,l)&&(p+=1,p<<=1);g(h,n)&&(p+=1);l=3*(256*f+k);b.GBCEnabled&&0<a?(n=rb(m&7,p,!1),m=ua(0,n),h=ua(1,n),n=ua(2,n),l=zb+l,e[l]=m,e[l+1]=h,e[l+2]=n):(m=qb(p,r.memoryLocationBackgroundPalette),l=zb+l,e[l+0]=(m&16711680)>>16,e[l+1]=(m&65280)>>8,e[l+2]=m&255)}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var c=
0;31>c;c++){var d=0;15<c&&(d=1);var e=a;15<a&&(e-=15);e<<=4;e=15<c?e+(c-15):e+c;var f=r.memoryLocationTileDataSelectOneStart;15<a&&(f=r.memoryLocationTileDataSelectZeroStart);for(var h=r.memoryLocationBackgroundPalette,k=-1,m=-1,l=0;8>l;l++)for(var n=0;5>n;n++){var p=4*(8*n+l),q=v(r.memoryLocationSpriteAttributesTable+p+2);e===q&&(p=v(r.memoryLocationSpriteAttributesTable+p+3),q=0,b.GBCEnabled&&g(3,p)&&(q=1),q===d&&(m=p,l=8,n=5,h=r.memoryLocationSpritePaletteOne,g(4,m)&&(h=r.memoryLocationSpritePaletteTwo)))}if(b.GBCEnabled&&
0>m){l=r.memoryLocationTileMapSelectZeroStart;u.bgTileMapDisplaySelect&&(l=r.memoryLocationTileMapSelectOneStart);n=-1;for(p=0;32>p;p++)for(q=0;32>q;q++){var t=l+32*q+p,w=X(t,0);e===w&&(n=t,q=p=32)}0<=n&&(k=X(n,1))}for(l=0;8>l;l++)Eb(e,f,d,0,7,l,8*c,8*a+l,248,Xb,!1,h,k,m)}},drawOamToWasmMemory:function(){for(var a=0;8>a;a++)for(var c=0;5>c;c++){var d=4*(8*c+a);v(r.memoryLocationSpriteAttributesTable+d);v(r.memoryLocationSpriteAttributesTable+d+1);var e=v(r.memoryLocationSpriteAttributesTable+d+2),
f=1;u.tallSpriteSize&&(1===e%2&&--e,f+=1);d=v(r.memoryLocationSpriteAttributesTable+d+3);var h=0;b.GBCEnabled&&g(3,d)&&(h=1);var l=r.memoryLocationSpritePaletteOne;g(4,d)&&(l=r.memoryLocationSpritePaletteTwo);for(var k=0;k<f;k++)for(var m=0;8>m;m++)Eb(e+k,r.memoryLocationTileDataSelectOneStart,h,0,7,m,8*a,16*c+m+8*k,64,Ab,!1,l,-1,d)}},getDIV:function(){return w.dividerRegister},getTIMA:function(){return w.timerCounter},getTMA:function(){return w.timerModulo},getTAC:function(){var a=w.timerInputClock;
w.timerEnabled&&(a|=4);return a},updateDebugGBMemory:function(){for(var a=0;65535>a;a++){var b=Nb(a);e[Yb+a]=b}aa.reachedBreakpoint=!1}});let Yc=async()=>({instance:{exports:Xc},byteMemory:mb.wasmByteMemory,type:"TypeScript"}),lb,yb,tc,q;q={graphicsWorkerPort:void 0,memoryWorkerPort:void 0,controllerWorkerPort:void 0,audioWorkerPort:void 0,wasmInstance:void 0,wasmByteMemory:void 0,options:void 0,WASMBOY_BOOT_ROM_LOCATION:0,WASMBOY_GAME_BYTES_LOCATION:0,WASMBOY_GAME_RAM_BANKS_LOCATION:0,WASMBOY_INTERNAL_STATE_SIZE:0,
WASMBOY_INTERNAL_STATE_LOCATION:0,WASMBOY_INTERNAL_MEMORY_SIZE:0,WASMBOY_INTERNAL_MEMORY_LOCATION:0,WASMBOY_PALETTE_MEMORY_SIZE:0,WASMBOY_PALETTE_MEMORY_LOCATION:0,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:0,WASMBOY_CURRENT_FRAME_SIZE:0,WASMBOY_SOUND_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_1_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_2_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_3_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_4_OUTPUT_LOCATION:0,paused:!0,updateId:void 0,timeStampsUntilReady:0,fpsTimeStamps:[],speed:0,frameSkipCounter:0,
currentAudioLatencyInSeconds:0,messageHandler:a=>{let b=eb(a);switch(b.message.type){case B.CONNECT:"GRAPHICS"===b.message.workerId?(q.graphicsWorkerPort=b.message.ports[0],fb(xc.bind(void 0,q),q.graphicsWorkerPort)):"MEMORY"===b.message.workerId?(q.memoryWorkerPort=b.message.ports[0],fb(Ac.bind(void 0,q),q.memoryWorkerPort)):"CONTROLLER"===b.message.workerId?(q.controllerWorkerPort=b.message.ports[0],fb(zc.bind(void 0,q),q.controllerWorkerPort)):"AUDIO"===b.message.workerId&&(q.audioWorkerPort=b.message.ports[0],
fb(yc.bind(void 0,q),q.audioWorkerPort));ea(O(void 0,b.messageId));break;case B.INSTANTIATE_WASM:(async()=>{let a;a=await Yc();q.wasmInstance=a.instance;q.wasmByteMemory=a.byteMemory;ea(O({type:a.type},b.messageId))})();break;case B.CONFIG:q.wasmInstance.exports.config.apply(q,b.message.config);q.options=b.message.options;ea(O(void 0,b.messageId));break;case B.RESET_AUDIO_QUEUE:q.wasmInstance.exports.clearAudioBuffer();ea(O(void 0,b.messageId));break;case B.PLAY:if(!q.paused||!q.wasmInstance||!q.wasmByteMemory){ea(O({error:!0},
b.messageId));break}q.paused=!1;q.fpsTimeStamps=[];Vb(q);q.frameSkipCounter=0;q.currentAudioLatencyInSeconds=0;q.options.isGbcColorizationEnabled?q.options.gbcColorizationPalette&&q.wasmInstance.exports.setManualColorizationPalette("wasmboygb brown red darkbrown green darkgreen inverted pastelmix orange yellow blue darkblue grayscale".split(" ").indexOf(q.options.gbcColorizationPalette.toLowerCase())):q.wasmInstance.exports.setManualColorizationPalette(0);uc(q,1E3/q.options.gameboyFrameRate);ea(O(void 0,
b.messageId));break;case B.PAUSE:q.paused=!0;q.updateId&&(clearTimeout(q.updateId),q.updateId=void 0);ea(O(void 0,b.messageId));break;case B.RUN_WASM_EXPORT:a=b.message.parameters?q.wasmInstance.exports[b.message.export].apply(void 0,b.message.parameters):q.wasmInstance.exports[b.message.export]();ea(O({type:B.RUN_WASM_EXPORT,response:a},b.messageId));break;case B.GET_WASM_MEMORY_SECTION:{a=0;let c=q.wasmByteMemory.length;b.message.start&&(a=b.message.start);b.message.end&&(c=b.message.end);a=q.wasmByteMemory.slice(a,
c).buffer;ea(O({type:B.RUN_WASM_EXPORT,response:a},b.messageId),[a]);break}case B.GET_WASM_CONSTANT:ea(O({type:B.GET_WASM_CONSTANT,response:q.wasmInstance.exports[b.message.constant].valueOf()},b.messageId));break;case B.FORCE_OUTPUT_FRAME:rc(q);break;case B.SET_SPEED:q.speed=b.message.speed;q.fpsTimeStamps=[];q.timeStampsUntilReady=60;Vb(q);q.frameSkipCounter=0;q.currentAudioLatencyInSeconds=0;q.wasmInstance.exports.clearAudioBuffer();break;case B.IS_GBC:a=0<q.wasmInstance.exports.isGBC();ea(O({type:B.IS_GBC,
response:a},b.messageId));break;default:console.log("Unknown WasmBoy Worker message:",b)}},getFPS:()=>0<q.timeStampsUntilReady?q.speed&&0<q.speed?q.options.gameboyFrameRate*q.speed:q.options.gameboyFrameRate:q.fpsTimeStamps?q.fpsTimeStamps.length:0};fb(q.messageHandler)})()

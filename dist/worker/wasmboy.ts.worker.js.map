{"version":3,"file":"wasmboy.ts.worker.js","sources":["../../lib/worker/util.js","../../lib/worker/workerapi.js","../../lib/worker/constants.js","../../lib/worker/smartworker.js","../../lib/wasmboy/worker/graphics/onmessage.js","../../lib/wasmboy/worker/audio/onmessage.js","../../lib/wasmboy/worker/controller/onmessage.js","../../lib/wasmboy/worker/memory/rom.js","../../lib/wasmboy/worker/memory/ram.js","../../lib/wasmboy/worker/memory/header.js","../../lib/wasmboy/worker/memory/gameboymemory.js","../../lib/wasmboy/worker/memory/palettememory.js","../../lib/wasmboy/worker/memory/internalstate.js","../../lib/wasmboy/worker/memory/onmessage.js","../core/getWasmBoyTsCore.esm.js","../../lib/common/common.js","../../lib/wasmboy/worker/timestamp.js","../../lib/wasmboy/worker/graphics/transfer.js","../../lib/wasmboy/worker/update.js","../../lib/wasmboy/worker/wasmboy.worker.js"],"sourcesContent":["export function getEventData(event) {\n  if (event.data) {\n    return event.data;\n  }\n\n  return event;\n}\n\nexport const isInBrowser = typeof self !== 'undefined';\n\n// Function to read a base64 string as a buffer\nexport function readBase64String(base64String) {\n  if (isInBrowser) {\n    return base64String;\n  } else {\n    return readBase64Buffer(base64String).toString('utf8');\n  }\n}\n\nexport function readBase64Buffer(base64String) {\n  return Buffer.from(base64String.split(',')[1], 'base64');\n}\n","// Isomorphic worker api to be imported by web workers\n// https://medium.com/dailyjs/threads-in-node-10-5-0-a-practical-intro-3b85a0a3c953\n\n// Initilize some of our isomorphic values\nimport { isInBrowser } from './util';\n\nlet parentPort;\nif (!isInBrowser) {\n  parentPort = require('worker_threads').parentPort;\n}\n\n// https://nodejs.org/api/worker_threads.html#worker_threads_worker_postmessage_value_transferlist\n// https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage\nexport function postMessage(message, transferArray) {\n  // Can't bind parentPort.postMessage, so we need to kinda copy code here :p\n  if (isInBrowser) {\n    self.postMessage(message, transferArray);\n  } else {\n    parentPort.postMessage(message, transferArray);\n  }\n}\n\n// https://nodejs.org/api/worker_threads.html#worker_threads_worker_parentport\n// https://developer.mozilla.org/en-US/docs/Web/API/Worker/onmessage\nexport function onMessage(callback, port) {\n  if (!callback) {\n    console.error('workerapi: No callback was provided to onMessage!');\n  }\n\n  // If we passed a port, use that\n  if (port) {\n    if (isInBrowser) {\n      // We are in the browser\n      port.onmessage = callback;\n    } else {\n      // We are in Node\n      port.on('message', callback);\n    }\n    return;\n  }\n\n  if (isInBrowser) {\n    // We are in the browser\n    self.onmessage = callback;\n  } else {\n    // We are in Node\n    parentPort.on('message', callback);\n  }\n}\n","export const WORKER_MESSAGE_TYPE = {\n  CONNECT: 'CONNECT',\n  INSTANTIATE_WASM: 'INSTANTIATE_WASM',\n  CLEAR_MEMORY: 'CLEAR_MEMORY',\n  CLEAR_MEMORY_DONE: 'CLEAR_MEMORY_DONE',\n  GET_MEMORY: 'GET_MEMORY',\n  SET_MEMORY: 'SET_MEMORY',\n  SET_MEMORY_DONE: 'SET_MEMORY_DONE',\n  GET_CONSTANTS: 'GET_CONSTANTS',\n  GET_CONSTANTS_DONE: 'GET_CONSTANTS_DONE',\n  CONFIG: 'CONFIG',\n  RESET_AUDIO_QUEUE: 'RESET_AUDIO_QUEUE',\n  PLAY: 'PLAY',\n  PLAY_UNTIL_BREAKPOINT: 'PLAY_UNTIL_BREAKPOINT',\n  BREAKPOINT: 'BREAKPOINT',\n  PAUSE: 'PAUSE',\n  UPDATED: 'UPDATED',\n  CRASHED: 'CRASHED',\n  SET_JOYPAD_STATE: 'SET_JOYPAD_STATE',\n  AUDIO_LATENCY: 'AUDIO_LATENCY',\n  RUN_WASM_EXPORT: 'RUN_WASM_EXPORT',\n  GET_WASM_MEMORY_SECTION: 'GET_WASM_MEMORY_SECTION',\n  GET_WASM_CONSTANT: 'GET_WASM_CONSTANT',\n  FORCE_OUTPUT_FRAME: 'FORCE_OUTPUT_FRAME',\n  SET_SPEED: 'SET_SPEED',\n  IS_GBC: 'IS_GBC'\n};\n\nexport const WORKER_ID = {\n  LIB: 'LIB',\n  GRAPHICS: 'GRAPHICS',\n  MEMORY: 'MEMORY',\n  CONTROLLER: 'CONTROLLER',\n  AUDIO: 'AUDIO'\n};\n\nexport const MEMORY_TYPE = {\n  CARTRIDGE_RAM: 'CARTRIDGE_RAM',\n  CARTRIDGE_ROM: 'CARTRIDGE_ROM',\n  CARTRIDGE_HEADER: 'CARTRIDGE_HEADER',\n  GAMEBOY_MEMORY: 'GAMEBOY_MEMORY',\n  PALETTE_MEMORY: 'PALETTE_MEMORY',\n  INTERNAL_STATE: 'INTERNAL_STATE'\n};\n","// Smarter workers.\n// Workers with ids, pub sub, etc...\n// https://medium.com/dailyjs/threads-in-node-10-5-0-a-practical-intro-3b85a0a3c953\n\n/*ROLLUP_REPLACE_NODE\nconst { Worker } = require('worker_threads');\nROLLUP_REPLACE_NODE*/\n\nimport { getEventData, readBase64String } from './util';\n\n// Generate ids. Use a counter to help against possible collisions.\nlet idCounter = 0;\nconst generateId = () => {\n  const randomId = Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(2, 10);\n  idCounter++;\n  const id = `${randomId}-${idCounter}`;\n  if (idCounter > 100000) {\n    idCounter = 0;\n  }\n  return id;\n};\n\nexport function getSmartWorkerMessage(message, messageId, workerId) {\n  if (!messageId) {\n    messageId = generateId();\n  }\n  return {\n    workerId,\n    messageId,\n    message\n  };\n}\n\nexport class SmartWorker {\n  constructor(workerUrl, id) {\n    this.id = generateId();\n    if (id) {\n      this.id = id;\n    }\n    this.messageListeners = [];\n\n    /*ROLLUP_REPLACE_PROD_BROWSER\n    \n    // Can't load base63 data string directly because safari\n    // https://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\n\n    let workerJs = atob(workerUrl.split(',')[1]);\n    let blob;\n    try {\n      blob = new Blob([workerJs], {type: 'application/javascript'});\n    } catch (e) {\n      // Legacy\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(workerJs);\n      blob = blob.getBlob();\n    }\n    this.worker = new Worker(URL.createObjectURL(blob));\n\n\n    this.worker.onmessage = this._onMessageHandler.bind(this);\n    \n    ROLLUP_REPLACE_PROD_BROWSER*/\n\n    /*ROLLUP_REPLACE_DEV_BROWSER\n\n    this.worker = new Worker(workerUrl);\n    this.worker.onmessage = this._onMessageHandler.bind(this);\n\n    ROLLUP_REPLACE_DEV_BROWSER*/\n\n    /*ROLLUP_REPLACE_NODE\n\n    // Split by Comma, to remove the file header from the base 64 string\n    const workerAsString = readBase64String(workerUrl);\n    this.worker = new Worker(workerAsString, {\n      eval: true\n    });\n    this.worker.on('message', this._onMessageHandler.bind(this))\n\n    ROLLUP_REPLACE_NODE*/\n  }\n\n  postMessage(message, transfer) {\n    const messageObject = getSmartWorkerMessage(message, undefined, this.id);\n    const messageId = messageObject.messageId;\n\n    const messageIdListener = new Promise(resolve => {\n      // Listen for a message with the same message id to be returned\n      this.addMessageListener((responseMessage, messageListener) => {\n        const eventData = getEventData(responseMessage);\n        if (eventData.messageId === messageId) {\n          this.removeMessageListener(messageListener.id);\n          resolve(eventData);\n        }\n      });\n    });\n\n    this.worker.postMessage(messageObject, transfer);\n\n    return messageIdListener;\n  }\n\n  addMessageListener(callback) {\n    this.messageListeners.push({\n      id: generateId(),\n      callback: callback\n    });\n  }\n\n  removeMessageListener(id) {\n    let messageListenerIndex;\n    this.messageListeners.some((messageListener, index) => {\n      if (messageListener.id === id) {\n        messageListenerIndex = index;\n        return true;\n      }\n\n      return false;\n    });\n\n    if (messageListenerIndex !== undefined) {\n      this.messageListeners.splice(messageListenerIndex, 1);\n    }\n  }\n\n  _onMessageHandler(message) {\n    this.messageListeners.forEach(messageListener => {\n      messageListener.callback(message, messageListener);\n    });\n  }\n}\n","import { postMessage, onMessage } from '../../../worker/workerapi';\nimport { WORKER_MESSAGE_TYPE } from '../../../worker/constants';\nimport { getEventData } from '../../../worker/util';\nimport { getSmartWorkerMessage } from '../../../worker/smartworker';\n\n// Function to handle on message from graphics worker\n// to the lib worker\nexport function graphicsWorkerOnMessage(libWorker, event) {\n  // Handle our messages from the main thread\n  const eventData = getEventData(event);\n\n  switch (eventData.message.type) {\n    case WORKER_MESSAGE_TYPE.GET_CONSTANTS: {\n      libWorker.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION = libWorker.wasmInstance.exports.frameInProgressVideoOutputLocation.valueOf();\n      libWorker.WASMBOY_CURRENT_FRAME_SIZE = libWorker.wasmInstance.exports.FRAME_SIZE.valueOf();\n      // Forward to our lib worker\n      libWorker.graphicsWorkerPort.postMessage(\n        getSmartWorkerMessage(\n          {\n            type: WORKER_MESSAGE_TYPE.GET_CONSTANTS_DONE,\n            WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION: libWorker.wasmInstance.exports.frameInProgressVideoOutputLocation.valueOf()\n          },\n          eventData.messageId\n        )\n      );\n      return;\n    }\n  }\n}\n","import { postMessage, onMessage } from '../../../worker/workerapi';\nimport { WORKER_MESSAGE_TYPE } from '../../../worker/constants';\nimport { getEventData } from '../../../worker/util';\nimport { getSmartWorkerMessage } from '../../../worker/smartworker';\n\n// Function to handler audio worker on message to the libWorker\nexport function audioWorkerOnMessage(libWorker, event) {\n  // Handle our messages from the main thread\n  const eventData = getEventData(event);\n\n  switch (eventData.message.type) {\n    case WORKER_MESSAGE_TYPE.GET_CONSTANTS: {\n      libWorker.WASMBOY_SOUND_OUTPUT_LOCATION = libWorker.wasmInstance.exports.soundOutputLocation.valueOf();\n      libWorker.WASMBOY_CHANNEL_1_OUTPUT_LOCATION = libWorker.wasmInstance.exports.CHANNEL_1_BUFFER_LOCATION.valueOf();\n      libWorker.WASMBOY_CHANNEL_2_OUTPUT_LOCATION = libWorker.wasmInstance.exports.CHANNEL_2_BUFFER_LOCATION.valueOf();\n      libWorker.WASMBOY_CHANNEL_3_OUTPUT_LOCATION = libWorker.wasmInstance.exports.CHANNEL_3_BUFFER_LOCATION.valueOf();\n      libWorker.WASMBOY_CHANNEL_4_OUTPUT_LOCATION = libWorker.wasmInstance.exports.CHANNEL_4_BUFFER_LOCATION.valueOf();\n\n      // Forward to our lib worker\n      libWorker.audioWorkerPort.postMessage(\n        getSmartWorkerMessage(\n          {\n            type: WORKER_MESSAGE_TYPE.GET_CONSTANTS_DONE,\n            WASMBOY_SOUND_OUTPUT_LOCATION: libWorker.wasmInstance.exports.soundOutputLocation.valueOf()\n          },\n          eventData.messageId\n        )\n      );\n      return;\n    }\n\n    case WORKER_MESSAGE_TYPE.AUDIO_LATENCY: {\n      libWorker.currentAudioLatencyInSeconds = eventData.message.latency;\n      return;\n    }\n  }\n}\n","import { postMessage, onMessage } from '../../../worker/workerapi';\nimport { WORKER_MESSAGE_TYPE } from '../../../worker/constants';\nimport { getEventData } from '../../../worker/util';\nimport { getSmartWorkerMessage } from '../../../worker/smartworker';\n\n// Handler for when the controller worker posts to the libWorker\nexport function controllerWorkerOnMessage(libWorker, event) {\n  // Handle our messages from the main thread\n  const eventData = getEventData(event);\n\n  switch (eventData.message.type) {\n    case WORKER_MESSAGE_TYPE.SET_JOYPAD_STATE: {\n      // Config will come in as an array, pass in values using apply\n      // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\n      const setJoypadStateParamsAsArray = eventData.message.setJoypadStateParamsAsArray;\n      libWorker.wasmInstance.exports.setJoypadState.apply(libWorker, setJoypadStateParamsAsArray);\n      return;\n    }\n  }\n}\n","// Private function to get the caretridge rom\nexport function getCartridgeRom(libWorker) {\n  if (!libWorker.wasmByteMemory) {\n    return new Uint8Array();\n  }\n\n  // Depening on the rom type, we will have different rom sizes.\n  // Due memory restrictions described in:\n  // https://developers.google.com/web/fundamentals/instant-and-offline/web-storage/offline-for-pwa\n  // We will make sure to only store as much as we need per ROM :)\n\n  // Similar to `initializeCartridgeType()` in `wasm/memory/memory.ts`\n  // We will determine our cartridge type\n  // Get our game MBC type from the cartridge header\n  // http://gbdev.gg8.se/wiki/articles/The_Cartridge_Header\n  let cartridgeType = libWorker.wasmByteMemory[libWorker.WASMBOY_GAME_BYTES_LOCATION + 0x0147];\n\n  let romSize = undefined;\n  if (cartridgeType === 0x00) {\n    // ROM only, 32KB\n    romSize = 0x8000;\n  } else if (cartridgeType >= 0x01 && cartridgeType <= 0x03) {\n    // MBC1 2MB of ROM\n    romSize = 0x200000;\n  } else if (cartridgeType >= 0x05 && cartridgeType <= 0x06) {\n    // MBC2 256KB ROM\n    romSize = 0x40000;\n  } else if (cartridgeType >= 0x0f && cartridgeType <= 0x13) {\n    // MBC3 2MB of ROM\n    romSize = 0x200000;\n  } else if (cartridgeType >= 0x19 && cartridgeType <= 0x1e) {\n    // MBC5 8MB of ROM\n    romSize = 0x800000;\n  }\n\n  if (!romSize) {\n    return new Uint8Array();\n  }\n\n  // Finally fill our cartridgeRam from the ram in memory\n  const cartridgeRom = libWorker.wasmByteMemory.slice(\n    libWorker.WASMBOY_GAME_BYTES_LOCATION,\n    libWorker.WASMBOY_GAME_BYTES_LOCATION + romSize\n  );\n  return cartridgeRom;\n}\n","// Private function to get the cartridge ram\nexport function getCartridgeRam(libWorker) {\n  if (!libWorker.wasmByteMemory) {\n    return new Uint8Array();\n  }\n\n  // Depening on the rom type, we will have different ram sizes.\n  // Due memory restrictions described in:\n  // https://developers.google.com/web/fundamentals/instant-and-offline/web-storage/offline-for-pwa\n  // We will make sure to only store as much as we need per ROM :)\n\n  // Similar to `initializeCartridgeType()` in `wasm/memory/memory.ts`\n  // We will determine our cartridge type\n  // Get our game MBC type from the cartridge header\n  // http://gbdev.gg8.se/wiki/articles/The_Cartridge_Header\n  let cartridgeType = libWorker.wasmByteMemory[libWorker.WASMBOY_GAME_BYTES_LOCATION + 0x0147];\n\n  let ramSize = undefined;\n  if (cartridgeType === 0x00) {\n    // No memory for this rom type\n    return new Uint8Array();\n  } else if (cartridgeType >= 0x01 && cartridgeType <= 0x03) {\n    // MBC1 32KB of Ram\n    ramSize = 0x8000;\n  } else if (cartridgeType >= 0x05 && cartridgeType <= 0x06) {\n    // MBC2 512X4 Bytes, 2KB\n    ramSize = 0x800;\n  } else if (cartridgeType >= 0x0f && cartridgeType <= 0x13) {\n    // MBC3 32KB of Ram\n    ramSize = 0x8000;\n  } else if (cartridgeType >= 0x19 && cartridgeType <= 0x1e) {\n    // MBC5 128KB of Ram\n    ramSize = 0x20000;\n  }\n\n  if (!ramSize) {\n    return new Uint8Array();\n  }\n\n  // Finally fill our cartridgeRam from the ram in memory\n  const cartridgeRam = libWorker.wasmByteMemory.slice(\n    libWorker.WASMBOY_GAME_RAM_BANKS_LOCATION,\n    libWorker.WASMBOY_GAME_RAM_BANKS_LOCATION + ramSize\n  );\n  return cartridgeRam;\n}\n","// Function to get the cartridge header\nexport function getCartridgeHeader(libWorker) {\n  if (!libWorker.wasmByteMemory) {\n    return new Uint8Array();\n  }\n\n  // Header is at 0x0134 - 0x014F\n  // http://gbdev.gg8.se/wiki/articles/The_Cartridge_Header\n  const headerLength = 0x014f - 0x0134;\n  const headerLocation = libWorker.WASMBOY_GAME_BYTES_LOCATION + 0x0134;\n  const headerArray = libWorker.wasmByteMemory.slice(headerLocation, headerLocation + headerLength);\n\n  return headerArray;\n}\n","// Returns the standard 0xFFFF gameboy memory\n// You will normally see in gameboy docs.\n// This is returned from the core, and represents\n// This wasmboy gameboy state\nexport function getGameBoyMemory(libWorker) {\n  return libWorker.wasmByteMemory.slice(\n    libWorker.WASMBOY_INTERNAL_MEMORY_LOCATION,\n    libWorker.WASMBOY_INTERNAL_MEMORY_LOCATION + libWorker.WASMBOY_INTERNAL_MEMORY_SIZE\n  );\n}\n","// Function to get the current palette data for\n// GBC in memory. This is needed to load state with\n// The correct colors\nexport function getPaletteMemory(libWorker) {\n  return libWorker.wasmByteMemory.slice(\n    libWorker.WASMBOY_PALETTE_MEMORY_LOCATION,\n    libWorker.WASMBOY_PALETTE_MEMORY_LOCATION + libWorker.WASMBOY_PALETTE_MEMORY_SIZE\n  );\n}\n","// Returns the internal savestate of the wasmboy core,\n// To save all soft values held in memory\nexport function getInternalState(libWorker) {\n  libWorker.wasmInstance.exports.saveState();\n  return libWorker.wasmByteMemory.slice(\n    libWorker.WASMBOY_INTERNAL_STATE_LOCATION,\n    libWorker.WASMBOY_INTERNAL_STATE_LOCATION + libWorker.WASMBOY_INTERNAL_STATE_SIZE\n  );\n}\n","import { postMessage, onMessage } from '../../../worker/workerapi';\nimport { WORKER_MESSAGE_TYPE, MEMORY_TYPE } from '../../../worker/constants';\nimport { getEventData } from '../../../worker/util';\nimport { getSmartWorkerMessage } from '../../../worker/smartworker';\n\n// Our memory getters\nimport { getCartridgeRom } from './rom';\nimport { getCartridgeRam } from './ram';\nimport { getCartridgeHeader } from './header';\nimport { getGameBoyMemory } from './gameboymemory';\nimport { getPaletteMemory } from './palettememory';\nimport { getInternalState } from './internalstate';\n\n// On message handler for when memory worker\n// posts to lib Worker\nexport function memoryWorkerOnMessage(libWorker, event) {\n  // Handle our messages from the main thread\n  const eventData = getEventData(event);\n\n  switch (eventData.message.type) {\n    case WORKER_MESSAGE_TYPE.CLEAR_MEMORY: {\n      // Clear Wasm memory\n      // https://docs.google.com/spreadsheets/d/17xrEzJk5-sCB9J2mMJcVnzhbE-XH_NvczVSQH9OHvRk/edit?usp=sharing\n      for (let i = 0; i <= libWorker.wasmByteMemory.length; i++) {\n        libWorker.wasmByteMemory[i] = 0;\n      }\n\n      const wasmByteMemory = libWorker.wasmByteMemory.slice(0);\n      libWorker.memoryWorkerPort.postMessage(\n        getSmartWorkerMessage(\n          {\n            type: WORKER_MESSAGE_TYPE.CLEAR_MEMORY_DONE,\n            wasmByteMemory: wasmByteMemory.buffer\n          },\n          eventData.messageId\n        ),\n        [wasmByteMemory.buffer]\n      );\n      return;\n    }\n\n    case WORKER_MESSAGE_TYPE.GET_CONSTANTS: {\n      libWorker.WASMBOY_GAME_BYTES_LOCATION = libWorker.wasmInstance.exports.gameBytesLocation.valueOf();\n      (libWorker.WASMBOY_GAME_RAM_BANKS_LOCATION = libWorker.wasmInstance.exports.gameRamBanksLocation.valueOf()),\n        (libWorker.WASMBOY_INTERNAL_STATE_SIZE = libWorker.wasmInstance.exports.wasmBoyInternalStateSize.valueOf()),\n        (libWorker.WASMBOY_INTERNAL_STATE_LOCATION = libWorker.wasmInstance.exports.wasmBoyInternalStateLocation.valueOf()),\n        (libWorker.WASMBOY_INTERNAL_MEMORY_SIZE = libWorker.wasmInstance.exports.gameBoyInternalMemorySize.valueOf()),\n        (libWorker.WASMBOY_INTERNAL_MEMORY_LOCATION = libWorker.wasmInstance.exports.gameBoyInternalMemoryLocation.valueOf()),\n        (libWorker.WASMBOY_PALETTE_MEMORY_SIZE = libWorker.wasmInstance.exports.gameboyColorPaletteSize.valueOf()),\n        (libWorker.WASMBOY_PALETTE_MEMORY_LOCATION = libWorker.wasmInstance.exports.gameboyColorPaletteLocation.valueOf());\n\n      // Forward to our lib worker\n      libWorker.memoryWorkerPort.postMessage(\n        getSmartWorkerMessage(\n          {\n            type: WORKER_MESSAGE_TYPE.GET_CONSTANTS_DONE,\n            WASMBOY_GAME_BYTES_LOCATION: libWorker.wasmInstance.exports.gameBytesLocation.valueOf(),\n            WASMBOY_GAME_RAM_BANKS_LOCATION: libWorker.wasmInstance.exports.gameRamBanksLocation.valueOf(),\n            WASMBOY_INTERNAL_STATE_SIZE: libWorker.wasmInstance.exports.wasmBoyInternalStateSize.valueOf(),\n            WASMBOY_INTERNAL_STATE_LOCATION: libWorker.wasmInstance.exports.wasmBoyInternalStateLocation.valueOf(),\n            WASMBOY_INTERNAL_MEMORY_SIZE: libWorker.wasmInstance.exports.gameBoyInternalMemorySize.valueOf(),\n            WASMBOY_INTERNAL_MEMORY_LOCATION: libWorker.wasmInstance.exports.gameBoyInternalMemoryLocation.valueOf(),\n            WASMBOY_PALETTE_MEMORY_SIZE: libWorker.wasmInstance.exports.gameboyColorPaletteSize.valueOf(),\n            WASMBOY_PALETTE_MEMORY_LOCATION: libWorker.wasmInstance.exports.gameboyColorPaletteLocation.valueOf()\n          },\n          eventData.messageId\n        )\n      );\n      return;\n    }\n\n    case WORKER_MESSAGE_TYPE.SET_MEMORY: {\n      const memoryKeys = Object.keys(eventData.message);\n\n      if (memoryKeys.includes(MEMORY_TYPE.CARTRIDGE_ROM)) {\n        libWorker.wasmByteMemory.set(new Uint8Array(eventData.message[MEMORY_TYPE.CARTRIDGE_ROM]), libWorker.WASMBOY_GAME_BYTES_LOCATION);\n      }\n      if (memoryKeys.includes(MEMORY_TYPE.CARTRIDGE_RAM)) {\n        libWorker.wasmByteMemory.set(\n          new Uint8Array(eventData.message[MEMORY_TYPE.CARTRIDGE_RAM]),\n          libWorker.WASMBOY_GAME_RAM_BANKS_LOCATION\n        );\n      }\n      if (memoryKeys.includes(MEMORY_TYPE.GAMEBOY_MEMORY)) {\n        libWorker.wasmByteMemory.set(\n          new Uint8Array(eventData.message[MEMORY_TYPE.GAMEBOY_MEMORY]),\n          libWorker.WASMBOY_INTERNAL_MEMORY_LOCATION\n        );\n      }\n      if (memoryKeys.includes(MEMORY_TYPE.PALETTE_MEMORY)) {\n        libWorker.wasmByteMemory.set(\n          new Uint8Array(eventData.message[MEMORY_TYPE.PALETTE_MEMORY]),\n          libWorker.WASMBOY_PALETTE_MEMORY_LOCATION\n        );\n      }\n      if (memoryKeys.includes(MEMORY_TYPE.INTERNAL_STATE)) {\n        libWorker.wasmByteMemory.set(\n          new Uint8Array(eventData.message[MEMORY_TYPE.INTERNAL_STATE]),\n          libWorker.WASMBOY_INTERNAL_STATE_LOCATION\n        );\n        libWorker.wasmInstance.exports.loadState();\n      }\n\n      libWorker.memoryWorkerPort.postMessage(\n        getSmartWorkerMessage(\n          {\n            type: WORKER_MESSAGE_TYPE.SET_MEMORY_DONE\n          },\n          eventData.messageId\n        )\n      );\n\n      return;\n    }\n\n    case WORKER_MESSAGE_TYPE.GET_MEMORY: {\n      // Construct our data object\n      const responseMemory = {\n        type: WORKER_MESSAGE_TYPE.GET_MEMORY\n      };\n      const responseTransferrables = [];\n\n      const memoryTypes = eventData.message.memoryTypes;\n\n      if (memoryTypes.includes(MEMORY_TYPE.CARTRIDGE_ROM)) {\n        const cartridgeRom = getCartridgeRom(libWorker).buffer;\n        responseMemory[MEMORY_TYPE.CARTRIDGE_ROM] = cartridgeRom;\n        responseTransferrables.push(cartridgeRom);\n      }\n      if (memoryTypes.includes(MEMORY_TYPE.CARTRIDGE_RAM)) {\n        const cartridgeRam = getCartridgeRam(libWorker).buffer;\n        responseMemory[MEMORY_TYPE.CARTRIDGE_RAM] = cartridgeRam;\n        responseTransferrables.push(cartridgeRam);\n      }\n      if (memoryTypes.includes(MEMORY_TYPE.CARTRIDGE_HEADER)) {\n        const cartridgeHeader = getCartridgeHeader(libWorker).buffer;\n        responseMemory[MEMORY_TYPE.CARTRIDGE_HEADER] = cartridgeHeader;\n        responseTransferrables.push(cartridgeHeader);\n      }\n      if (memoryTypes.includes(MEMORY_TYPE.GAMEBOY_MEMORY)) {\n        const gameboyMemory = getGameBoyMemory(libWorker).buffer;\n        responseMemory[MEMORY_TYPE.GAMEBOY_MEMORY] = gameboyMemory;\n        responseTransferrables.push(gameboyMemory);\n      }\n      if (memoryTypes.includes(MEMORY_TYPE.PALETTE_MEMORY)) {\n        const paletteMemory = getPaletteMemory(libWorker).buffer;\n        responseMemory[MEMORY_TYPE.PALETTE_MEMORY] = paletteMemory;\n        responseTransferrables.push(paletteMemory);\n      }\n      if (memoryTypes.includes(MEMORY_TYPE.INTERNAL_STATE)) {\n        libWorker.wasmInstance.exports.saveState();\n        const internalState = getInternalState(libWorker).buffer;\n        responseMemory[MEMORY_TYPE.INTERNAL_STATE] = internalState;\n        responseTransferrables.push(internalState);\n      }\n\n      libWorker.memoryWorkerPort.postMessage(getSmartWorkerMessage(responseMemory, eventData.messageId), responseTransferrables);\n\n      return;\n    }\n  }\n}\n","// Banner placed by rollup to mock out some items on our esm build\n// This is useful for things like wasmmemory\nconst wasmboyMemorySize = 0x8b0000; // Simply initialized to the size we need\n\nconst wasmByteMemory = new Uint8ClampedArray(wasmboyMemorySize); // Memory mock\n\nconst memory = {\n  size: () => {\n    return wasmboyMemorySize;\n  },\n  grow: () => {},\n  wasmByteMemory: wasmByteMemory\n};\n\nconst load = offset => {\n  return wasmByteMemory[offset];\n};\n\nconst store = (offset, value) => {\n  wasmByteMemory[offset] = value;\n};\n\nconst abs = value => {\n  return Math.abs(value);\n};\n\nconst ceil = value => {\n  return Math.ceil(value);\n}; // Constants that will be shared by the wasm core of the emulator\n// And libraries built around the wasm (such as the official JS), or @CryZe wasmboy-rs\n// ----------------------------------\n// Wasmboy Memory Map\n// https://docs.google.com/spreadsheets/d/17xrEzJk5-sCB9J2mMJcVnzhbE-XH_NvczVSQH9OHvRk/edit?usp=sharing\n// ----------------------------------\n// AssemblyScript\n\n\nvar ASSEMBLYSCRIPT_MEMORY_LOCATION = 0x000000;\nvar ASSEMBLYSCRIPT_MEMORY_SIZE = 0x000400; // WasmBoy States\n\nvar WASMBOY_STATE_LOCATION = ASSEMBLYSCRIPT_MEMORY_LOCATION + ASSEMBLYSCRIPT_MEMORY_SIZE;\nvar WASMBOY_STATE_SIZE = 0x000400; // Gameboy Internal Memory\n\nvar VIDEO_RAM_LOCATION = WASMBOY_STATE_LOCATION + WASMBOY_STATE_SIZE;\nvar VIDEO_RAM_SIZE = 0x004000;\nvar WORK_RAM_LOCATION = VIDEO_RAM_LOCATION + VIDEO_RAM_SIZE;\nvar WORK_RAM_SIZE = 0x008000;\nvar OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION = WORK_RAM_LOCATION + WORK_RAM_SIZE;\nvar OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE = 0x004000; // General Gameboy Internal Memory\n\nvar GAMEBOY_INTERNAL_MEMORY_LOCATION = VIDEO_RAM_LOCATION;\nvar GAMEBOY_INTERNAL_MEMORY_SIZE = OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION - VIDEO_RAM_LOCATION + OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE; // Graphics Output\n\nvar GBC_PALETTE_LOCATION = OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION + OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE;\nvar GBC_PALETTE_SIZE = 0x000080;\nvar BG_PRIORITY_MAP_LOCATION = GBC_PALETTE_LOCATION + GBC_PALETTE_SIZE;\nvar BG_PRIORITY_MAP_SIZE = 0x005c00;\nvar FRAME_LOCATION = BG_PRIORITY_MAP_LOCATION + BG_PRIORITY_MAP_SIZE;\nvar FRAME_SIZE = 0x016c00;\nvar BACKGROUND_MAP_LOCATION = FRAME_LOCATION + FRAME_SIZE;\nvar BACKGROUND_MAP_SIZE = 0x030000;\nvar TILE_DATA_LOCATION = BACKGROUND_MAP_LOCATION + BACKGROUND_MAP_SIZE;\nvar TILE_DATA_SIZE = 0x024000;\nvar OAM_TILES_LOCATION = TILE_DATA_LOCATION + TILE_DATA_SIZE;\nvar OAM_TILES_SIZE = 0x003c00; // General Graphics Output\n\nvar GRAPHICS_OUTPUT_LOCATION = GBC_PALETTE_LOCATION;\nvar GRAPHICS_OUTPUT_SIZE = OAM_TILES_LOCATION - GBC_PALETTE_LOCATION + OAM_TILES_SIZE; // Audio Output\n\nvar CHANNEL_1_BUFFER_LOCATION = OAM_TILES_LOCATION + OAM_TILES_SIZE;\nvar CHANNEL_1_BUFFER_SIZE = 0x020000;\nvar CHANNEL_2_BUFFER_LOCATION = CHANNEL_1_BUFFER_LOCATION + CHANNEL_1_BUFFER_SIZE;\nvar CHANNEL_2_BUFFER_SIZE = 0x020000;\nvar CHANNEL_3_BUFFER_LOCATION = CHANNEL_2_BUFFER_LOCATION + CHANNEL_2_BUFFER_SIZE;\nvar CHANNEL_3_BUFFER_SIZE = 0x020000;\nvar CHANNEL_4_BUFFER_LOCATION = CHANNEL_3_BUFFER_LOCATION + CHANNEL_3_BUFFER_SIZE;\nvar CHANNEL_4_BUFFER_SIZE = 0x020000;\nvar AUDIO_BUFFER_LOCATION = CHANNEL_4_BUFFER_LOCATION + CHANNEL_4_BUFFER_SIZE;\nvar AUDIO_BUFFER_SIZE = 0x020000; // Catridge Memory\n\nvar CARTRIDGE_RAM_LOCATION = AUDIO_BUFFER_LOCATION + AUDIO_BUFFER_SIZE;\nvar CARTRIDGE_RAM_SIZE = 0x020000;\nvar CARTRIDGE_ROM_LOCATION = CARTRIDGE_RAM_LOCATION + CARTRIDGE_RAM_SIZE;\nvar CARTRIDGE_ROM_SIZE = 0x7e0400; // Debug Memory\n\nvar DEBUG_GAMEBOY_MEMORY_LOCATION = CARTRIDGE_ROM_LOCATION + CARTRIDGE_ROM_SIZE;\nvar DEBUG_GAMEBOY_MEMORY_SIZE = 0xffff; // Final General Size\n\nvar WASMBOY_MEMORY_LOCATION = 0x000000;\nvar WASMBOY_MEMORY_SIZE = DEBUG_GAMEBOY_MEMORY_LOCATION + DEBUG_GAMEBOY_MEMORY_SIZE + 1;\nvar WASMBOY_WASM_PAGES = ceil(WASMBOY_MEMORY_SIZE / 1024 / 64) + 1;\n\nvar Config =\n/** @class */\nfunction () {\n  function Config() {} // Boot Rom\n\n\n  Config.enableBootRom = false; // GBC Preference\n\n  Config.useGbcWhenAvailable = true; // Batch Processing\n\n  Config.audioBatchProcessing = false;\n  Config.graphicsBatchProcessing = false;\n  Config.timersBatchProcessing = false; // Scanline Rendering\n\n  Config.graphicsDisableScanlineRendering = false; // Acumulate Sound Samples\n\n  Config.audioAccumulateSamples = false; // Tile Rednering\n\n  Config.tileRendering = false;\n  Config.tileCaching = false; // Audio Debugging\n\n  Config.enableAudioDebugging = false;\n  return Config;\n}(); // Grouped registers\n// possible overload these later to performace actions\n// AF, BC, DE, HL\n\n\nfunction concatenateBytes(highByte, lowByte) {\n  //https://stackoverflow.com/questions/38298412/convert-two-bytes-into-signed-16-bit-integer-in-javascript\n  return (highByte & 0xff) << 8 | lowByte & 0xff;\n}\n\nfunction splitHighByte(groupedByte) {\n  return (groupedByte & 0xff00) >> 8;\n}\n\nfunction splitLowByte(groupedByte) {\n  return groupedByte & 0x00ff;\n}\n\nfunction rotateByteLeft(value) {\n  // Rotate left\n  // https://stackoverflow.com/questions/19204750/how-do-i-perform-a-circular-rotation-of-a-byte\n  // 4-bit example:\n  // 1010 -> 0100 | 0001\n  return u8Portable(value << 1 | value >> 7);\n}\n\nfunction rotateByteLeftThroughCarry(value) {\n  // Example: https://github.com/nakardo/node-gameboy/blob/master/lib/cpu/opcodes.js\n  // Through carry meaning, instead of raotating the bit that gets dropped off, but the carry there instead\n  return u8Portable(value << 1 | getCarryFlag$$1());\n}\n\nfunction rotateByteRight(value) {\n  // Rotate right\n  // 4-bit example:\n  // 1010 -> 0101 | 0000\n  return u8Portable(value >> 1 | value << 7);\n}\n\nfunction rotateByteRightThroughCarry(value) {\n  // Example: https://github.com/nakardo/node-gameboy/blob/master/lib/cpu/opcodes.js\n  // Through carry meaning, instead of raotating the bit that gets dropped off, put the carry there instead\n  return u8Portable(value >> 1 | getCarryFlag$$1() << 7);\n}\n\nfunction setBitOnByte(bitPosition, byte) {\n  return byte | 0x01 << bitPosition;\n}\n\nfunction resetBitOnByte(bitPosition, byte) {\n  return byte & ~(0x01 << bitPosition);\n}\n\nfunction checkBitOnByte(bitPosition, byte) {\n  // Perforamnce improvements\n  // https://github.com/AssemblyScript/assemblyscript/issues/40\n  return (byte & 1 << bitPosition) != 0;\n} // Portable Code for JS Wasm Benchmarking\n\n\nfunction u8Portable(param) {\n  return param & 0xff;\n}\n\nfunction u16Portable(param) {\n  return param & 0xffff;\n}\n\nfunction i8Portable(param) {\n  // JS ints are all i32, therefore, get the sign bit, and then convert accordingly\n  // Example: https://blog.michaelyin.info/convert-8bit-byte-to-signed-int/\n  var response = param;\n\n  if (checkBitOnByte(7, response)) {\n    response = (256 - param) * -1;\n  }\n\n  return response;\n}\n\nfunction i32Portable(param) {\n  return param | 0;\n} // Set flag bit on on register F. For instance set zero flag to zero -> (7, 0)\n\n\nfunction setFlagBit(flagBit, flagValue) {\n  var bitwiseOperand = u8Portable(1 << flagBit);\n\n  if (flagValue > 0) {\n    Cpu.registerF = Cpu.registerF | bitwiseOperand;\n  } else {\n    // XOR out the two ones\n    bitwiseOperand = 0xff ^ bitwiseOperand;\n    Cpu.registerF = Cpu.registerF & bitwiseOperand;\n  }\n\n  return Cpu.registerF;\n} // Overload the set flag bit for ease of use\n\n\nfunction setZeroFlag$$1(value) {\n  setFlagBit(7, value);\n}\n\nfunction setSubtractFlag(value) {\n  setFlagBit(6, value);\n}\n\nfunction setHalfCarryFlag(value) {\n  setFlagBit(5, value);\n}\n\nfunction setCarryFlag(value) {\n  setFlagBit(4, value);\n} // Getters for flags\n\n\nfunction getZeroFlag$$1() {\n  return Cpu.registerF >> 7 & 0x01;\n}\n\nfunction getSubtractFlag() {\n  return Cpu.registerF >> 6 & 0x01;\n}\n\nfunction getHalfCarryFlag() {\n  return Cpu.registerF >> 5 & 0x01;\n}\n\nfunction getCarryFlag$$1() {\n  return Cpu.registerF >> 4 & 0x01;\n} // Must be run before the register actually performs the add\n// amountToAdd i16, since max number can be an u8\n\n\nfunction checkAndSetEightBitHalfCarryFlag(value, amountToAdd) {\n  if (amountToAdd >= 0) {\n    // https://robdor.com/2016/08/10/gameboy-emulator-half-carry-flag/\n    var result = u8Portable((value & 0x0f) + (amountToAdd & 0x0f)) & 0x10;\n\n    if (result !== 0x00) {\n      setHalfCarryFlag(1);\n    } else {\n      setHalfCarryFlag(0);\n    }\n  } else {\n    // From: https://github.com/djhworld/gomeboycolor/blob/master/src/cpu/index.go\n    // CTRL+F \"subBytes(a, b byte)\"\n    if ((abs(amountToAdd) & 0x0f) > (value & 0x0f)) {\n      setHalfCarryFlag(1);\n    } else {\n      setHalfCarryFlag(0);\n    }\n  }\n}\n\nfunction checkAndSetEightBitCarryFlag(value, amountToAdd) {\n  if (amountToAdd >= 0) {\n    var result = u8Portable(value + amountToAdd);\n\n    if (value > result) {\n      setCarryFlag(1);\n    } else {\n      setCarryFlag(0);\n    }\n  } else {\n    if (abs(amountToAdd) > value) {\n      setCarryFlag(1);\n    } else {\n      setCarryFlag(0);\n    }\n  }\n} // Function to handle 16 bit addition overflow, and set the carry flags accordingly\n// i32 on valueTwo to support passing signed immedaite values\n\n\nfunction checkAndSetSixteenBitFlagsAddOverflow(valueOne, valueTwo, useStackPointerBits) {\n  // need to differentiate between HL and SP\n  // HL carries are at 11 and 15, SP carries are at 3 and 7 :p\n  if (useStackPointerBits) {\n    // Logic from : https://github.com/nakardo/node-gameboy/blob/master/lib/cpu/opcodes.js\n    // CTRL+F add_sp_n\n    // using the stack pointer bits means we can safely assume the value is signed\n    var signedValueOne = valueOne;\n    var result = signedValueOne + valueTwo;\n    var flagXor = signedValueOne ^ valueTwo ^ result;\n\n    if ((flagXor & 0x10) !== 0) {\n      setHalfCarryFlag(1);\n    } else {\n      setHalfCarryFlag(0);\n    }\n\n    if ((flagXor & 0x100) !== 0) {\n      setCarryFlag(1);\n    } else {\n      setCarryFlag(0);\n    }\n  } else {\n    // Logic from: https://github.com/djhworld/gomeboycolor/blob/master/src/cpu/index.go\n    // CTRL+F addWords\n    // Value two is not signed\n    var result = u16Portable(valueOne + valueTwo); // Check the carry flag by allowing the overflow\n\n    if (result < valueOne) {\n      setCarryFlag(1);\n    } else {\n      setCarryFlag(0);\n    } // To check for half carry flag (bit 15), by XOR'ing valyes, and and'ing the bit in question\n\n\n    var halfCarryXor = valueOne ^ valueTwo ^ result;\n    var halfCarryAnd = u16Portable(halfCarryXor & 0x1000);\n\n    if (halfCarryAnd !== 0x00) {\n      setHalfCarryFlag(1);\n    } else {\n      setHalfCarryFlag(0);\n    }\n  }\n} // Class for GBC Color palletes\n// http://gbdev.gg8.se/wiki/articles/Video_Display#FF68_-_BCPS.2FBGPI_-_CGB_Mode_Only_-_Background_Palette_Index\n\n\nvar Palette =\n/** @class */\nfunction () {\n  function Palette() {}\n\n  Palette.memoryLocationBackgroundPaletteIndex = 0xff68;\n  Palette.memoryLocationBackgroundPaletteData = 0xff69;\n  Palette.memoryLocationSpritePaletteIndex = 0xff6a;\n  Palette.memoryLocationSpritePaletteData = 0xff6b;\n  return Palette;\n}();\n\nfunction initializePalette() {\n  if (Cpu.GBCEnabled) {\n    // GBC Palettes\n    eightBitStoreIntoGBMemory(0xff68, 0xc0);\n    eightBitStoreIntoGBMemory(0xff69, 0xff);\n    eightBitStoreIntoGBMemory(0xff6a, 0xc1);\n    eightBitStoreIntoGBMemory(0xff6b, 0x0d);\n  } else {\n    // GBC Palettes\n    eightBitStoreIntoGBMemory(0xff68, 0xff);\n    eightBitStoreIntoGBMemory(0xff69, 0xff);\n    eightBitStoreIntoGBMemory(0xff6a, 0xff);\n    eightBitStoreIntoGBMemory(0xff6b, 0xff);\n  }\n} // Simple get pallete color or monochroime GB\n// shouldRepresentColorByColorId is good for debugging tile data for GBC games that don't have\n// monochromePalettes\n\n\nfunction getMonochromeColorFromPalette(colorId, paletteMemoryLocation, shouldRepresentColorByColorId) {\n  if (shouldRepresentColorByColorId === void 0) {\n    shouldRepresentColorByColorId = false;\n  } // Shift our paletteByte, 2 times for each color ID\n  // And off any extra bytes\n  // Return our Color (00 - white, 01 - light grey, 10 Dark grey, or 11 - Black)\n\n\n  var color = colorId;\n\n  if (!shouldRepresentColorByColorId) {\n    color = eightBitLoadFromGBMemory(paletteMemoryLocation) >> colorId * 2 & 0x03;\n  } // Since our max is 254, and max is 3.\n  // monochrome color palette is modified from bgb\n  // TODO: Make these colors into a constant\n\n\n  var rgbColor = 242;\n\n  switch (color) {\n    case 0:\n      break;\n\n    case 1:\n      rgbColor = 160;\n      break;\n\n    case 2:\n      rgbColor = 88;\n      break;\n\n    case 3:\n      rgbColor = 8;\n      break;\n  }\n\n  return rgbColor;\n}\n\nfunction writeColorPaletteToMemory(offset, value) {\n  // FF68\n  //  Bit 0-5   Index (00-3F)\n  if (offset === Palette.memoryLocationBackgroundPaletteData || offset === Palette.memoryLocationSpritePaletteData) {\n    // Get the palette index\n    var paletteIndex = eightBitLoadFromGBMemory(offset - 1); // Clear the 6th bit, as it does nothing\n\n    paletteIndex = resetBitOnByte(6, paletteIndex); // Check if we are changing the sprite pallete data\n\n    var isSprite = false;\n\n    if (offset === Palette.memoryLocationSpritePaletteData) {\n      isSprite = true;\n    }\n\n    storePaletteByteInWasmMemory(paletteIndex, value, isSprite);\n    incrementPaletteIndexIfSet(paletteIndex, offset - 1);\n  }\n} // Functions to Handle Write to pallete data registers\n// http://gbdev.gg8.se/wiki/articles/Video_Display#FF68_-_BCPS.2FBGPI_-_CGB_Mode_Only_-_Background_Palette_Index\n// Function to handle incrementing the pallete index if required\n\n\nfunction incrementPaletteIndexIfSet(paletteIndex, offset) {\n  // Check ther auto increment box\n  if (checkBitOnByte(7, paletteIndex)) {\n    // Increment the index, and return the value before the increment\n    // Ensure we don't ouverflow our auto increment bit\n    paletteIndex += 1;\n    paletteIndex = setBitOnByte(7, paletteIndex);\n    eightBitStoreIntoGBMemory(offset, paletteIndex);\n  }\n} // FF68\n// Bit 0-5   Index (00-3F)\n// Bit 7     Auto Increment  (0=Disabled, 1=Increment after Writing)\n// Index is 00-0x3F because the means 0 - 63 (64),\n// and apparently there are 8 bytes per pallete to describe Color 0-3 (4 colors),\n// and 0-7 (8 palltetes). Therefore, 64!\n\n\nfunction getRgbColorFromPalette(paletteId, colorId, isSprite) {\n  // Each Pallete takes 8 bytes, so multiply by 8 to get the pallete\n  // And Each color takes 2 bytes, therefore, multiple by 2 for the correct color bytes in the palette\n  var paletteIndex = paletteId * 8 + colorId * 2; // Load the Color that is seperated into two bytes\n\n  var paletteHighByte = loadPaletteByteFromWasmMemory(paletteIndex + 1, isSprite);\n  var paletteLowByte = loadPaletteByteFromWasmMemory(paletteIndex, isSprite); // Return the concatenated color byte\n\n  return concatenateBytes(paletteHighByte, paletteLowByte);\n} // Function to return the color from a passed 16 bit color pallette\n\n\nfunction getColorComponentFromRgb(colorId, colorRgb) {\n  // Get our bitmask for the color ID\n  // bit mask tested good :)\n  var bitMask = 0x1f << colorId * 5;\n  var colorValue = (colorRgb & bitMask) >> colorId * 5; // Goal is to reach 254 for each color, so 255 / 31 (0x1F) ~8 TODO: Make exact\n  // Want 5 bits for each\n\n  return colorValue * 8;\n} // Function to load a byte from our Gbc Palette memory\n\n\nfunction loadPaletteByteFromWasmMemory(paletteIndexByte, isSprite) {\n  // Clear the top two bits to just get the bottom palette Index\n  var paletteIndex = paletteIndexByte & 0x3f; // Move over the palette index to not overlap the background has 0x3F, so Zero for Sprites is 0x40)\n\n  if (isSprite) {\n    paletteIndex += 0x40;\n  }\n\n  return load(GBC_PALETTE_LOCATION + paletteIndex);\n} // Function to store a byte to our Gbc Palette memory\n\n\nfunction storePaletteByteInWasmMemory(paletteIndexByte, value, isSprite) {\n  // Clear the top two bits to just get the bottom palette Index\n  var paletteIndex = paletteIndexByte & 0x3f; // Move over the palette index to not overlap the background (has 0x3F, so Zero for Sprites is 0x40)\n\n  if (isSprite) {\n    paletteIndex += 0x40;\n  }\n\n  store(GBC_PALETTE_LOCATION + paletteIndex, value);\n} // https://github.com/torch2424/wasmBoy/issues/51\n\n\nfunction addPriorityforPixel(x, y, colorId, hasGbcBgPriority) {\n  if (colorId === void 0) {\n    colorId = 0;\n  }\n\n  if (hasGbcBgPriority === void 0) {\n    hasGbcBgPriority = false;\n  }\n\n  var bgPriorityByte = colorId & 0x03;\n\n  if (hasGbcBgPriority) {\n    bgPriorityByte = setBitOnByte(2, bgPriorityByte);\n  }\n\n  store(BG_PRIORITY_MAP_LOCATION + getPixelStart(x, y), bgPriorityByte);\n}\n\nfunction getPriorityforPixel(x, y) {\n  return load(BG_PRIORITY_MAP_LOCATION + getPixelStart(x, y));\n}\n\nfunction clearPriorityMap() {\n  for (var y = 0; y < 144; y++) {\n    for (var x = 0; x < 160; x++) {\n      store(BG_PRIORITY_MAP_LOCATION + getPixelStart(x, y), 0);\n    }\n  }\n}\n\nfunction getPixelStart(x, y) {\n  // Get the pixel number\n  return y * 160 + x;\n} // Functions for performance hacks, and debugging tiles\n\n\nvar TileCache =\n/** @class */\nfunction () {\n  function TileCache() {}\n\n  TileCache.tileId = -1;\n  TileCache.horizontalFlip = false;\n  TileCache.nextXIndexToPerformCacheCheck = -1;\n  return TileCache;\n}();\n\nfunction resetTileCache() {\n  TileCache.tileId = -1;\n  TileCache.nextXIndexToPerformCacheCheck = -1;\n}\n\nfunction drawPixelsFromLineOfTile(tileId, tileDataMemoryLocation, vramBankId, tileLineXStart, tileLineXEnd, tileLineY, outputLineX, outputLineY, outputWidth, wasmMemoryStart, shouldRepresentMonochromeColorByColorId, paletteLocation, bgMapAttributes, spriteAttributes) {\n  // Get our number of pixels drawn\n  var pixelsDrawn = 0; // Get our tile data address\n\n  var tileDataAddress = getTileDataAddress(tileDataMemoryLocation, tileId); // Get the bytes for our tile\n\n  var byteOneForLineOfTilePixels = loadFromVramBank(tileDataAddress + tileLineY * 2, vramBankId);\n  var byteTwoForLineOfTilePixels = loadFromVramBank(tileDataAddress + tileLineY * 2 + 1, vramBankId); // Loop through our X values to draw\n\n  for (var x = tileLineXStart; x <= tileLineXEnd; x++) {\n    // First find where we are going to do our final output x\n    // And don't allow any width overflow\n    var iteratedOutputX = outputLineX + (x - tileLineXStart);\n\n    if (iteratedOutputX < outputWidth) {\n      // However, We need to reverse our byte (if not horizontally flipped),\n      // As pixel 0 is on byte 7, and pixel 1 is on byte 6, etc...\n      // Therefore, is pixelX was 2, then really is need to be 5\n      // So 2 - 7 = -5, * 1 = 5\n      // Or to simplify, 7 - 2 = 5 haha!\n      var pixelXInTile = x;\n\n      if (bgMapAttributes < 0 || !checkBitOnByte(5, bgMapAttributes)) {\n        pixelXInTile = 7 - pixelXInTile;\n      } // Get our pallete colors for the tile\n\n\n      var paletteColorId = 0;\n\n      if (checkBitOnByte(pixelXInTile, byteTwoForLineOfTilePixels)) {\n        // Byte one represents the second bit in our color id, so bit shift\n        paletteColorId += 1;\n        paletteColorId = paletteColorId << 1;\n      }\n\n      if (checkBitOnByte(pixelXInTile, byteOneForLineOfTilePixels)) {\n        paletteColorId += 1;\n      } // Get the pallete\n\n\n      var red = 0;\n      var green = 0;\n      var blue = 0; // Check if we should draw color or not\n\n      if (bgMapAttributes >= 0) {\n        // Call the helper function to grab the correct color from the palette\n        // Get the palette index byte\n        var bgPalette = bgMapAttributes & 0x07;\n        var rgbColorPalette = getRgbColorFromPalette(bgPalette, paletteColorId, false); // Split off into red green and blue\n\n        red = getColorComponentFromRgb(0, rgbColorPalette);\n        green = getColorComponentFromRgb(1, rgbColorPalette);\n        blue = getColorComponentFromRgb(2, rgbColorPalette);\n      } else {\n        if (paletteLocation <= 0) {\n          paletteLocation = Graphics.memoryLocationBackgroundPalette;\n        }\n\n        var monochromeColor = getMonochromeColorFromPalette(paletteColorId, paletteLocation, shouldRepresentMonochromeColorByColorId);\n        red = monochromeColor;\n        green = monochromeColor;\n        blue = monochromeColor;\n      } // Finally Lets place a pixel in memory\n      // Find where our tile line would start\n\n\n      var pixelStart = getTilePixelStart(iteratedOutputX, outputLineY, outputWidth);\n      store(wasmMemoryStart + pixelStart, red);\n      store(wasmMemoryStart + pixelStart + 1, green);\n      store(wasmMemoryStart + pixelStart + 2, blue);\n      var gbcBgPriority = false;\n\n      if (bgMapAttributes >= 0) {\n        gbcBgPriority = checkBitOnByte(7, bgMapAttributes);\n      } // Lastly, add the pixel to our background priority map\n      // https://github.com/torch2424/wasmBoy/issues/51\n      // Bits 0 & 1 will represent the color Id drawn by the BG/Window\n      // Bit 2 will represent if the Bg/Window has GBC priority.\n\n\n      addPriorityforPixel(iteratedOutputX, outputLineY, paletteColorId, gbcBgPriority);\n      pixelsDrawn++;\n    }\n  }\n\n  return pixelsDrawn;\n}\n\nfunction getTilePixelStart(outputLineX, outputLineY, outputWidth) {\n  // Finally Lets place a pixel in memory\n  var pixelStart = outputLineY * outputWidth + outputLineX; // Each pixel takes 3 slots, therefore, multiply by 3!\n\n  return pixelStart * 3;\n}\n\nfunction getTileDataAddress(tileDataMemoryLocation, tileIdFromTileMap) {\n  // Watch this part of The ultimate gameboy talk: https://youtu.be/HyzD8pNlpwI?t=30m50s\n  // A line of 8 pixels on a single tile, is represented by 2 bytes.\n  // since a single tile is 8x8 pixels, 8 * 2 = 16 bytes\n  // Get the tile ID's tile addess from tile data.\n  // For instance, let's say our first line of tile data represents tiles for letters:\n  // a b c d e f g\n  // And we have tileId 0x02. That means we want the tile for the 'c' character\n  // Since each tile is 16 bytes, it would be the starting tileDataAddress + (tileId * tileSize), to skip over tiles we dont want\n  // The whole signed thing is weird, and has something to do how the second set of tile data is stored :p\n  if (tileDataMemoryLocation === Graphics.memoryLocationTileDataSelectZeroStart) {\n    // Treat the tile Id as a signed int, subtract an offset of 128\n    // if the tileId was 0 then the tile would be in memory region 0x9000-0x900F\n    // NOTE: Assemblyscript, Can't cast to i16, need to make negative manually\n    var signedTileId = tileIdFromTileMap + 128;\n\n    if (checkBitOnByte(7, tileIdFromTileMap)) {\n      signedTileId = tileIdFromTileMap - 128;\n    }\n\n    return tileDataMemoryLocation + signedTileId * 16;\n  } // if the background layout gave us the tileId 0, then the tile data would be between 0x8000-0x800F.\n\n\n  return tileDataMemoryLocation + tileIdFromTileMap * 16;\n} // Functions to help with Handling Duty on Square Channels\n// Since there are no 2d arrays, we will use a byte to represent duty cycles (wave form from percentages)\n\n\nfunction isDutyCycleClockPositiveOrNegativeForWaveform(channelDuty, waveFormPositionOnDuty) {\n  // Get our Wave Form According to the Duty\n  // Default to a duty of 1\n  // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Square_Wave\n  switch (channelDuty) {\n    case 0x01:\n      // 1000 0001\n      return checkBitOnByte(waveFormPositionOnDuty, 0x81);\n\n    case 0x02:\n      // 1000 0111\n      return checkBitOnByte(waveFormPositionOnDuty, 0x87);\n\n    case 0x03:\n      // 0111 1110\n      return checkBitOnByte(waveFormPositionOnDuty, 0x7e);\n\n    default:\n      // 0000 0001\n      return checkBitOnByte(waveFormPositionOnDuty, 0x01);\n  }\n} // NOTE: Tons of Copy-pasta btween channels, because Classes cannot be instantiated yet in assemblyscript\n\n\nvar Channel1 =\n/** @class */\nfunction () {\n  function Channel1() {}\n\n  Channel1.updateNRx0 = function (value) {\n    Channel1.NRx0SweepPeriod = (value & 0x70) >> 4;\n    Channel1.NRx0Negate = checkBitOnByte(3, value);\n    Channel1.NRx0SweepShift = value & 0x07;\n  };\n\n  Channel1.updateNRx1 = function (value) {\n    Channel1.NRx1Duty = value >> 6 & 0x03;\n    Channel1.NRx1LengthLoad = value & 0x3f; // Also need to set our length counter. Taken from the old, setChannelLengthCounter\n    // Channel length is determined by 64 (or 256 if channel 3), - the length load\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n    // Note, this will be different for channel 3\n\n    Channel1.lengthCounter = 64 - Channel1.NRx1LengthLoad;\n  };\n\n  Channel1.updateNRx2 = function (value) {\n    Channel1.NRx2StartingVolume = value >> 4 & 0x0f;\n    Channel1.NRx2EnvelopeAddMode = checkBitOnByte(3, value);\n    Channel1.NRx2EnvelopePeriod = value & 0x07; // Also, get our channel is dac enabled\n\n    Channel1.isDacEnabled = (value & 0xf8) > 0;\n  };\n\n  Channel1.updateNRx3 = function (value) {\n    Channel1.NRx3FrequencyLSB = value; // Update Channel Frequency\n\n    var frequency = Channel1.NRx4FrequencyMSB << 8 | Channel1.NRx3FrequencyLSB;\n    Channel1.frequency = frequency;\n  };\n\n  Channel1.updateNRx4 = function (value) {\n    Channel1.NRx4LengthEnabled = checkBitOnByte(6, value);\n    Channel1.NRx4FrequencyMSB = value & 0x07; // Update Channel Frequency\n\n    var frequency = Channel1.NRx4FrequencyMSB << 8 | Channel1.NRx3FrequencyLSB;\n    Channel1.frequency = frequency;\n  }; // Function to save the state of the class\n\n\n  Channel1.saveState = function () {\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x00, Channel1.saveStateSlot), Channel1.isEnabled);\n    store(getSaveStateMemoryOffset(0x01, Channel1.saveStateSlot), Channel1.frequencyTimer);\n    store(getSaveStateMemoryOffset(0x05, Channel1.saveStateSlot), Channel1.envelopeCounter);\n    store(getSaveStateMemoryOffset(0x09, Channel1.saveStateSlot), Channel1.lengthCounter);\n    store(getSaveStateMemoryOffset(0x0e, Channel1.saveStateSlot), Channel1.volume);\n    store(getSaveStateMemoryOffset(0x13, Channel1.saveStateSlot), Channel1.dutyCycle);\n    store(getSaveStateMemoryOffset(0x14, Channel1.saveStateSlot), Channel1.waveFormPositionOnDuty);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x19, Channel1.saveStateSlot), Channel1.isSweepEnabled);\n    store(getSaveStateMemoryOffset(0x1a, Channel1.saveStateSlot), Channel1.sweepCounter);\n    store(getSaveStateMemoryOffset(0x1f, Channel1.saveStateSlot), Channel1.sweepShadowFrequency);\n  }; // Function to load the save state from memory\n\n\n  Channel1.loadState = function () {\n    Channel1.isEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x00, Channel1.saveStateSlot));\n    Channel1.frequencyTimer = load(getSaveStateMemoryOffset(0x01, Channel1.saveStateSlot));\n    Channel1.envelopeCounter = load(getSaveStateMemoryOffset(0x05, Channel1.saveStateSlot));\n    Channel1.lengthCounter = load(getSaveStateMemoryOffset(0x09, Channel1.saveStateSlot));\n    Channel1.volume = load(getSaveStateMemoryOffset(0x0e, Channel1.saveStateSlot));\n    Channel1.dutyCycle = load(getSaveStateMemoryOffset(0x13, Channel1.saveStateSlot));\n    Channel1.waveFormPositionOnDuty = load(getSaveStateMemoryOffset(0x14, Channel1.saveStateSlot));\n    Channel1.isSweepEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x19, Channel1.saveStateSlot));\n    Channel1.sweepCounter = load(getSaveStateMemoryOffset(0x1a, Channel1.saveStateSlot));\n    Channel1.sweepShadowFrequency = load(getSaveStateMemoryOffset(0x1f, Channel1.saveStateSlot));\n  };\n\n  Channel1.initialize = function () {\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx0, 0x80);\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx1, 0xbf);\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx2, 0xf3);\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx3, 0xc1);\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx4, 0xbf);\n  }; // Function to get a sample using the cycle counter on the channel\n\n\n  Channel1.getSampleFromCycleCounter = function () {\n    var accumulatedCycles = Channel1.cycleCounter;\n    Channel1.cycleCounter = 0;\n    return Channel1.getSample(accumulatedCycles);\n  }; // Function to reset our timer, useful for GBC double speed mode\n\n\n  Channel1.resetTimer = function () {\n    Channel1.frequencyTimer = (2048 - Channel1.frequency) * 4; // TODO: Ensure this is correct for GBC Double Speed Mode\n\n    if (Cpu.GBCDoubleSpeed) {\n      Channel1.frequencyTimer = Channel1.frequencyTimer * 2;\n    }\n  };\n\n  Channel1.getSample = function (numberOfCycles) {\n    // Decrement our channel timer\n    Channel1.frequencyTimer -= numberOfCycles;\n\n    if (Channel1.frequencyTimer <= 0) {\n      // Get the amount that overflowed so we don't drop cycles\n      var overflowAmount = abs(Channel1.frequencyTimer); // Reset our timer\n      // A square channel's frequency timer period is set to (2048-frequency)*4.\n      // Four duty cycles are available, each waveform taking 8 frequency timer clocks to cycle through:\n\n      Channel1.resetTimer();\n      Channel1.frequencyTimer -= overflowAmount; // Also increment our duty cycle\n      // What is duty? https://en.wikipedia.org/wiki/Duty_cycle\n      // Duty cycle for square wave: http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Square_Wave\n\n      Channel1.waveFormPositionOnDuty += 1;\n\n      if (Channel1.waveFormPositionOnDuty >= 8) {\n        Channel1.waveFormPositionOnDuty = 0;\n      }\n    } // Get our ourput volume\n\n\n    var outputVolume = 0; // Finally to set our output volume, the channel must be enabled,\n    // Our channel DAC must be enabled, and we must be in an active state\n    // Of our duty cycle\n\n    if (Channel1.isEnabled && Channel1.isDacEnabled) {\n      outputVolume = Channel1.volume;\n    } else {\n      // Return silence\n      // Since range from -15 - 15, or 0 to 30 for our unsigned\n      return 15;\n    } // Get the current sampleValue\n\n\n    var sample = 1;\n\n    if (!isDutyCycleClockPositiveOrNegativeForWaveform(Channel1.NRx1Duty, Channel1.waveFormPositionOnDuty)) {\n      sample = sample * -1;\n    }\n\n    sample = sample * outputVolume; // Square Waves Can range from -15 - 15. Therefore simply add 15\n\n    sample = sample + 15;\n    return sample;\n  }; //http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Trigger_Event\n\n\n  Channel1.trigger = function () {\n    Channel1.isEnabled = true;\n\n    if (Channel1.lengthCounter === 0) {\n      Channel1.lengthCounter = 64;\n    } // Reset our timer\n    // A square channel's frequency timer period is set to (2048-frequency)*4.\n    // Four duty cycles are available, each waveform taking 8 frequency timer clocks to cycle through:\n\n\n    Channel1.resetTimer();\n    Channel1.envelopeCounter = Channel1.NRx2EnvelopePeriod;\n    Channel1.volume = Channel1.NRx2StartingVolume; // Handle Channel Sweep\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware\n\n    Channel1.sweepShadowFrequency = Channel1.frequency; // Reset back to the sweep period\n\n    Channel1.sweepCounter = Channel1.NRx0SweepPeriod; // The internal enabled flag is set if either the sweep period or shift are non-zero, cleared otherwise.\n\n    if (Channel1.NRx0SweepPeriod > 0 && Channel1.NRx0SweepShift > 0) {\n      Channel1.isSweepEnabled = true;\n    } else {\n      Channel1.isSweepEnabled = false;\n    } // If the sweep shift is non-zero, frequency calculation and the overflow check are performed immediately.\n\n\n    if (Channel1.NRx0SweepShift > 0) {\n      calculateSweepAndCheckOverflow();\n    } // Finally if DAC is off, channel is still disabled\n\n\n    if (!Channel1.isDacEnabled) {\n      Channel1.isEnabled = false;\n    }\n  }; // Function to determine if the current channel would update when getting the sample\n  // This is used to accumulate samples\n\n\n  Channel1.willChannelUpdate = function (numberOfCycles) {\n    //Increment our cycle counter\n    Channel1.cycleCounter += numberOfCycles; // Dac enabled status cached by accumulator\n\n    if (Channel1.frequencyTimer - Channel1.cycleCounter > 0) {\n      return false;\n    }\n\n    return true;\n  };\n\n  Channel1.updateSweep = function () {\n    // Obscure behavior\n    // TODO: The volume envelope and sweep timers treat a period of 0 as 8.\n    // Decrement the sweep counter\n    Channel1.sweepCounter -= 1;\n\n    if (Channel1.sweepCounter <= 0) {\n      // Reset back to the sweep period\n      Channel1.sweepCounter = Channel1.NRx0SweepPeriod; // Calculate our sweep\n      // When it generates a clock and the sweep's internal enabled flag is set and the sweep period is not zero,\n      // a new frequency is calculated and the overflow check is performed.\n\n      if (Channel1.isSweepEnabled && Channel1.NRx0SweepPeriod > 0) {\n        calculateSweepAndCheckOverflow();\n      }\n    }\n  };\n\n  Channel1.updateLength = function () {\n    if (Channel1.lengthCounter > 0 && Channel1.NRx4LengthEnabled) {\n      Channel1.lengthCounter -= 1;\n    }\n\n    if (Channel1.lengthCounter === 0) {\n      Channel1.isEnabled = false;\n    }\n  };\n\n  Channel1.updateEnvelope = function () {\n    // Obscure behavior\n    // TODO: The volume envelope and sweep timers treat a period of 0 as 8.\n    Channel1.envelopeCounter -= 1;\n\n    if (Channel1.envelopeCounter <= 0) {\n      Channel1.envelopeCounter = Channel1.NRx2EnvelopePeriod; // When the timer generates a clock and the envelope period is NOT zero, a new volume is calculated\n      // NOTE: There is some weiirrdd obscure behavior where zero can equal 8, so watch out for that\n      // If notes are sustained for too long, this is probably why\n\n      if (Channel1.envelopeCounter !== 0) {\n        if (Channel1.NRx2EnvelopeAddMode && Channel1.volume < 15) {\n          Channel1.volume += 1;\n        } else if (!Channel1.NRx2EnvelopeAddMode && Channel1.volume > 0) {\n          Channel1.volume -= 1;\n        }\n      }\n    }\n  };\n\n  Channel1.setFrequency = function (frequency) {\n    // Get the high and low bits\n    var passedFrequencyHighBits = frequency >> 8;\n    var passedFrequencyLowBits = frequency & 0xff; // Get the new register 4\n\n    var register4 = eightBitLoadFromGBMemory(Channel1.memoryLocationNRx4); // Knock off lower 3 bits, and Or on our high bits\n\n    var newRegister4 = register4 & 0xf8;\n    newRegister4 = newRegister4 | passedFrequencyHighBits; // Set the registers\n\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx3, passedFrequencyLowBits);\n    eightBitStoreIntoGBMemory(Channel1.memoryLocationNRx4, newRegister4); // Save the frequency for ourselves without triggering memory traps\n\n    Channel1.NRx3FrequencyLSB = passedFrequencyLowBits;\n    Channel1.NRx4FrequencyMSB = passedFrequencyHighBits;\n    Channel1.frequency = Channel1.NRx4FrequencyMSB << 8 | Channel1.NRx3FrequencyLSB;\n  }; // Cycle Counter for our sound accumulator\n\n\n  Channel1.cycleCounter = 0; // Squarewave channel with volume envelope and frequency sweep functions.\n  // NR10 -> Sweep Register R/W\n\n  Channel1.memoryLocationNRx0 = 0xff10; // -PPP NSSS Sweep period, negate, shift\n\n  Channel1.NRx0SweepPeriod = 0;\n  Channel1.NRx0Negate = false;\n  Channel1.NRx0SweepShift = 0; // NR11 -> Sound length/Wave pattern duty (R/W)\n\n  Channel1.memoryLocationNRx1 = 0xff11; // DDLL LLLL Duty, Length load (64-L)\n\n  Channel1.NRx1Duty = 0;\n  Channel1.NRx1LengthLoad = 0; // NR12 -> Volume Envelope (R/W)\n\n  Channel1.memoryLocationNRx2 = 0xff12; // VVVV APPP Starting volume, Envelope add mode, period\n\n  Channel1.NRx2StartingVolume = 0;\n  Channel1.NRx2EnvelopeAddMode = false;\n  Channel1.NRx2EnvelopePeriod = 0; // NR13 -> Frequency lo (W)\n\n  Channel1.memoryLocationNRx3 = 0xff13; // FFFF FFFF Frequency LSB\n\n  Channel1.NRx3FrequencyLSB = 0; // NR14 -> Frequency hi (R/W)\n\n  Channel1.memoryLocationNRx4 = 0xff14; // TL-- -FFF Trigger, Length enable, Frequency MSB\n\n  Channel1.NRx4LengthEnabled = false;\n  Channel1.NRx4FrequencyMSB = 0; // Channel Properties\n\n  Channel1.channelNumber = 1;\n  Channel1.isEnabled = false;\n  Channel1.isDacEnabled = false;\n  Channel1.frequency = 0;\n  Channel1.frequencyTimer = 0x00;\n  Channel1.envelopeCounter = 0x00;\n  Channel1.lengthCounter = 0x00;\n  Channel1.volume = 0x00; // Square Wave properties\n\n  Channel1.dutyCycle = 0x00;\n  Channel1.waveFormPositionOnDuty = 0x00; // Channel 1 Sweep\n\n  Channel1.isSweepEnabled = false;\n  Channel1.sweepCounter = 0x00;\n  Channel1.sweepShadowFrequency = 0x00; // Save States\n\n  Channel1.saveStateSlot = 7;\n  return Channel1;\n}(); // Sweep Specific functions\n\n\nfunction calculateSweepAndCheckOverflow() {\n  var newFrequency = getNewFrequencyFromSweep(); // 7FF is the highest value of the frequency: 111 1111 1111\n\n  if (newFrequency <= 0x7ff && Channel1.NRx0SweepShift > 0) {\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware\n    // If the new frequency is 2047 or less and the sweep shift is not zero,\n    // this new frequency is written back to the shadow frequency and square 1's frequency in NR13 and NR14,\n    // then frequency calculation and overflow check are run AGAIN immediately using this new value,\n    // but this second new frequency is not written back.\n    Channel1.sweepShadowFrequency = newFrequency;\n    Channel1.setFrequency(newFrequency); // Re calculate the new frequency\n\n    newFrequency = getNewFrequencyFromSweep();\n  } // Next check if the new Frequency is above 0x7FF\n  // if So, disable our sweep\n\n\n  if (newFrequency > 0x7ff) {\n    Channel1.isEnabled = false;\n  }\n} // Function to determing a new sweep in the current context\n\n\nfunction getNewFrequencyFromSweep() {\n  // Start our new frequency, by making it equal to the \"shadow frequency\"\n  var newFrequency = Channel1.sweepShadowFrequency;\n  newFrequency = newFrequency >> Channel1.NRx0SweepShift; // Check for sweep negation\n\n  if (Channel1.NRx0Negate) {\n    newFrequency = Channel1.sweepShadowFrequency - newFrequency;\n  } else {\n    newFrequency = Channel1.sweepShadowFrequency + newFrequency;\n  }\n\n  return newFrequency;\n} // NOTE: Tons of Copy-pasta btween channels, because Classes cannot be instantiated yet in assemblyscript\n\n\nvar Channel2 =\n/** @class */\nfunction () {\n  function Channel2() {}\n\n  Channel2.updateNRx1 = function (value) {\n    Channel2.NRx1Duty = value >> 6 & 0x03;\n    Channel2.NRx1LengthLoad = value & 0x3f; // Also need to set our length counter. Taken from the old, setChannelLengthCounter\n    // Channel length is determined by 64 (or 256 if channel 3), - the length load\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n    // Note, this will be different for channel 3\n\n    Channel2.lengthCounter = 64 - Channel2.NRx1LengthLoad;\n  };\n\n  Channel2.updateNRx2 = function (value) {\n    Channel2.NRx2StartingVolume = value >> 4 & 0x0f;\n    Channel2.NRx2EnvelopeAddMode = checkBitOnByte(3, value);\n    Channel2.NRx2EnvelopePeriod = value & 0x07; // Also, get our channel is dac enabled\n\n    Channel2.isDacEnabled = (value & 0xf8) > 0;\n  };\n\n  Channel2.updateNRx3 = function (value) {\n    Channel2.NRx3FrequencyLSB = value; // Update Channel Frequency\n\n    var frequency = Channel2.NRx4FrequencyMSB << 8 | Channel2.NRx3FrequencyLSB;\n    Channel2.frequency = frequency;\n  };\n\n  Channel2.updateNRx4 = function (value) {\n    Channel2.NRx4LengthEnabled = checkBitOnByte(6, value);\n    Channel2.NRx4FrequencyMSB = value & 0x07; // Update Channel Frequency\n\n    var frequency = Channel2.NRx4FrequencyMSB << 8 | Channel2.NRx3FrequencyLSB;\n    Channel2.frequency = frequency;\n  }; // Function to save the state of the class\n\n\n  Channel2.saveState = function () {\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x00, Channel2.saveStateSlot), Channel2.isEnabled);\n    store(getSaveStateMemoryOffset(0x01, Channel2.saveStateSlot), Channel2.frequencyTimer);\n    store(getSaveStateMemoryOffset(0x05, Channel2.saveStateSlot), Channel2.envelopeCounter);\n    store(getSaveStateMemoryOffset(0x09, Channel2.saveStateSlot), Channel2.lengthCounter);\n    store(getSaveStateMemoryOffset(0x0e, Channel2.saveStateSlot), Channel2.volume);\n    store(getSaveStateMemoryOffset(0x13, Channel2.saveStateSlot), Channel2.dutyCycle);\n    store(getSaveStateMemoryOffset(0x14, Channel2.saveStateSlot), Channel2.waveFormPositionOnDuty);\n  }; // Function to load the save state from memory\n\n\n  Channel2.loadState = function () {\n    Channel2.isEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x00, Channel2.saveStateSlot));\n    Channel2.frequencyTimer = load(getSaveStateMemoryOffset(0x01, Channel2.saveStateSlot));\n    Channel2.envelopeCounter = load(getSaveStateMemoryOffset(0x05, Channel2.saveStateSlot));\n    Channel2.lengthCounter = load(getSaveStateMemoryOffset(0x09, Channel2.saveStateSlot));\n    Channel2.volume = load(getSaveStateMemoryOffset(0x0e, Channel2.saveStateSlot));\n    Channel2.dutyCycle = load(getSaveStateMemoryOffset(0x13, Channel2.saveStateSlot));\n    Channel2.waveFormPositionOnDuty = load(getSaveStateMemoryOffset(0x14, Channel2.saveStateSlot));\n  };\n\n  Channel2.initialize = function () {\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx1 - 1, 0xff);\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx1, 0x3f);\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx2, 0x00);\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx3, 0x00);\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx4, 0xb8);\n  }; // Function to get a sample using the cycle counter on the channel\n\n\n  Channel2.getSampleFromCycleCounter = function () {\n    var accumulatedCycles = Channel2.cycleCounter;\n    Channel2.cycleCounter = 0;\n    return Channel2.getSample(accumulatedCycles);\n  }; // Function to reset our timer, useful for GBC double speed mode\n\n\n  Channel2.resetTimer = function () {\n    Channel2.frequencyTimer = (2048 - Channel2.frequency) * 4; // TODO: Ensure this is correct for GBC Double Speed Mode\n\n    if (Cpu.GBCDoubleSpeed) {\n      Channel2.frequencyTimer = Channel2.frequencyTimer * 2;\n    }\n  };\n\n  Channel2.getSample = function (numberOfCycles) {\n    // Decrement our channel timer\n    Channel2.frequencyTimer -= numberOfCycles;\n\n    if (Channel2.frequencyTimer <= 0) {\n      // Get the amount that overflowed so we don't drop cycles\n      var overflowAmount = abs(Channel2.frequencyTimer); // Reset our timer\n      // A square channel's frequency timer period is set to (2048-frequency)*4.\n      // Four duty cycles are available, each waveform taking 8 frequency timer clocks to cycle through:\n\n      Channel2.resetTimer();\n      Channel2.frequencyTimer -= overflowAmount; // Also increment our duty cycle\n      // What is duty? https://en.wikipedia.org/wiki/Duty_cycle\n      // Duty cycle for square wave: http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Square_Wave\n\n      Channel2.waveFormPositionOnDuty += 1;\n\n      if (Channel2.waveFormPositionOnDuty >= 8) {\n        Channel2.waveFormPositionOnDuty = 0;\n      }\n    } // Get our ourput volume\n\n\n    var outputVolume = 0; // Finally to set our output volume, the channel must be enabled,\n    // Our channel DAC must be enabled, and we must be in an active state\n    // Of our duty cycle\n\n    if (Channel2.isEnabled && Channel2.isDacEnabled) {\n      outputVolume = Channel2.volume;\n    } else {\n      // Return silence\n      // Since range from -15 - 15, or 0 to 30 for our unsigned\n      return 15;\n    } // Get the current sampleValue\n\n\n    var sample = 1;\n\n    if (!isDutyCycleClockPositiveOrNegativeForWaveform(Channel2.NRx1Duty, Channel2.waveFormPositionOnDuty)) {\n      sample = sample * -1;\n    }\n\n    sample = sample * outputVolume; // Square Waves Can range from -15 - 15. Therefore simply add 15\n\n    sample = sample + 15;\n    return sample;\n  }; //http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Trigger_Event\n\n\n  Channel2.trigger = function () {\n    Channel2.isEnabled = true;\n\n    if (Channel2.lengthCounter === 0) {\n      Channel2.lengthCounter = 64;\n    } // Reset our timer\n    // A square channel's frequency timer period is set to (2048-frequency)*4.\n    // Four duty cycles are available, each waveform taking 8 frequency timer clocks to cycle through:\n\n\n    Channel2.resetTimer();\n    Channel2.envelopeCounter = Channel2.NRx2EnvelopePeriod;\n    Channel2.volume = Channel2.NRx2StartingVolume; // Finally if DAC is off, channel is still disabled\n\n    if (!Channel2.isDacEnabled) {\n      Channel2.isEnabled = false;\n    }\n  }; // Function to determine if the current channel would update when getting the sample\n  // This is used to accumulate samples\n\n\n  Channel2.willChannelUpdate = function (numberOfCycles) {\n    //Increment our cycle counter\n    Channel2.cycleCounter += numberOfCycles; // Dac enabled status cached by accumulator\n\n    if (Channel2.frequencyTimer - Channel2.cycleCounter > 0) {\n      return false;\n    }\n\n    return true;\n  };\n\n  Channel2.updateLength = function () {\n    if (Channel2.lengthCounter > 0 && Channel2.NRx4LengthEnabled) {\n      Channel2.lengthCounter -= 1;\n    }\n\n    if (Channel2.lengthCounter === 0) {\n      Channel2.isEnabled = false;\n    }\n  };\n\n  Channel2.updateEnvelope = function () {\n    // Obscure behavior\n    // TODO: The volume envelope and sweep timers treat a period of 0 as 8.\n    Channel2.envelopeCounter -= 1;\n\n    if (Channel2.envelopeCounter <= 0) {\n      Channel2.envelopeCounter = Channel2.NRx2EnvelopePeriod; // When the timer generates a clock and the envelope period is NOT zero, a new volume is calculated\n      // NOTE: There is some weiirrdd obscure behavior where zero can equal 8, so watch out for that\n\n      if (Channel2.envelopeCounter !== 0) {\n        if (Channel2.NRx2EnvelopeAddMode && Channel2.volume < 15) {\n          Channel2.volume += 1;\n        } else if (!Channel2.NRx2EnvelopeAddMode && Channel2.volume > 0) {\n          Channel2.volume -= 1;\n        }\n      }\n    }\n  };\n\n  Channel2.setFrequency = function (frequency) {\n    // Get the high and low bits\n    var passedFrequencyHighBits = frequency >> 8;\n    var passedFrequencyLowBits = frequency & 0xff; // Get the new register 4\n\n    var register4 = eightBitLoadFromGBMemory(Channel2.memoryLocationNRx4); // Knock off lower 3 bits, and Or on our high bits\n\n    var newRegister4 = register4 & 0xf8;\n    newRegister4 = newRegister4 | passedFrequencyHighBits; // Set the registers\n\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx3, passedFrequencyLowBits);\n    eightBitStoreIntoGBMemory(Channel2.memoryLocationNRx4, newRegister4); // Save the frequency for ourselves without triggering memory traps\n\n    Channel2.NRx3FrequencyLSB = passedFrequencyLowBits;\n    Channel2.NRx4FrequencyMSB = passedFrequencyHighBits;\n    Channel2.frequency = Channel2.NRx4FrequencyMSB << 8 | Channel2.NRx3FrequencyLSB;\n  }; // Cycle Counter for our sound accumulator\n\n\n  Channel2.cycleCounter = 0; // Squarewave channel with volume envelope functions only.\n  // NR21 -> Sound length/Wave pattern duty (R/W)\n\n  Channel2.memoryLocationNRx1 = 0xff16; // DDLL LLLL Duty, Length load (64-L)\n\n  Channel2.NRx1Duty = 0;\n  Channel2.NRx1LengthLoad = 0; // NR22 -> Volume Envelope (R/W)\n\n  Channel2.memoryLocationNRx2 = 0xff17; // VVVV APPP Starting volume, Envelope add mode, period\n\n  Channel2.NRx2StartingVolume = 0;\n  Channel2.NRx2EnvelopeAddMode = false;\n  Channel2.NRx2EnvelopePeriod = 0; // NR23 -> Frequency lo (W)\n\n  Channel2.memoryLocationNRx3 = 0xff18; // FFFF FFFF Frequency LSB\n\n  Channel2.NRx3FrequencyLSB = 0; // NR24 -> Frequency hi (R/W)\n\n  Channel2.memoryLocationNRx4 = 0xff19; // TL-- -FFF Trigger, Length enable, Frequency MSB\n\n  Channel2.NRx4LengthEnabled = false;\n  Channel2.NRx4FrequencyMSB = 0; // Channel Properties\n\n  Channel2.channelNumber = 2;\n  Channel2.isEnabled = false;\n  Channel2.isDacEnabled = false;\n  Channel2.frequency = 0;\n  Channel2.frequencyTimer = 0x00;\n  Channel2.envelopeCounter = 0x00;\n  Channel2.lengthCounter = 0x00;\n  Channel2.volume = 0x00; // Square Wave properties\n\n  Channel2.dutyCycle = 0x00;\n  Channel2.waveFormPositionOnDuty = 0x00; // Save States\n\n  Channel2.saveStateSlot = 8;\n  return Channel2;\n}(); // NOTE: Tons of Copy-pasta btween channels, because Classes cannot be instantiated yet in assemblyscript\n\n\nvar Channel3 =\n/** @class */\nfunction () {\n  function Channel3() {} // E--- ---- DAC power\n\n\n  Channel3.updateNRx0 = function (value) {\n    Channel3.isDacEnabled = checkBitOnByte(7, value);\n  };\n\n  Channel3.updateNRx1 = function (value) {\n    Channel3.NRx1LengthLoad = value; // Also need to set our length counter. Taken from the old, setChannelLengthCounter\n    // Channel length is determined by 64 (or 256 if channel 3), - the length load\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n    // Note, this will be different for channel 3\n    // Supposed to be 256, so subtracting 255 and then adding 1 if that makes sense\n\n    Channel3.lengthCounter = 256 - Channel3.NRx1LengthLoad;\n  };\n\n  Channel3.updateNRx2 = function (value) {\n    Channel3.NRx2VolumeCode = value >> 5 & 0x0f;\n  };\n\n  Channel3.updateNRx3 = function (value) {\n    Channel3.NRx3FrequencyLSB = value; // Update Channel Frequency\n\n    var frequency = Channel3.NRx4FrequencyMSB << 8 | Channel3.NRx3FrequencyLSB;\n    Channel3.frequency = frequency;\n  };\n\n  Channel3.updateNRx4 = function (value) {\n    Channel3.NRx4LengthEnabled = checkBitOnByte(6, value);\n    Channel3.NRx4FrequencyMSB = value & 0x07; // Update Channel Frequency\n\n    var frequency = Channel3.NRx4FrequencyMSB << 8 | Channel3.NRx3FrequencyLSB;\n    Channel3.frequency = frequency;\n  }; // Function to save the state of the class\n\n\n  Channel3.saveState = function () {\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x00, Channel3.saveStateSlot), Channel3.isEnabled);\n    store(getSaveStateMemoryOffset(0x01, Channel3.saveStateSlot), Channel3.frequencyTimer);\n    store(getSaveStateMemoryOffset(0x05, Channel3.saveStateSlot), Channel3.lengthCounter);\n    store(getSaveStateMemoryOffset(0x09, Channel3.saveStateSlot), Channel3.waveTablePosition);\n  }; // Function to load the save state from memory\n\n\n  Channel3.loadState = function () {\n    Channel3.isEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x00, Channel3.saveStateSlot));\n    Channel3.frequencyTimer = load(getSaveStateMemoryOffset(0x01, Channel3.saveStateSlot));\n    Channel3.lengthCounter = load(getSaveStateMemoryOffset(0x05, Channel3.saveStateSlot));\n    Channel3.waveTablePosition = load(getSaveStateMemoryOffset(0x09, Channel3.saveStateSlot));\n  };\n\n  Channel3.initialize = function () {\n    eightBitStoreIntoGBMemory(Channel3.memoryLocationNRx0, 0x7f);\n    eightBitStoreIntoGBMemory(Channel3.memoryLocationNRx1, 0xff);\n    eightBitStoreIntoGBMemory(Channel3.memoryLocationNRx2, 0x9f);\n    eightBitStoreIntoGBMemory(Channel3.memoryLocationNRx3, 0x00);\n    eightBitStoreIntoGBMemory(Channel3.memoryLocationNRx4, 0xb8); // The volume code changed\n\n    Channel3.volumeCodeChanged = true;\n  }; // Function to get a sample using the cycle counter on the channel\n\n\n  Channel3.getSampleFromCycleCounter = function () {\n    var accumulatedCycles = Channel3.cycleCounter;\n    Channel3.cycleCounter = 0;\n    return Channel3.getSample(accumulatedCycles);\n  }; // Function to reset our timer, useful for GBC double speed mode\n\n\n  Channel3.resetTimer = function () {\n    Channel3.frequencyTimer = (2048 - Channel3.frequency) * 2; // TODO: Ensure this is correct for GBC Double Speed Mode\n\n    if (Cpu.GBCDoubleSpeed) {\n      Channel3.frequencyTimer = Channel3.frequencyTimer * 2;\n    }\n  };\n\n  Channel3.getSample = function (numberOfCycles) {\n    // Decrement our channel timer\n    Channel3.frequencyTimer -= numberOfCycles;\n\n    if (Channel3.frequencyTimer <= 0) {\n      // Get the amount that overflowed so we don't drop cycles\n      var overflowAmount = abs(Channel3.frequencyTimer); // Reset our timer\n      // A wave channel's frequency timer period is set to (2048-frequency) * 2.\n      // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Wave_Channel\n\n      Channel3.resetTimer();\n      Channel3.frequencyTimer -= overflowAmount; // Advance the wave table position, and loop back if needed\n\n      Channel3.waveTablePosition += 1;\n\n      if (Channel3.waveTablePosition >= 32) {\n        Channel3.waveTablePosition = 0;\n      }\n    } // Get our ourput volume\n\n\n    var outputVolume = 0;\n    var volumeCode = Channel3.volumeCode; // Finally to set our output volume, the channel must be enabled,\n    // Our channel DAC must be enabled, and we must be in an active state\n    // Of our duty cycle\n\n    if (Channel3.isEnabled && Channel3.isDacEnabled) {\n      // Get our volume code\n      if (Channel3.volumeCodeChanged) {\n        volumeCode = eightBitLoadFromGBMemory(Channel3.memoryLocationNRx2);\n        volumeCode = volumeCode >> 5;\n        volumeCode = volumeCode & 0x0f;\n        Channel3.volumeCode = volumeCode;\n        Channel3.volumeCodeChanged = false;\n      }\n    } else {\n      // Return silence\n      // Since range from -15 - 15, or 0 to 30 for our unsigned\n      return 15;\n    } // Get the current sample\n\n\n    var sample = 0; // Will Find the position, and knock off any remainder\n\n    var positionIndexToAdd = i32Portable(Channel3.waveTablePosition / 2);\n    var memoryLocationWaveSample = Channel3.memoryLocationWaveTable + positionIndexToAdd;\n    sample = eightBitLoadFromGBMemory(memoryLocationWaveSample); // Need to grab the top or lower half for the correct sample\n\n    if (Channel3.waveTablePosition % 2 === 0) {\n      // First sample\n      sample = sample >> 4;\n      sample = sample & 0x0f;\n    } else {\n      // Second Samples\n      sample = sample & 0x0f;\n    } // Shift our sample and set our volume depending on the volume code\n    // Since we can't multiply by float, simply divide by 4, 2, 1\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Wave_Channel\n\n\n    switch (volumeCode) {\n      case 0:\n        sample = sample >> 4;\n        break;\n\n      case 1:\n        // Dont Shift sample\n        outputVolume = 1;\n        break;\n\n      case 2:\n        sample = sample >> 1;\n        outputVolume = 2;\n        break;\n\n      default:\n        sample = sample >> 2;\n        outputVolume = 4;\n        break;\n    } // Spply out output volume\n\n\n    if (outputVolume > 0) {\n      sample = sample / outputVolume;\n    } else {\n      sample = 0;\n    } // Square Waves Can range from -15 - 15. Therefore simply add 15\n\n\n    sample = sample + 15;\n    return sample;\n  }; //http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Trigger_Event\n\n\n  Channel3.trigger = function () {\n    Channel3.isEnabled = true;\n\n    if (Channel3.lengthCounter === 0) {\n      Channel3.lengthCounter = 256;\n    } // Reset our timer\n    // A wave channel's frequency timer period is set to (2048-frequency)*2.\n\n\n    Channel3.resetTimer(); // Reset our wave table position\n\n    Channel3.waveTablePosition = 0; // Finally if DAC is off, channel is still disabled\n\n    if (!Channel3.isDacEnabled) {\n      Channel3.isEnabled = false;\n    }\n  }; // Function to determine if the current channel would update when getting the sample\n  // This is used to accumulate samples\n\n\n  Channel3.willChannelUpdate = function (numberOfCycles) {\n    //Increment our cycle counter\n    Channel3.cycleCounter += numberOfCycles; // Dac enabled status cached by accumulator\n\n    if (Channel3.frequencyTimer - Channel3.cycleCounter > 0 && !Channel3.volumeCodeChanged) {\n      return false;\n    }\n\n    return true;\n  };\n\n  Channel3.updateLength = function () {\n    if (Channel3.lengthCounter > 0 && Channel3.NRx4LengthEnabled) {\n      Channel3.lengthCounter -= 1;\n    }\n\n    if (Channel3.lengthCounter === 0) {\n      Channel3.isEnabled = false;\n    }\n  }; // Cycle Counter for our sound accumulator\n\n\n  Channel3.cycleCounter = 0; // Voluntary Wave channel with 32 4-bit programmable samples, played in sequence.\n  // NR30 -> Sound on/off (R/W)\n\n  Channel3.memoryLocationNRx0 = 0xff1a; // NR31 -> Sound length (R/W)\n\n  Channel3.memoryLocationNRx1 = 0xff1b; // LLLL LLLL Length load (256-L)\n\n  Channel3.NRx1LengthLoad = 0; // NR32 -> Select ouput level (R/W)\n\n  Channel3.memoryLocationNRx2 = 0xff1c; // -VV- ---- Volume code (00=0%, 01=100%, 10=50%, 11=25%)\n\n  Channel3.NRx2VolumeCode = 0; // NR33 -> Frequency lower data (W)\n\n  Channel3.memoryLocationNRx3 = 0xff1d; // FFFF FFFF Frequency LSB\n\n  Channel3.NRx3FrequencyLSB = 0; // NR34 -> Frequency higher data (R/W)\n\n  Channel3.memoryLocationNRx4 = 0xff1e; // TL-- -FFF Trigger, Length enable, Frequency MSB\n\n  Channel3.NRx4LengthEnabled = false;\n  Channel3.NRx4FrequencyMSB = 0; // Our wave table location\n\n  Channel3.memoryLocationWaveTable = 0xff30; // Channel Properties\n\n  Channel3.channelNumber = 3;\n  Channel3.isEnabled = false;\n  Channel3.isDacEnabled = false;\n  Channel3.frequency = 0;\n  Channel3.frequencyTimer = 0x00;\n  Channel3.lengthCounter = 0x00;\n  Channel3.waveTablePosition = 0x00;\n  Channel3.volumeCode = 0x00;\n  Channel3.volumeCodeChanged = false; // Save States\n\n  Channel3.saveStateSlot = 9;\n  return Channel3;\n}(); // NOTE: Tons of Copy-pasta btween channels, because Classes cannot be instantiated yet in assemblyscript\n\n\nvar Channel4 =\n/** @class */\nfunction () {\n  function Channel4() {}\n\n  Channel4.updateNRx1 = function (value) {\n    Channel4.NRx1LengthLoad = value & 0x3f; // Also need to set our length counter. Taken from the old, setChannelLengthCounter\n    // Channel length is determined by 64 (or 256 if channel 3), - the length load\n    // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n    // Note, this will be different for channel 3\n\n    Channel4.lengthCounter = 64 - Channel4.NRx1LengthLoad;\n  };\n\n  Channel4.updateNRx2 = function (value) {\n    Channel4.NRx2StartingVolume = value >> 4 & 0x0f;\n    Channel4.NRx2EnvelopeAddMode = checkBitOnByte(3, value);\n    Channel4.NRx2EnvelopePeriod = value & 0x07; // Also, get our channel is dac enabled\n\n    Channel4.isDacEnabled = (value & 0xf8) > 0;\n  };\n\n  Channel4.updateNRx3 = function (value) {\n    Channel4.NRx3ClockShift = value >> 4;\n    Channel4.NRx3WidthMode = checkBitOnByte(3, value);\n    Channel4.NRx3DivisorCode = value & 0x07; // Also, get our divisor\n\n    switch (Channel4.NRx3DivisorCode) {\n      case 0:\n        Channel4.divisor = 8;\n        return;\n\n      case 1:\n        Channel4.divisor = 16;\n        return;\n\n      case 2:\n        Channel4.divisor = 32;\n        return;\n\n      case 3:\n        Channel4.divisor = 48;\n        return;\n\n      case 4:\n        Channel4.divisor = 64;\n        return;\n\n      case 5:\n        Channel4.divisor = 80;\n        return;\n\n      case 6:\n        Channel4.divisor = 96;\n        return;\n\n      case 7:\n        Channel4.divisor = 112;\n        return;\n    }\n  };\n\n  Channel4.updateNRx4 = function (value) {\n    Channel4.NRx4LengthEnabled = checkBitOnByte(6, value);\n  }; // Function to save the state of the class\n\n\n  Channel4.saveState = function () {\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x00, Channel4.saveStateSlot), Channel4.isEnabled);\n    store(getSaveStateMemoryOffset(0x01, Channel4.saveStateSlot), Channel4.frequencyTimer);\n    store(getSaveStateMemoryOffset(0x05, Channel4.saveStateSlot), Channel4.envelopeCounter);\n    store(getSaveStateMemoryOffset(0x09, Channel4.saveStateSlot), Channel4.lengthCounter);\n    store(getSaveStateMemoryOffset(0x0e, Channel4.saveStateSlot), Channel4.volume);\n    store(getSaveStateMemoryOffset(0x13, Channel4.saveStateSlot), Channel4.linearFeedbackShiftRegister);\n  }; // Function to load the save state from memory\n\n\n  Channel4.loadState = function () {\n    Channel4.isEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x00, Channel4.saveStateSlot));\n    Channel4.frequencyTimer = load(getSaveStateMemoryOffset(0x01, Channel4.saveStateSlot));\n    Channel4.envelopeCounter = load(getSaveStateMemoryOffset(0x05, Channel4.saveStateSlot));\n    Channel4.lengthCounter = load(getSaveStateMemoryOffset(0x09, Channel4.saveStateSlot));\n    Channel4.volume = load(getSaveStateMemoryOffset(0x0e, Channel4.saveStateSlot));\n    Channel4.linearFeedbackShiftRegister = load(getSaveStateMemoryOffset(0x13, Channel4.saveStateSlot));\n  };\n\n  Channel4.initialize = function () {\n    eightBitStoreIntoGBMemory(Channel4.memoryLocationNRx1 - 1, 0xff);\n    eightBitStoreIntoGBMemory(Channel4.memoryLocationNRx1, 0xff);\n    eightBitStoreIntoGBMemory(Channel4.memoryLocationNRx2, 0x00);\n    eightBitStoreIntoGBMemory(Channel4.memoryLocationNRx3, 0x00);\n    eightBitStoreIntoGBMemory(Channel4.memoryLocationNRx4, 0xbf);\n  }; // Function to get a sample using the cycle counter on the channel\n\n\n  Channel4.getSampleFromCycleCounter = function () {\n    var accumulatedCycles = Channel4.cycleCounter;\n    Channel4.cycleCounter = 0;\n    return Channel4.getSample(accumulatedCycles);\n  };\n\n  Channel4.getSample = function (numberOfCycles) {\n    // Decrement our channel timer\n    Channel4.frequencyTimer -= numberOfCycles;\n\n    if (Channel4.frequencyTimer <= 0) {\n      // Get the amount that overflowed so we don't drop cycles\n      var overflowAmount = abs(Channel4.frequencyTimer); // Reset our timer\n\n      Channel4.frequencyTimer = Channel4.getNoiseChannelFrequencyPeriod();\n      Channel4.frequencyTimer -= overflowAmount; // Do some cool stuff with lfsr\n      // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Noise_Channel\n      // First XOR bit zero and one\n\n      var lfsrBitZero = Channel4.linearFeedbackShiftRegister & 0x01;\n      var lfsrBitOne = Channel4.linearFeedbackShiftRegister >> 1;\n      lfsrBitOne = lfsrBitOne & 0x01;\n      var xorLfsrBitZeroOne = lfsrBitZero ^ lfsrBitOne; // Shift all lsfr bits by one\n\n      Channel4.linearFeedbackShiftRegister = Channel4.linearFeedbackShiftRegister >> 1; // Place the XOR result on bit 15\n\n      Channel4.linearFeedbackShiftRegister = Channel4.linearFeedbackShiftRegister | xorLfsrBitZeroOne << 14; // If the width mode is set, set xor on bit 6, and make lfsr 7 bit\n\n      if (Channel4.NRx3WidthMode) {\n        // Make 7 bit, by knocking off lower bits. Want to keeps bits 8 - 16, and then or on 7\n        Channel4.linearFeedbackShiftRegister = Channel4.linearFeedbackShiftRegister & ~0x40;\n        Channel4.linearFeedbackShiftRegister = Channel4.linearFeedbackShiftRegister | xorLfsrBitZeroOne << 6;\n      }\n    } // Get our ourput volume, set to zero for silence\n\n\n    var outputVolume = 0; // Finally to set our output volume, the channel must be enabled,\n    // Our channel DAC must be enabled, and we must be in an active state\n    // Of our duty cycle\n\n    if (Channel4.isEnabled && Channel4.isDacEnabled) {\n      outputVolume = Channel4.volume;\n    } else {\n      // Return silence\n      // Since range from -15 - 15, or 0 to 30 for our unsigned\n      return 15;\n    } // Declare our sample\n\n\n    var sample = 0; // Wave form output is bit zero of lfsr, INVERTED\n\n    if (!checkBitOnByte(0, Channel4.linearFeedbackShiftRegister)) {\n      sample = 1;\n    } else {\n      sample = -1;\n    }\n\n    sample = sample * outputVolume; // Noise Can range from -15 - 15. Therefore simply add 15\n\n    sample = sample + 15;\n    return sample;\n  }; //http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Trigger_Event\n\n\n  Channel4.trigger = function () {\n    Channel4.isEnabled = true;\n\n    if (Channel4.lengthCounter === 0) {\n      Channel4.lengthCounter = 64;\n    } // Reset our timers\n\n\n    Channel4.frequencyTimer = Channel4.getNoiseChannelFrequencyPeriod();\n    Channel4.envelopeCounter = Channel4.NRx2EnvelopePeriod;\n    Channel4.volume = Channel4.NRx2StartingVolume; // Noise channel's LFSR bits are all set to 1.\n\n    Channel4.linearFeedbackShiftRegister = 0x7fff; // Finally if DAC is off, channel is still disabled\n\n    if (!Channel4.isDacEnabled) {\n      Channel4.isEnabled = false;\n    }\n  }; // Function to determine if the current channel would update when getting the sample\n  // This is used to accumulate samples\n\n\n  Channel4.willChannelUpdate = function (numberOfCycles) {\n    //Increment our cycle counter\n    Channel4.cycleCounter += numberOfCycles; // Dac enabled status cached by accumulator\n\n    if (Channel4.frequencyTimer - Channel4.cycleCounter > 0) {\n      return false;\n    }\n\n    return true;\n  };\n\n  Channel4.getNoiseChannelFrequencyPeriod = function () {\n    // Get our divisor from the divisor code, and shift by the clock shift\n    var response = Channel4.divisor << Channel4.NRx3ClockShift;\n\n    if (Cpu.GBCDoubleSpeed) {\n      response = response * 2;\n    }\n\n    return response;\n  };\n\n  Channel4.updateLength = function () {\n    if (Channel4.lengthCounter > 0 && Channel4.NRx4LengthEnabled) {\n      Channel4.lengthCounter -= 1;\n    }\n\n    if (Channel4.lengthCounter === 0) {\n      Channel4.isEnabled = false;\n    }\n  };\n\n  Channel4.updateEnvelope = function () {\n    // Obscure behavior\n    // TODO: The volume envelope and sweep timers treat a period of 0 as 8.\n    Channel4.envelopeCounter -= 1;\n\n    if (Channel4.envelopeCounter <= 0) {\n      Channel4.envelopeCounter = Channel4.NRx2EnvelopePeriod; // When the timer generates a clock and the envelope period is NOT zero, a new volume is calculated\n      // NOTE: There is some weiirrdd obscure behavior where zero can equal 8, so watch out for that\n\n      if (Channel4.envelopeCounter !== 0) {\n        if (Channel4.NRx2EnvelopeAddMode && Channel4.volume < 15) {\n          Channel4.volume += 1;\n        } else if (!Channel4.NRx2EnvelopeAddMode && Channel4.volume > 0) {\n          Channel4.volume -= 1;\n        }\n      }\n    }\n  }; // Cycle Counter for our sound accumulator\n\n\n  Channel4.cycleCounter = 0; // Channel 4\n  // 'white noise' channel with volume envelope functions.\n  // NR41 -> Sound length (R/W)\n\n  Channel4.memoryLocationNRx1 = 0xff20; // --LL LLLL Length load (64-L)\n\n  Channel4.NRx1LengthLoad = 0; // NR42 -> Volume Envelope (R/W)\n\n  Channel4.memoryLocationNRx2 = 0xff21; // VVVV APPP Starting volume, Envelope add mode, period\n\n  Channel4.NRx2StartingVolume = 0;\n  Channel4.NRx2EnvelopeAddMode = false;\n  Channel4.NRx2EnvelopePeriod = 0; // NR43 -> Polynomial Counter (R/W)\n\n  Channel4.memoryLocationNRx3 = 0xff22; // SSSS WDDD Clock shift, Width mode of LFSR, Divisor code\n\n  Channel4.NRx3ClockShift = 0;\n  Channel4.NRx3WidthMode = false;\n  Channel4.NRx3DivisorCode = 0; // NR44 -> Trigger, Length Enable\n\n  Channel4.memoryLocationNRx4 = 0xff23; // TL-- ---- Trigger, Length enable\n\n  Channel4.NRx4LengthEnabled = false; // Channel Properties\n\n  Channel4.channelNumber = 4;\n  Channel4.isEnabled = false;\n  Channel4.isDacEnabled = false;\n  Channel4.frequencyTimer = 0x00;\n  Channel4.envelopeCounter = 0x00;\n  Channel4.lengthCounter = 0x00;\n  Channel4.volume = 0x00;\n  Channel4.divisor = 0; // Noise properties\n  // NOTE: Is only 15 bits\n\n  Channel4.linearFeedbackShiftRegister = 0x00; // Save States\n\n  Channel4.saveStateSlot = 10;\n  return Channel4;\n}(); // Another class simply for accumulating samples\n// Default everything to silence\n\n\nvar SoundAccumulator =\n/** @class */\nfunction () {\n  function SoundAccumulator() {}\n\n  SoundAccumulator.channel1Sample = 15;\n  SoundAccumulator.channel2Sample = 15;\n  SoundAccumulator.channel3Sample = 15;\n  SoundAccumulator.channel4Sample = 15;\n  SoundAccumulator.channel1DacEnabled = false;\n  SoundAccumulator.channel2DacEnabled = false;\n  SoundAccumulator.channel3DacEnabled = false;\n  SoundAccumulator.channel4DacEnabled = false;\n  SoundAccumulator.leftChannelSampleUnsignedByte = 127;\n  SoundAccumulator.rightChannelSampleUnsignedByte = 127;\n  SoundAccumulator.mixerVolumeChanged = false;\n  SoundAccumulator.mixerEnabledChanged = false; //If a channel was updated, need to also track if we need to need to mix them again\n\n  SoundAccumulator.needToRemixSamples = false;\n  return SoundAccumulator;\n}();\n\nfunction initializeSoundAccumulator() {\n  SoundAccumulator.channel1Sample = 15;\n  SoundAccumulator.channel2Sample = 15;\n  SoundAccumulator.channel3Sample = 15;\n  SoundAccumulator.channel4Sample = 15;\n  SoundAccumulator.channel1DacEnabled = false;\n  SoundAccumulator.channel2DacEnabled = false;\n  SoundAccumulator.channel3DacEnabled = false;\n  SoundAccumulator.channel4DacEnabled = false;\n  SoundAccumulator.leftChannelSampleUnsignedByte = 127;\n  SoundAccumulator.rightChannelSampleUnsignedByte = 127;\n  SoundAccumulator.mixerVolumeChanged = true;\n  SoundAccumulator.mixerEnabledChanged = true;\n  SoundAccumulator.needToRemixSamples = false;\n}\n\nfunction accumulateSound(numberOfCycles) {\n  // Check if any of the individual channels will update\n  var channel1WillUpdate = Channel1.willChannelUpdate(numberOfCycles) || didChannelDacChange(Channel1.channelNumber);\n  var channel2WillUpdate = Channel2.willChannelUpdate(numberOfCycles) || didChannelDacChange(Channel2.channelNumber);\n  var channel3WillUpdate = Channel3.willChannelUpdate(numberOfCycles) || didChannelDacChange(Channel3.channelNumber);\n  var channel4WillUpdate = Channel4.willChannelUpdate(numberOfCycles) || didChannelDacChange(Channel4.channelNumber);\n\n  if (channel1WillUpdate) {\n    SoundAccumulator.channel1Sample = Channel1.getSampleFromCycleCounter();\n  }\n\n  if (channel2WillUpdate) {\n    SoundAccumulator.channel2Sample = Channel2.getSampleFromCycleCounter();\n  }\n\n  if (channel3WillUpdate) {\n    SoundAccumulator.channel3Sample = Channel3.getSampleFromCycleCounter();\n  }\n\n  if (channel4WillUpdate) {\n    SoundAccumulator.channel4Sample = Channel4.getSampleFromCycleCounter();\n  } // If any channel updated, we need to re-mix our samples\n\n\n  if (channel1WillUpdate || channel2WillUpdate || channel3WillUpdate || channel4WillUpdate) {\n    SoundAccumulator.needToRemixSamples = true;\n  } // Do Some downsampling magic\n\n\n  Sound.downSampleCycleCounter += numberOfCycles * Sound.downSampleCycleMultiplier;\n\n  if (Sound.downSampleCycleCounter >= Sound.maxDownSampleCycles()) {\n    // Reset the downsample counter\n    // Don't set to zero to catch overflowed cycles\n    Sound.downSampleCycleCounter -= Sound.maxDownSampleCycles();\n\n    if (SoundAccumulator.needToRemixSamples || SoundAccumulator.mixerVolumeChanged || SoundAccumulator.mixerEnabledChanged) {\n      mixChannelSamples(SoundAccumulator.channel1Sample, SoundAccumulator.channel2Sample, SoundAccumulator.channel3Sample, SoundAccumulator.channel4Sample);\n    } // Finally Simply place the accumulated sample in memory\n    // Set our volumes in memory\n    // +1 so it can not be zero\n\n\n    setLeftAndRightOutputForAudioQueue(SoundAccumulator.leftChannelSampleUnsignedByte + 1, SoundAccumulator.rightChannelSampleUnsignedByte + 1, AUDIO_BUFFER_LOCATION);\n    Sound.audioQueueIndex += 1; // Don't allow our audioQueueIndex to overflow into other parts of the wasmBoy memory map\n    // https://docs.google.com/spreadsheets/d/17xrEzJk5-sCB9J2mMJcVnzhbE-XH_NvczVSQH9OHvRk/edit#gid=0\n    // Not 0xFFFF because we need half of 64kb since we store left and right channel\n\n    var maxIndex = i32Portable(Sound.wasmBoyMemoryMaxBufferSize / 2) - 1;\n\n    if (Sound.audioQueueIndex >= maxIndex) {\n      Sound.audioQueueIndex -= 1;\n    }\n  }\n} // Function used by SoundAccumulator to find out if a channel Dac Changed\n\n\nfunction didChannelDacChange(channelNumber) {\n  switch (channelNumber) {\n    case Channel1.channelNumber:\n      if (SoundAccumulator.channel1DacEnabled !== Channel1.isDacEnabled) {\n        SoundAccumulator.channel1DacEnabled = Channel1.isDacEnabled;\n        return true;\n      }\n\n      return false;\n\n    case Channel2.channelNumber:\n      if (SoundAccumulator.channel2DacEnabled !== Channel2.isDacEnabled) {\n        SoundAccumulator.channel2DacEnabled = Channel2.isDacEnabled;\n        return true;\n      }\n\n      return false;\n\n    case Channel3.channelNumber:\n      if (SoundAccumulator.channel3DacEnabled !== Channel3.isDacEnabled) {\n        SoundAccumulator.channel3DacEnabled = Channel3.isDacEnabled;\n        return true;\n      }\n\n      return false;\n\n    case Channel4.channelNumber:\n      if (SoundAccumulator.channel4DacEnabled !== Channel4.isDacEnabled) {\n        SoundAccumulator.channel4DacEnabled = Channel4.isDacEnabled;\n        return true;\n      }\n\n      return false;\n  }\n\n  return false;\n} // https://emu-docs.org/Game%20Boy/gb_sound.txt\n\n\nvar Sound =\n/** @class */\nfunction () {\n  function Sound() {} // Number of cycles to run in each batch process\n  // This number should be in sync so that sound doesn't run too many cyles at once\n  // and does not exceed the minimum number of cyles for either down sampling, or\n  // How often we change the frame, or a channel's update process\n\n\n  Sound.batchProcessCycles = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      return 174;\n    }\n\n    return 87;\n  };\n\n  Sound.updateNR50 = function (value) {\n    Sound.NR50LeftMixerVolume = value >> 4 & 0x07;\n    Sound.NR50RightMixerVolume = value & 0x07;\n  };\n\n  Sound.updateNR51 = function (value) {\n    Sound.NR51IsChannel4EnabledOnLeftOutput = checkBitOnByte(7, value);\n    Sound.NR51IsChannel3EnabledOnLeftOutput = checkBitOnByte(6, value);\n    Sound.NR51IsChannel2EnabledOnLeftOutput = checkBitOnByte(5, value);\n    Sound.NR51IsChannel1EnabledOnLeftOutput = checkBitOnByte(4, value);\n    Sound.NR51IsChannel4EnabledOnRightOutput = checkBitOnByte(3, value);\n    Sound.NR51IsChannel3EnabledOnRightOutput = checkBitOnByte(2, value);\n    Sound.NR51IsChannel2EnabledOnRightOutput = checkBitOnByte(1, value);\n    Sound.NR51IsChannel1EnabledOnRightOutput = checkBitOnByte(0, value);\n  };\n\n  Sound.updateNR52 = function (value) {\n    Sound.NR52IsSoundEnabled = checkBitOnByte(7, value);\n  };\n\n  Sound.maxFrameSequenceCycles = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      return 16384;\n    }\n\n    return 8192;\n  };\n\n  Sound.maxDownSampleCycles = function () {\n    return Cpu.CLOCK_SPEED();\n  }; // Function to save the state of the class\n\n\n  Sound.saveState = function () {\n    store(getSaveStateMemoryOffset(0x00, Sound.saveStateSlot), Sound.frameSequenceCycleCounter);\n    store(getSaveStateMemoryOffset(0x04, Sound.saveStateSlot), Sound.downSampleCycleCounter);\n    store(getSaveStateMemoryOffset(0x05, Sound.saveStateSlot), Sound.frameSequencer);\n  }; // Function to load the save state from memory\n\n\n  Sound.loadState = function () {\n    Sound.frameSequenceCycleCounter = load(getSaveStateMemoryOffset(0x00, Sound.saveStateSlot));\n    Sound.downSampleCycleCounter = load(getSaveStateMemoryOffset(0x04, Sound.saveStateSlot));\n    Sound.frameSequencer = load(getSaveStateMemoryOffset(0x05, Sound.saveStateSlot));\n    clearAudioBuffer();\n  }; // Current cycles\n  // This will be used for batch processing\n  // https://github.com/binji/binjgb/commit/e028f45e805bc0b0aa4697224a209f9ae514c954\n  // TODO: May Also need to do this for Reads\n\n\n  Sound.currentCycles = 0; // Channel control / On-OFF / Volume (RW)\n\n  Sound.memoryLocationNR50 = 0xff24;\n  Sound.NR50LeftMixerVolume = 0;\n  Sound.NR50RightMixerVolume = 0; // 0xFF25 selects which output each channel goes to, Referred to as NR51\n\n  Sound.memoryLocationNR51 = 0xff25;\n  Sound.NR51IsChannel1EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel2EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel3EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel4EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel1EnabledOnRightOutput = true;\n  Sound.NR51IsChannel2EnabledOnRightOutput = true;\n  Sound.NR51IsChannel3EnabledOnRightOutput = true;\n  Sound.NR51IsChannel4EnabledOnRightOutput = true; // Sound on/off\n\n  Sound.memoryLocationNR52 = 0xff26;\n  Sound.NR52IsSoundEnabled = true; // $FF30 -- $FF3F is the load register space for the 4-bit samples for channel 3\n\n  Sound.memoryLocationChannel3LoadRegisterStart = 0xff30; // Need to count how often we need to increment our frame sequencer\n  // Which you can read about below\n\n  Sound.frameSequenceCycleCounter = 0x0000; // Also need to downsample our audio to average audio qualty\n  // https://www.reddit.com/r/EmuDev/comments/5gkwi5/gb_apu_sound_emulation/\n  // Want to do 48000hz, so CpuRate / Sound Rate, 4194304 / 48000 ~ 87 cycles\n\n  Sound.downSampleCycleCounter = 0x00;\n  Sound.downSampleCycleMultiplier = 48000; // Frame sequencer controls what should be updated and and ticked\n  // Every time the sound is updated :) It is updated everytime the\n  // Cycle counter reaches the max cycle\n\n  Sound.frameSequencer = 0x00; // Our current sample number we are passing back to the wasmboy memory map\n  // Found that a static number of samples doesn't work well on mobile\n  // Will just update the queue index, grab as much as we can whenever we need more audio, then reset\n  // NOTE: Giving a really large sample rate gives more latency, but less pops!\n  //static readonly MAX_NUMBER_OF_SAMPLES: i32 = 4096;\n\n  Sound.audioQueueIndex = 0x0000;\n  Sound.wasmBoyMemoryMaxBufferSize = 0x20000; // Save States\n\n  Sound.saveStateSlot = 6;\n  return Sound;\n}(); // Initialize sound registers\n// From: https://emu-docs.org/Game%20Boy/gb_sound.txt\n\n\nfunction initializeSound() {\n  // Reset Stateful variables\n  Sound.currentCycles = 0;\n  Sound.NR50LeftMixerVolume = 0;\n  Sound.NR50RightMixerVolume = 0;\n  Sound.NR51IsChannel1EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel2EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel3EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel4EnabledOnLeftOutput = true;\n  Sound.NR51IsChannel1EnabledOnRightOutput = true;\n  Sound.NR51IsChannel2EnabledOnRightOutput = true;\n  Sound.NR51IsChannel3EnabledOnRightOutput = true;\n  Sound.NR51IsChannel4EnabledOnRightOutput = true;\n  Sound.NR52IsSoundEnabled = true;\n  Sound.frameSequenceCycleCounter = 0x0000;\n  Sound.downSampleCycleCounter = 0x00;\n  Sound.frameSequencer = 0x00;\n  Sound.audioQueueIndex = 0x0000; // intiialize our channels\n\n  Channel1.initialize();\n  Channel2.initialize();\n  Channel3.initialize();\n  Channel4.initialize(); // Other Sound Registers\n\n  eightBitStoreIntoGBMemory(Sound.memoryLocationNR50, 0x77);\n  eightBitStoreIntoGBMemory(Sound.memoryLocationNR51, 0xf3);\n  eightBitStoreIntoGBMemory(Sound.memoryLocationNR52, 0xf1);\n  initializeSoundAccumulator();\n} // Function to batch process our audio after we skipped so many cycles\n\n\nfunction batchProcessAudio() {\n  if (Sound.currentCycles < Sound.batchProcessCycles()) {\n    return;\n  }\n\n  while (Sound.currentCycles >= Sound.batchProcessCycles()) {\n    updateSound(Sound.batchProcessCycles());\n    Sound.currentCycles = Sound.currentCycles - Sound.batchProcessCycles();\n  }\n} // Function for updating sound\n\n\nfunction updateSound(numberOfCycles) {\n  // Check if our frameSequencer updated\n  var frameSequencerUpdated = updateFrameSequencer(numberOfCycles);\n\n  if (Config.audioAccumulateSamples && !frameSequencerUpdated) {\n    accumulateSound(numberOfCycles);\n  } else {\n    calculateSound(numberOfCycles);\n  }\n} // Funciton to get the current Audio Queue index\n\n\nfunction getNumberOfSamplesInAudioBuffer() {\n  return Sound.audioQueueIndex;\n} // Function to reset the audio queue\n\n\nfunction clearAudioBuffer() {\n  Sound.audioQueueIndex = 0;\n}\n\nfunction calculateSound(numberOfCycles) {\n  // Update all of our channels\n  // All samples will be returned as 0 to 30\n  // 0 being -1.0, and 30 being 1.0\n  // (see blurb at top)\n  var channel1Sample = i32Portable(Channel1.getSample(numberOfCycles));\n  var channel2Sample = i32Portable(Channel2.getSample(numberOfCycles));\n  var channel3Sample = i32Portable(Channel3.getSample(numberOfCycles));\n  var channel4Sample = i32Portable(Channel4.getSample(numberOfCycles)); // TODO: Allow individual channels to be muted\n  // let channel1Sample: i32 = 15;\n  // let channel2Sample: i32 = 15;\n  // let channel3Sample: i32 = 15;\n  // let channel4Sample: i32 = 15;\n  // Save the samples in the accumulator\n\n  SoundAccumulator.channel1Sample = channel1Sample;\n  SoundAccumulator.channel2Sample = channel2Sample;\n  SoundAccumulator.channel3Sample = channel3Sample;\n  SoundAccumulator.channel4Sample = channel4Sample; // Do Some downsampling magic\n\n  Sound.downSampleCycleCounter += numberOfCycles * Sound.downSampleCycleMultiplier;\n\n  if (Sound.downSampleCycleCounter >= Sound.maxDownSampleCycles()) {\n    // Reset the downsample counter\n    // Don't set to zero to catch overflowed cycles\n    Sound.downSampleCycleCounter -= Sound.maxDownSampleCycles(); // Mix our samples\n\n    var mixedSample = mixChannelSamples(channel1Sample, channel2Sample, channel3Sample, channel4Sample);\n    var leftChannelSampleUnsignedByte = splitHighByte(mixedSample);\n    var rightChannelSampleUnsignedByte = splitLowByte(mixedSample); // Set our volumes in memory\n    // +1 so it can not be zero\n\n    setLeftAndRightOutputForAudioQueue(leftChannelSampleUnsignedByte + 1, rightChannelSampleUnsignedByte + 1, AUDIO_BUFFER_LOCATION);\n\n    if (Config.enableAudioDebugging) {\n      // Channel 1\n      mixedSample = mixChannelSamples(channel1Sample, 15, 15, 15);\n      leftChannelSampleUnsignedByte = splitHighByte(mixedSample);\n      rightChannelSampleUnsignedByte = splitLowByte(mixedSample);\n      setLeftAndRightOutputForAudioQueue(leftChannelSampleUnsignedByte + 1, rightChannelSampleUnsignedByte + 1, CHANNEL_1_BUFFER_LOCATION); // Channel 2\n\n      mixedSample = mixChannelSamples(15, channel2Sample, 15, 15);\n      leftChannelSampleUnsignedByte = splitHighByte(mixedSample);\n      rightChannelSampleUnsignedByte = splitLowByte(mixedSample);\n      setLeftAndRightOutputForAudioQueue(leftChannelSampleUnsignedByte + 1, rightChannelSampleUnsignedByte + 1, CHANNEL_2_BUFFER_LOCATION); // Channel 3\n\n      mixedSample = mixChannelSamples(15, 15, channel3Sample, 15);\n      leftChannelSampleUnsignedByte = splitHighByte(mixedSample);\n      rightChannelSampleUnsignedByte = splitLowByte(mixedSample);\n      setLeftAndRightOutputForAudioQueue(leftChannelSampleUnsignedByte + 1, rightChannelSampleUnsignedByte + 1, CHANNEL_3_BUFFER_LOCATION); // Channel 4\n\n      mixedSample = mixChannelSamples(15, 15, 15, channel4Sample);\n      leftChannelSampleUnsignedByte = splitHighByte(mixedSample);\n      rightChannelSampleUnsignedByte = splitLowByte(mixedSample);\n      setLeftAndRightOutputForAudioQueue(leftChannelSampleUnsignedByte + 1, rightChannelSampleUnsignedByte + 1, CHANNEL_4_BUFFER_LOCATION);\n    }\n\n    Sound.audioQueueIndex += 1; // Don't allow our audioQueueIndex to overflow into other parts of the wasmBoy memory map\n    // https://docs.google.com/spreadsheets/d/17xrEzJk5-sCB9J2mMJcVnzhbE-XH_NvczVSQH9OHvRk/edit#gid=0\n    // Not 0xFFFF because we need half of 64kb since we store left and right channel\n\n    var maxIndex = i32Portable(Sound.wasmBoyMemoryMaxBufferSize / 2) - 1;\n\n    if (Sound.audioQueueIndex >= maxIndex) {\n      Sound.audioQueueIndex -= 1;\n    }\n  }\n}\n\nfunction updateFrameSequencer(numberOfCycles) {\n  // APU runs at 4194304 / 512\n  // Or Cpu.clockSpeed / 512\n  // Which means, we need to update once every 8192 cycles :)\n  Sound.frameSequenceCycleCounter += numberOfCycles;\n\n  if (Sound.frameSequenceCycleCounter >= Sound.maxFrameSequenceCycles()) {\n    // Reset the frameSequenceCycleCounter\n    // Not setting to zero as we do not want to drop cycles\n    Sound.frameSequenceCycleCounter -= Sound.maxFrameSequenceCycles(); // Check our frame sequencer\n    // https://gist.github.com/drhelius/3652407\n\n    switch (Sound.frameSequencer) {\n      case 0:\n        // Update Length on Channels\n        Channel1.updateLength();\n        Channel2.updateLength();\n        Channel3.updateLength();\n        Channel4.updateLength();\n        break;\n\n      /* Do Nothing on one */\n\n      case 2:\n        // Update Sweep and Length on Channels\n        Channel1.updateLength();\n        Channel2.updateLength();\n        Channel3.updateLength();\n        Channel4.updateLength();\n        Channel1.updateSweep();\n        break;\n\n      /* Do Nothing on three */\n\n      case 4:\n        // Update Length on Channels\n        Channel1.updateLength();\n        Channel2.updateLength();\n        Channel3.updateLength();\n        Channel4.updateLength();\n        break;\n\n      /* Do Nothing on five */\n\n      case 6:\n        // Update Sweep and Length on Channels\n        Channel1.updateLength();\n        Channel2.updateLength();\n        Channel3.updateLength();\n        Channel4.updateLength();\n        Channel1.updateSweep();\n        break;\n\n      case 7:\n        // Update Envelope on channels\n        Channel1.updateEnvelope();\n        Channel2.updateEnvelope();\n        Channel4.updateEnvelope();\n        break;\n    } // Update our frame sequencer\n\n\n    Sound.frameSequencer += 1;\n\n    if (Sound.frameSequencer >= 8) {\n      Sound.frameSequencer = 0;\n    }\n\n    return true;\n  }\n\n  return false;\n}\n\nfunction mixChannelSamples(channel1Sample, channel2Sample, channel3Sample, channel4Sample) {\n  // Do Some Cool mixing\n  // NR50 FF24 ALLL BRRR Vin L enable, Left vol, Vin R enable, Right vol\n  // NR51 FF25 NW21 NW21 Left enables, Right enables\n  // NR52 FF26 P--- NW21 Power control/status, Channel length statuses\n  // NW21 = 4 bits on byte\n  // 3 -> Channel 4, 2 -> Channel 3, 1 -> Channel 2, 0 -> Channel 1\n  if (channel1Sample === void 0) {\n    channel1Sample = 15;\n  }\n\n  if (channel2Sample === void 0) {\n    channel2Sample = 15;\n  }\n\n  if (channel3Sample === void 0) {\n    channel3Sample = 15;\n  }\n\n  if (channel4Sample === void 0) {\n    channel4Sample = 15;\n  } // Matt's Proccess\n  // I push out 1024 samples at a time and use 96000 hz sampling rate, so I guess i'm a bit less than one frame,\n  // but I let the queue fill up with 4 x 1024 samples before I start waiting for the audio\n  // TODO: Vin Mixing\n\n\n  SoundAccumulator.mixerVolumeChanged = false; // Get our channel volume for left/right\n\n  var leftChannelSample = 0;\n  var rightChannelSample = 0; // Find the sample for the left if enabled\n  // other wise add silence (15) for the channel\n\n  if (Sound.NR51IsChannel1EnabledOnLeftOutput) {\n    leftChannelSample += channel1Sample;\n  } else {\n    leftChannelSample += 15;\n  }\n\n  if (Sound.NR51IsChannel2EnabledOnLeftOutput) {\n    leftChannelSample += channel2Sample;\n  } else {\n    leftChannelSample += 15;\n  }\n\n  if (Sound.NR51IsChannel3EnabledOnLeftOutput) {\n    leftChannelSample += channel3Sample;\n  } else {\n    leftChannelSample += 15;\n  }\n\n  if (Sound.NR51IsChannel4EnabledOnLeftOutput) {\n    leftChannelSample += channel4Sample;\n  } else {\n    leftChannelSample += 15;\n  } // Find the sample for the right if enabled\n  // other wise add silence (15) for the channel\n\n\n  if (Sound.NR51IsChannel1EnabledOnRightOutput) {\n    rightChannelSample += channel1Sample;\n  } else {\n    rightChannelSample += 15;\n  }\n\n  if (Sound.NR51IsChannel2EnabledOnRightOutput) {\n    rightChannelSample += channel2Sample;\n  } else {\n    rightChannelSample += 15;\n  }\n\n  if (Sound.NR51IsChannel3EnabledOnRightOutput) {\n    rightChannelSample += channel3Sample;\n  } else {\n    rightChannelSample += 15;\n  }\n\n  if (Sound.NR51IsChannel4EnabledOnRightOutput) {\n    rightChannelSample += channel4Sample;\n  } else {\n    rightChannelSample += 15;\n  } // Update our accumulator\n\n\n  SoundAccumulator.mixerEnabledChanged = false;\n  SoundAccumulator.needToRemixSamples = false; // Finally multiply our volumes by the mixer volume\n  // Mixer volume can be at most 7 + 1\n  // Can be at most 7, because we only have 3 bits, 111 = 7\n  // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Mixer\n  // Done in the getSampleAsUnsignedByte(), since we are doing some weirdness there :)\n  // Convert our samples from unsigned 32 to unsigned byte\n  // Reason being, We want to be able to pass in wasm memory as usigned byte. Javascript will handle the conversion back\n\n  var leftChannelSampleUnsignedByte = getSampleAsUnsignedByte(leftChannelSample, Sound.NR50LeftMixerVolume + 1);\n  var rightChannelSampleUnsignedByte = getSampleAsUnsignedByte(rightChannelSample, Sound.NR50RightMixerVolume + 1); // Save these samples in the accumulator\n\n  SoundAccumulator.leftChannelSampleUnsignedByte = leftChannelSampleUnsignedByte;\n  SoundAccumulator.rightChannelSampleUnsignedByte = rightChannelSampleUnsignedByte;\n  return concatenateBytes(leftChannelSampleUnsignedByte, rightChannelSampleUnsignedByte);\n}\n\nfunction getSampleAsUnsignedByte(sample, mixerVolume) {\n  // If the sample is silence, return silence as unsigned byte\n  // Silence is common, and should be checked for performance\n  if (sample === 60) {\n    return 127;\n  } // convert to a signed, precise scale of -6000 to 6000 (cheap way of -1.0 to 1.0)\n  // Multiply by the mixer volume fraction (to find the actual volume)\n\n\n  var precision = 100000;\n  var convertedSample = sample - 60;\n  convertedSample = convertedSample * precision; // Multiply by the mixer volume fraction (to find the actual volume)\n\n  convertedSample = i32Portable(convertedSample * mixerVolume / 8); // Convert back to scale of 0 to 120\n\n  convertedSample = i32Portable(convertedSample / precision);\n  convertedSample = convertedSample + 60; // Finally, convert to an unsigned byte scale\n  // With Four Channels (0 to 30) and no global volume. Max is 120\n  // max unsigned byte goal is 254 (see blurb at top).\n  // 120 / 254 should give the correct conversion\n  // For example, 120 / 254 = 0.47244094488188976\n  // Multiply by 1000 to increase the float into an int\n  // so, 120 * 1000 / (0.47244094488188976 * 1000) should give approximate answer for max mixer volume\n\n  var maxDivider = i32Portable(120 * precision / 254);\n  convertedSample = i32Portable(convertedSample * precision / maxDivider); // Ensure we have an i32 and not a float for JS builds\n\n  convertedSample = i32Portable(convertedSample);\n  return convertedSample;\n} // Function to set our left and right channels at the correct queue index\n\n\nfunction setLeftAndRightOutputForAudioQueue(leftVolume, rightVolume, bufferLocation) {\n  // Get our stereo index\n  var audioQueueOffset = bufferLocation + Sound.audioQueueIndex * 2; // Store our volumes\n  // +1 that way we don't have empty data to ensure that the value is set\n\n  store(audioQueueOffset, leftVolume + 1);\n  store(audioQueueOffset + 1, rightVolume + 1);\n} // Functions involved in R/W of sound registers\n// Function to check and handle writes to sound registers\n\n\nfunction SoundRegisterWriteTraps(offset, value) {\n  if (offset !== Sound.memoryLocationNR52 && !Sound.NR52IsSoundEnabled) {\n    // Block all writes to any sound register EXCEPT NR52!\n    // This is under the assumption that the check for\n    // offset >= 0xFF10 && offset <= 0xFF26\n    // is done in writeTraps.ts (which it is)\n    // NOTE: Except on DMG, length can still be written (whatever that means)\n    return false;\n  }\n\n  switch (offset) {\n    // Handle NRx0 on Channels\n    case Channel1.memoryLocationNRx0:\n      Channel1.updateNRx0(value);\n      return true;\n\n    case Channel3.memoryLocationNRx0:\n      Channel3.updateNRx0(value);\n      return true;\n    // Handle NRx1 (Length Counter) on Channels\n\n    case Channel1.memoryLocationNRx1:\n      Channel1.updateNRx1(value);\n      return true;\n\n    case Channel2.memoryLocationNRx1:\n      Channel2.updateNRx1(value);\n      return true;\n\n    case Channel3.memoryLocationNRx1:\n      Channel3.updateNRx1(value);\n      return true;\n\n    case Channel4.memoryLocationNRx1:\n      Channel4.updateNRx1(value);\n      return true;\n    // Handle NRx2 (Envelope / Volume) on Channels\n\n    case Channel1.memoryLocationNRx2:\n      Channel1.updateNRx2(value);\n      return true;\n\n    case Channel2.memoryLocationNRx2:\n      Channel2.updateNRx2(value);\n      return true;\n\n    case Channel3.memoryLocationNRx2:\n      // Check if channel 3's volume code was written too\n      // This is handcy to know for accumulation of samples\n      Channel3.volumeCodeChanged = true;\n      Channel3.updateNRx2(value);\n      return true;\n\n    case Channel4.memoryLocationNRx2:\n      Channel4.updateNRx2(value);\n      return true;\n    // Handle NRx3 (Frequency / Noise Properties) on Channels\n\n    case Channel1.memoryLocationNRx3:\n      Channel1.updateNRx3(value);\n      return true;\n\n    case Channel2.memoryLocationNRx3:\n      Channel2.updateNRx3(value);\n      return true;\n\n    case Channel3.memoryLocationNRx3:\n      Channel3.updateNRx3(value);\n      return true;\n\n    case Channel4.memoryLocationNRx3:\n      Channel4.updateNRx3(value);\n      return true;\n    // Check our NRx4 registers to trap our trigger bits\n\n    case Channel1.memoryLocationNRx4:\n      if (checkBitOnByte(7, value)) {\n        Channel1.updateNRx4(value);\n        Channel1.trigger();\n      }\n\n      return true;\n\n    case Channel2.memoryLocationNRx4:\n      if (checkBitOnByte(7, value)) {\n        Channel2.updateNRx4(value);\n        Channel2.trigger();\n      }\n\n      return true;\n\n    case Channel3.memoryLocationNRx4:\n      if (checkBitOnByte(7, value)) {\n        Channel3.updateNRx4(value);\n        Channel3.trigger();\n      }\n\n      return true;\n\n    case Channel4.memoryLocationNRx4:\n      if (checkBitOnByte(7, value)) {\n        Channel4.updateNRx4(value);\n        Channel4.trigger();\n      }\n\n      return true;\n    // Tell the sound accumulator if volumes changes\n\n    case Sound.memoryLocationNR50:\n      Sound.updateNR50(value);\n      SoundAccumulator.mixerVolumeChanged = true;\n      return true;\n    // Tell the sound accumulator if volumes changes\n\n    case Sound.memoryLocationNR51:\n      Sound.updateNR51(value);\n      SoundAccumulator.mixerEnabledChanged = true;\n      return true;\n\n    case Sound.memoryLocationNR52:\n      // Reset all registers except NR52\n      Sound.updateNR52(value);\n\n      if (!checkBitOnByte(7, value)) {\n        for (var i = 0xff10; i < 0xff26; i++) {\n          eightBitStoreIntoGBMemory(i, 0x00);\n        }\n      }\n\n      return true;\n  } // We did not handle the write, Allow the write\n\n\n  return true;\n} // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n\n\nfunction SoundRegisterReadTraps(offset) {\n  // TODO: OR All Registers\n  // This will fix bugs in orcale of ages :)\n  if (offset === Sound.memoryLocationNR52) {\n    // Get our registerNR52\n    var registerNR52 = eightBitLoadFromGBMemory(Sound.memoryLocationNR52); // Knock off lower 7 bits\n\n    registerNR52 = registerNR52 & 0x80; // Or from the table\n\n    registerNR52 = registerNR52 | 0x70;\n    return registerNR52;\n  }\n\n  return -1;\n}\n\nvar Interrupts =\n/** @class */\nfunction () {\n  function Interrupts() {}\n\n  Interrupts.updateInterruptEnabled = function (value) {\n    Interrupts.isVBlankInterruptEnabled = checkBitOnByte(Interrupts.bitPositionVBlankInterrupt, value);\n    Interrupts.isLcdInterruptEnabled = checkBitOnByte(Interrupts.bitPositionLcdInterrupt, value);\n    Interrupts.isTimerInterruptEnabled = checkBitOnByte(Interrupts.bitPositionTimerInterrupt, value);\n    Interrupts.isSerialInterruptEnabled = checkBitOnByte(Interrupts.bitPositionSerialInterrupt, value);\n    Interrupts.isJoypadInterruptEnabled = checkBitOnByte(Interrupts.bitPositionJoypadInterrupt, value);\n    Interrupts.interruptsEnabledValue = value;\n  };\n\n  Interrupts.updateInterruptRequested = function (value) {\n    Interrupts.isVBlankInterruptRequested = checkBitOnByte(Interrupts.bitPositionVBlankInterrupt, value);\n    Interrupts.isLcdInterruptRequested = checkBitOnByte(Interrupts.bitPositionLcdInterrupt, value);\n    Interrupts.isTimerInterruptRequested = checkBitOnByte(Interrupts.bitPositionTimerInterrupt, value);\n    Interrupts.isSerialInterruptRequested = checkBitOnByte(Interrupts.bitPositionSerialInterrupt, value);\n    Interrupts.isJoypadInterruptRequested = checkBitOnByte(Interrupts.bitPositionJoypadInterrupt, value);\n    Interrupts.interruptsRequestedValue = value;\n  }; // Function to return if we have any pending interrupts\n\n\n  Interrupts.areInterruptsPending = function () {\n    return (Interrupts.interruptsRequestedValue & Interrupts.interruptsEnabledValue & 0x1f) > 0;\n  }; // Function to save the state of the class\n\n\n  Interrupts.saveState = function () {\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x00, Interrupts.saveStateSlot), Interrupts.masterInterruptSwitch);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x01, Interrupts.saveStateSlot), Interrupts.masterInterruptSwitchDelay); // Interrupts enabled and requested are stored in actual GB memory, thus, don't need to be saved\n  }; // Function to load the save state from memory\n\n\n  Interrupts.loadState = function () {\n    Interrupts.masterInterruptSwitch = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x00, Interrupts.saveStateSlot));\n    Interrupts.masterInterruptSwitchDelay = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x01, Interrupts.saveStateSlot));\n    Interrupts.updateInterruptEnabled(eightBitLoadFromGBMemory(Interrupts.memoryLocationInterruptEnabled));\n    Interrupts.updateInterruptRequested(eightBitLoadFromGBMemory(Interrupts.memoryLocationInterruptRequest));\n  };\n\n  Interrupts.masterInterruptSwitch = false; // According to mooneye, interrupts are not handled until AFTER\n  // Next instruction\n  // https://github.com/Gekkio/mooneye-gb/blob/master/docs/accuracy.markdown\n\n  Interrupts.masterInterruptSwitchDelay = false; // Biut position for each part of the interrupts HW registers\n\n  Interrupts.bitPositionVBlankInterrupt = 0;\n  Interrupts.bitPositionLcdInterrupt = 1;\n  Interrupts.bitPositionTimerInterrupt = 2;\n  Interrupts.bitPositionSerialInterrupt = 3;\n  Interrupts.bitPositionJoypadInterrupt = 4;\n  Interrupts.memoryLocationInterruptEnabled = 0xffff; // A.K.A interrupt Flag (IE)\n  // Cache which Interrupts are enabled\n\n  Interrupts.interruptsEnabledValue = 0;\n  Interrupts.isVBlankInterruptEnabled = false;\n  Interrupts.isLcdInterruptEnabled = false;\n  Interrupts.isTimerInterruptEnabled = false;\n  Interrupts.isSerialInterruptEnabled = false;\n  Interrupts.isJoypadInterruptEnabled = false;\n  Interrupts.memoryLocationInterruptRequest = 0xff0f; // A.K.A interrupt Flag (IF)\n  // Cache which Interrupts are requested\n\n  Interrupts.interruptsRequestedValue = 0;\n  Interrupts.isVBlankInterruptRequested = false;\n  Interrupts.isLcdInterruptRequested = false;\n  Interrupts.isTimerInterruptRequested = false;\n  Interrupts.isSerialInterruptRequested = false;\n  Interrupts.isJoypadInterruptRequested = false; // Save States\n\n  Interrupts.saveStateSlot = 2;\n  return Interrupts;\n}();\n\nfunction initializeInterrupts() {\n  // Values from BGB\n  // IE\n  Interrupts.updateInterruptEnabled(0x00);\n  eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptEnabled, Interrupts.interruptsEnabledValue); // IF\n\n  Interrupts.updateInterruptRequested(0xe1);\n  eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptRequest, Interrupts.interruptsRequestedValue);\n} // NOTE: Interrupts should be handled before reading an opcode\n\n\nfunction checkInterrupts() {\n  // First check for our delay was enabled\n  if (Interrupts.masterInterruptSwitchDelay) {\n    Interrupts.masterInterruptSwitch = true;\n    Interrupts.masterInterruptSwitchDelay = false;\n  } // Check if we have an enabled and requested interrupt\n\n\n  var isAnInterruptRequestedAndEnabledValue = Interrupts.interruptsEnabledValue & Interrupts.interruptsRequestedValue & 0x1f;\n\n  if (isAnInterruptRequestedAndEnabledValue > 0) {\n    // Boolean to track if interrupts were handled\n    // Interrupt handling requires 20 cycles\n    // https://github.com/Gekkio/mooneye-gb/blob/master/docs/accuracy.markdown#what-is-the-exact-timing-of-cpu-servicing-an-interrupt\n    var wasInterruptHandled = false; // Service our interrupts, if we have the master switch enabled\n    // https://www.reddit.com/r/EmuDev/comments/5ie3k7/infinite_loop_trying_to_pass_blarggs_interrupt/\n\n    if (Interrupts.masterInterruptSwitch && !Cpu.isHaltNoJump) {\n      if (Interrupts.isVBlankInterruptEnabled && Interrupts.isVBlankInterruptRequested) {\n        _handleInterrupt(Interrupts.bitPositionVBlankInterrupt);\n\n        wasInterruptHandled = true;\n      } else if (Interrupts.isLcdInterruptEnabled && Interrupts.isLcdInterruptRequested) {\n        _handleInterrupt(Interrupts.bitPositionLcdInterrupt);\n\n        wasInterruptHandled = true;\n      } else if (Interrupts.isTimerInterruptEnabled && Interrupts.isTimerInterruptRequested) {\n        _handleInterrupt(Interrupts.bitPositionTimerInterrupt);\n\n        wasInterruptHandled = true;\n      } else if (Interrupts.isSerialInterruptEnabled && Interrupts.isSerialInterruptRequested) {\n        _handleInterrupt(Interrupts.bitPositionSerialInterrupt);\n\n        wasInterruptHandled = true;\n      } else if (Interrupts.isJoypadInterruptEnabled && Interrupts.isJoypadInterruptRequested) {\n        _handleInterrupt(Interrupts.bitPositionJoypadInterrupt);\n\n        wasInterruptHandled = true;\n      }\n    }\n\n    var interuptHandlerCycles = 0;\n\n    if (wasInterruptHandled) {\n      // Interrupt handling requires 20 cycles, TCAGBD\n      interuptHandlerCycles = 20;\n\n      if (Cpu.isHalted()) {\n        // If the CPU was halted, now is the time to un-halt\n        // Should be done here when the jump occurs according to:\n        // https://www.reddit.com/r/EmuDev/comments/6fmjch/gb_glitches_in_links_awakening_and_pok%C3%A9mon_gold/\n        Cpu.exitHaltAndStop();\n        interuptHandlerCycles += 4;\n      }\n    }\n\n    if (Cpu.isHalted()) {\n      Cpu.exitHaltAndStop();\n    }\n\n    return interuptHandlerCycles;\n  }\n\n  return 0;\n}\n\nfunction _handleInterrupt(bitPosition) {\n  // Disable the master switch\n  setInterrupts(false); // Disable the bit on the interruptRequest\n\n  var interruptRequest = eightBitLoadFromGBMemory(Interrupts.memoryLocationInterruptRequest);\n  interruptRequest = resetBitOnByte(bitPosition, interruptRequest);\n  Interrupts.interruptsRequestedValue = interruptRequest;\n  eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptRequest, interruptRequest); // Push the programCounter onto the stacks\n  // Push the next instruction, not the halt itself (TCAGBD).\n\n  Cpu.stackPointer = Cpu.stackPointer - 2;\n\n  if (Cpu.isHalted()) {\n    // TODO: This breaks Pokemon Yellow, And OG Link's awakening. Find out why...\n    // sixteenBitStoreIntoGBMemory(Cpu.stackPointer, Cpu.programCounter + 1);\n    sixteenBitStoreIntoGBMemory(Cpu.stackPointer, Cpu.programCounter);\n  } else {\n    sixteenBitStoreIntoGBMemory(Cpu.stackPointer, Cpu.programCounter);\n  } // Jump to the correct interrupt location\n  // Also piggyback off of the switch to reset our HW Register caching\n  // http://www.codeslinger.co.uk/pages/projects/gameboy/interupts.html\n\n\n  switch (bitPosition) {\n    case Interrupts.bitPositionVBlankInterrupt:\n      Interrupts.isVBlankInterruptRequested = false;\n      Cpu.programCounter = 0x40;\n      break;\n\n    case Interrupts.bitPositionLcdInterrupt:\n      Interrupts.isLcdInterruptRequested = false;\n      Cpu.programCounter = 0x48;\n      break;\n\n    case Interrupts.bitPositionTimerInterrupt:\n      Interrupts.isTimerInterruptRequested = false;\n      Cpu.programCounter = 0x50;\n      break;\n\n    case Interrupts.bitPositionSerialInterrupt:\n      Interrupts.isSerialInterruptRequested = false;\n      Cpu.programCounter = 0x58;\n      break;\n\n    case Interrupts.bitPositionJoypadInterrupt:\n      Interrupts.isJoypadInterruptRequested = false;\n      Cpu.programCounter = 0x60;\n      break;\n  }\n}\n\nfunction _requestInterrupt(bitPosition) {\n  var interruptRequest = eightBitLoadFromGBMemory(Interrupts.memoryLocationInterruptRequest); // Pass to set the correct interrupt bit on interruptRequest\n\n  interruptRequest = setBitOnByte(bitPosition, interruptRequest);\n  Interrupts.interruptsRequestedValue = interruptRequest;\n  eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptRequest, interruptRequest);\n}\n\nfunction setInterrupts(value) {\n  // If we are enabling interrupts,\n  // we want to wait 4 cycles before enabling\n  if (value) {\n    Interrupts.masterInterruptSwitchDelay = true;\n  } else {\n    Interrupts.masterInterruptSwitch = false;\n  }\n}\n\nfunction requestVBlankInterrupt() {\n  Interrupts.isVBlankInterruptRequested = true;\n\n  _requestInterrupt(Interrupts.bitPositionVBlankInterrupt);\n}\n\nfunction requestLcdInterrupt() {\n  Interrupts.isLcdInterruptRequested = true;\n\n  _requestInterrupt(Interrupts.bitPositionLcdInterrupt);\n}\n\nfunction requestTimerInterrupt() {\n  Interrupts.isTimerInterruptRequested = true;\n\n  _requestInterrupt(Interrupts.bitPositionTimerInterrupt);\n}\n\nfunction requestJoypadInterrupt() {\n  Interrupts.isJoypadInterruptRequested = true;\n\n  _requestInterrupt(Interrupts.bitPositionJoypadInterrupt);\n}\n\nfunction requestSerialInterrupt() {\n  Interrupts.isSerialInterruptRequested = true;\n\n  _requestInterrupt(Interrupts.bitPositionSerialInterrupt);\n}\n\nvar Timers =\n/** @class */\nfunction () {\n  function Timers() {} // Number of cycles to run in each batch process\n\n\n  Timers.batchProcessCycles = function () {\n    return 256;\n  };\n\n  Timers.updateDividerRegister = function (value) {\n    var oldDividerRegister = Timers.dividerRegister;\n    Timers.dividerRegister = 0;\n    eightBitStoreIntoGBMemory(Timers.memoryLocationDividerRegister, 0);\n\n    if (Timers.timerEnabled && _checkDividerRegisterFallingEdgeDetector(oldDividerRegister, Timers.dividerRegister)) {\n      _incrementTimerCounter();\n    }\n  };\n\n  Timers.updateTimerCounter = function (value) {\n    if (Timers.timerEnabled) {\n      // From binjgb, dont write TIMA if we were just reset\n      if (Timers.timerCounterWasReset) {\n        return;\n      } // Mooneye Test, tima_write_reloading\n      // Writing in this strange delay cycle, will cancel\n      // Both the interrupt and the TMA reload\n\n\n      if (Timers.timerCounterOverflowDelay) {\n        Timers.timerCounterOverflowDelay = false;\n      }\n    }\n\n    Timers.timerCounter = value;\n  };\n\n  Timers.updateTimerModulo = function (value) {\n    Timers.timerModulo = value; // Mooneye Test, tma_write_reloading\n    // Don't update if we were reloading\n\n    if (Timers.timerEnabled && Timers.timerCounterWasReset) {\n      Timers.timerCounter = Timers.timerModulo;\n      Timers.timerCounterWasReset = false;\n    }\n  };\n\n  Timers.updateTimerControl = function (value) {\n    // Get some initial values\n    var oldTimerEnabled = Timers.timerEnabled;\n    Timers.timerEnabled = checkBitOnByte(2, value);\n    var newTimerInputClock = value & 0x03; // Do some obscure behavior for if we should increment TIMA\n    // This does the timer increments from rapid_toggle mooneye tests\n\n    if (!oldTimerEnabled) {\n      var oldTimerCounterMaskBit = _getTimerCounterMaskBit(Timers.timerInputClock);\n\n      var newTimerCounterMaskBit = _getTimerCounterMaskBit(newTimerInputClock);\n\n      var shouldIncrementTimerCounter = false;\n\n      if (Timers.timerEnabled) {\n        shouldIncrementTimerCounter = checkBitOnByte(oldTimerCounterMaskBit, Timers.dividerRegister);\n      } else {\n        shouldIncrementTimerCounter = checkBitOnByte(oldTimerCounterMaskBit, Timers.dividerRegister) && checkBitOnByte(newTimerCounterMaskBit, Timers.dividerRegister);\n      }\n\n      if (shouldIncrementTimerCounter) {\n        _incrementTimerCounter();\n      }\n    }\n\n    Timers.timerInputClock = newTimerInputClock;\n  }; // Function to save the state of the class\n  // TODO: Save state for new properties on Timers\n\n\n  Timers.saveState = function () {\n    store(getSaveStateMemoryOffset(0x00, Timers.saveStateSlot), Timers.currentCycles);\n    store(getSaveStateMemoryOffset(0x04, Timers.saveStateSlot), Timers.dividerRegister);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x08, Timers.saveStateSlot), Timers.timerCounterOverflowDelay);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x0b, Timers.saveStateSlot), Timers.timerCounterWasReset);\n    eightBitStoreIntoGBMemory(Timers.memoryLocationTimerCounter, Timers.timerCounter);\n  }; // Function to load the save state from memory\n\n\n  Timers.loadState = function () {\n    Timers.currentCycles = load(getSaveStateMemoryOffset(0x00, Timers.saveStateSlot));\n    Timers.dividerRegister = load(getSaveStateMemoryOffset(0x04, Timers.saveStateSlot));\n    Timers.timerCounterOverflowDelay = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x08, Timers.saveStateSlot));\n    Timers.timerCounterWasReset = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x0b, Timers.saveStateSlot));\n    Timers.timerCounter = eightBitLoadFromGBMemory(Timers.memoryLocationTimerCounter);\n    Timers.timerModulo = eightBitLoadFromGBMemory(Timers.memoryLocationTimerModulo);\n    Timers.timerInputClock = eightBitLoadFromGBMemory(Timers.memoryLocationTimerControl);\n  }; // Current cycles\n  // This will be used for batch processing\n\n\n  Timers.currentCycles = 0; // Divider Register = DIV\n  // Divider Register is 16 bits.\n  // Divider Register when read is just the upper 8 bits\n  // But internally is used as the full 16\n  // Essentially dividerRegister is an always counting clock\n  // DIV Drives everything, it is the heart of the timer.\n  // All other timing registers base them selves relative to the DIV register\n  // Think of the div register as like a cycle counter :)\n  // DIV will increment TIMA, whenever there is a falling edge, see below for that.\n\n  Timers.memoryLocationDividerRegister = 0xff04; // DIV\n\n  Timers.dividerRegister = 0; // timerCounter = TIMA\n  // TIMA is the actual counter.\n  // Whenever the DIV gets the falling edge, and other obscure cases,\n  // This is incremented. When this overflows, we need to fire an interrupt.\n\n  Timers.memoryLocationTimerCounter = 0xff05;\n  Timers.timerCounter = 0;\n  Timers.timerCounterOverflowDelay = false;\n  Timers.timerCounterWasReset = false;\n  Timers.timerCounterMask = 0; // Timer Modulo = TMA\n  // TMA is what TIMA (Notice the I :p) is counting from, and TIMA will load\n  // Whenever TIMA overflow.\n  // For instance, we count like 1,2,3,4,5,6,7,8,9, and then overflow to 10.\n  // TMA would be like \"Hey, start counting from 5 whenever we reset\"\n  // Then we would be like 5,6,7,8,9...5,6,7,8,9...etc...\n\n  Timers.memoryLocationTimerModulo = 0xff06;\n  Timers.timerModulo = 0; // Timer Control = TAC\n  // TAC Says how fast we are counting.\n  // TAC controls which bit we are watching for the falling edge on the DIV register\n  // And whenever the bit has the falling edge, we increment TIMA (The thing counting).\n  // Therefore, depending on the value, we will either count faster or slower.\n\n  Timers.memoryLocationTimerControl = 0xff07; // Bit 2    - Timer Stop  (0=Stop, 1=Start)\n  // Bits 1-0 - Input Clock Select\n  //            00:   4096 Hz    (~4194 Hz SGB) (1024 cycles)\n  //            01: 262144 Hz  (~268400 Hz SGB) (16 cycles)\n  //            10:  65536 Hz   (~67110 Hz SGB) (64 cycles)\n  //            11:  16384 Hz   (~16780 Hz SGB) (256 cycles)\n\n  Timers.timerEnabled = false;\n  Timers.timerInputClock = 0; // Save States\n\n  Timers.saveStateSlot = 5;\n  return Timers;\n}();\n\nfunction initializeTimers() {\n  // Reset stateful Variables\n  Timers.currentCycles = 0;\n  Timers.dividerRegister = 0;\n  Timers.timerCounter = 0;\n  Timers.timerModulo = 0;\n  Timers.timerEnabled = false;\n  Timers.timerInputClock = 0;\n  Timers.timerCounterOverflowDelay = false;\n  Timers.timerCounterWasReset = false;\n\n  if (Cpu.GBCEnabled) {\n    // DIV\n    eightBitStoreIntoGBMemory(0xff04, 0x1e);\n    Timers.dividerRegister = 0x1ea0; // 0xFF05 -> 0xFF06 = 0x00\n    // TAC\n\n    eightBitStoreIntoGBMemory(0xff07, 0xf8);\n    Timers.timerInputClock = 0xf8;\n  } else {\n    // DIV\n    eightBitStoreIntoGBMemory(0xff04, 0xab);\n    Timers.dividerRegister = 0xabcc; // 0xFF05 -> 0xFF06 = 0x00\n    // TAC\n\n    eightBitStoreIntoGBMemory(0xff07, 0xf8);\n    Timers.timerInputClock = 0xf8;\n  }\n} // Batch Process Timers\n// Only checked on writes\n// Function to batch process our Timers after we skipped so many cycles\n\n\nfunction batchProcessTimers() {\n  // TODO: Did a timer rewrite, make a proper batch processing\n  // For timers\n  updateTimers(Timers.currentCycles);\n  Timers.currentCycles = 0;\n}\n\nfunction updateTimers(numberOfCycles) {\n  // Want to increment 4 cycles at a time like an actual GB would\n  var cyclesIncreased = 0;\n\n  while (cyclesIncreased < numberOfCycles) {\n    var oldDividerRegister = Timers.dividerRegister;\n    cyclesIncreased += 4;\n    Timers.dividerRegister += 4;\n\n    if (Timers.dividerRegister > 0xffff) {\n      Timers.dividerRegister -= 0x10000;\n    }\n\n    if (Timers.timerEnabled) {\n      if (Timers.timerCounterOverflowDelay) {\n        Timers.timerCounter = Timers.timerModulo; // Fire off timer interrupt\n\n        requestTimerInterrupt();\n        Timers.timerCounterOverflowDelay = false;\n        Timers.timerCounterWasReset = true;\n      } else if (Timers.timerCounterWasReset) {\n        Timers.timerCounterWasReset = false;\n      }\n\n      if (_checkDividerRegisterFallingEdgeDetector(oldDividerRegister, Timers.dividerRegister)) {\n        _incrementTimerCounter();\n      }\n    }\n  }\n} // Function to increment our Timer Counter\n// This fires off interrupts once we overflow\n\n\nfunction _incrementTimerCounter() {\n  Timers.timerCounter += 1;\n\n  if (Timers.timerCounter > 255) {\n    // Whenever the timer overflows, there is a slight delay (4 cycles)\n    // Of when TIMA gets TMA's value, and the interrupt is fired.\n    // Thus we will set the delay, which can be handled in the update timer or write trap\n    Timers.timerCounterOverflowDelay = true;\n    Timers.timerCounter = 0;\n  }\n} // Function to act as our falling edge detector\n// Whenever we have a falling edge, we need to increment TIMA\n// http://gbdev.gg8.se/wiki/articles/Timer_Obscure_Behaviour\n// https://github.com/binji/binjgb/blob/master/src/emulator.c#L1944\n\n\nfunction _checkDividerRegisterFallingEdgeDetector(oldDividerRegister, newDividerRegister) {\n  // Get our mask\n  var timerCounterMaskBit = _getTimerCounterMaskBit(Timers.timerInputClock); // If the old register's watched bit was zero,\n  // but after adding the new registers wastch bit is now 1\n\n\n  if (checkBitOnByte(timerCounterMaskBit, oldDividerRegister) && !checkBitOnByte(timerCounterMaskBit, newDividerRegister)) {\n    return true;\n  }\n\n  return false;\n} // Function to get our current tima mask bit\n// used for our falling edge detector\n// See The docs linked above, or TCAGB for this bit mapping\n\n\nfunction _getTimerCounterMaskBit(timerInputClock) {\n  switch (timerInputClock) {\n    case 0x00:\n      return 9;\n\n    case 0x01:\n      return 3;\n\n    case 0x02:\n      return 5;\n\n    case 0x03:\n      return 7;\n  }\n\n  return 0;\n} // Link cable / serial implementation\n\n\nvar Serial =\n/** @class */\nfunction () {\n  function Serial() {}\n\n  Serial.updateTransferControl = function (value) {\n    Serial.isShiftClockInternal = checkBitOnByte(0, value);\n    Serial.isClockSpeedFast = checkBitOnByte(1, value);\n    Serial.transferStartFlag = checkBitOnByte(7, value); // Allow the original write, and return since we dont need to look anymore\n\n    return true;\n  }; // Cycle counter\n\n\n  Serial.currentCycles = 0x00; // Register locations\n\n  Serial.memoryLocationSerialTransferData = 0xff01; // SB\n\n  Serial.memoryLocationSerialTransferControl = 0xff02; // SC\n  // Number of bits transferred\n\n  Serial.numberOfBitsTransferred = 0; // Transfer control variables\n\n  Serial.isShiftClockInternal = false;\n  Serial.isClockSpeedFast = false;\n  Serial.transferStartFlag = false;\n  return Serial;\n}(); // Function to initialize our serial values\n\n\nfunction initializeSerial() {\n  Serial.currentCycles = 0x00;\n  Serial.numberOfBitsTransferred = 0;\n\n  if (Cpu.GBCEnabled) {\n    // FF01 = 0x00\n    eightBitStoreIntoGBMemory(0xff02, 0x7c);\n    Serial.updateTransferControl(0x7c);\n  } else {\n    // FF01 = 0x00\n    eightBitStoreIntoGBMemory(0xff02, 0x7e);\n    Serial.updateTransferControl(0x7e);\n  }\n} // TODO: Finish serial\n// See minimal serial: https://github.com/binji/binjgb/commit/64dece05c4ef5a052c4b9b75eb3ddbbfc6677cbe\n\n\nfunction updateSerial(numberOfCycles) {\n  // If we aren't starting our transfer, or transferring,\n  // return\n  if (!Serial.transferStartFlag) {\n    return;\n  } // Want to increment 4 cycles at a time like an actual GB would\n\n\n  var cyclesIncreased = 0;\n\n  while (cyclesIncreased < numberOfCycles) {\n    var oldCycles = Serial.currentCycles;\n    cyclesIncreased += 4;\n    Serial.currentCycles += 4;\n\n    if (Serial.currentCycles > 0xffff) {\n      Serial.currentCycles -= 0x10000;\n    }\n\n    if (_checkFallingEdgeDetector(oldCycles, Serial.currentCycles)) {\n      // TODO: Since no actual connection, always transfer 1\n      // Need to fix this\n      var transferData = eightBitLoadFromGBMemory(Serial.memoryLocationSerialTransferData);\n      transferData = (transferData << 1) + 1;\n      transferData = transferData & 0xff;\n      eightBitStoreIntoGBMemory(Serial.memoryLocationSerialTransferData, transferData);\n      Serial.numberOfBitsTransferred += 1;\n\n      if (Serial.numberOfBitsTransferred === 8) {\n        Serial.numberOfBitsTransferred = 0;\n        requestSerialInterrupt(); // Disable transfer start\n\n        var transferControl = eightBitLoadFromGBMemory(Serial.memoryLocationSerialTransferControl);\n        eightBitStoreIntoGBMemory(Serial.memoryLocationSerialTransferControl, resetBitOnByte(7, transferControl));\n        Serial.transferStartFlag = false;\n      }\n    }\n  }\n}\n\nfunction _checkFallingEdgeDetector(oldCycles, newCycles) {\n  // Get our mask\n  var maskBit = _getFallingEdgeMaskBit(); // If the old register's watched bit was zero,\n  // but after adding the new registers wastch bit is now 1\n\n\n  if (checkBitOnByte(maskBit, oldCycles) && !checkBitOnByte(maskBit, newCycles)) {\n    return true;\n  }\n\n  return false;\n} // Function to get our current tima mask bit\n// used for our falling edge detector\n// See The docs linked above, or TCAGB for this bit mapping\n\n\nfunction _getFallingEdgeMaskBit() {\n  if (Serial.isClockSpeedFast) {\n    return 2;\n  }\n\n  return 7;\n} // http://www.codeslinger.co.uk/pages/projects/gameboy/joypad.html\n// Joypad Register\n// Taken from pandocs\n// Bit 7 - Not used\n// Bit 6 - Not used\n// Bit 5 - P15 Select Button Keys (0=Select)\n// Bit 4 - P14 Select Direction Keys (0=Select)\n// Bit 3 - P13 Input Down or Start (0=Pressed) (Read Only)\n// Bit 2 - P12 Input Up or Select (0=Pressed) (Read Only)\n// Bit 1 - P11 Input Left or Button B (0=Pressed) (Read Only)\n// Bit 0 - P10 Input Right or Button A (0=Pressed) (Read Only)\n// Button Ids will be the following:\n// UP - 0\n// RIGHT - 1\n// DOWN - 2\n// LEFT - 3\n// A - 4\n// B - 5\n// SELECT - 6\n// START - 7\n\n\nvar Joypad =\n/** @class */\nfunction () {\n  function Joypad() {}\n\n  Joypad.updateJoypad = function (value) {\n    Joypad.joypadRegisterFlipped = value ^ 0xff;\n    Joypad.isDpadType = checkBitOnByte(4, Joypad.joypadRegisterFlipped);\n    Joypad.isButtonType = checkBitOnByte(5, Joypad.joypadRegisterFlipped);\n  }; // Function to save the state of the class\n\n\n  Joypad.saveState = function () {}; // Function to load the save state from memory\n\n\n  Joypad.loadState = function () {\n    Joypad.updateJoypad(eightBitLoadFromGBMemory(Joypad.memoryLocationJoypadRegister));\n  };\n\n  Joypad.up = false;\n  Joypad.down = false;\n  Joypad.left = false;\n  Joypad.right = false;\n  Joypad.a = false;\n  Joypad.b = false;\n  Joypad.select = false;\n  Joypad.start = false;\n  Joypad.memoryLocationJoypadRegister = 0xff00; // Cache some values on the Joypad register\n\n  Joypad.joypadRegisterFlipped = 0;\n  Joypad.isDpadType = false;\n  Joypad.isButtonType = false; // Save States\n  // Not doing anything for Joypad for now\n\n  Joypad.saveStateSlot = 3;\n  return Joypad;\n}();\n\nfunction getJoypadState() {\n  // Get the joypad register\n  var joypadRegister = Joypad.joypadRegisterFlipped;\n\n  if (Joypad.isDpadType) {\n    // D-pad buttons\n    // Up\n    if (Joypad.up) {\n      joypadRegister = resetBitOnByte(2, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(2, joypadRegister);\n    } // Right\n\n\n    if (Joypad.right) {\n      joypadRegister = resetBitOnByte(0, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(0, joypadRegister);\n    } // Down\n\n\n    if (Joypad.down) {\n      joypadRegister = resetBitOnByte(3, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(3, joypadRegister);\n    } // Left\n\n\n    if (Joypad.left) {\n      joypadRegister = resetBitOnByte(1, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(1, joypadRegister);\n    }\n  } else if (Joypad.isButtonType) {\n    // A\n    if (Joypad.a) {\n      joypadRegister = resetBitOnByte(0, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(0, joypadRegister);\n    } // B\n\n\n    if (Joypad.b) {\n      joypadRegister = resetBitOnByte(1, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(1, joypadRegister);\n    } // Select\n\n\n    if (Joypad.select) {\n      joypadRegister = resetBitOnByte(2, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(2, joypadRegister);\n    } // Start\n\n\n    if (Joypad.start) {\n      joypadRegister = resetBitOnByte(3, joypadRegister);\n    } else {\n      joypadRegister = setBitOnByte(3, joypadRegister);\n    }\n  } // Set the top 4 bits to on\n\n\n  joypadRegister = joypadRegister | 0xf0;\n  return joypadRegister;\n}\n\nfunction setJoypadState(up, right, down, left, a, b, select, start) {\n  if (up > 0) {\n    _pressJoypadButton(0);\n  } else {\n    _releaseJoypadButton(0);\n  }\n\n  if (right > 0) {\n    _pressJoypadButton(1);\n  } else {\n    _releaseJoypadButton(1);\n  }\n\n  if (down > 0) {\n    _pressJoypadButton(2);\n  } else {\n    _releaseJoypadButton(2);\n  }\n\n  if (left > 0) {\n    _pressJoypadButton(3);\n  } else {\n    _releaseJoypadButton(3);\n  }\n\n  if (a > 0) {\n    _pressJoypadButton(4);\n  } else {\n    _releaseJoypadButton(4);\n  }\n\n  if (b > 0) {\n    _pressJoypadButton(5);\n  } else {\n    _releaseJoypadButton(5);\n  }\n\n  if (select > 0) {\n    _pressJoypadButton(6);\n  } else {\n    _releaseJoypadButton(6);\n  }\n\n  if (start > 0) {\n    _pressJoypadButton(7);\n  } else {\n    _releaseJoypadButton(7);\n  }\n}\n\nfunction _pressJoypadButton(buttonId) {\n  // Un stop the CPU\n  Cpu.isStopped = false; // Check if the button state changed from not pressed\n\n  var isButtonStateChanging = false;\n\n  if (!_getJoypadButtonStateFromButtonId(buttonId)) {\n    isButtonStateChanging = true;\n  } // Set our joypad state\n\n\n  _setJoypadButtonStateFromButtonId(buttonId, true); // If the button state is changing, check for an interrupt\n\n\n  if (isButtonStateChanging) {\n    // Determine if it is a button or a dpad button\n    var isDpadTypeButton = false;\n\n    if (buttonId <= 3) {\n      isDpadTypeButton = true;\n    }\n\n    var shouldRequestInterrupt = false; // Check if the game is looking for a dpad type button press\n\n    if (Joypad.isDpadType && isDpadTypeButton) {\n      shouldRequestInterrupt = true;\n    } // Check if the game is looking for a button type button press\n\n\n    if (Joypad.isButtonType && !isDpadTypeButton) {\n      shouldRequestInterrupt = true;\n    } // Finally, request the interrupt, if the button state actually changed\n\n\n    if (shouldRequestInterrupt) {\n      requestJoypadInterrupt();\n    }\n  }\n}\n\nfunction _releaseJoypadButton(buttonId) {\n  // Set our joypad state\n  _setJoypadButtonStateFromButtonId(buttonId, false);\n}\n\nfunction _getJoypadButtonStateFromButtonId(buttonId) {\n  switch (buttonId) {\n    case 0:\n      return Joypad.up;\n\n    case 1:\n      return Joypad.right;\n\n    case 2:\n      return Joypad.down;\n\n    case 3:\n      return Joypad.left;\n\n    case 4:\n      return Joypad.a;\n\n    case 5:\n      return Joypad.b;\n\n    case 6:\n      return Joypad.select;\n\n    case 7:\n      return Joypad.start;\n\n    default:\n      return false;\n  }\n}\n\nfunction _setJoypadButtonStateFromButtonId(buttonId, isPressed) {\n  switch (buttonId) {\n    case 0:\n      Joypad.up = isPressed;\n      break;\n\n    case 1:\n      Joypad.right = isPressed;\n      break;\n\n    case 2:\n      Joypad.down = isPressed;\n      break;\n\n    case 3:\n      Joypad.left = isPressed;\n      break;\n\n    case 4:\n      Joypad.a = isPressed;\n      break;\n\n    case 5:\n      Joypad.b = isPressed;\n      break;\n\n    case 6:\n      Joypad.select = isPressed;\n      break;\n\n    case 7:\n      Joypad.start = isPressed;\n      break;\n  }\n} // Function to handle rom/rambanking\n\n\nfunction handleBanking(offset, value) {\n  // Is rom Only does not bank\n  if (Memory.isRomOnly) {\n    return;\n  } // Enable Ram Banking\n\n\n  if (offset <= 0x1fff) {\n    if (Memory.isMBC2 && !checkBitOnByte(4, value)) {\n      // Do Nothing\n      return;\n    } else {\n      var romEnableByte = value & 0x0f;\n\n      if (romEnableByte === 0x00) {\n        Memory.isRamBankingEnabled = false;\n      } else if (romEnableByte === 0x0a) {\n        Memory.isRamBankingEnabled = true;\n      }\n    }\n  } else if (offset <= 0x3fff) {\n    if (!Memory.isMBC5 || offset <= 0x2fff) {\n      // Change Low Bits on the Current Rom Bank\n      if (Memory.isMBC2) {\n        Memory.currentRomBank = value & 0x0f;\n      } // Set the number of bottom bytes from the MBC type\n\n\n      var romBankLowerBits = value;\n\n      if (Memory.isMBC1) {\n        // Only want the bottom 5\n        romBankLowerBits = romBankLowerBits & 0x1f;\n        Memory.currentRomBank = Memory.currentRomBank & 0xe0;\n      } else if (Memory.isMBC3) {\n        // Only Want the bottom 7\n        romBankLowerBits = romBankLowerBits & 0x7f;\n        Memory.currentRomBank = Memory.currentRomBank & 0x80;\n      } else if (Memory.isMBC5) {\n        // Going to switch the whole thing\n        Memory.currentRomBank = Memory.currentRomBank & 0x00;\n      } // Set the lower bytes\n\n\n      Memory.currentRomBank = Memory.currentRomBank | romBankLowerBits;\n      return;\n    } else {\n      // TODO: MBC5 High bits Rom bank, check if this works, not sure about the value\n      var highByte = 0;\n      var lowByte = splitLowByte(Memory.currentRomBank);\n\n      if (value > 0) {\n        highByte = 1;\n      }\n\n      Memory.currentRomBank = concatenateBytes(highByte, lowByte);\n    }\n  } else if (!Memory.isMBC2 && offset <= 0x5fff) {\n    // ROM / RAM Banking, MBC2 doesn't do this\n    if (Memory.isMBC1 && Memory.isMBC1RomModeEnabled) {\n      // Do an upper bit rom bank for MBC 1\n      // Remove upper bits of currentRomBank\n      Memory.currentRomBank = Memory.currentRomBank & 0x1f;\n      var romBankHigherBits = value & 0xe0;\n      Memory.currentRomBank = Memory.currentRomBank | romBankHigherBits;\n      return;\n    }\n\n    var ramBankBits = value;\n\n    if (!Memory.isMBC5) {\n      // Get the bottom 2 bits\n      ramBankBits = ramBankBits & 0x03;\n    } else {\n      // Get the bottom nibble\n      ramBankBits = ramBankBits & 0x0f;\n    } // Set our ram bank\n\n\n    Memory.currentRamBank = ramBankBits;\n    return;\n  } else if (!Memory.isMBC2 && offset <= 0x7fff) {\n    if (Memory.isMBC1) {\n      if (checkBitOnByte(0, value)) {\n        Memory.isMBC1RomModeEnabled = true;\n      } else {\n        Memory.isMBC1RomModeEnabled = false;\n      }\n    } // TODO: MBC3 Latch Clock Data\n\n  }\n}\n\nfunction getRomBankAddress(gameboyOffset) {\n  var currentRomBank = Memory.currentRomBank;\n\n  if (!Memory.isMBC5 && currentRomBank === 0) {\n    currentRomBank = 1;\n  } // Adjust our gameboy offset relative to zero for the gameboy memory map\n\n\n  return 0x4000 * currentRomBank + (gameboyOffset - Memory.switchableCartridgeRomLocation);\n}\n\nfunction getRamBankAddress(gameboyOffset) {\n  // Adjust our gameboy offset relative to zero for the gameboy memory map\n  return 0x2000 * Memory.currentRamBank + (gameboyOffset - Memory.cartridgeRamLocation);\n}\n\nfunction initializeDma() {\n  if (Cpu.GBCEnabled) {\n    // GBC DMA\n    eightBitStoreIntoGBMemory(0xff51, 0xff);\n    eightBitStoreIntoGBMemory(0xff52, 0xff);\n    eightBitStoreIntoGBMemory(0xff53, 0xff);\n    eightBitStoreIntoGBMemory(0xff54, 0xff);\n    eightBitStoreIntoGBMemory(0xff55, 0xff);\n  } else {\n    // GBC DMA\n    eightBitStoreIntoGBMemory(0xff51, 0xff);\n    eightBitStoreIntoGBMemory(0xff52, 0xff);\n    eightBitStoreIntoGBMemory(0xff53, 0xff);\n    eightBitStoreIntoGBMemory(0xff54, 0xff);\n    eightBitStoreIntoGBMemory(0xff55, 0xff);\n  }\n}\n\nfunction startDmaTransfer(sourceAddressOffset) {\n  var sourceAddress = sourceAddressOffset;\n  sourceAddress = sourceAddress << 8;\n\n  for (var i = 0; i <= 0x9f; i++) {\n    var spriteInformationByte = eightBitLoadFromGBMemory(sourceAddress + i);\n    var spriteInformationAddress = Memory.spriteInformationTableLocation + i;\n    eightBitStoreIntoGBMemory(spriteInformationAddress, spriteInformationByte);\n  } // TCAGBD:  This copy (DMA) needs 160  4 + 4 clocks to complete in both double speed and single speeds modes\n  // Increment all of our Cycle coiunters in ../cpu/opcodes\n\n\n  Memory.DMACycles = 644;\n} // https://gist.github.com/drhelius/3394856\n// http://bgb.bircd.org/pandocs.htm\n\n\nfunction startHdmaTransfer(hdmaTriggerByteToBeWritten) {\n  // Check if we are Gbc\n  if (!Cpu.GBCEnabled) {\n    return;\n  } // Check if we are trying to terminate an already active HBLANK HDMA\n\n\n  if (Memory.isHblankHdmaActive && !checkBitOnByte(7, hdmaTriggerByteToBeWritten)) {\n    // Don't reset anything, just set bit 7 to 1 on the trigger byte\n    Memory.isHblankHdmaActive = false;\n    var hdmaTriggerByte = eightBitLoadFromGBMemory(Memory.memoryLocationHdmaTrigger);\n    eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger, setBitOnByte(7, hdmaTriggerByte));\n    return;\n  } // Get our source and destination for the HDMA\n\n\n  var hdmaSource = getHdmaSourceFromMemory();\n  var hdmaDestination = getHdmaDestinationFromMemory(); // Get the length from the trigger\n  // Lower 7 bits, Add 1, times 16\n  // https://gist.github.com/drhelius/3394856\n\n  var transferLength = resetBitOnByte(7, hdmaTriggerByteToBeWritten);\n  transferLength = (transferLength + 1) * 16; // Get bit 7 of the trigger for the HDMA type\n\n  if (checkBitOnByte(7, hdmaTriggerByteToBeWritten)) {\n    // H-Blank DMA\n    Memory.isHblankHdmaActive = true;\n    Memory.hblankHdmaTransferLengthRemaining = transferLength;\n    Memory.hblankHdmaSource = hdmaSource;\n    Memory.hblankHdmaDestination = hdmaDestination; // This will be handled in updateHblankHdma()\n    // Since we return false in write traps, we need to now write the byte\n    // Be sure to reset bit 7, to show that the hdma is active\n\n    eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger, resetBitOnByte(7, hdmaTriggerByteToBeWritten));\n  } else {\n    // General DMA\n    hdmaTransfer(hdmaSource, hdmaDestination, transferLength); // Stop the DMA\n\n    eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger, 0xff);\n  }\n}\n\nfunction updateHblankHdma() {\n  if (!Memory.isHblankHdmaActive) {\n    return;\n  } // Get our amount of bytes to transfer (Only 0x10 bytes at a time)\n\n\n  var bytesToTransfer = 0x10;\n\n  if (Memory.hblankHdmaTransferLengthRemaining < bytesToTransfer) {\n    // Set to the difference\n    bytesToTransfer = Memory.hblankHdmaTransferLengthRemaining;\n  } // Do the transfer (Only 0x10 bytes at a time)\n\n\n  hdmaTransfer(Memory.hblankHdmaSource, Memory.hblankHdmaDestination, bytesToTransfer); // Update our source and destination\n\n  Memory.hblankHdmaSource += bytesToTransfer;\n  Memory.hblankHdmaDestination += bytesToTransfer;\n  Memory.hblankHdmaTransferLengthRemaining -= bytesToTransfer;\n\n  if (Memory.hblankHdmaTransferLengthRemaining <= 0) {\n    // End the transfer\n    Memory.isHblankHdmaActive = false; // Need to clear the HDMA with 0xFF, which sets bit 7 to 1 to show the HDMA has ended\n\n    eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger, 0xff);\n  } else {\n    // Set our new transfer length, make sure it is in the weird format,\n    // and make sure bit 7 is 0, to show that the HDMA is Active\n    var remainingTransferLength = Memory.hblankHdmaTransferLengthRemaining;\n    var transferLengthAsByte = remainingTransferLength / 16 - 1;\n    eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger, resetBitOnByte(7, transferLengthAsByte));\n  }\n} // Simple Function to transfer the bytes from a destination to a source for a general pourpose or Hblank HDMA\n\n\nfunction hdmaTransfer(hdmaSource, hdmaDestination, transferLength) {\n  for (var i = 0; i < transferLength; i++) {\n    var sourceByte = eightBitLoadFromGBMemoryWithTraps(hdmaSource + i); // get the hdmaDestination with wrapping\n    // See issue #61: https://github.com/torch2424/wasmBoy/issues/61\n\n    var hdmaDestinationWithWrapping = hdmaDestination + i;\n\n    while (hdmaDestinationWithWrapping > 0x9fff) {\n      // Simply clear the top 3 bits\n      hdmaDestinationWithWrapping = hdmaDestinationWithWrapping - 0x2000;\n    }\n\n    eightBitStoreIntoGBMemoryWithTraps(hdmaDestinationWithWrapping, sourceByte);\n  } // Set our Cycles used for the HDMA\n  // Since DMA in GBC Double Speed Mode takes 80 micro seconds,\n  // And HDMA takes 8 micro seconds per 0x10 bytes in GBC Double Speed mode (and GBC Normal Mode)\n  // Will assume (644 / 10) cycles for GBC Double Speed Mode,\n  // and (644 / 10 / 2) for GBC Normal Mode\n\n\n  var hdmaCycles = 32;\n\n  if (Cpu.GBCDoubleSpeed) {\n    hdmaCycles = 64;\n  }\n\n  hdmaCycles = hdmaCycles * (transferLength / 0x10);\n  Memory.DMACycles += hdmaCycles;\n} // Function to get our HDMA Source\n// Follows the poan docs\n\n\nfunction getHdmaSourceFromMemory() {\n  // Get our source for the HDMA\n  var hdmaSourceHigh = eightBitLoadFromGBMemory(Memory.memoryLocationHdmaSourceHigh);\n  var hdmaSourceLow = eightBitLoadFromGBMemory(Memory.memoryLocationHdmaSourceLow);\n  var hdmaSource = concatenateBytes(hdmaSourceHigh, hdmaSourceLow); // And off the appopriate bits for the source and destination\n  // And off the bottom 4 bits\n\n  hdmaSource = hdmaSource & 0xfff0;\n  return hdmaSource;\n} // Function to get our HDMA Destination\n// Follows the poan docs\n\n\nfunction getHdmaDestinationFromMemory() {\n  var hdmaDestinationHigh = eightBitLoadFromGBMemory(Memory.memoryLocationHdmaDestinationHigh);\n  var hdmaDestinationLow = eightBitLoadFromGBMemory(Memory.memoryLocationHdmaDestinationLow);\n  var hdmaDestination = concatenateBytes(hdmaDestinationHigh, hdmaDestinationLow); // Can only be in VRAM, 0x8000 -> 0x9FF0\n  // Pan docs says to knock off upper 3 bits, and lower 4 bits\n  // Which gives us: 0001111111110000 or 0x1FF0\n  // Meaning we must add 0x8000\n\n  hdmaDestination = hdmaDestination & 0x1ff0;\n  hdmaDestination += Memory.videoRamLocation;\n  return hdmaDestination;\n} // Internal function to trap any modify data trying to be written to Gameboy memory\n// Follows the Gameboy memory map\n// Return true if you want to continue the write, return false to end it here\n\n\nfunction checkWriteTraps(offset, value) {\n  // Cpu\n  if (offset === Cpu.memoryLocationSpeedSwitch) {\n    // TCAGBD, only Bit 0 is writable\n    eightBitStoreIntoGBMemory(Cpu.memoryLocationSpeedSwitch, value & 0x01); // We did the write, dont need to\n\n    return false;\n  } // Graphics\n  // Cache globals used multiple times for performance\n\n\n  var videoRamLocation = Memory.videoRamLocation;\n  var spriteInformationTableLocation = Memory.spriteInformationTableLocation; // Handle banking\n\n  if (offset < videoRamLocation) {\n    handleBanking(offset, value);\n    return false;\n  } // Check the graphics mode to see if we can write to VRAM\n  // http://gbdev.gg8.se/wiki/articles/Video_Display#Accessing_VRAM_and_OAM\n\n\n  if (offset >= videoRamLocation && offset < Memory.cartridgeRamLocation) {\n    // Can only read/write from VRAM During Modes 0 - 2\n    // See graphics/lcd.ts\n    // TODO: This can do more harm than good in a beta emulator,\n    // requires precise timing disabling for now\n    // if (Graphics.currentLcdMode > 2) {\n    //   return false;\n    // }\n    // Not batch processing here for performance\n    // batchProcessGraphics();\n    // Allow the original write, and return since we dont need to look anymore\n    return true;\n  } // Be sure to copy everything in EchoRam to Work Ram\n  // Codeslinger: The ECHO memory region (0xE000-0xFDFF) is quite different because any data written here is also written in the equivelent ram memory region 0xC000-0xDDFF.\n  // Hence why it is called echo\n\n\n  if (offset >= Memory.echoRamLocation && offset < spriteInformationTableLocation) {\n    var wramOffset = offset - 0x2000;\n    eightBitStoreIntoGBMemory(wramOffset, value); // Allow the original write, and return since we dont need to look anymore\n\n    return true;\n  } // Also check for individal writes\n  // Can only read/write from OAM During Modes 0 - 1\n  // See graphics/lcd.ts\n\n\n  if (offset >= spriteInformationTableLocation && offset <= Memory.spriteInformationTableLocationEnd) {\n    // Can only read/write from OAM During Mode 2\n    // See graphics/lcd.ts\n    if (Lcd.currentLcdMode < 2) {\n      return false;\n    } // Not batch processing here for performance\n    // batchProcessGraphics();\n    // Allow the original write, and return since we dont need to look anymore\n\n\n    return true;\n  }\n\n  if (offset >= Memory.unusableMemoryLocation && offset <= Memory.unusableMemoryEndLocation) {\n    return false;\n  } // Serial\n\n\n  if (offset === Serial.memoryLocationSerialTransferControl) {\n    // SC\n    return Serial.updateTransferControl(value);\n  } // Sound\n  // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n\n\n  if (offset >= 0xff10 && offset <= 0xff26) {\n    batchProcessAudio();\n    return SoundRegisterWriteTraps(offset, value);\n  } // FF27 - FF2F not used\n  // Final Wave Table for Channel 3\n\n\n  if (offset >= 0xff30 && offset <= 0xff3f) {\n    batchProcessAudio();\n  } // Other Memory effects fomr read/write to Lcd/Graphics\n\n\n  if (offset >= Lcd.memoryLocationLcdControl && offset <= Graphics.memoryLocationWindowX) {\n    // Not batch processing here for performance\n    // batchProcessGraphics();\n    if (offset === Lcd.memoryLocationLcdControl) {\n      // Shorcut for isLCD Enabled since it gets \"hot\"\n      Lcd.updateLcdControl(value);\n      return true;\n    }\n\n    if (offset === Lcd.memoryLocationLcdStatus) {\n      // We are handling the write here\n      Lcd.updateLcdStatus(value);\n      return false;\n    } // reset the current scanline if the game tries to write to it\n\n\n    if (offset === Graphics.memoryLocationScanlineRegister) {\n      Graphics.scanlineRegister = 0;\n      eightBitStoreIntoGBMemory(offset, 0);\n      return false;\n    } // Cache our coincidence compare\n\n\n    if (offset === Lcd.memoryLocationCoincidenceCompare) {\n      Lcd.coincidenceCompare = value;\n      return true;\n    } // Do the direct memory access transfer for spriteInformationTable\n    // Check the graphics mode to see if we can write to VRAM\n    // http://gbdev.gg8.se/wiki/articles/Video_Display#Accessing_VRAM_and_OAM\n\n\n    if (offset === Graphics.memoryLocationDmaTransfer) {\n      // otherwise, perform a DMA transfer\n      // And allow the original write\n      startDmaTransfer(value);\n      return true;\n    } // Scroll and Window XY\n\n\n    switch (offset) {\n      case Graphics.memoryLocationScrollX:\n        Graphics.scrollX = value;\n        return true;\n\n      case Graphics.memoryLocationScrollY:\n        Graphics.scrollY = value;\n        return true;\n\n      case Graphics.memoryLocationWindowX:\n        Graphics.windowX = value;\n        return true;\n\n      case Graphics.memoryLocationWindowY:\n        Graphics.windowY = value;\n        return true;\n    } // Allow the original write, and return since we dont need to look anymore\n\n\n    return true;\n  } // Do an HDMA\n\n\n  if (offset === Memory.memoryLocationHdmaTrigger) {\n    startHdmaTransfer(value);\n    return false;\n  } // Don't allow banking if we are doing an Hblank HDM transfer\n  // https://gist.github.com/drhelius/3394856\n\n\n  if (offset === Memory.memoryLocationGBCWRAMBank || offset === Memory.memoryLocationGBCVRAMBank) {\n    if (Memory.isHblankHdmaActive) {\n      if (Memory.hblankHdmaSource >= 0x4000 && Memory.hblankHdmaSource <= 0x7fff || Memory.hblankHdmaSource >= 0xd000 && Memory.hblankHdmaSource <= 0xdfff) {\n        return false;\n      }\n    }\n  } // Handle GBC Pallete Write\n\n\n  if (offset >= Palette.memoryLocationBackgroundPaletteIndex && offset <= Palette.memoryLocationSpritePaletteData) {\n    // Incremeenting the palette handled by the write\n    writeColorPaletteToMemory(offset, value);\n    return true;\n  } // Handle timer writes\n\n\n  if (offset >= Timers.memoryLocationDividerRegister && offset <= Timers.memoryLocationTimerControl) {\n    // Batch Process\n    batchProcessTimers();\n\n    switch (offset) {\n      case Timers.memoryLocationDividerRegister:\n        Timers.updateDividerRegister(value);\n        return false;\n\n      case Timers.memoryLocationTimerCounter:\n        Timers.updateTimerCounter(value);\n        return true;\n\n      case Timers.memoryLocationTimerModulo:\n        Timers.updateTimerModulo(value);\n        return true;\n\n      case Timers.memoryLocationTimerControl:\n        Timers.updateTimerControl(value);\n        return true;\n    }\n\n    return true;\n  } // Handle Joypad writes for HW reg caching\n\n\n  if (offset === Joypad.memoryLocationJoypadRegister) {\n    Joypad.updateJoypad(value);\n  } // Handle Interrupt writes\n\n\n  if (offset === Interrupts.memoryLocationInterruptRequest) {\n    Interrupts.updateInterruptRequested(value);\n    return true;\n  }\n\n  if (offset === Interrupts.memoryLocationInterruptEnabled) {\n    Interrupts.updateInterruptEnabled(value);\n    return true;\n  } // Allow the original write\n\n\n  return true;\n} // WasmBoy memory map:\n// Private function to translate a offset meant for the gameboy memory map\n// To the wasmboy memory map\n// Following: http://gameboy.mongenel.com/dmg/asmmemmap.html\n// And https://github.com/Dooskington/GameLad/wiki/Part-11---Memory-Bank-Controllers\n// Performance help from @dcodeIO, and awesome-gbdev\n\n\nfunction getWasmBoyOffsetFromGameBoyOffset(gameboyOffset) {\n  // Get the top byte and switch\n  var gameboyOffsetHighByte = gameboyOffset >> 12;\n\n  switch (gameboyOffsetHighByte) {\n    case 0x00:\n    case 0x01:\n    case 0x02:\n    case 0x03:\n      // Cartridge ROM - Bank 0 (fixed)\n      // 0x0000 -> 0x0D2400\n      return gameboyOffset + CARTRIDGE_ROM_LOCATION;\n\n    case 0x04:\n    case 0x05:\n    case 0x06:\n    case 0x07:\n      // Cartridge ROM - Switchable Banks 1-xx\n      // 0x4000 -> (0x0D2400 + 0x4000)\n      return getRomBankAddress(gameboyOffset) + CARTRIDGE_ROM_LOCATION;\n\n    case 0x08:\n    case 0x09:\n      // Video RAM\n      // 0x8000 -> 0x000400\n      var vramBankId = 0;\n\n      if (Cpu.GBCEnabled) {\n        // Find our current VRAM Bank\n        vramBankId = eightBitLoadFromGBMemory(Memory.memoryLocationGBCVRAMBank) & 0x01; // Even though We added another 0x2000, the Cartridge ram is pulled out of our Internal Memory Space\n        // Therefore, we do not need to adjust for this extra 0x2000\n      }\n\n      return gameboyOffset - Memory.videoRamLocation + VIDEO_RAM_LOCATION + 0x2000 * vramBankId;\n\n    case 0x0a:\n    case 0x0b:\n      // Cartridge RAM - A.K.A External RAM\n      // 0xA000 -> 0x008400\n      return getRamBankAddress(gameboyOffset) + CARTRIDGE_RAM_LOCATION;\n\n    case 0x0c:\n      // Gameboy Ram Bank 0\n      // 0xC000 -> 0x000400\n      // Don't need to add head, since we move out 0x200 from the cartridge ram\n      return gameboyOffset - Memory.internalRamBankZeroLocation + WORK_RAM_LOCATION;\n\n    case 0x0d:\n      // Gameboy Ram Banks, Switchable in GBC Mode\n      // 0xD000 -> 0x000400\n      // In CGB Mode 32 KBytes internal RAM are available.\n      // This memory is divided into 8 banks of 4 KBytes each.\n      // Bank 0 is always available in memory at C000-CFFF,\n      // Bank 1-7 can be selected into the address space at D000-DFFF.\n      // http://gbdev.gg8.se/wiki/articles/CGB_Registers#FF70_-_SVBK_-_CGB_Mode_Only_-_WRAM_Bank\n      // Get the last 3 bits to find our wram ID\n      var wramBankId = 0;\n\n      if (Cpu.GBCEnabled) {\n        wramBankId = eightBitLoadFromGBMemory(Memory.memoryLocationGBCWRAMBank) & 0x07;\n      }\n\n      if (wramBankId < 1) {\n        wramBankId = 1;\n      } // (0x1000 * (wramBankId - 1)) -> To find the correct wram bank.\n      // wramBankId - 1, because we alreayd have the space for wramBank 1, and are currently in it\n      // So need to address space for 6 OTHER banks\n\n\n      return gameboyOffset - Memory.internalRamBankZeroLocation + WORK_RAM_LOCATION + 0x1000 * (wramBankId - 1);\n\n    default:\n      // Everything Else after Gameboy Ram Banks\n      // 0xE000 -> 0x000400\n      // 0x6000 For the Extra WRAM Banks\n      return gameboyOffset - Memory.echoRamLocation + OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION;\n  }\n} // Store / Write memory access\n\n\nfunction eightBitStoreIntoGBMemory(gameboyOffset, value) {\n  store(getWasmBoyOffsetFromGameBoyOffset(gameboyOffset), value);\n}\n\nfunction eightBitStoreIntoGBMemoryWithTraps(offset, value) {\n  if (checkWriteTraps(offset, value)) {\n    eightBitStoreIntoGBMemory(offset, value);\n  }\n}\n\nfunction sixteenBitStoreIntoGBMemoryWithTraps(offset, value) {\n  // Dividing into two seperate eight bit calls to help with debugging tilemap overwrites\n  // Split the value into two seperate bytes\n  var highByte = splitHighByte(value);\n  var lowByte = splitLowByte(value);\n  var nextOffset = offset + 1;\n\n  if (checkWriteTraps(offset, lowByte)) {\n    eightBitStoreIntoGBMemory(offset, lowByte);\n  }\n\n  if (checkWriteTraps(nextOffset, highByte)) {\n    eightBitStoreIntoGBMemory(nextOffset, highByte);\n  }\n}\n\nfunction sixteenBitStoreIntoGBMemory(offset, value) {\n  // Dividing into two seperate eight bit calls to help with debugging tilemap overwrites\n  // Split the value into two seperate bytes\n  var highByte = splitHighByte(value);\n  var lowByte = splitLowByte(value);\n  var nextOffset = offset + 1;\n  eightBitStoreIntoGBMemory(offset, lowByte);\n  eightBitStoreIntoGBMemory(nextOffset, highByte);\n}\n\nfunction storeBooleanDirectlyToWasmMemory(offset, value) {\n  if (value) {\n    store(offset, 0x01);\n  } else {\n    store(offset, 0x00);\n  }\n} // Funcitons for setting and checking the LCD\n\n\nvar Lcd =\n/** @class */\nfunction () {\n  function Lcd() {} // Function called in write traps to update our hardware registers\n\n\n  Lcd.updateLcdStatus = function (value) {\n    // Bottom three bits are read only\n    var currentLcdStatus = eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus);\n    var valueNoBottomBits = value & 0xf8;\n    var lcdStatusOnlyBottomBits = currentLcdStatus & 0x07;\n    value = valueNoBottomBits | lcdStatusOnlyBottomBits; // Top bit is always 1\n\n    value = setBitOnByte(7, value);\n    eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus, value);\n  }; // Function called in write traps to update our hardware registers\n\n\n  Lcd.updateLcdControl = function (value) {\n    var wasLcdEnabled = Lcd.enabled;\n    Lcd.enabled = checkBitOnByte(7, value);\n    Lcd.windowTileMapDisplaySelect = checkBitOnByte(6, value);\n    Lcd.windowDisplayEnabled = checkBitOnByte(5, value);\n    Lcd.bgWindowTileDataSelect = checkBitOnByte(4, value);\n    Lcd.bgTileMapDisplaySelect = checkBitOnByte(3, value);\n    Lcd.tallSpriteSize = checkBitOnByte(2, value);\n    Lcd.spriteDisplayEnable = checkBitOnByte(1, value);\n    Lcd.bgDisplayEnabled = checkBitOnByte(0, value);\n\n    if (wasLcdEnabled && !Lcd.enabled) {\n      // Disable the LCD\n      resetLcd(true);\n    }\n\n    if (!wasLcdEnabled && Lcd.enabled) {\n      // Re-enable the LCD\n      resetLcd(false);\n    }\n  }; // Memory Locations\n  // Also known at STAT\n  // LCD Status (0xFF41) bits Explanation\n  // 0                0                    000                    0             00\n  //       |Coicedence Interrupt|     |Mode Interrupts|  |coincidence flag|  | Mode |\n  // Modes:\n  // 0 or 00: H-Blank\n  // 1 or 01: V-Blank\n  // 2 or 10: Searching Sprites Atts\n  // 3 or 11: Transfering Data to LCD Driver\n\n\n  Lcd.memoryLocationLcdStatus = 0xff41;\n  Lcd.currentLcdMode = 0;\n  Lcd.memoryLocationCoincidenceCompare = 0xff45;\n  Lcd.coincidenceCompare = 0; // Also known as LCDC\n  // http://www.codeslinger.co.uk/pages/projects/gameboy/graphics.html\n  // Bit 7 - LCD Display Enable (0=Off, 1=On)\n  // Bit 6 - Window Tile Map Display Select (0=9800-9BFF, 1=9C00-9FFF)\n  // Bit 5 - Window Display Enable (0=Off, 1=On)\n  // Bit 4 - BG & Window Tile Data Select (0=8800-97FF, 1=8000-8FFF)\n  // Bit 3 - BG Tile Map Display Select (0=9800-9BFF, 1=9C00-9FFF)\n  // Bit 2 - OBJ (Sprite) Size (0=8x8, 1=8x16)\n  // Bit 1 - OBJ (Sprite) Display Enable (0=Off, 1=On)\n  // Bit 0 - BG Display (for CGB see below) (0=Off, 1=On\n\n  Lcd.memoryLocationLcdControl = 0xff40; // Decoupled LCDC for caching\n\n  Lcd.enabled = true;\n  Lcd.windowTileMapDisplaySelect = false;\n  Lcd.windowDisplayEnabled = false;\n  Lcd.bgWindowTileDataSelect = false;\n  Lcd.bgTileMapDisplaySelect = false;\n  Lcd.tallSpriteSize = false;\n  Lcd.spriteDisplayEnable = false;\n  Lcd.bgDisplayEnabled = false;\n  return Lcd;\n}();\n\nfunction resetLcd(shouldBlankScreen) {\n  // Reset scanline cycle counter\n  Graphics.scanlineCycleCounter = 0;\n  Graphics.scanlineRegister = 0;\n  eightBitStoreIntoGBMemory(Graphics.memoryLocationScanlineRegister, 0); // Set to mode 0\n  // https://www.reddit.com/r/EmuDev/comments/4w6479/gb_dr_mario_level_generation_issues/\n\n  var lcdStatus = eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus);\n  lcdStatus = resetBitOnByte(1, lcdStatus);\n  lcdStatus = resetBitOnByte(0, lcdStatus);\n  Lcd.currentLcdMode = 0; // Store the status in memory\n\n  eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus, lcdStatus); // Blank the screen\n\n  if (shouldBlankScreen) {\n    for (var i = 0; i < GRAPHICS_OUTPUT_SIZE; i++) {\n      store(GRAPHICS_OUTPUT_LOCATION + i, 255);\n    }\n  }\n} // Pass in the lcd status for performance\n\n\nfunction setLcdStatus() {\n  // Check if the Lcd was disabled\n  if (!Lcd.enabled) {\n    return;\n  } // Get our current scanline, and lcd mode\n\n\n  var scanlineRegister = Graphics.scanlineRegister;\n  var lcdMode = Lcd.currentLcdMode; // Default to  H-Blank\n\n  var newLcdMode = 0; // Find our newLcd mode\n\n  if (scanlineRegister >= 144) {\n    // VBlank mode\n    newLcdMode = 1;\n  } else {\n    if (Graphics.scanlineCycleCounter >= Graphics.MIN_CYCLES_SPRITES_LCD_MODE()) {\n      // Searching Sprites Atts\n      newLcdMode = 2;\n    } else if (Graphics.scanlineCycleCounter >= Graphics.MIN_CYCLES_TRANSFER_DATA_LCD_MODE()) {\n      // Transferring data to lcd\n      newLcdMode = 3;\n    }\n  }\n\n  if (lcdMode !== newLcdMode) {\n    // Get our lcd status\n    var lcdStatus = eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus); // Save our lcd mode\n\n    Lcd.currentLcdMode = newLcdMode;\n    var shouldRequestInterrupt = false; // Set our LCD Status accordingly\n\n    switch (newLcdMode) {\n      case 0x00:\n        lcdStatus = resetBitOnByte(0, lcdStatus);\n        lcdStatus = resetBitOnByte(1, lcdStatus);\n        shouldRequestInterrupt = checkBitOnByte(3, lcdStatus);\n        break;\n\n      case 0x01:\n        lcdStatus = resetBitOnByte(1, lcdStatus);\n        lcdStatus = setBitOnByte(0, lcdStatus);\n        shouldRequestInterrupt = checkBitOnByte(4, lcdStatus);\n        break;\n\n      case 0x02:\n        lcdStatus = resetBitOnByte(0, lcdStatus);\n        lcdStatus = setBitOnByte(1, lcdStatus);\n        shouldRequestInterrupt = checkBitOnByte(5, lcdStatus);\n        break;\n\n      case 0x03:\n        lcdStatus = setBitOnByte(0, lcdStatus);\n        lcdStatus = setBitOnByte(1, lcdStatus);\n        break;\n    } // Check if we want to request an interrupt, and we JUST changed modes\n\n\n    if (shouldRequestInterrupt) {\n      requestLcdInterrupt();\n    } // Check for updating the Hblank HDMA\n\n\n    if (newLcdMode === 0) {\n      // Update the Hblank DMA, will simply return if not active\n      updateHblankHdma();\n    } // Check for requesting a VBLANK interrupt\n\n\n    if (newLcdMode === 1) {\n      requestVBlankInterrupt();\n    } // Check for the coincidence\n\n\n    lcdStatus = checkCoincidence(newLcdMode, lcdStatus); // Finally, save our status\n\n    eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus, lcdStatus);\n  } else if (scanlineRegister === 153) {\n    // Special Case, need to check LYC\n    // Fix prehistorik man freeze\n    var lcdStatus = eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus);\n    lcdStatus = checkCoincidence(newLcdMode, lcdStatus);\n    eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus, lcdStatus);\n  }\n}\n\nfunction checkCoincidence(lcdMode, lcdStatus) {\n  // Check for the coincidence flag\n  // Need to check on every mode, and not just HBLANK, as checking on hblank breaks shantae, which checks on vblank\n  var coincidenceCompare = Lcd.coincidenceCompare;\n\n  if ((lcdMode === 0 || lcdMode === 1) && Graphics.scanlineRegister === coincidenceCompare) {\n    lcdStatus = setBitOnByte(2, lcdStatus);\n\n    if (checkBitOnByte(6, lcdStatus)) {\n      requestLcdInterrupt();\n    }\n  } else {\n    lcdStatus = resetBitOnByte(2, lcdStatus);\n  }\n\n  return lcdStatus;\n} // Functions for rendering the background\n\n\nfunction renderBackground(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation) {\n  // NOTE: Camera is reffering to what you can see inside the 160x144 viewport of the entire rendered 256x256 map.\n  // Get our scrollX and scrollY (u16 to play nice with assemblyscript)\n  // let scrollX: i32 = eightBitLoadFromGBMemory(Graphics.memoryLocationScrollX);\n  // let scrollY: i32 = eightBitLoadFromGBMemory(Graphics.memoryLocationScrollY);\n  var scrollX = Graphics.scrollX;\n  var scrollY = Graphics.scrollY; // Get our current pixel y positon on the 160x144 camera (Row that the scanline draws across)\n  // this is done by getting the current scroll Y position,\n  // and adding it do what Y Value the scanline is drawing on the camera.\n\n  var pixelYPositionInMap = scanlineRegister + scrollY; // Gameboy camera will \"wrap\" around the background map,\n  // meaning that if the pixelValue is 350, then we need to subtract 256 (decimal) to get it's actual value\n  // pixel values (scrollX and scrollY) range from 0x00 - 0xFF\n\n  if (pixelYPositionInMap >= 0x100) {\n    pixelYPositionInMap -= 0x100;\n  } // Draw the Background scanline\n\n\n  drawBackgroundWindowScanline(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation, pixelYPositionInMap, 0, scrollX);\n}\n\nfunction renderWindow(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation) {\n  // Get our windowX and windowY\n  // let windowX: i32 = eightBitLoadFromGBMemory(Graphics.memoryLocationWindowX);\n  // let windowY: i32 = eightBitLoadFromGBMemory(Graphics.memoryLocationWindowY);\n  var windowX = Graphics.windowX;\n  var windowY = Graphics.windowY; // NOTE: Camera is reffering to what you can see inside the 160x144 viewport of the entire rendered 256x256 map.\n  // First ensure that the scanline is greater than our window\n\n  if (scanlineRegister < windowY) {\n    // Window is not within the current camera view\n    return;\n  } // WindowX is offset by 7\n\n\n  windowX = windowX - 7; // Get our current pixel y positon on the 160x144 camera (Row that the scanline draws across)\n\n  var pixelYPositionInMap = scanlineRegister - windowY; // xOffset is simply a neagative window x\n\n  var xOffset = -1 * windowX; // Draw the Background scanline\n\n  drawBackgroundWindowScanline(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation, pixelYPositionInMap, windowX, xOffset);\n} // Function frankenstein'd together to allow background and window to share the same draw scanline function\n\n\nfunction drawBackgroundWindowScanline(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation, pixelYPositionInMap, iStart, xOffset) {\n  // Get our tile Y position in the map\n  var tileYPositionInMap = pixelYPositionInMap >> 3; // Loop through x to draw the line like a CRT\n\n  for (var i = iStart; i < 160; i++) {\n    // Get our Current X position of our pixel on the on the 160x144 camera\n    // this is done by getting the current scroll X position,\n    // and adding it do what X Value the scanline is drawing on the camera.\n    var pixelXPositionInMap = i + xOffset; // This is to compensate wrapping, same as pixelY\n\n    if (pixelXPositionInMap >= 0x100) {\n      pixelXPositionInMap -= 0x100;\n    } // Divide our pixel position by 8 to get our tile.\n    // Since, there are 256x256 pixels, and 32x32 tiles.\n    // 256 / 8 = 32.\n    // Also, bitshifting by 3, do do a division by 8\n    // Need to use u16s, as they will be used to compute an address, which will cause weird errors and overflows\n\n\n    var tileXPositionInMap = pixelXPositionInMap >> 3; // Get our tile address on the tileMap\n    // NOTE: (tileMap represents where each tile is displayed on the screen)\n    // NOTE: (tile map represents the entire map, now just what is within the \"camera\")\n    // For instance, if we have y pixel 144. 144 / 8 = 18. 18 * 32 = line address in map memory.\n    // And we have x pixel 160. 160 / 8 = 20.\n    // * 32, because remember, this is NOT only for the camera, the actual map is 32x32. Therefore, the next tile line of the map, is 32 byte offset.\n    // Think like indexing a 2d array, as a 1d array and it make sense :)\n\n    var tileMapAddress = tileMapMemoryLocation + tileYPositionInMap * 32 + tileXPositionInMap; // Get the tile Id on the Tile Map\n\n    var tileIdFromTileMap = loadFromVramBank(tileMapAddress, 0); // Now that we have our Tile Id, let's check our Tile Cache\n\n    var usedTileCache = false;\n\n    if (Config.tileCaching) {\n      var pixelsDrawn = drawLineOfTileFromTileCache(i, scanlineRegister, pixelXPositionInMap, pixelYPositionInMap, tileMapAddress, tileDataMemoryLocation, tileIdFromTileMap); // Increment i by 7, not 8 because i will be incremented at end of for loop\n\n      if (pixelsDrawn > 0) {\n        i += pixelsDrawn - 1;\n        usedTileCache = true;\n      }\n    }\n\n    if (Config.tileRendering && !usedTileCache) {\n      var pixelsDrawn = drawLineOfTileFromTileId(i, scanlineRegister, pixelXPositionInMap, pixelYPositionInMap, tileMapAddress, tileDataMemoryLocation, tileIdFromTileMap); // A line of a tile is 8 pixels wide, therefore increase i by (pixelsDrawn - 1), and then the for loop will increment by 1\n      // For a net increment for 8\n\n      if (pixelsDrawn > 0) {\n        i += pixelsDrawn - 1;\n      }\n    } else if (!usedTileCache) {\n      if (Cpu.GBCEnabled) {\n        // Draw the individual pixel\n        drawColorPixelFromTileId(i, scanlineRegister, pixelXPositionInMap, pixelYPositionInMap, tileMapAddress, tileDataMemoryLocation, tileIdFromTileMap);\n      } else {\n        // Draw the individual pixel\n        drawMonochromePixelFromTileId(i, scanlineRegister, pixelXPositionInMap, pixelYPositionInMap, tileDataMemoryLocation, tileIdFromTileMap);\n      }\n    }\n  }\n} // Function to draw a pixel for the standard GB\n\n\nfunction drawMonochromePixelFromTileId(xPixel, yPixel, pixelXPositionInMap, pixelYPositionInMap, tileDataMemoryLocation, tileIdFromTileMap) {\n  // Now we can process the the individual bytes that represent the pixel on a tile\n  // Now get our tileDataAddress for the corresponding tileID we found in the map\n  // Read the comments in _getTileDataAddress() to see what's going on.\n  // tl;dr if we had the tile map of \"a b c d\", and wanted tileId 2.\n  // This funcitons returns the start of memory locaiton for the tile 'c'.\n  var tileDataAddress = getTileDataAddress(tileDataMemoryLocation, tileIdFromTileMap); // Get the y pixel of the 8 by 8 tile.\n  // Simply modulo the scanline.\n  // For instance, let's say we are printing the first line of pixels on our camera,\n  // And the first line of pixels on our tile.\n  // yPixel = 1. 1 % 8 = 1.\n  // And for the last line\n  // yPixel = 144. 144 % 8 = 0.\n  // 0 Represents last line of pixels in a tile, 1 represents first. 1 2 3 4 5 6 7 0.\n  // Because remember, we are counting lines on the display NOT including zero\n\n  var pixelYInTile = pixelYPositionInMap % 8; // Remember to represent a single line of 8 pixels on a tile, we need two bytes.\n  // Therefore, we need to times our modulo by 2, to get the correct line of pixels on the tile.\n  // Again, think like you had to map a 2d array as a 1d.\n\n  var byteOneForLineOfTilePixels = loadFromVramBank(tileDataAddress + pixelYInTile * 2, 0);\n  var byteTwoForLineOfTilePixels = loadFromVramBank(tileDataAddress + pixelYInTile * 2 + 1, 0); // Same logic as pixelYInTile.\n  // However, We need to reverse our byte,\n  // As pixel 0 is on byte 7, and pixel 1 is on byte 6, etc...\n  // Therefore, is pixelX was 2, then really is need to be 5\n  // So 2 - 7 = -5, * 1 = 5\n  // Or to simplify, 7 - 2 = 5 haha!\n\n  var pixelXInTile = pixelXPositionInMap % 8;\n  pixelXInTile = 7 - pixelXInTile; // Now we can get the color for that pixel\n  // Colors are represented by getting X position of ByteTwo, and X positon of Byte One\n  // To Get the color Id.\n  // For example, the result of the color id is 0000 00[xPixelByteTwo][xPixelByteOne]\n  // See: How to draw a tile/sprite from memory: http://www.codeslinger.co.uk/pages/projects/gameboy/graphics.html\n\n  var paletteColorId = 0;\n\n  if (checkBitOnByte(pixelXInTile, byteTwoForLineOfTilePixels)) {\n    // Byte one represents the second bit in our color id, so bit shift\n    paletteColorId += 1;\n    paletteColorId = paletteColorId << 1;\n  }\n\n  if (checkBitOnByte(pixelXInTile, byteOneForLineOfTilePixels)) {\n    paletteColorId += 1;\n  } // Not checking u8 Portability overflow here, since it can't be greater than i32 over :p\n  // Now get the colorId from the pallete, to get our final color\n  // Developers could change colorIds to represents different colors\n  // in their palette, thus we need to grab the color from there\n  //let pixelColorInTileFromPalette: u8 = getColorFromPalette(paletteColorId, Graphics.memoryLocationBackgroundPalette);\n  // Moved below for perofrmance\n  // FINALLY, RENDER THAT PIXEL!\n  // Only rendering camera for now, so coordinates are for the camera.\n  // Get the rgb value for the color Id, will be repeated into R, G, B\n\n\n  var monochromeColor = getMonochromeColorFromPalette(paletteColorId, Graphics.memoryLocationBackgroundPalette);\n  setPixelOnFrame(xPixel, yPixel, 0, monochromeColor);\n  setPixelOnFrame(xPixel, yPixel, 1, monochromeColor);\n  setPixelOnFrame(xPixel, yPixel, 2, monochromeColor); // Lastly, add the pixel to our background priority map\n  // https://github.com/torch2424/wasmBoy/issues/51\n  // Bits 0 & 1 will represent the color Id drawn by the BG/Window\n  // Bit 2 will represent if the Bg/Window has GBC priority.\n\n  addPriorityforPixel(xPixel, yPixel, paletteColorId);\n} // Function to draw a pixel from a tile in C O L O R\n// See above for more context on some variables\n\n\nfunction drawColorPixelFromTileId(xPixel, yPixel, pixelXPositionInMap, pixelYPositionInMap, tileMapAddress, tileDataMemoryLocation, tileIdFromTileMap) {\n  // Now get our tileDataAddress for the corresponding tileID we found in the map\n  // Read the comments in _getTileDataAddress() to see what's going on.\n  // tl;dr if we had the tile map of \"a b c d\", and wanted tileId 2.\n  // This funcitons returns the start of memory locaiton for the tile 'c'.\n  var tileDataAddress = getTileDataAddress(tileDataMemoryLocation, tileIdFromTileMap); // Get the GB Map Attributes\n  // Bit 0-2  Background Palette number  (BGP0-7)\n  // Bit 3    Tile VRAM Bank number      (0=Bank 0, 1=Bank 1)\n  // Bit 4    Not used\n  // Bit 5    Horizontal Flip            (0=Normal, 1=Mirror horizontally)\n  // Bit 6    Vertical Flip              (0=Normal, 1=Mirror vertically)\n  // Bit 7    BG-to-OAM Priority         (0=Use OAM priority bit, 1=BG Priority)\n\n  var bgMapAttributes = loadFromVramBank(tileMapAddress, 1); // See above for explanation\n\n  var pixelYInTile = pixelYPositionInMap % 8;\n\n  if (checkBitOnByte(6, bgMapAttributes)) {\n    // We are mirroring the tile, therefore, we need to opposite byte\n    // So if our pixel was 0 our of 8, it wild become 7 :)\n    pixelYInTile = 7 - pixelYInTile;\n  } // Remember to represent a single line of 8 pixels on a tile, we need two bytes.\n  // Therefore, we need to times our modulo by 2, to get the correct line of pixels on the tile.\n  // But we need to load the time from a specific Vram bank\n\n\n  var vramBankId = 0;\n\n  if (checkBitOnByte(3, bgMapAttributes)) {\n    vramBankId = 1;\n  }\n\n  var byteOneForLineOfTilePixels = loadFromVramBank(tileDataAddress + pixelYInTile * 2, vramBankId);\n  var byteTwoForLineOfTilePixels = loadFromVramBank(tileDataAddress + pixelYInTile * 2 + 1, vramBankId); // Get our X pixel. Need to NOT reverse it if it was flipped.\n  // See above, you have to reverse this normally\n\n  var pixelXInTile = pixelXPositionInMap % 8;\n\n  if (!checkBitOnByte(5, bgMapAttributes)) {\n    pixelXInTile = 7 - pixelXInTile;\n  } // Now we can get the color for that pixel\n  // Colors are represented by getting X position of ByteTwo, and X positon of Byte One\n  // To Get the color Id.\n  // For example, the result of the color id is 0000 00[xPixelByteTwo][xPixelByteOne]\n  // See: How to draw a tile/sprite from memory: http://www.codeslinger.co.uk/pages/projects/gameboy/graphics.html\n\n\n  var paletteColorId = 0;\n\n  if (checkBitOnByte(pixelXInTile, byteTwoForLineOfTilePixels)) {\n    // Byte one represents the second bit in our color id, so bit shift\n    paletteColorId += 1;\n    paletteColorId = paletteColorId << 1;\n  }\n\n  if (checkBitOnByte(pixelXInTile, byteOneForLineOfTilePixels)) {\n    paletteColorId += 1;\n  } // Finally lets add some, C O L O R\n  // Want the botom 3 bits\n\n\n  var bgPalette = bgMapAttributes & 0x07; // Call the helper function to grab the correct color from the palette\n\n  var rgbColorPalette = getRgbColorFromPalette(bgPalette, paletteColorId, false); // Split off into red green and blue\n\n  var red = getColorComponentFromRgb(0, rgbColorPalette);\n  var green = getColorComponentFromRgb(1, rgbColorPalette);\n  var blue = getColorComponentFromRgb(2, rgbColorPalette); // Finally Place our colors on the things\n\n  setPixelOnFrame(xPixel, yPixel, 0, red);\n  setPixelOnFrame(xPixel, yPixel, 1, green);\n  setPixelOnFrame(xPixel, yPixel, 2, blue); // Lastly, add the pixel to our background priority map\n  // https://github.com/torch2424/wasmBoy/issues/51\n  // Bits 0 & 1 will represent the color Id drawn by the BG/Window\n  // Bit 2 will represent if the Bg/Window has GBC priority.\n\n  addPriorityforPixel(xPixel, yPixel, paletteColorId, checkBitOnByte(7, bgMapAttributes));\n} // Function to attempt to draw the tile from the tile cache\n\n\nfunction drawLineOfTileFromTileCache(xPixel, yPixel, pixelXPositionInMap, pixelYPositionInMap, tileMapAddress, tileDataMemoryLocation, tileIdFromTileMap) {\n  // First, initialize how many pixels we have drawn\n  var pixelsDrawn = 0; // Check if the current tile matches our tileId\n  // TODO: Allow the first line to use the tile cache, for some odd reason it doesn't work when scanline is 0\n\n  if (yPixel > 0 && xPixel > 8 && tileIdFromTileMap === TileCache.tileId && xPixel === TileCache.nextXIndexToPerformCacheCheck) {\n    // Was last tile flipped\n    var wasLastTileHorizontallyFlipped = false;\n    var isCurrentTileHorizontallyFlipped = false;\n\n    if (checkBitOnByte(5, eightBitLoadFromGBMemory(tileMapAddress - 1))) {\n      wasLastTileHorizontallyFlipped = true;\n    }\n\n    if (checkBitOnByte(5, eightBitLoadFromGBMemory(tileMapAddress))) {\n      isCurrentTileHorizontallyFlipped = true;\n    } // Simply copy the last 8 pixels from memory to copy the line from the tile\n\n\n    for (var tileCacheIndex = 0; tileCacheIndex < 8; tileCacheIndex++) {\n      // Check if we need to render backwards for flipping\n      if (wasLastTileHorizontallyFlipped !== isCurrentTileHorizontallyFlipped) {\n        tileCacheIndex = 7 - tileCacheIndex;\n      } // First check for overflow\n\n\n      if (xPixel + tileCacheIndex <= 160) {\n        // Get the pixel location in memory of the tile\n        var previousXPixel = xPixel - (8 - tileCacheIndex);\n        var previousTilePixelLocation = FRAME_LOCATION + getRgbPixelStart(xPixel + tileCacheIndex, yPixel); // Cycle through the RGB\n\n        for (var tileCacheRgb = 0; tileCacheRgb < 3; tileCacheRgb++) {\n          setPixelOnFrame(xPixel + tileCacheIndex, yPixel, tileCacheRgb, load(previousTilePixelLocation + tileCacheRgb));\n        } // Copy the priority for the pixel\n\n\n        var pixelPriority = getPriorityforPixel(previousXPixel, yPixel);\n        addPriorityforPixel(xPixel + tileCacheIndex, yPixel, resetBitOnByte(2, pixelPriority), checkBitOnByte(2, pixelPriority));\n        pixelsDrawn++;\n      }\n    }\n  } else {\n    // Save our current tile Id, and the next x value we should check the x index\n    TileCache.tileId = tileIdFromTileMap;\n  } // Calculate when we should do the tileCache calculation again\n\n\n  if (xPixel >= TileCache.nextXIndexToPerformCacheCheck) {\n    TileCache.nextXIndexToPerformCacheCheck = xPixel + 8;\n    var xOffsetTileWidthRemainder = pixelXPositionInMap % 8;\n\n    if (xPixel < xOffsetTileWidthRemainder) {\n      TileCache.nextXIndexToPerformCacheCheck += xOffsetTileWidthRemainder;\n    }\n  }\n\n  return pixelsDrawn;\n} // Function to draw a line of a tile in Color\n// This is for tile rendering shortcuts\n\n\nfunction drawLineOfTileFromTileId(xPixel, yPixel, pixelXPositionInMap, pixelYPositionInMap, tileMapAddress, tileDataMemoryLocation, tileIdFromTileMap) {\n  // Get the which line of the tile we are rendering\n  var tileLineY = pixelYPositionInMap % 8; // Now lets find our tileX start and end\n  // This is for the case where i = 0, but scroll X was 3.\n  // Or i is 157, and our camera is only 160 pixels wide\n\n  var tileXStart = 0;\n\n  if (xPixel == 0) {\n    tileXStart = pixelXPositionInMap - pixelXPositionInMap / 8 * 8;\n  }\n\n  var tileXEnd = 7;\n\n  if (xPixel + 8 > 160) {\n    tileXEnd = 160 - xPixel;\n  } // initialize some variables for GBC\n\n\n  var bgMapAttributes = -1;\n  var vramBankId = 0;\n\n  if (Cpu.GBCEnabled) {\n    // Get Our GBC properties\n    bgMapAttributes = loadFromVramBank(tileMapAddress, 1);\n\n    if (checkBitOnByte(3, bgMapAttributes)) {\n      vramBankId = 1;\n    }\n\n    if (checkBitOnByte(6, bgMapAttributes)) {\n      // We are mirroring the tile, therefore, we need to opposite byte\n      // So if our pixel was 0 our of 8, it wild become 7 :)\n      tileLineY = 7 - tileLineY;\n    }\n  } // Return the number of pixels drawn\n\n\n  return drawPixelsFromLineOfTile(tileIdFromTileMap, tileDataMemoryLocation, vramBankId, tileXStart, tileXEnd, tileLineY, xPixel, yPixel, 160, FRAME_LOCATION, false, 0, bgMapAttributes, -1);\n} // Functions for rendering the sprites\n\n\nfunction renderSprites(scanlineRegister, useLargerSprites) {\n  // Need to loop through all 40 sprites to check their status\n  // Going backwards since lower sprites draw over higher ones\n  // Will fix dragon warrior 3 intro\n  for (var i = 39; i >= 0; i--) {\n    // Sprites occupy 4 bytes in the sprite attribute table\n    var spriteTableIndex = i * 4; // Y positon is offset by 16, X position is offset by 8\n\n    var spriteYPosition = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex);\n    var spriteXPosition = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex + 1);\n    var spriteTileId = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex + 2); // Pan docs of sprite attirbute table\n    // Bit7   OBJ-to-BG Priority (0=OBJ Above BG, 1=OBJ Behind BG color 1-3)\n    //      (Used for both BG and Window. BG color 0 is always behind OBJ)\n    // Bit6   Y flip          (0=Normal, 1=Vertically mirrored)\n    // Bit5   X flip          (0=Normal, 1=Horizontally mirrored)\n    // Bit4   Palette number  **Non CGB Mode Only** (0=OBP0, 1=OBP1)\n    // Bit3   Tile VRAM-Bank  **CGB Mode Only**     (0=Bank 0, 1=Bank 1)\n    // Bit2-0 Palette number  **CGB Mode Only**     (OBP0-7)\n    // Apply sprite X and Y offset\n    // TODO: Sprites are overflowing on x if less than 8\n\n    spriteYPosition -= 16;\n    spriteXPosition -= 8; // Find our sprite height\n\n    var spriteHeight = 8;\n\n    if (useLargerSprites) {\n      spriteHeight = 16; // @binji says in 8x16 mode, even tileId always drawn first\n      // This will fix shantae sprites which always uses odd numbered indexes\n      // TODO: Do the actual Pandocs thing:\n      // \"In 8x16 mode, the lower bit of the tile number is ignored. Ie. the upper 8x8 tile is \"NN AND FEh\", and the lower 8x8 tile is \"NN OR 01h\".\"\n      // So just knock off the last bit? :)\n\n      if (spriteTileId % 2 === 1) {\n        spriteTileId -= 1;\n      }\n    } // Find if our sprite is on the current scanline\n\n\n    if (scanlineRegister >= spriteYPosition && scanlineRegister < spriteYPosition + spriteHeight) {\n      // Then we need to draw the current sprite\n      // Get our sprite attributes since we know we shall be drawing the tile\n      var spriteAttributes = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex + 3); // Check sprite Priority\n\n      var isSpritePriorityBehindWindowAndBackground = checkBitOnByte(7, spriteAttributes); // Check if we should flip the sprite on the x or y axis\n\n      var flipSpriteY = checkBitOnByte(6, spriteAttributes);\n      var flipSpriteX = checkBitOnByte(5, spriteAttributes); // TODO: Torch2424 continue here.\n      // Find which line on the sprite we are on\n\n      var currentSpriteLine = scanlineRegister - spriteYPosition; // If we fliiped the Y axis on our sprite, need to read from memory backwards to acheive the same effect\n\n      if (flipSpriteY) {\n        currentSpriteLine -= spriteHeight;\n        currentSpriteLine = currentSpriteLine * -1; // Bug fix for the flipped flies in link's awakening\n\n        currentSpriteLine -= 1;\n      } // Each line of a tile takes two bytes of memory\n\n\n      currentSpriteLine = currentSpriteLine * 2; // Get our sprite tile address, need to also add the current sprite line to get the correct bytes\n\n      var spriteTileAddressStart = getTileDataAddress(Graphics.memoryLocationTileDataSelectOneStart, spriteTileId);\n      spriteTileAddressStart = spriteTileAddressStart + currentSpriteLine;\n      var spriteTileAddress = spriteTileAddressStart; // Find which VRAM Bank to load from\n\n      var vramBankId = 0;\n\n      if (Cpu.GBCEnabled && checkBitOnByte(3, spriteAttributes)) {\n        vramBankId = 1;\n      }\n\n      var spriteDataByteOneForLineOfTilePixels = loadFromVramBank(spriteTileAddress, vramBankId);\n      var spriteDataByteTwoForLineOfTilePixels = loadFromVramBank(spriteTileAddress + 1, vramBankId); // Iterate over the width of our sprite to find our individual pixels\n\n      for (var tilePixel = 7; tilePixel >= 0; tilePixel--) {\n        // Get our spritePixel, and check for flipping\n        var spritePixelXInTile = tilePixel;\n\n        if (flipSpriteX) {\n          spritePixelXInTile -= 7;\n          spritePixelXInTile = spritePixelXInTile * -1;\n        } // Get the color Id of our sprite, similar to renderBackground()\n        // With the first byte, and second byte lined up method thing\n        // Yes, the second byte comes before the first, see ./background.ts\n\n\n        var spriteColorId = 0;\n\n        if (checkBitOnByte(spritePixelXInTile, spriteDataByteTwoForLineOfTilePixels)) {\n          // Byte one represents the second bit in our color id, so bit shift\n          spriteColorId += 1;\n          spriteColorId = spriteColorId << 1;\n        }\n\n        if (checkBitOnByte(spritePixelXInTile, spriteDataByteOneForLineOfTilePixels)) {\n          spriteColorId += 1;\n        } // ColorId zero (last two bits of pallette) are transparent\n        // http://gbdev.gg8.se/wiki/articles/Video_Display\n\n\n        if (spriteColorId !== 0) {\n          // Find our actual X pixel location on the gameboy \"camera\" view\n          // This cannot be less than zero, i32 will overflow\n          var spriteXPixelLocationInCameraView = spriteXPosition + (7 - tilePixel);\n\n          if (spriteXPixelLocationInCameraView >= 0 && spriteXPixelLocationInCameraView <= 160) {\n            // There are two cases where wouldnt draw the pixel on top of the Bg/window\n            // 1. if isSpritePriorityBehindWindowAndBackground, sprite can only draw over color 0\n            // 2. if bit 2 of our priority is set, then BG-to-OAM Priority from pandoc\n            //  is active, meaning BG tile will have priority above all OBJs\n            //  (regardless of the priority bits in OAM memory)\n            // But if GBC and Bit 0 of LCDC is set, we always draw the object\n            var shouldShowFromLcdcPriority = false;\n            var shouldHideFromOamPriority = false;\n            var shouldHideFromBgPriority = false; // LCDC Priority\n\n            if (Cpu.GBCEnabled && !Lcd.bgDisplayEnabled) {\n              shouldShowFromLcdcPriority = true;\n            }\n\n            if (!shouldShowFromLcdcPriority) {\n              // Now that we have our coordinates, check for sprite priority\n              // Lets get the priority byte we put in memory\n              var bgPriorityByte = getPriorityforPixel(spriteXPixelLocationInCameraView, scanlineRegister);\n              var bgColorFromPriorityByte = bgPriorityByte & 0x03; // Doing an else if, since either will automatically stop drawing the pixel\n\n              if (isSpritePriorityBehindWindowAndBackground && bgColorFromPriorityByte > 0) {\n                // OAM Priority\n                shouldHideFromOamPriority = true;\n              } else if (Cpu.GBCEnabled && checkBitOnByte(2, bgPriorityByte) && bgColorFromPriorityByte > 0) {\n                // Bg priority\n                shouldHideFromBgPriority = true;\n              }\n            }\n\n            if (shouldShowFromLcdcPriority || !shouldHideFromOamPriority && !shouldHideFromBgPriority) {\n              if (!Cpu.GBCEnabled) {\n                // Get our monochrome color RGB from the current sprite pallete\n                // Get our sprite pallete\n                var spritePaletteLocation = Graphics.memoryLocationSpritePaletteOne;\n\n                if (checkBitOnByte(4, spriteAttributes)) {\n                  spritePaletteLocation = Graphics.memoryLocationSpritePaletteTwo;\n                }\n\n                var spritePixelColorFromPalette = getMonochromeColorFromPalette(spriteColorId, spritePaletteLocation); // Finally set the pixel!\n\n                setPixelOnFrame(spriteXPixelLocationInCameraView, scanlineRegister, 0, spritePixelColorFromPalette);\n                setPixelOnFrame(spriteXPixelLocationInCameraView, scanlineRegister, 1, spritePixelColorFromPalette);\n                setPixelOnFrame(spriteXPixelLocationInCameraView, scanlineRegister, 2, spritePixelColorFromPalette);\n              } else {\n                // Get our RGB Color\n                // Finally lets add some, C O L O R\n                // Want the botom 3 bits\n                var bgPalette = spriteAttributes & 0x07; // Call the helper function to grab the correct color from the palette\n\n                var rgbColorPalette = getRgbColorFromPalette(bgPalette, spriteColorId, true); // Split off into red green and blue\n\n                var red = getColorComponentFromRgb(0, rgbColorPalette);\n                var green = getColorComponentFromRgb(1, rgbColorPalette);\n                var blue = getColorComponentFromRgb(2, rgbColorPalette); // Finally Place our colors on the things\n\n                setPixelOnFrame(spriteXPixelLocationInCameraView, scanlineRegister, 0, red);\n                setPixelOnFrame(spriteXPixelLocationInCameraView, scanlineRegister, 1, green);\n                setPixelOnFrame(spriteXPixelLocationInCameraView, scanlineRegister, 2, blue);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n} // Main Class and funcitons for rendering the gameboy display\n\n\nvar Graphics =\n/** @class */\nfunction () {\n  function Graphics() {} // Number of cycles to run in each batch process\n  // This number should be in sync so that graphics doesn't run too many cyles at once\n  // and does not exceed the minimum number of cyles for either scanlines, or\n  // How often we change the frame, or a channel's update process\n\n\n  Graphics.batchProcessCycles = function () {\n    return Graphics.MAX_CYCLES_PER_SCANLINE();\n  }; // TCAGBD says 456 per scanline, but 153 only a handful\n\n\n  Graphics.MAX_CYCLES_PER_SCANLINE = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      if (Graphics.scanlineRegister === 153) {\n        return 8;\n      }\n\n      return 912;\n    }\n\n    if (Graphics.scanlineRegister === 153) {\n      return 4;\n    }\n\n    return 456;\n  };\n\n  Graphics.MIN_CYCLES_SPRITES_LCD_MODE = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      // TODO: Confirm these clock cyles, double similar to scanline, which TCAGBD did\n      return 752;\n    }\n\n    return 376;\n  };\n\n  Graphics.MIN_CYCLES_TRANSFER_DATA_LCD_MODE = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      // TODO: Confirm these clock cyles, double similar to scanline, which TCAGBD did\n      return 498;\n    }\n\n    return 249;\n  }; // Function to save the state of the class\n\n\n  Graphics.saveState = function () {\n    store(getSaveStateMemoryOffset(0x00, Graphics.saveStateSlot), Graphics.scanlineCycleCounter);\n    store(getSaveStateMemoryOffset(0x04, Graphics.saveStateSlot), Lcd.currentLcdMode);\n    eightBitStoreIntoGBMemory(Graphics.memoryLocationScanlineRegister, Graphics.scanlineRegister);\n  }; // Function to load the save state from memory\n\n\n  Graphics.loadState = function () {\n    Graphics.scanlineCycleCounter = load(getSaveStateMemoryOffset(0x00, Graphics.saveStateSlot));\n    Lcd.currentLcdMode = load(getSaveStateMemoryOffset(0x04, Graphics.saveStateSlot));\n    Graphics.scanlineRegister = eightBitLoadFromGBMemory(Graphics.memoryLocationScanlineRegister);\n    Lcd.updateLcdControl(eightBitLoadFromGBMemory(Lcd.memoryLocationLcdControl));\n  }; // Current cycles\n  // This will be used for batch processing\n\n\n  Graphics.currentCycles = 0; // Count the number of cycles to keep synced with cpu cycles\n  // Found GBC cycles by finding clock speed from Gb Cycles\n  // See TCAGBD For cycles\n\n  Graphics.scanlineCycleCounter = 0x00; // LCD\n  // scanlineRegister also known as LY\n  // See: http://bgb.bircd.org/pandocs.txt , and search \" LY \"\n\n  Graphics.memoryLocationScanlineRegister = 0xff44;\n  Graphics.scanlineRegister = 0;\n  Graphics.memoryLocationDmaTransfer = 0xff46; // Scroll and Window\n\n  Graphics.memoryLocationScrollX = 0xff43;\n  Graphics.scrollX = 0;\n  Graphics.memoryLocationScrollY = 0xff42;\n  Graphics.scrollY = 0;\n  Graphics.memoryLocationWindowX = 0xff4b;\n  Graphics.windowX = 0;\n  Graphics.memoryLocationWindowY = 0xff4a;\n  Graphics.windowY = 0; // Tile Maps And Data\n\n  Graphics.memoryLocationTileMapSelectZeroStart = 0x9800;\n  Graphics.memoryLocationTileMapSelectOneStart = 0x9c00;\n  Graphics.memoryLocationTileDataSelectZeroStart = 0x8800;\n  Graphics.memoryLocationTileDataSelectOneStart = 0x8000; // Sprites\n\n  Graphics.memoryLocationSpriteAttributesTable = 0xfe00; // Palettes\n\n  Graphics.memoryLocationBackgroundPalette = 0xff47;\n  Graphics.memoryLocationSpritePaletteOne = 0xff48;\n  Graphics.memoryLocationSpritePaletteTwo = 0xff49; // Screen data needs to be stored in wasm memory\n  // Save States\n\n  Graphics.saveStateSlot = 1;\n  return Graphics;\n}(); // Batch Process Graphics\n// http://gameboy.mongenel.com/dmg/asmmemmap.html and http://gbdev.gg8.se/wiki/articles/Video_Display\n// Function to batch process our graphics after we skipped so many cycles\n// This is not currently checked in memory read/write\n\n\nfunction batchProcessGraphics() {\n  if (Graphics.currentCycles < Graphics.batchProcessCycles()) {\n    return;\n  }\n\n  while (Graphics.currentCycles >= Graphics.batchProcessCycles()) {\n    updateGraphics(Graphics.batchProcessCycles());\n    Graphics.currentCycles = Graphics.currentCycles - Graphics.batchProcessCycles();\n  }\n}\n\nfunction initializeGraphics() {\n  // Reset Stateful Variables\n  Graphics.currentCycles = 0;\n  Graphics.scanlineCycleCounter = 0x00;\n  Graphics.scanlineRegister = 0;\n  Graphics.scrollX = 0;\n  Graphics.scrollY = 0;\n  Graphics.windowX = 0;\n  Graphics.windowY = 0;\n\n  if (Cpu.GBCEnabled) {\n    // Bgb says LY is 90 on boot\n    Graphics.scanlineRegister = 0x90;\n    eightBitStoreIntoGBMemory(0xff40, 0x91);\n    eightBitStoreIntoGBMemory(0xff41, 0x81); // 0xFF42 -> 0xFF43 = 0x00\n\n    eightBitStoreIntoGBMemory(0xff44, 0x90); // 0xFF45 -> 0xFF46 = 0x00\n\n    eightBitStoreIntoGBMemory(0xff47, 0xfc); // 0xFF48 -> 0xFF4B = 0x00\n    // GBC VRAM Banks\n\n    eightBitStoreIntoGBMemory(0xff4f, 0x00);\n    eightBitStoreIntoGBMemory(0xff70, 0x01);\n  } else {\n    Graphics.scanlineRegister = 0x90;\n    eightBitStoreIntoGBMemory(0xff40, 0x91);\n    eightBitStoreIntoGBMemory(0xff41, 0x85); // 0xFF42 -> 0xFF45 = 0x00\n\n    eightBitStoreIntoGBMemory(0xff46, 0xff);\n    eightBitStoreIntoGBMemory(0xff47, 0xfc);\n    eightBitStoreIntoGBMemory(0xff48, 0xff);\n    eightBitStoreIntoGBMemory(0xff49, 0xff); // 0xFF4A -> 0xFF4B = 0x00\n    // GBC VRAM Banks\n\n    eightBitStoreIntoGBMemory(0xff4f, 0x00);\n    eightBitStoreIntoGBMemory(0xff70, 0x01);\n  }\n}\n\nfunction updateGraphics(numberOfCycles) {\n  if (Lcd.enabled) {\n    Graphics.scanlineCycleCounter += numberOfCycles;\n\n    while (Graphics.scanlineCycleCounter >= Graphics.MAX_CYCLES_PER_SCANLINE()) {\n      // Reset the scanlineCycleCounter\n      // Don't set to zero to catch extra cycles\n      Graphics.scanlineCycleCounter -= Graphics.MAX_CYCLES_PER_SCANLINE(); // Move to next scanline\n      // let scanlineRegister: i32 = eightBitLoadFromGBMemory(Graphics.memoryLocationScanlineRegister);\n\n      var scanlineRegister = Graphics.scanlineRegister; // Check if we've reached the last scanline\n\n      if (scanlineRegister === 144) {\n        // Draw the scanline\n        if (!Config.graphicsDisableScanlineRendering) {\n          _drawScanline(scanlineRegister);\n        } else {\n          _renderEntireFrame();\n        } // Clear the priority map\n\n\n        clearPriorityMap(); // Reset the tile cache\n\n        resetTileCache();\n      } else if (scanlineRegister < 144) {\n        // Draw the scanline\n        if (!Config.graphicsDisableScanlineRendering) {\n          _drawScanline(scanlineRegister);\n        }\n      } // Post increment the scanline register after drawing\n      // TODO: Need to fix graphics timing\n\n\n      if (scanlineRegister > 153) {\n        // Check if we overflowed scanlines\n        // if so, reset our scanline number\n        scanlineRegister = 0;\n      } else {\n        scanlineRegister += 1;\n      } // Store our new scanline value\n\n\n      Graphics.scanlineRegister = scanlineRegister; // eightBitStoreIntoGBMemory(Graphics.memoryLocationScanlineRegister, scanlineRegister);\n    }\n  } // Games like Pokemon crystal want the vblank right as it turns to the value, and not have it increment after\n  // It will break and lead to an infinite loop in crystal\n  // Therefore, we want to be checking/Setting our LCD status after the scanline updates\n\n\n  setLcdStatus();\n} // TODO: Make this a _drawPixelOnScanline, as values can be updated while drawing a scanline\n\n\nfunction _drawScanline(scanlineRegister) {\n  // Get our seleted tile data memory location\n  var tileDataMemoryLocation = Graphics.memoryLocationTileDataSelectZeroStart;\n\n  if (Lcd.bgWindowTileDataSelect) {\n    tileDataMemoryLocation = Graphics.memoryLocationTileDataSelectOneStart;\n  } // Check if the background is enabled\n  // NOTE: On Gameboy color, Pandocs says this does something completely different\n  // LCDC.0 - 2) CGB in CGB Mode: BG and Window Master Priority\n  // When Bit 0 is cleared, the background and window lose their priority -\n  // the sprites will be always displayed on top of background and window,\n  // independently of the priority flags in OAM and BG Map attributes.\n  // TODO: Enable this different feature for GBC\n\n\n  if (Cpu.GBCEnabled || Lcd.bgDisplayEnabled) {\n    // Get our map memory location\n    var tileMapMemoryLocation = Graphics.memoryLocationTileMapSelectZeroStart;\n\n    if (Lcd.bgTileMapDisplaySelect) {\n      tileMapMemoryLocation = Graphics.memoryLocationTileMapSelectOneStart;\n    } // Finally, pass everything to draw the background\n\n\n    renderBackground(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation);\n  } // Check if the window is enabled, and we are currently\n  // Drawing lines on the window\n\n\n  if (Lcd.windowDisplayEnabled) {\n    // Get our map memory location\n    var tileMapMemoryLocation = Graphics.memoryLocationTileMapSelectZeroStart;\n\n    if (Lcd.windowTileMapDisplaySelect) {\n      tileMapMemoryLocation = Graphics.memoryLocationTileMapSelectOneStart;\n    } // Finally, pass everything to draw the background\n\n\n    renderWindow(scanlineRegister, tileDataMemoryLocation, tileMapMemoryLocation);\n  }\n\n  if (Lcd.spriteDisplayEnable) {\n    // Sprites are enabled, render them!\n    renderSprites(scanlineRegister, Lcd.tallSpriteSize);\n  }\n} // Function to render everything for a frame at once\n// This is to improve performance\n// See above for comments on how things are donw\n\n\nfunction _renderEntireFrame() {\n  // Scanline needs to be in sync while we draw, thus, we can't shortcut anymore than here\n  for (var i = 0; i <= 144; i++) {\n    _drawScanline(i);\n  }\n} // Function to get the start of a RGB pixel (R, G, B)\n\n\nfunction getRgbPixelStart(x, y) {\n  // Get the pixel number\n  // let pixelNumber: i32 = (y * 160) + x;\n  // Each pixel takes 3 slots, therefore, multiply by 3!\n  return (y * 160 + x) * 3;\n} // Also need to store current frame in memory to be read by JS\n\n\nfunction setPixelOnFrame(x, y, colorId, color) {\n  // Currently only supports 160x144\n  // Storing in X, then y\n  // So need an offset\n  store(FRAME_LOCATION + getRgbPixelStart(x, y) + colorId, color);\n} // Function to shortcut the memory map, and load directly from the VRAM Bank\n\n\nfunction loadFromVramBank(gameboyOffset, vramBankId) {\n  var wasmBoyAddress = gameboyOffset - Memory.videoRamLocation + GAMEBOY_INTERNAL_MEMORY_LOCATION + 0x2000 * (vramBankId & 0x01);\n  return load(wasmBoyAddress);\n} // Returns -1 if no trap found, otherwise returns a value that should be fed for the address\n\n\nfunction checkReadTraps(offset) {\n  // Cache globals used multiple times for performance\n  var videoRamLocation = Memory.videoRamLocation; // Try to break early for most common scenario\n\n  if (offset < videoRamLocation) {\n    return -1;\n  } // Check the graphics mode to see if we can read VRAM\n  // http://gbdev.gg8.se/wiki/articles/Video_Display#Accessing_VRAM_and_OAM\n\n\n  if (offset >= videoRamLocation && offset < Memory.cartridgeRamLocation) {\n    // Can only read/write from VRAM During Modes 0 - 2\n    // See graphics/lcd.ts\n    // TODO: This can do more harm than good in a beta emulator,\n    // requres precise timing, disabling for now\n    // if (Graphics.currentLcdMode > 2) {\n    //   return 0xFF;\n    // }\n    return -1;\n  } // ECHO Ram, E000\tFDFF\tMirror of C000~DDFF (ECHO RAM)\n  // http://gbdev.gg8.se/wiki/articles/Memory_Map\n\n\n  if (offset >= Memory.echoRamLocation && offset < Memory.spriteInformationTableLocation) {\n    // Simply return the mirror'd value\n    return eightBitLoadFromGBMemory(offset - 0x2000);\n  } // Check for individal writes\n  // Can only read/write from OAM During Modes 0 - 1\n  // See graphics/lcd.ts\n\n\n  if (offset >= Memory.spriteInformationTableLocation && offset <= Memory.spriteInformationTableLocationEnd) {\n    // Can only read/write from OAM During Mode 2\n    // See graphics/lcd.ts\n    if (Lcd.currentLcdMode < 2) {\n      return 0xff;\n    } // Not batch processing here for performance\n    // batchProcessGraphics();\n\n\n    return -1;\n  } // CPU\n\n\n  if (offset === Cpu.memoryLocationSpeedSwitch) {\n    // TCAGBD, only Bit 7 and 0 are readable, all others are 1\n    var response = 0xff;\n    var currentSpeedSwitchRegister = eightBitLoadFromGBMemory(Cpu.memoryLocationSpeedSwitch);\n\n    if (!checkBitOnByte(0, currentSpeedSwitchRegister)) {\n      response = resetBitOnByte(0, response);\n    }\n\n    if (!Cpu.GBCDoubleSpeed) {\n      response = resetBitOnByte(7, response);\n    }\n\n    return response;\n  } // Graphics\n  // Not batch processing here for performance\n  // batchProcessGraphics();\n\n\n  if (offset === Graphics.memoryLocationScanlineRegister) {\n    eightBitStoreIntoGBMemory(offset, Graphics.scanlineRegister);\n    return Graphics.scanlineRegister;\n  } // Sound\n  // http://gbdev.gg8.se/wiki/articles/Gameboy_sound_hardware#Registers\n  // TODO: Put these bounds on the Sound Class\n\n\n  if (offset >= 0xff10 && offset <= 0xff26) {\n    batchProcessAudio();\n    return SoundRegisterReadTraps(offset);\n  } // FF27 - FF2F not used\n  // Final Wave Table for Channel 3\n\n\n  if (offset >= 0xff30 && offset <= 0xff3f) {\n    batchProcessAudio();\n    return -1;\n  } // Timers\n\n\n  if (offset === Timers.memoryLocationDividerRegister) {\n    // Divider register in memory is just the upper 8 bits\n    // http://gbdev.gg8.se/wiki/articles/Timer_Obscure_Behaviour\n    var upperDividerRegisterBits = splitHighByte(Timers.dividerRegister);\n    eightBitStoreIntoGBMemory(offset, upperDividerRegisterBits);\n    return upperDividerRegisterBits;\n  }\n\n  if (offset === Timers.memoryLocationTimerCounter) {\n    eightBitStoreIntoGBMemory(offset, Timers.timerCounter);\n    return Timers.timerCounter;\n  } // Interrupts\n\n\n  if (offset === Interrupts.memoryLocationInterruptRequest) {\n    // TCAGB and BGB say the top 5 bits are always 1.\n    return 0xe0 | Interrupts.interruptsRequestedValue;\n  } // Joypad\n\n\n  if (offset === Joypad.memoryLocationJoypadRegister) {\n    return getJoypadState();\n  }\n\n  return -1;\n} // Load/Read functionality for memory\n\n\nfunction eightBitLoadFromGBMemory(gameboyOffset) {\n  return load(getWasmBoyOffsetFromGameBoyOffset(gameboyOffset));\n}\n\nfunction eightBitLoadFromGBMemoryWithTraps(offset) {\n  var readTrapResult = checkReadTraps(offset);\n\n  switch (readTrapResult) {\n    case -1:\n      return eightBitLoadFromGBMemory(offset);\n\n    default:\n      return readTrapResult;\n  }\n} // TODO: Rename this to sixteenBitLoadFromGBMemoryWithTraps\n\n\nfunction sixteenBitLoadFromGBMemory(offset) {\n  // Get our low byte\n  var lowByte = 0;\n  var lowByteReadTrapResult = checkReadTraps(offset);\n\n  switch (lowByteReadTrapResult) {\n    case -1:\n      lowByte = eightBitLoadFromGBMemory(offset);\n      break;\n\n    default:\n      lowByte = lowByteReadTrapResult;\n      break;\n  } // Get the next offset for the second byte\n\n\n  var nextOffset = offset + 1; // Get our high byte\n\n  var highByte = 0;\n  var highByteReadTrapResult = checkReadTraps(nextOffset);\n\n  switch (highByteReadTrapResult) {\n    case -1:\n      highByte = eightBitLoadFromGBMemory(nextOffset);\n      break;\n\n    default:\n      highByte = highByteReadTrapResult;\n      break;\n  } // Concatenate the bytes and return\n\n\n  return concatenateBytes(highByte, lowByte);\n}\n\nfunction loadBooleanDirectlyFromWasmMemory(offset) {\n  var booleanAsInt = load(offset);\n\n  if (booleanAsInt > 0) {\n    return true;\n  }\n\n  return false;\n}\n\nvar Memory =\n/** @class */\nfunction () {\n  function Memory() {} // Function to save the state of the class\n\n\n  Memory.saveState = function () {\n    store(getSaveStateMemoryOffset(0x00, Memory.saveStateSlot), Memory.currentRomBank);\n    store(getSaveStateMemoryOffset(0x02, Memory.saveStateSlot), Memory.currentRamBank);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x04, Memory.saveStateSlot), Memory.isRamBankingEnabled);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x05, Memory.saveStateSlot), Memory.isMBC1RomModeEnabled);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x06, Memory.saveStateSlot), Memory.isRomOnly);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x07, Memory.saveStateSlot), Memory.isMBC1);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x08, Memory.saveStateSlot), Memory.isMBC2);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x09, Memory.saveStateSlot), Memory.isMBC3);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x0a, Memory.saveStateSlot), Memory.isMBC5);\n  }; // Function to load the save state from memory\n\n\n  Memory.loadState = function () {\n    Memory.currentRomBank = load(getSaveStateMemoryOffset(0x00, Memory.saveStateSlot));\n    Memory.currentRamBank = load(getSaveStateMemoryOffset(0x02, Memory.saveStateSlot));\n    Memory.isRamBankingEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x04, Memory.saveStateSlot));\n    Memory.isMBC1RomModeEnabled = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x05, Memory.saveStateSlot));\n    Memory.isRomOnly = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x06, Memory.saveStateSlot));\n    Memory.isMBC1 = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x07, Memory.saveStateSlot));\n    Memory.isMBC2 = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x08, Memory.saveStateSlot));\n    Memory.isMBC3 = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x09, Memory.saveStateSlot));\n    Memory.isMBC5 = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x0a, Memory.saveStateSlot));\n  }; // ----------------------------------\n  // Gameboy Memory Map\n  // ----------------------------------\n  // https://github.com/AntonioND/giibiiadvance/blob/master/docs/TCAGBD.pdf\n  // http://gameboy.mongenel.com/dmg/asmmemmap.html\n  // using Arrays, first index is start, second is end\n\n\n  Memory.cartridgeRomLocation = 0x0000;\n  Memory.switchableCartridgeRomLocation = 0x4000;\n  Memory.videoRamLocation = 0x8000;\n  Memory.cartridgeRamLocation = 0xa000;\n  Memory.internalRamBankZeroLocation = 0xc000; // This ram bank is switchable\n\n  Memory.internalRamBankOneLocation = 0xd000;\n  Memory.echoRamLocation = 0xe000;\n  Memory.spriteInformationTableLocation = 0xfe00;\n  Memory.spriteInformationTableLocationEnd = 0xfe9f;\n  Memory.unusableMemoryLocation = 0xfea0;\n  Memory.unusableMemoryEndLocation = 0xfeff; // Hardware I/O, 0xFF00 -> 0xFF7F\n  // Zero Page, 0xFF80 -> 0xFFFE\n  // Intterupt Enable Flag, 0xFFFF\n  // ----------------------------------\n  // Rom/Ram Banking\n  // ----------------------------------\n  // http://gbdev.gg8.se/wiki/articles/Memory_Bank_Controllers#MBC3_.28max_2MByte_ROM_and.2For_32KByte_RAM_and_Timer.29\n  // http://www.codeslinger.co.uk/pages/projects/gameboy/banking.html\n\n  Memory.currentRomBank = 0x00;\n  Memory.currentRamBank = 0x00;\n  Memory.isRamBankingEnabled = false;\n  Memory.isMBC1RomModeEnabled = true; // Cartridge Types\n  // http://gbdev.gg8.se/wiki/articles/The_Cartridge_Header\n\n  Memory.isRomOnly = true;\n  Memory.isMBC1 = false;\n  Memory.isMBC2 = false;\n  Memory.isMBC3 = false;\n  Memory.isMBC5 = false; // DMA\n\n  Memory.memoryLocationHdmaSourceHigh = 0xff51;\n  Memory.memoryLocationHdmaSourceLow = 0xff52;\n  Memory.memoryLocationHdmaDestinationHigh = 0xff53;\n  Memory.memoryLocationHdmaDestinationLow = 0xff54;\n  Memory.memoryLocationHdmaTrigger = 0xff55; // Cycles accumulated for DMA\n\n  Memory.DMACycles = 0; // Boolean we will mirror to indicate if Hdma is active\n\n  Memory.isHblankHdmaActive = false;\n  Memory.hblankHdmaTransferLengthRemaining = 0x00; // Store the source and destination for performance, and update as needed\n\n  Memory.hblankHdmaSource = 0x00;\n  Memory.hblankHdmaDestination = 0x00; // GBC Registers\n\n  Memory.memoryLocationGBCVRAMBank = 0xff4f;\n  Memory.memoryLocationGBCWRAMBank = 0xff70; // Save States\n\n  Memory.saveStateSlot = 4;\n  return Memory;\n}();\n\nfunction initializeCartridge() {\n  // Reset stateful variables\n  Memory.isRamBankingEnabled = false;\n  Memory.isMBC1RomModeEnabled = true; // Get our game MBC type from the cartridge header\n  // http://gbdev.gg8.se/wiki/articles/The_Cartridge_Header\n\n  var cartridgeType = eightBitLoadFromGBMemory(0x0147); // Reset our Cartridge types\n\n  Memory.isRomOnly = false;\n  Memory.isMBC1 = false;\n  Memory.isMBC2 = false;\n  Memory.isMBC3 = false;\n  Memory.isMBC5 = false;\n\n  if (cartridgeType === 0x00) {\n    Memory.isRomOnly = true;\n  } else if (cartridgeType >= 0x01 && cartridgeType <= 0x03) {\n    Memory.isMBC1 = true;\n  } else if (cartridgeType >= 0x05 && cartridgeType <= 0x06) {\n    Memory.isMBC2 = true;\n  } else if (cartridgeType >= 0x0f && cartridgeType <= 0x13) {\n    Memory.isMBC3 = true;\n  } else if (cartridgeType >= 0x19 && cartridgeType <= 0x1e) {\n    Memory.isMBC5 = true;\n  }\n\n  Memory.currentRomBank = 0x01;\n  Memory.currentRamBank = 0x00;\n} // WasmBoy memory map:\n// Everything Static as class instances just aren't quite there yet\n// https://github.com/AssemblyScript/assemblyscript/blob/master/tests/compiler/showcase.ts\n\n\nvar Cpu =\n/** @class */\nfunction () {\n  function Cpu() {}\n\n  Cpu.CLOCK_SPEED = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      // 2^23, thanks binji!\n      return 8388608;\n    }\n\n    return 4194304;\n  }; // Cycles Per Frame = Clock Speed / fps\n  // So: 4194304 / 59.73\n\n\n  Cpu.MAX_CYCLES_PER_FRAME = function () {\n    if (Cpu.GBCDoubleSpeed) {\n      return 140448;\n    }\n\n    return 70224;\n  }; // See section 4.10 of TCAGBD\n  // Cpu Halting explained: https://www.reddit.com/r/EmuDev/comments/5ie3k7/infinite_loop_trying_to_pass_blarggs_interrupt/db7xnbe/\n\n\n  Cpu.enableHalt = function () {\n    if (Interrupts.masterInterruptSwitch) {\n      Cpu.isHaltNormal = true;\n      return;\n    }\n\n    var haltTypeValue = Interrupts.interruptsEnabledValue & Interrupts.interruptsRequestedValue & 0x1f;\n\n    if (haltTypeValue === 0) {\n      Cpu.isHaltNoJump = true;\n      return;\n    }\n\n    Cpu.isHaltBug = true;\n  };\n\n  Cpu.exitHaltAndStop = function () {\n    Cpu.isHaltNoJump = false;\n    Cpu.isHaltNormal = false;\n    Cpu.isHaltBug = false;\n    Cpu.isStopped = false;\n  };\n\n  Cpu.isHalted = function () {\n    if (Cpu.isHaltNormal || Cpu.isHaltNoJump) {\n      return true;\n    }\n\n    return false;\n  }; // Function to save the state of the class\n\n\n  Cpu.saveState = function () {\n    // Registers\n    store(getSaveStateMemoryOffset(0x00, Cpu.saveStateSlot), Cpu.registerA);\n    store(getSaveStateMemoryOffset(0x01, Cpu.saveStateSlot), Cpu.registerB);\n    store(getSaveStateMemoryOffset(0x02, Cpu.saveStateSlot), Cpu.registerC);\n    store(getSaveStateMemoryOffset(0x03, Cpu.saveStateSlot), Cpu.registerD);\n    store(getSaveStateMemoryOffset(0x04, Cpu.saveStateSlot), Cpu.registerE);\n    store(getSaveStateMemoryOffset(0x05, Cpu.saveStateSlot), Cpu.registerH);\n    store(getSaveStateMemoryOffset(0x06, Cpu.saveStateSlot), Cpu.registerL);\n    store(getSaveStateMemoryOffset(0x07, Cpu.saveStateSlot), Cpu.registerF);\n    store(getSaveStateMemoryOffset(0x08, Cpu.saveStateSlot), Cpu.stackPointer);\n    store(getSaveStateMemoryOffset(0x0a, Cpu.saveStateSlot), Cpu.programCounter);\n    store(getSaveStateMemoryOffset(0x0c, Cpu.saveStateSlot), Cpu.currentCycles);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x11, Cpu.saveStateSlot), Cpu.isHaltNormal);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x12, Cpu.saveStateSlot), Cpu.isHaltNoJump);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x13, Cpu.saveStateSlot), Cpu.isHaltBug);\n    storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0x14, Cpu.saveStateSlot), Cpu.isStopped);\n  }; // Function to load the save state from memory\n\n\n  Cpu.loadState = function () {\n    // Registers\n    Cpu.registerA = load(getSaveStateMemoryOffset(0x00, Cpu.saveStateSlot));\n    Cpu.registerB = load(getSaveStateMemoryOffset(0x01, Cpu.saveStateSlot));\n    Cpu.registerC = load(getSaveStateMemoryOffset(0x02, Cpu.saveStateSlot));\n    Cpu.registerD = load(getSaveStateMemoryOffset(0x03, Cpu.saveStateSlot));\n    Cpu.registerE = load(getSaveStateMemoryOffset(0x04, Cpu.saveStateSlot));\n    Cpu.registerH = load(getSaveStateMemoryOffset(0x05, Cpu.saveStateSlot));\n    Cpu.registerL = load(getSaveStateMemoryOffset(0x06, Cpu.saveStateSlot));\n    Cpu.registerF = load(getSaveStateMemoryOffset(0x07, Cpu.saveStateSlot));\n    Cpu.stackPointer = load(getSaveStateMemoryOffset(0x08, Cpu.saveStateSlot));\n    Cpu.programCounter = load(getSaveStateMemoryOffset(0x0a, Cpu.saveStateSlot));\n    Cpu.currentCycles = load(getSaveStateMemoryOffset(0x0c, Cpu.saveStateSlot));\n    Cpu.isHaltNormal = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x11, Cpu.saveStateSlot));\n    Cpu.isHaltNoJump = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x12, Cpu.saveStateSlot));\n    Cpu.isHaltBug = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x13, Cpu.saveStateSlot));\n    Cpu.isStopped = loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0x14, Cpu.saveStateSlot));\n  }; // Status to track if we are in Gameboy Color Mode, and GBC State\n\n\n  Cpu.GBCEnabled = false; // Memory Location for the GBC Speed switch\n  // And the current status\n\n  Cpu.memoryLocationSpeedSwitch = 0xff4d;\n  Cpu.GBCDoubleSpeed = false; // 8-bit Cpu.registers\n\n  Cpu.registerA = 0;\n  Cpu.registerB = 0;\n  Cpu.registerC = 0;\n  Cpu.registerD = 0;\n  Cpu.registerE = 0;\n  Cpu.registerH = 0;\n  Cpu.registerL = 0;\n  Cpu.registerF = 0; // 16-bit Cpu.registers\n\n  Cpu.stackPointer = 0; // Boot rom from 0x00 to 0x99, all games start at 0x100\n\n  Cpu.programCounter = 0x00; // Current number of cycles, shouldn't execeed max number of cycles\n\n  Cpu.currentCycles = 0; // HALT and STOP instructions need to stop running opcodes, but simply check timers\n  // https://github.com/nakardo/node-gameboy/blob/master/lib/cpu/opcodes.js\n  // Matt said is should work to, so it must work!\n  // TCAGBD shows three different HALT states. Therefore, we need to handle each\n\n  Cpu.isHaltNormal = false;\n  Cpu.isHaltNoJump = false;\n  Cpu.isHaltBug = false;\n  Cpu.isStopped = false; // Save States\n\n  Cpu.saveStateSlot = 0;\n  return Cpu;\n}();\n\nfunction initializeCpu() {\n  // Reset all stateful Cpu variables\n  // Cpu.GBCEnabled is done by core/initialize\n  Cpu.GBCDoubleSpeed = false;\n  Cpu.registerA = 0;\n  Cpu.registerB = 0;\n  Cpu.registerC = 0;\n  Cpu.registerD = 0;\n  Cpu.registerE = 0;\n  Cpu.registerH = 0;\n  Cpu.registerL = 0;\n  Cpu.registerF = 0;\n  Cpu.stackPointer = 0;\n  Cpu.programCounter = 0x00;\n  Cpu.currentCycles = 0;\n  Cpu.isHaltNormal = false;\n  Cpu.isHaltNoJump = false;\n  Cpu.isHaltBug = false;\n  Cpu.isStopped = false;\n\n  if (Cpu.GBCEnabled) {\n    // CPU Registers\n    Cpu.registerA = 0x11;\n    Cpu.registerF = 0x80;\n    Cpu.registerB = 0x00;\n    Cpu.registerC = 0x00;\n    Cpu.registerD = 0xff;\n    Cpu.registerE = 0x56;\n    Cpu.registerH = 0x00;\n    Cpu.registerL = 0x0d; // Cpu Control Flow\n\n    Cpu.programCounter = 0x100;\n    Cpu.stackPointer = 0xfffe;\n  } else {\n    // Cpu Registers\n    Cpu.registerA = 0x01;\n    Cpu.registerF = 0xb0;\n    Cpu.registerB = 0x00;\n    Cpu.registerC = 0x13;\n    Cpu.registerD = 0x00;\n    Cpu.registerE = 0xd8;\n    Cpu.registerH = 0x01;\n    Cpu.registerL = 0x4d; // Cpu Control Flow\n\n    Cpu.programCounter = 0x100;\n    Cpu.stackPointer = 0xfffe;\n  }\n} // Imports\n// General Logic Instructions\n// Such as the ones found on the CB table and 0x40 - 0xBF\n// NOTE: Only CB table uses these for now, was mostly me realizing that I messed up, trying to be all cute and verbose :p\n// NOTE: TODO: Refactor honestly shouldn't take that long, and may happen once assembly script is improved\n\n\nfunction addARegister(register) {\n  checkAndSetEightBitHalfCarryFlag(Cpu.registerA, register);\n  checkAndSetEightBitCarryFlag(Cpu.registerA, register);\n  Cpu.registerA = u8Portable(Cpu.registerA + register);\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n}\n\nfunction addAThroughCarryRegister(register) {\n  // Handling flags manually as they require some special overflow\n  // From: https://github.com/nakardo/node-gameboy/blob/master/lib/cpu/opcodes.js\n  // CTRL+F adc\n  var result = u8Portable(Cpu.registerA + register + getCarryFlag$$1());\n\n  if ((u8Portable(Cpu.registerA ^ register ^ result) & 0x10) != 0) {\n    setHalfCarryFlag(1);\n  } else {\n    setHalfCarryFlag(0);\n  }\n\n  var overflowedResult = u16Portable(Cpu.registerA + register + getCarryFlag$$1());\n\n  if ((overflowedResult & 0x100) > 0) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  Cpu.registerA = result;\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n}\n\nfunction subARegister(register) {\n  // Need to convert the register on one line, and flip the sign on another\n  var negativeRegister = register;\n  negativeRegister = negativeRegister * -1;\n  checkAndSetEightBitHalfCarryFlag(Cpu.registerA, negativeRegister);\n  checkAndSetEightBitCarryFlag(Cpu.registerA, negativeRegister);\n  Cpu.registerA = u8Portable(Cpu.registerA - register);\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(1);\n}\n\nfunction subAThroughCarryRegister(register) {\n  // Handling flags manually as they require some special overflow\n  // From: https://github.com/nakardo/node-gameboy/blob/master/lib/cpu/opcodes.js\n  // CTRL+F adc\n  var result = u8Portable(Cpu.registerA - register - getCarryFlag$$1());\n  var carryRegisterCheck = u8Portable((Cpu.registerA ^ register ^ result) & 0x10);\n\n  if (carryRegisterCheck != 0) {\n    setHalfCarryFlag(1);\n  } else {\n    setHalfCarryFlag(0);\n  }\n\n  var overflowedResult = u16Portable(Cpu.registerA - register - getCarryFlag$$1());\n\n  if ((overflowedResult & 0x100) > 0) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  Cpu.registerA = result;\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(1);\n}\n\nfunction andARegister(register) {\n  Cpu.registerA = Cpu.registerA & register;\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(1);\n  setCarryFlag(0);\n}\n\nfunction xorARegister(register) {\n  Cpu.registerA = u8Portable(Cpu.registerA ^ register);\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n  setCarryFlag(0);\n}\n\nfunction orARegister(register) {\n  Cpu.registerA = Cpu.registerA | register;\n\n  if (Cpu.registerA === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n  setCarryFlag(0);\n}\n\nfunction cpARegister(register) {\n  // 0xB8 - 0xBF\n  // CP B\n  // 1  4\n  // Z 1 H C\n  var negativeRegister = register;\n  negativeRegister = negativeRegister * -1;\n  checkAndSetEightBitHalfCarryFlag(Cpu.registerA, negativeRegister);\n  checkAndSetEightBitCarryFlag(Cpu.registerA, negativeRegister);\n  var tempResult = Cpu.registerA + negativeRegister;\n\n  if (tempResult === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(1);\n}\n\nfunction rotateRegisterLeft(register) {\n  // RLC register 8-bit\n  // Z 0 0 C\n  if ((register & 0x80) === 0x80) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  register = rotateByteLeft(register);\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  } // Set all other flags to zero\n\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0); // Return the register\n\n  return register;\n}\n\nfunction rotateRegisterRight(register) {\n  // RLC register 8-bit\n  // Z 0 0 C\n  // Check for the last bit, to see if it will be carried\n  if ((register & 0x01) > 0) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  register = rotateByteRight(register);\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0); // Return the register\n\n  return register;\n}\n\nfunction rotateRegisterLeftThroughCarry(register) {\n  // RL register 8-bit\n  // Z 0 0 C\n  // setting has first bit since we need to use carry\n  var hasHighbit = false;\n\n  if ((register & 0x80) === 0x80) {\n    hasHighbit = true;\n  }\n\n  register = rotateByteLeftThroughCarry(register);\n\n  if (hasHighbit) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n  return register;\n}\n\nfunction rotateRegisterRightThroughCarry(register) {\n  // RR register 8-bit\n  // Z 0 0 C\n  var hasLowBit = false;\n\n  if ((register & 0x01) === 0x01) {\n    hasLowBit = true;\n  }\n\n  register = rotateByteRightThroughCarry(register);\n\n  if (hasLowBit) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n  return register;\n}\n\nfunction shiftLeftRegister(register) {\n  // SLA register 8-bit\n  // Z 0 0 C\n  var hasHighbit = false;\n\n  if ((register & 0x80) === 0x80) {\n    hasHighbit = true;\n  }\n\n  register = u8Portable(register << 1);\n\n  if (hasHighbit) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n  return register;\n}\n\nfunction shiftRightArithmeticRegister(register) {\n  // SRA register 8-bit\n  // Z 0 0 C\n  // NOTE: This C flag may need to be set to 0;\n  // This preserves the MSB (Most significant bit)\n  var hasHighbit = false;\n\n  if ((register & 0x80) === 0x80) {\n    hasHighbit = true;\n  }\n\n  var hasLowbit = false;\n\n  if ((register & 0x01) === 0x01) {\n    hasLowbit = true;\n  }\n\n  register = u8Portable(register >> 1);\n\n  if (hasHighbit) {\n    register = register | 0x80;\n  }\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n\n  if (hasLowbit) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  return register;\n}\n\nfunction swapNibblesOnRegister(register) {\n  // SWAP register 8-bit\n  // Z 0 0 0\n  var highNibble = register & 0xf0;\n  var lowNibble = register & 0x0f;\n  register = u8Portable(lowNibble << 4 | highNibble >> 4);\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n  setCarryFlag(0);\n  return register;\n}\n\nfunction shiftRightLogicalRegister(register) {\n  // SRA register 8-bit\n  // Z 0 0 C\n  // NOTE: This C flag may need to be set to 0;\n  // This does NOT preserve MSB (most significant bit)\n  var hasLowbit = false;\n\n  if ((register & 0x01) === 0x01) {\n    hasLowbit = true;\n  }\n\n  register = u8Portable(register >> 1);\n\n  if (register === 0) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(0);\n\n  if (hasLowbit) {\n    setCarryFlag(1);\n  } else {\n    setCarryFlag(0);\n  }\n\n  return register;\n}\n\nfunction testBitOnRegister(bitPosition, register) {\n  // BIT bitPosition ,register 8-bit\n  // Z 0 1 -\n  var testByte = 0x01 << bitPosition;\n  var result = register & testByte;\n\n  if (result === 0x00) {\n    setZeroFlag$$1(1);\n  } else {\n    setZeroFlag$$1(0);\n  }\n\n  setSubtractFlag(0);\n  setHalfCarryFlag(1);\n  return register;\n}\n\nfunction setBitOnRegister(bitPosition, bitValue, register) {\n  // RES 0,B or SET 0,B depending on bit value\n  if (bitValue > 0) {\n    var setByte = 0x01 << bitPosition;\n    register = register | setByte;\n  } else {\n    // NOT (byte we want)\n    // 0000 0100 becomes 1111 1011\n    var setByte = ~(0x01 << bitPosition);\n    register = register & setByte;\n  }\n\n  return register;\n} // Private function for our relative jumps\n\n\nfunction relativeJump(value) {\n  // Need to convert the value to i8, since in this case, u8 can be negative\n  var relativeJumpOffset = i8Portable(value);\n  Cpu.programCounter = u16Portable(Cpu.programCounter + relativeJumpOffset); // Realtive jump, using bgb debugger\n  // and my debugger shows,\n  // on JR you need to jump to the relative jump offset,\n  // However, if the jump fails (such as conditional), only jump +2 in total\n\n  Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n} // Imports\n// Handle CB Opcodes\n// NOTE: Program stpes and cycles are standardized depending on the register type\n// NOTE: Doing some funny stuff to get around not having arrays or objects\n\n\nfunction handleCbOpcode(cbOpcode) {\n  var numberOfCycles = -1;\n  var handledOpcode = false; // The result of our cb logic instruction\n\n  var instructionRegisterValue = 0;\n  var instructionRegisterResult = 0; // Get our register number by modulo 0x08 (number of registers)\n  // cbOpcode % 0x08\n\n  var registerNumber = cbOpcode % 0x08; // NOTE: registerNumber = register on CB table. Cpu.registerB = 0, Cpu.registerC = 1....Cpu.registerA = 7\n\n  switch (registerNumber) {\n    case 0:\n      instructionRegisterValue = Cpu.registerB;\n      break;\n\n    case 1:\n      instructionRegisterValue = Cpu.registerC;\n      break;\n\n    case 2:\n      instructionRegisterValue = Cpu.registerD;\n      break;\n\n    case 3:\n      instructionRegisterValue = Cpu.registerE;\n      break;\n\n    case 4:\n      instructionRegisterValue = Cpu.registerH;\n      break;\n\n    case 5:\n      instructionRegisterValue = Cpu.registerL;\n      break;\n\n    case 6:\n      // Value at register HL\n      // 4 cycles\n      instructionRegisterValue = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      break;\n\n    case 7:\n      instructionRegisterValue = Cpu.registerA;\n      break;\n  } // Grab the high nibble to perform skips to speed up performance\n\n\n  var opcodeHighNibble = cbOpcode & 0xf0;\n  opcodeHighNibble = opcodeHighNibble >> 4; // Send to the correct function\n\n  switch (opcodeHighNibble) {\n    case 0x00:\n      if (cbOpcode <= 0x07) {\n        // RLC register 8-bit\n        // Z 0 0 C\n        instructionRegisterResult = rotateRegisterLeft(instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x0f) {\n        // RRC register 8-bit\n        // Z 0 0 C\n        instructionRegisterResult = rotateRegisterRight(instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x01:\n      if (cbOpcode <= 0x17) {\n        // RL register 8-bit\n        // Z 0 0 C\n        instructionRegisterResult = rotateRegisterLeftThroughCarry(instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x1f) {\n        // RR register 8-bit\n        // Z 0 0 C\n        instructionRegisterResult = rotateRegisterRightThroughCarry(instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x02:\n      if (cbOpcode <= 0x27) {\n        // SLA register 8-bit\n        // Z 0 0 C\n        instructionRegisterResult = shiftLeftRegister(instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x2f) {\n        // SRA register 8-bit\n        // Z 0 0 0\n        instructionRegisterResult = shiftRightArithmeticRegister(instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x03:\n      if (cbOpcode <= 0x37) {\n        // SWAP register 8-bit\n        // Z 0 0 0\n        instructionRegisterResult = swapNibblesOnRegister(instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x3f) {\n        // SRL B\n        // Z 0 0 C\n        instructionRegisterResult = shiftRightLogicalRegister(instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x04:\n      if (cbOpcode <= 0x47) {\n        // BIT 0,register 8-bit\n        // Z 0 1 -\n        //TODO: Optimize this not to do logic of setting register back\n        instructionRegisterResult = testBitOnRegister(0, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x4f) {\n        // BIT 1,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(1, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x05:\n      if (cbOpcode <= 0x57) {\n        // BIT 2,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(2, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x5f) {\n        // BIT 3,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(3, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x06:\n      if (cbOpcode <= 0x67) {\n        // BIT 4,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(4, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x6f) {\n        // BIT 5,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(5, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x07:\n      if (cbOpcode <= 0x77) {\n        // BIT 6,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(6, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x7f) {\n        // BIT 7,register 8-bit\n        // Z 0 1 -\n        instructionRegisterResult = testBitOnRegister(7, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x08:\n      if (cbOpcode <= 0x87) {\n        // Res 0,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(0, 0, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x8f) {\n        // Res 1,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(1, 0, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x09:\n      if (cbOpcode <= 0x97) {\n        // Res 2,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(2, 0, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0x9f) {\n        // Res 3,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(3, 0, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x0a:\n      if (cbOpcode <= 0xa7) {\n        // Res 4,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(4, 0, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0xaf) {\n        // Res 5,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(5, 0, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x0b:\n      if (cbOpcode <= 0xb7) {\n        // Res 6,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(6, 0, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0xbf) {\n        // Res 7,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(7, 0, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x0c:\n      if (cbOpcode <= 0xc7) {\n        // SET 0,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(0, 1, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0xcf) {\n        // SET 1,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(1, 1, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x0d:\n      if (cbOpcode <= 0xd7) {\n        // SET 2,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(2, 1, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0xdf) {\n        // SET 3,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(3, 1, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x0e:\n      if (cbOpcode <= 0xe7) {\n        // SET 4,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(4, 1, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0xef) {\n        // SET 5,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(5, 1, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n\n    case 0x0f:\n      if (cbOpcode <= 0xf7) {\n        // SET 6,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(6, 1, instructionRegisterValue);\n        handledOpcode = true;\n      } else if (cbOpcode <= 0xff) {\n        // SET 7,register 8-bit\n        // - - - -\n        instructionRegisterResult = setBitOnRegister(7, 1, instructionRegisterValue);\n        handledOpcode = true;\n      }\n\n      break;\n  } // Finally Pass back into the correct register\n\n\n  switch (registerNumber) {\n    case 0:\n      Cpu.registerB = instructionRegisterResult;\n      break;\n\n    case 1:\n      Cpu.registerC = instructionRegisterResult;\n      break;\n\n    case 2:\n      Cpu.registerD = instructionRegisterResult;\n      break;\n\n    case 3:\n      Cpu.registerE = instructionRegisterResult;\n      break;\n\n    case 4:\n      Cpu.registerH = instructionRegisterResult;\n      break;\n\n    case 5:\n      Cpu.registerL = instructionRegisterResult;\n      break;\n\n    case 6:\n      // Value at register HL\n      // Opcodes 0x40 -> 0x7F only do simple\n      // Bit test, and don't need to be stored back in memory\n      // Thus they take 4 less cycles to run\n      if (opcodeHighNibble < 0x04 || opcodeHighNibble > 0x07) {\n        // Store the result back\n        // 4 cycles\n        eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), instructionRegisterResult);\n      }\n\n      break;\n\n    case 7:\n      Cpu.registerA = instructionRegisterResult;\n      break;\n  } // Finally our number of cycles\n  // Set if we handled the opcode\n\n\n  if (handledOpcode) {\n    numberOfCycles = 4;\n  } // Return our number of cycles\n\n\n  return numberOfCycles;\n} // Imports\n// Take in any opcode, and decode it, and return the number of cycles\n// Program counter can be gotten from getProgramCounter();\n// Setting return value to i32 instead of u16, as we want to return a negative number on error\n// https://rednex.github.io/rgbds/gbz80.7.html\n// http://pastraiser.com/cpu/gameboy/gameboyopcodes.html\n\n\nfunction executeOpcode$$1(opcode) {\n  // Always implement the program counter by one\n  // Any other value can just subtract or add however much offset before reaching this line\n  Cpu.programCounter = u16Portable(Cpu.programCounter + 1); // Check if we are in the halt bug\n\n  if (Cpu.isHaltBug) {\n    // Need to not increment program counter,\n    // thus, running the next opcode twice\n    // E.g\n    // 0x76 - halt\n    // FA 34 12 - ld a,(1234)\n    // Becomes\n    // FA FA 34 ld a,(34FA)\n    // 12 ld (de),a\n    Cpu.programCounter = u16Portable(Cpu.programCounter - 1);\n  } // Split our opcode into a high nibble to speed up performance\n  // Running 255 if statements is slow, even in wasm haha!\n\n\n  var opcodeHighNibble = opcode & 0xf0;\n  opcodeHighNibble = opcodeHighNibble >> 4; // NOTE: @binji rule of thumb: it takes 4 cpu cycles to read one byte\n  // Therefore isntructions that use more than just the opcode (databyte one and two) will take at least\n  // 8 cyckles to use getDataByteOne(), and two cycles to use the concatented\n  // Not using a switch statement to avoid cannot redeclare this variable errors\n  // And it would be a ton of work :p\n\n  switch (opcodeHighNibble) {\n    case 0x00:\n      return handleOpcode0x(opcode);\n\n    case 0x01:\n      return handleOpcode1x(opcode);\n\n    case 0x02:\n      return handleOpcode2x(opcode);\n\n    case 0x03:\n      return handleOpcode3x(opcode);\n\n    case 0x04:\n      return handleOpcode4x(opcode);\n\n    case 0x05:\n      return handleOpcode5x(opcode);\n\n    case 0x06:\n      return handleOpcode6x(opcode);\n\n    case 0x07:\n      return handleOpcode7x(opcode);\n\n    case 0x08:\n      return handleOpcode8x(opcode);\n\n    case 0x09:\n      return handleOpcode9x(opcode);\n\n    case 0x0a:\n      return handleOpcodeAx(opcode);\n\n    case 0x0b:\n      return handleOpcodeBx(opcode);\n\n    case 0x0c:\n      return handleOpcodeCx(opcode);\n\n    case 0x0d:\n      return handleOpcodeDx(opcode);\n\n    case 0x0e:\n      return handleOpcodeEx(opcode);\n\n    default:\n      return handleOpcodeFx(opcode);\n  }\n} // Wrapper functions around loading and storing memory, and syncing those cycles\n\n\nfunction eightBitLoadSyncCycles(gameboyOffset) {\n  syncCycles(4);\n  return eightBitLoadFromGBMemoryWithTraps(gameboyOffset);\n}\n\nfunction eightBitStoreSyncCycles(gameboyOffset, value) {\n  syncCycles(4);\n  eightBitStoreIntoGBMemoryWithTraps(gameboyOffset, value);\n}\n\nfunction sixteenBitLoadSyncCycles(gameboyOffset) {\n  syncCycles(8); // sixteen bit load has traps even though it has no label\n\n  return sixteenBitLoadFromGBMemory(gameboyOffset);\n}\n\nfunction sixteenBitStoreSyncCycles(gameboyOffset, value) {\n  syncCycles(8);\n  sixteenBitStoreIntoGBMemoryWithTraps(gameboyOffset, value);\n} // Functions to access the next operands of a opcode, reffering to them as \"dataBytes\"\n\n\nfunction getDataByteOne() {\n  syncCycles(4);\n  return eightBitLoadFromGBMemory(Cpu.programCounter);\n}\n\nfunction getDataByteTwo() {\n  syncCycles(4);\n  return eightBitLoadFromGBMemory(u16Portable(Cpu.programCounter + 1));\n} // Get our concatenated databyte one and getDataByteTwo()\n// Find and replace with : getConcatenatedDataByte()\n\n\nfunction getConcatenatedDataByte() {\n  return concatenateBytes(getDataByteTwo(), getDataByteOne());\n}\n\nfunction handleOpcode0x(opcode) {\n  switch (opcode) {\n    case 0x00:\n      // NOP\n      // 1  4\n      // No Operation\n      return 4;\n\n    case 0x01:\n      // LD BC,d16\n      // 3  12\n      // 8 cycles\n      var concatenatedDataByte = getConcatenatedDataByte();\n      Cpu.registerB = splitHighByte(concatenatedDataByte);\n      Cpu.registerC = splitLowByte(concatenatedDataByte);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    case 0x02:\n      // LD (BC),A\n      // 1  8\n      // () means load into address pointed by BC\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerB, Cpu.registerC), Cpu.registerA);\n      return 4;\n\n    case 0x03:\n      // INC BC\n      // 1  8\n      var registerBC3 = concatenateBytes(Cpu.registerB, Cpu.registerC);\n      registerBC3++;\n      Cpu.registerB = splitHighByte(registerBC3);\n      Cpu.registerC = splitLowByte(registerBC3);\n      return 8;\n\n    case 0x04:\n      // INC B\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerB, 1);\n      Cpu.registerB = u8Portable(Cpu.registerB + 1);\n\n      if (Cpu.registerB === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x05:\n      // DEC B\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerB, -1);\n      Cpu.registerB = u8Portable(Cpu.registerB - 1);\n\n      if (Cpu.registerB === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x06:\n      // LD B,d8\n      // 2  8\n      // 4 cycles\n      Cpu.registerB = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x07:\n      // RLCA\n      // 1  4\n      // 0 0 0 C\n      // Check for the carry\n      if ((Cpu.registerA & 0x80) === 0x80) {\n        setCarryFlag(1);\n      } else {\n        setCarryFlag(0);\n      }\n\n      Cpu.registerA = rotateByteLeft(Cpu.registerA); // Set all other flags to zero\n\n      setZeroFlag$$1(0);\n      setSubtractFlag(0);\n      setHalfCarryFlag(0);\n      return 4;\n\n    case 0x08:\n      // LD (a16),SP\n      // 3  20\n      // Load the stack pointer into the 16 bit address represented by the two data bytes\n      // 16 cycles, 8 from data byte, 8 from sixteenbit store\n      sixteenBitStoreSyncCycles(getConcatenatedDataByte(), Cpu.stackPointer);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    case 0x09:\n      // ADD HL,BC\n      // 1 8\n      // - 0 H C\n      var registerHL = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      var registerBC9 = concatenateBytes(Cpu.registerB, Cpu.registerC);\n      checkAndSetSixteenBitFlagsAddOverflow(registerHL, registerBC9, false);\n      var result = u16Portable(registerHL + registerBC9);\n      Cpu.registerH = splitHighByte(result);\n      Cpu.registerL = splitLowByte(result);\n      setSubtractFlag(0);\n      return 8;\n\n    case 0x0a:\n      // LD A,(BC)\n      // 1 8\n      // 4 cycles from load\n      Cpu.registerA = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerB, Cpu.registerC));\n      return 4;\n\n    case 0x0b:\n      // DEC BC\n      // 1  8\n      var registerBCB = concatenateBytes(Cpu.registerB, Cpu.registerC);\n      registerBCB = u16Portable(registerBCB - 1);\n      Cpu.registerB = splitHighByte(registerBCB);\n      Cpu.registerC = splitLowByte(registerBCB);\n      return 8;\n\n    case 0x0c:\n      // INC C\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerC, 1);\n      Cpu.registerC = u8Portable(Cpu.registerC + 1);\n\n      if (Cpu.registerC === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x0d:\n      // DEC C\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerC, -1);\n      Cpu.registerC = u8Portable(Cpu.registerC - 1);\n\n      if (Cpu.registerC === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x0e:\n      // LD C,d8\n      // 2 8\n      // 4 cycles\n      Cpu.registerC = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x0f:\n      // RRCA\n      // 1 4\n      // 0 0 0 C\n      // Check for the last bit, to see if it will be carried\n      if ((Cpu.registerA & 0x01) > 0) {\n        setCarryFlag(1);\n      } else {\n        setCarryFlag(0);\n      }\n\n      Cpu.registerA = rotateByteRight(Cpu.registerA); // Set all other flags to zero\n\n      setZeroFlag$$1(0);\n      setSubtractFlag(0);\n      setHalfCarryFlag(0);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode1x(opcode) {\n  switch (opcode) {\n    case 0x10:\n      // STOP 0\n      // 2 4\n      // Enter CPU very low power mode. Also used to switch between double and normal speed CPU modes in GBC.\n      // Meaning Don't Decode anymore opcodes , or updated the LCD until joypad interrupt (or when button is pressed if I am wrong)\n      // See HALT\n      // If we are in gameboy color mode, set the new speed\n      if (Cpu.GBCEnabled) {\n        // 4 cycles\n        var speedSwitch = eightBitLoadSyncCycles(Cpu.memoryLocationSpeedSwitch);\n\n        if (checkBitOnByte(0, speedSwitch)) {\n          // Reset the prepare bit\n          speedSwitch = resetBitOnByte(0, speedSwitch); // Switch to the new mode, and set the speed switch to the OTHER speed, to represent our new speed\n\n          if (!checkBitOnByte(7, speedSwitch)) {\n            Cpu.GBCDoubleSpeed = true;\n            speedSwitch = setBitOnByte(7, speedSwitch);\n          } else {\n            Cpu.GBCDoubleSpeed = false;\n            speedSwitch = resetBitOnByte(7, speedSwitch);\n          } // Store the final speed switch\n          // 4 cycles\n\n\n          eightBitStoreSyncCycles(Cpu.memoryLocationSpeedSwitch, speedSwitch); // Cycle accurate gameboy docs says this takes 76 clocks\n          // 76 - 8 cycles (from load/store) = 68\n\n          return 68;\n        }\n      } // NOTE: This breaks Blarggs CPU tests if CGB Stop is not implemented\n\n\n      Cpu.isStopped = true;\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x11:\n      // LD DE,d16\n      // 3  12\n      // 8 cycles\n      var concatenatedDataByte = getConcatenatedDataByte();\n      Cpu.registerD = splitHighByte(concatenatedDataByte);\n      Cpu.registerE = splitLowByte(concatenatedDataByte);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    case 0x12:\n      // LD (DE),A\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerD, Cpu.registerE), Cpu.registerA);\n      return 4;\n\n    case 0x13:\n      // INC DE\n      // 1 8\n      var registerDE3 = concatenateBytes(Cpu.registerD, Cpu.registerE);\n      registerDE3 = u16Portable(registerDE3 + 1);\n      Cpu.registerD = splitHighByte(registerDE3);\n      Cpu.registerE = splitLowByte(registerDE3);\n      return 8;\n\n    case 0x14:\n      // INC D\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerD, 1);\n      Cpu.registerD = u8Portable(Cpu.registerD + 1);\n\n      if (Cpu.registerD === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x15:\n      // DEC D\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerD, -1);\n      Cpu.registerD = u8Portable(Cpu.registerD - 1);\n\n      if (Cpu.registerD === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x16:\n      // LD D,d8\n      // 2 8\n      // 4 cycles\n      Cpu.registerD = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x17:\n      // RLA\n      // 1 4\n      // 0 0 0 C\n      // Check for the carry\n      // setting has first bit since we need to use carry\n      var hasHighbit = false;\n\n      if ((Cpu.registerA & 0x80) === 0x80) {\n        hasHighbit = true;\n      }\n\n      Cpu.registerA = rotateByteLeftThroughCarry(Cpu.registerA); // OR the carry flag to the end\n\n      if (hasHighbit) {\n        setCarryFlag(1);\n      } else {\n        setCarryFlag(0);\n      } // Set all other flags to zero\n\n\n      setZeroFlag$$1(0);\n      setSubtractFlag(0);\n      setHalfCarryFlag(0);\n      return 4;\n\n    case 0x18:\n      // JR r8\n      // 2  12\n      // NOTE: Discoved dataByte is signed\n      // However the relative Jump Function handles this\n      // 4 cycles\n      relativeJump(getDataByteOne());\n      return 8;\n    // Relative Jump Function Handles program counter\n\n    case 0x19:\n      // ADD HL,DE\n      // 1  8\n      // - 0 H C\n      var registerHL = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      var registerDE9 = concatenateBytes(Cpu.registerD, Cpu.registerE);\n      checkAndSetSixteenBitFlagsAddOverflow(registerHL, registerDE9, false);\n      var result = u16Portable(registerHL + registerDE9);\n      Cpu.registerH = splitHighByte(result);\n      Cpu.registerL = splitLowByte(result);\n      setSubtractFlag(0);\n      return 8;\n\n    case 0x1a:\n      // LD A,(DE)\n      // 1 8\n      var registerDEA = concatenateBytes(Cpu.registerD, Cpu.registerE); // 4 cycles\n\n      Cpu.registerA = eightBitLoadSyncCycles(registerDEA);\n      return 4;\n\n    case 0x1b:\n      // DEC DE\n      // 1 8\n      var registerDEB = concatenateBytes(Cpu.registerD, Cpu.registerE);\n      registerDEB = u16Portable(registerDEB - 1);\n      Cpu.registerD = splitHighByte(registerDEB);\n      Cpu.registerE = splitLowByte(registerDEB);\n      return 8;\n\n    case 0x1c:\n      // INC E\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerE, 1);\n      Cpu.registerE = u8Portable(Cpu.registerE + 1);\n\n      if (Cpu.registerE === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x1d:\n      // DEC E\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerE, -1);\n      Cpu.registerE = u8Portable(Cpu.registerE - 1);\n\n      if (Cpu.registerE === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x1e:\n      // LD E,d8\n      // 2 8\n      // 4 cycles\n      Cpu.registerE = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x1f:\n      // RRA\n      // 1 4\n      // 0 0 0 C\n      // Check for the carry\n      // setting has low bit since we need to use carry\n      var hasLowBit = false;\n\n      if ((Cpu.registerA & 0x01) === 0x01) {\n        hasLowBit = true;\n      }\n\n      Cpu.registerA = rotateByteRightThroughCarry(Cpu.registerA);\n\n      if (hasLowBit) {\n        setCarryFlag(1);\n      } else {\n        setCarryFlag(0);\n      } // Set all other flags to zero\n\n\n      setZeroFlag$$1(0);\n      setSubtractFlag(0);\n      setHalfCarryFlag(0);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode2x(opcode) {\n  switch (opcode) {\n    case 0x20:\n      // JR NZ,r8\n      // 2  12/8\n      // NOTE: NZ stands for not [flag], so in this case, not zero flag\n      // Also, / means, if condition. so if met, 12 cycles, otherwise 8 cycles\n      if (getZeroFlag$$1() === 0) {\n        // 4 cycles\n        relativeJump(getDataByteOne()); // Relative Jump Funciton handles program counter\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      }\n\n      return 8;\n\n    case 0x21:\n      // LD HL,d16\n      // 3  12\n      // 8 cycles\n      var sixteenBitDataByte = getConcatenatedDataByte();\n      Cpu.registerH = splitHighByte(sixteenBitDataByte);\n      Cpu.registerL = splitLowByte(sixteenBitDataByte);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    case 0x22:\n      // LD (HL+),A\n      // 1 8\n      var registerHL2 = concatenateBytes(Cpu.registerH, Cpu.registerL); // 4 cycles\n\n      eightBitStoreSyncCycles(registerHL2, Cpu.registerA);\n      registerHL2 = u16Portable(registerHL2 + 1);\n      Cpu.registerH = splitHighByte(registerHL2);\n      Cpu.registerL = splitLowByte(registerHL2);\n      return 4;\n\n    case 0x23:\n      // INC HL\n      // 1  8\n      var registerHL3 = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      registerHL3 = u16Portable(registerHL3 + 1);\n      Cpu.registerH = splitHighByte(registerHL3);\n      Cpu.registerL = splitLowByte(registerHL3);\n      return 8;\n\n    case 0x24:\n      // INC H\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerH, 1);\n      Cpu.registerH = u8Portable(Cpu.registerH + 1);\n\n      if (Cpu.registerH === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x25:\n      // DEC H\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerH, -1);\n      Cpu.registerH = u8Portable(Cpu.registerH - 1);\n\n      if (Cpu.registerH === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x26:\n      // LD H,d8\n      // 2 8\n      // 4 cycles\n      Cpu.registerH = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x27:\n      // DAA\n      // 1 4\n      // Z - 0 C\n      var adjustedRegister = 0;\n      var adjustment = 0;\n\n      if (getHalfCarryFlag() > 0) {\n        adjustment = adjustment | 0x06;\n      }\n\n      if (getCarryFlag$$1() > 0) {\n        adjustment = adjustment | 0x60;\n      }\n\n      if (getSubtractFlag() > 0) {\n        adjustedRegister = u8Portable(Cpu.registerA - adjustment);\n      } else {\n        if ((Cpu.registerA & 0x0f) > 0x09) {\n          adjustment = adjustment | 0x06;\n        }\n\n        if (Cpu.registerA > 0x99) {\n          adjustment = adjustment | 0x60;\n        }\n\n        adjustedRegister = u8Portable(Cpu.registerA + adjustment);\n      } // Now set our flags to the correct values\n\n\n      if (adjustedRegister === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      if ((adjustment & 0x60) !== 0) {\n        setCarryFlag(1);\n      } else {\n        setCarryFlag(0);\n      }\n\n      setHalfCarryFlag(0);\n      Cpu.registerA = adjustedRegister;\n      return 4;\n\n    case 0x28:\n      // JR Z,r8\n      // 2  12/8\n      if (getZeroFlag$$1() > 0) {\n        // 4 cycles\n        relativeJump(getDataByteOne()); // Relative Jump funciton handles pogram counter\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      }\n\n      return 8;\n\n    case 0x29:\n      // ADD HL,HL\n      // 1  8\n      // - 0 H C\n      var registerHL9 = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      checkAndSetSixteenBitFlagsAddOverflow(registerHL9, registerHL9, false);\n      registerHL9 = u16Portable(registerHL9 * 2);\n      Cpu.registerH = splitHighByte(registerHL9);\n      Cpu.registerL = splitLowByte(registerHL9);\n      setSubtractFlag(0);\n      return 8;\n\n    case 0x2a:\n      // LD A,(HL+)\n      // 1  8\n      var registerHLA = concatenateBytes(Cpu.registerH, Cpu.registerL); // 4 cycles\n\n      Cpu.registerA = eightBitLoadSyncCycles(registerHLA);\n      registerHLA = u16Portable(registerHLA + 1);\n      Cpu.registerH = splitHighByte(registerHLA);\n      Cpu.registerL = splitLowByte(registerHLA);\n      return 4;\n\n    case 0x2b:\n      // DEC HL\n      // 1 8\n      var registerHLB = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      registerHLB = u16Portable(registerHLB - 1);\n      Cpu.registerH = splitHighByte(registerHLB);\n      Cpu.registerL = splitLowByte(registerHLB);\n      return 8;\n\n    case 0x2c:\n      // INC L\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerL, 1);\n      Cpu.registerL = u8Portable(Cpu.registerL + 1);\n\n      if (Cpu.registerL === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x2d:\n      // DEC L\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerL, -1);\n      Cpu.registerL = u8Portable(Cpu.registerL - 1);\n\n      if (Cpu.registerL === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x2e:\n      // LD L,d8\n      // 2  8\n      // 4 cycles\n      Cpu.registerL = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x2f:\n      // CPL\n      // 1 4\n      // - 1 1 -\n      Cpu.registerA = ~Cpu.registerA;\n      setSubtractFlag(1);\n      setHalfCarryFlag(1);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode3x(opcode) {\n  switch (opcode) {\n    case 0x30:\n      // JR NC,r8\n      // 2 12 / 8\n      if (getCarryFlag$$1() === 0) {\n        // 4 cycles\n        relativeJump(getDataByteOne()); // Relative Jump function handles program counter\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      }\n\n      return 8;\n\n    case 0x31:\n      // LD SP,d16\n      // 3 12\n      // 8 cycles\n      Cpu.stackPointer = getConcatenatedDataByte();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    case 0x32:\n      // LD (HL-),A\n      // 1 8\n      var registerHL2 = concatenateBytes(Cpu.registerH, Cpu.registerL); // 4 cycles\n\n      eightBitStoreSyncCycles(registerHL2, Cpu.registerA);\n      registerHL2 = u16Portable(registerHL2 - 1);\n      Cpu.registerH = splitHighByte(registerHL2);\n      Cpu.registerL = splitLowByte(registerHL2);\n      return 4;\n\n    case 0x33:\n      // INC SP\n      // 1 8\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 1);\n      return 8;\n\n    case 0x34:\n      // INC (HL)\n      // 1  12\n      // Z 0 H -\n      var registerHL4 = concatenateBytes(Cpu.registerH, Cpu.registerL); // 4 cycles\n\n      var valueAtHL4 = eightBitLoadSyncCycles(registerHL4); // Creating a varible for this to fix assemblyscript overflow bug\n      // Requires explicit casting\n      // https://github.com/AssemblyScript/assemblyscript/issues/26\n\n      var incrementer = 1;\n      checkAndSetEightBitHalfCarryFlag(valueAtHL4, incrementer);\n      valueAtHL4 = u8Portable(valueAtHL4 + incrementer);\n\n      if (valueAtHL4 === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0); // 4 cycles\n\n      eightBitStoreSyncCycles(registerHL4, valueAtHL4);\n      return 4;\n\n    case 0x35:\n      // DEC (HL)\n      // 1  12\n      // Z 1 H -\n      var registerHL5 = concatenateBytes(Cpu.registerH, Cpu.registerL); // 4 cycles\n\n      var valueAtHL5 = eightBitLoadSyncCycles(registerHL5); // NOTE: This opcode may not overflow correctly,\n      // Please see previous opcode\n\n      checkAndSetEightBitHalfCarryFlag(valueAtHL5, -1);\n      valueAtHL5 = u8Portable(valueAtHL5 - 1);\n\n      if (valueAtHL5 === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1); // 4 cycles\n\n      eightBitStoreSyncCycles(registerHL5, valueAtHL5);\n      return 4;\n\n    case 0x36:\n      // LD (HL),d8\n      // 2  12\n      // 8 cycles, 4 from store, 4 from data byte\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x37:\n      // SCF\n      // 1  4\n      // - 0 0 1\n      // Simply set the carry flag\n      setSubtractFlag(0);\n      setHalfCarryFlag(0);\n      setCarryFlag(1);\n      return 4;\n\n    case 0x38:\n      // JR C,r8\n      // 2 12/8\n      if (getCarryFlag$$1() === 1) {\n        // 4 cycles\n        relativeJump(getDataByteOne()); // Relative Jump Funciton handles program counter\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      }\n\n      return 8;\n\n    case 0x39:\n      // ADD HL,SP\n      // 1 8\n      // - 0 H C\n      var registerHL9 = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      checkAndSetSixteenBitFlagsAddOverflow(registerHL9, Cpu.stackPointer, false);\n      var result = u16Portable(registerHL9 + Cpu.stackPointer);\n      Cpu.registerH = splitHighByte(result);\n      Cpu.registerL = splitLowByte(result);\n      setSubtractFlag(0);\n      return 8;\n\n    case 0x3a:\n      // LD A,(HL-)\n      // 1 8\n      var registerHLA = concatenateBytes(Cpu.registerH, Cpu.registerL); // 4 cycles\n\n      Cpu.registerA = eightBitLoadSyncCycles(registerHLA);\n      registerHLA = u16Portable(registerHLA - 1);\n      Cpu.registerH = splitHighByte(registerHLA);\n      Cpu.registerL = splitLowByte(registerHLA);\n      return 4;\n\n    case 0x3b:\n      // DEC SP\n      // 1 8\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 1);\n      return 8;\n\n    case 0x3c:\n      // INC A\n      // 1  4\n      // Z 0 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerA, 1);\n      Cpu.registerA = u8Portable(Cpu.registerA + 1);\n\n      if (Cpu.registerA === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(0);\n      return 4;\n\n    case 0x3d:\n      // DEC A\n      // 1  4\n      // Z 1 H -\n      checkAndSetEightBitHalfCarryFlag(Cpu.registerA, -1);\n      Cpu.registerA = u8Portable(Cpu.registerA - 1);\n\n      if (Cpu.registerA === 0) {\n        setZeroFlag$$1(1);\n      } else {\n        setZeroFlag$$1(0);\n      }\n\n      setSubtractFlag(1);\n      return 4;\n\n    case 0x3e:\n      // LD A,d8\n      // 2 8\n      // 4 cycles\n      Cpu.registerA = getDataByteOne();\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0x3f:\n      // CCF\n      // 1 4\n      // - 0 0 C\n      setSubtractFlag(0);\n      setHalfCarryFlag(0);\n\n      if (getCarryFlag$$1() > 0) {\n        setCarryFlag(0);\n      } else {\n        setCarryFlag(1);\n      }\n\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode4x(opcode) {\n  switch (opcode) {\n    case 0x40:\n      // LD B,B\n      // 1 4\n      // Load B into B, Do nothing\n      return 4;\n\n    case 0x41:\n      // LD B,C\n      // 1 4\n      Cpu.registerB = Cpu.registerC;\n      return 4;\n\n    case 0x42:\n      // LD B,D\n      // 1 4\n      Cpu.registerB = Cpu.registerD;\n      return 4;\n\n    case 0x43:\n      // LD B,E\n      // 1 4\n      Cpu.registerB = Cpu.registerE;\n      return 4;\n\n    case 0x44:\n      // LD B,H\n      // 1 4\n      Cpu.registerB = Cpu.registerH;\n      return 4;\n\n    case 0x45:\n      // LD B,L\n      // 1 4\n      Cpu.registerB = Cpu.registerL;\n      return 4;\n\n    case 0x46:\n      // LD B,(HL)\n      // 1 8\n      // 4 cycles\n      Cpu.registerB = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x47:\n      // LD B,A\n      // 1 4\n      Cpu.registerB = Cpu.registerA;\n      return 4;\n\n    case 0x48:\n      // LD C,B\n      // 1 4\n      Cpu.registerC = Cpu.registerB;\n      return 4;\n\n    case 0x49:\n      // LD C,C\n      // 1 4\n      // Do nothing\n      return 4;\n\n    case 0x4a:\n      // LD C,D\n      // 1 4\n      Cpu.registerC = Cpu.registerD;\n      return 4;\n\n    case 0x4b:\n      // LD C,E\n      // 1 4\n      Cpu.registerC = Cpu.registerE;\n      return 4;\n\n    case 0x4c:\n      // LD C,H\n      // 1 4\n      Cpu.registerC = Cpu.registerH;\n      return 4;\n\n    case 0x4d:\n      // LD C,L\n      // 1 4\n      Cpu.registerC = Cpu.registerL;\n      return 4;\n\n    case 0x4e:\n      // LD C,(HL)\n      // 1 8\n      // 4 cycles\n      Cpu.registerC = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x4f:\n      // LD C,A\n      // 1 4\n      Cpu.registerC = Cpu.registerA;\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode5x(opcode) {\n  switch (opcode) {\n    case 0x50:\n      // LD D,B\n      // 1 4\n      Cpu.registerD = Cpu.registerB;\n      return 4;\n\n    case 0x51:\n      // LD D,C\n      // 1 4\n      Cpu.registerD = Cpu.registerC;\n      return 4;\n\n    case 0x52:\n      // LD D,D\n      // 1 4\n      // Do Nothing\n      return 4;\n\n    case 0x53:\n      // LD D,E\n      // 1 4\n      Cpu.registerD = Cpu.registerE;\n      return 4;\n\n    case 0x54:\n      // LD D,H\n      // 1 4\n      Cpu.registerD = Cpu.registerH;\n      return 4;\n\n    case 0x55:\n      // LD D,L\n      // 1 4\n      Cpu.registerD = Cpu.registerL;\n      return 4;\n\n    case 0x56:\n      // LD D,(HL)\n      // 1 8\n      // 4 cycles\n      Cpu.registerD = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x57:\n      // LD D,A\n      // 1 4\n      Cpu.registerD = Cpu.registerA;\n      return 4;\n\n    case 0x58:\n      // LD E,B\n      // 1 4\n      Cpu.registerE = Cpu.registerB;\n      return 4;\n\n    case 0x59:\n      // LD E,C\n      // 1 4\n      Cpu.registerE = Cpu.registerC;\n      return 4;\n\n    case 0x5a:\n      // LD E,D\n      // 1 4\n      Cpu.registerE = Cpu.registerD;\n      return 4;\n\n    case 0x5b:\n      // LD E,E\n      // 1 4\n      // Do Nothing\n      return 4;\n\n    case 0x5c:\n      // LD E,H\n      // 1 4\n      Cpu.registerE = Cpu.registerH;\n      return 4;\n\n    case 0x5d:\n      // LD E,L\n      // 1 4\n      Cpu.registerE = Cpu.registerL;\n      return 4;\n\n    case 0x5e:\n      // LD E,(HL)\n      // 1 8\n      // 4 cycles\n      Cpu.registerE = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x5f:\n      // LD E,A\n      // 1 4\n      Cpu.registerE = Cpu.registerA;\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode6x(opcode) {\n  switch (opcode) {\n    case 0x60:\n      // LD H,B\n      // 1 4\n      Cpu.registerH = Cpu.registerB;\n      return 4;\n\n    case 0x61:\n      // LD H,C\n      // 1 4\n      Cpu.registerH = Cpu.registerC;\n      return 4;\n\n    case 0x62:\n      // LD H,D\n      // 1 4\n      Cpu.registerH = Cpu.registerD;\n      return 4;\n\n    case 0x63:\n      // LD H,E\n      // 1 4\n      Cpu.registerH = Cpu.registerE;\n      return 4;\n\n    case 0x64:\n      // LD H,H\n      // 1 4\n      Cpu.registerH = Cpu.registerH;\n      return 4;\n\n    case 0x65:\n      // LD H,L\n      // 1 4\n      Cpu.registerH = Cpu.registerL;\n      return 4;\n\n    case 0x66:\n      // LD H,(HL)\n      // 1 8\n      // 4 cycles\n      Cpu.registerH = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x67:\n      // LD H,A\n      // 1 4\n      Cpu.registerH = Cpu.registerA;\n      return 4;\n\n    case 0x68:\n      // LD L,B\n      // 1 4\n      Cpu.registerL = Cpu.registerB;\n      return 4;\n\n    case 0x69:\n      // LD L,C\n      // 1 4\n      Cpu.registerL = Cpu.registerC;\n      return 4;\n\n    case 0x6a:\n      // LD L,D\n      // 1 4\n      Cpu.registerL = Cpu.registerD;\n      return 4;\n\n    case 0x6b:\n      // LD L,E\n      // 1 4\n      Cpu.registerL = Cpu.registerE;\n      return 4;\n\n    case 0x6c:\n      // LD L,H\n      // 1 4\n      Cpu.registerL = Cpu.registerH;\n      return 4;\n\n    case 0x6d:\n      // LD L,L\n      // 1 4\n      Cpu.registerL = Cpu.registerL;\n      return 4;\n\n    case 0x6e:\n      // LD L,(HL)\n      // 1 8\n      // 4 cycles\n      Cpu.registerL = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x6f:\n      // LD L,A\n      // 1 4\n      Cpu.registerL = Cpu.registerA;\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode7x(opcode) {\n  switch (opcode) {\n    case 0x70:\n      // LD (HL),B\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerB);\n      return 4;\n\n    case 0x71:\n      // LD (HL),C\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerC);\n      return 4;\n\n    case 0x72:\n      // LD (HL),D\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerD);\n      return 4;\n\n    case 0x73:\n      // LD (HL),E\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerE);\n      return 4;\n\n    case 0x74:\n      // LD (HL),H\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerH);\n      return 4;\n\n    case 0x75:\n      // LD (HL),L\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerL);\n      return 4;\n\n    case 0x76:\n      // HALT\n      // 1 4\n      // Enter CPU very low power mode\n      // Meaning Don't Decode anymore opcodes until an interrupt occurs\n      // Still need to do timers and things\n      // Can't Halt during an HDMA\n      // https://gist.github.com/drhelius/3394856\n      if (!Memory.isHblankHdmaActive) {\n        Cpu.enableHalt();\n      }\n\n      return 4;\n\n    case 0x77:\n      // LD (HL),A\n      // 1 8\n      // 4 cycles\n      eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL), Cpu.registerA);\n      return 4;\n\n    case 0x78:\n      // LD A,B\n      // 1 4\n      Cpu.registerA = Cpu.registerB;\n      return 4;\n\n    case 0x79:\n      // LD A,C\n      // 1 4\n      Cpu.registerA = Cpu.registerC;\n      return 4;\n\n    case 0x7a:\n      // LD A,D\n      // 1 4\n      Cpu.registerA = Cpu.registerD;\n      return 4;\n\n    case 0x7b:\n      // LD A,E\n      // 1 4\n      Cpu.registerA = Cpu.registerE;\n      return 4;\n\n    case 0x7c:\n      // LD A,H\n      // 1 4\n      Cpu.registerA = Cpu.registerH;\n      return 4;\n\n    case 0x7d:\n      // LD A,L\n      // 1 4\n      Cpu.registerA = Cpu.registerL;\n      return 4;\n\n    case 0x7e:\n      // LD A,(HL)\n      // 1 8\n      // NOTE: Thanks to @binji for catching that this should be 8 cycles, not 4\n      // 4 cycles\n      Cpu.registerA = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 4;\n\n    case 0x7f:\n      // LD A,A\n      // 1 4\n      // Do Nothing\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode8x(opcode) {\n  switch (opcode) {\n    case 0x80:\n      // ADD A,B\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerB);\n      return 4;\n\n    case 0x81:\n      // ADD A,C\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerC);\n      return 4;\n\n    case 0x82:\n      // ADD A,D\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerD);\n      return 4;\n\n    case 0x83:\n      // ADD A,E\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerE);\n      return 4;\n\n    case 0x84:\n      // ADD A,H\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerH);\n      return 4;\n\n    case 0x85:\n      // ADD A,L\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerL);\n      return 4;\n\n    case 0x86:\n      // ADD A,(HL)\n      // 1 8\n      // Z 0 H C\n      // 4 cycles\n      var valueAtHL6 = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      addARegister(valueAtHL6);\n      return 4;\n\n    case 0x87:\n      // ADD A,A\n      // 1 4\n      // Z 0 H C\n      addARegister(Cpu.registerA);\n      return 4;\n\n    case 0x88:\n      // ADC A,B\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerB);\n      return 4;\n\n    case 0x89:\n      // ADC A,C\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerC);\n      return 4;\n\n    case 0x8a:\n      // ADC A,D\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerD);\n      return 4;\n\n    case 0x8b:\n      // ADC A,E\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerE);\n      return 4;\n\n    case 0x8c:\n      // ADC A,H\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerH);\n      return 4;\n\n    case 0x8d:\n      // ADC A,L\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerL);\n      return 4;\n\n    case 0x8e:\n      // ADC A,(HL)\n      // 1 8\n      // Z 0 H C\n      // 4 cycles\n      var valueAtHLE = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      addAThroughCarryRegister(valueAtHLE);\n      return 4;\n\n    case 0x8f:\n      // ADC A,A\n      // 1 4\n      // Z 0 H C\n      addAThroughCarryRegister(Cpu.registerA);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcode9x(opcode) {\n  switch (opcode) {\n    case 0x90:\n      // SUB B\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerB);\n      return 4;\n\n    case 0x91:\n      // SUB C\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerC);\n      return 4;\n\n    case 0x92:\n      // SUB D\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerD);\n      return 4;\n\n    case 0x93:\n      // SUB E\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerE);\n      return 4;\n\n    case 0x94:\n      // SUB H\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerH);\n      return 4;\n\n    case 0x95:\n      // SUB L\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerL);\n      return 4;\n\n    case 0x96:\n      // SUB (HL)\n      // 1  8\n      // Z 1 H C\n      // 4 cycles\n      var valueAtHL6 = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      subARegister(valueAtHL6);\n      return 4;\n\n    case 0x97:\n      // SUB A\n      // 1  4\n      // Z 1 H C\n      subARegister(Cpu.registerA);\n      return 4;\n\n    case 0x98:\n      // SBC A,B\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerB);\n      return 4;\n\n    case 0x99:\n      // SBC A,C\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerC);\n      return 4;\n\n    case 0x9a:\n      // SBC A,D\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerD);\n      return 4;\n\n    case 0x9b:\n      // SBC A,E\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerE);\n      return 4;\n\n    case 0x9c:\n      // SBC A,H\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerH);\n      return 4;\n\n    case 0x9d:\n      // SBC A,L\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerL);\n      return 4;\n\n    case 0x9e:\n      // SBC A,(HL)\n      // 1  8\n      // Z 1 H C\n      // 4 cycles\n      var valueAtHLE = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      subAThroughCarryRegister(valueAtHLE);\n      return 4;\n\n    case 0x9f:\n      // SBC A,A\n      // 1  4\n      // Z 1 H C\n      subAThroughCarryRegister(Cpu.registerA);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcodeAx(opcode) {\n  switch (opcode) {\n    case 0xa0:\n      // AND B\n      // 1  4\n      // Z 0 1 0\n      andARegister(Cpu.registerB);\n      return 4;\n\n    case 0xa1:\n      // AND C\n      // 1  4\n      // Z 0 1 0\n      andARegister(Cpu.registerC);\n      return 4;\n\n    case 0xa2:\n      // AND D\n      // 1  4\n      // Z 0 1 0\n      andARegister(Cpu.registerD);\n      return 4;\n\n    case 0xa3:\n      // AND E\n      // 1  4\n      // Z 0 1 0\n      andARegister(Cpu.registerE);\n      return 4;\n\n    case 0xa4:\n      // AND H\n      // 1  4\n      // Z 0 1 0\n      andARegister(Cpu.registerH);\n      return 4;\n\n    case 0xa5:\n      // AND L\n      // 1  4\n      // Z 0 1 0\n      andARegister(Cpu.registerL);\n      return 4;\n\n    case 0xa6:\n      // AND (HL)\n      // 1  8\n      // Z 0 1 0\n      // 4 cycles\n      var valueAtHL6 = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      andARegister(valueAtHL6);\n      return 4;\n\n    case 0xa7:\n      // AND A\n      // 1  4\n      // Z 0 1 0\n      // NOTE: & Yourself, does nothing\n      andARegister(Cpu.registerA);\n      return 4;\n\n    case 0xa8:\n      // XOR B\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerB);\n      return 4;\n\n    case 0xa9:\n      // XOR C\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerC);\n      return 4;\n\n    case 0xaa:\n      // XOR D\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerD);\n      return 4;\n\n    case 0xab:\n      // XOR E\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerE);\n      return 4;\n\n    case 0xac:\n      // XOR H\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerH);\n      return 4;\n\n    case 0xad:\n      // XOR L\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerL);\n      return 4;\n\n    case 0xae:\n      // XOR (HL)\n      // 1  8\n      // Z 0 0 0\n      // 4 cycles\n      var valueAtHLE = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      xorARegister(valueAtHLE);\n      return 4;\n\n    case 0xaf:\n      // XOR A\n      // 1  4\n      // Z 0 0 0\n      xorARegister(Cpu.registerA);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcodeBx(opcode) {\n  switch (opcode) {\n    case 0xb0:\n      // OR B\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerB);\n      return 4;\n\n    case 0xb1:\n      // OR C\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerC);\n      return 4;\n\n    case 0xb2:\n      // OR D\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerD);\n      return 4;\n\n    case 0xb3:\n      // OR E\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerE);\n      return 4;\n\n    case 0xb4:\n      // OR H\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerH);\n      return 4;\n\n    case 0xb5:\n      // OR L\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerL);\n      return 4;\n\n    case 0xb6:\n      // OR (HL)\n      // 1  8\n      // Z 0 0 0\n      // 4 cycles\n      var valueAtHL6 = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      orARegister(valueAtHL6);\n      return 4;\n\n    case 0xb7:\n      // OR A\n      // 1  4\n      // Z 0 0 0\n      orARegister(Cpu.registerA);\n      return 4;\n\n    case 0xb8:\n      // CP B\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerB);\n      return 4;\n\n    case 0xb9:\n      // CP C\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerC);\n      return 4;\n\n    case 0xba:\n      // CP D\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerD);\n      return 4;\n\n    case 0xbb:\n      // CP E\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerE);\n      return 4;\n\n    case 0xbc:\n      // CP H\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerH);\n      return 4;\n\n    case 0xbd:\n      // CP L\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerL);\n      return 4;\n\n    case 0xbe:\n      // CP (HL)\n      // 1  8\n      // Z 1 H C\n      // 4 cycles\n      var valueAtHLE = eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH, Cpu.registerL));\n      cpARegister(valueAtHLE);\n      return 4;\n\n    case 0xbf:\n      // CP A\n      // 1  4\n      // Z 1 H C\n      cpARegister(Cpu.registerA);\n      return 4;\n  }\n\n  return -1;\n}\n\nfunction handleOpcodeCx(opcode) {\n  switch (opcode) {\n    case 0xc0:\n      // RET NZ\n      // 1  20/8\n      if (getZeroFlag$$1() === 0) {\n        // 8 cycles\n        Cpu.programCounter = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n        return 12;\n      } else {\n        return 8;\n      }\n\n    case 0xc1:\n      // POP BC\n      // 1  12\n      // 8 cycles\n      var registerBC1 = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n      Cpu.registerB = splitHighByte(registerBC1);\n      Cpu.registerC = splitLowByte(registerBC1);\n      return 4;\n\n    case 0xc2:\n      // JP NZ,a16\n      // 3  16/12\n      if (getZeroFlag$$1() === 0) {\n        // 8 cycles\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    case 0xc3:\n      // JP a16\n      // 3  16\n      // 8 cycles\n      Cpu.programCounter = getConcatenatedDataByte();\n      return 8;\n\n    case 0xc4:\n      // CALL NZ,a16\n      // 3  24/12\n      if (getZeroFlag$$1() === 0) {\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n        sixteenBitStoreSyncCycles(Cpu.stackPointer, u16Portable(Cpu.programCounter + 2)); // 8 cycles\n\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    case 0xc5:\n      // PUSH BC\n      // 1  16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, concatenateBytes(Cpu.registerB, Cpu.registerC));\n      return 8;\n\n    case 0xc6:\n      // ADD A,d8\n      // 2 8\n      // Z 0 H C\n      // 4 cycles\n      addARegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xc7:\n      // RST 00H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x00;\n      return 8;\n\n    case 0xc8:\n      // RET Z\n      // 1  20/8\n      if (getZeroFlag$$1() === 1) {\n        // 8 cycles\n        Cpu.programCounter = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n        return 12;\n      } else {\n        return 8;\n      }\n\n    case 0xc9:\n      // RET\n      // 1 16\n      // 8 cycles\n      Cpu.programCounter = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n      return 8;\n\n    case 0xca:\n      // JP Z,a16\n      // 3 16/12\n      if (getZeroFlag$$1() === 1) {\n        // 8 cycles\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    case 0xcb:\n      // PREFIX CB\n      // 1  4\n      // 4 cycles\n      var cbCycles = handleCbOpcode(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return cbCycles;\n\n    case 0xcc:\n      // CALL Z,a16\n      // 3  24/12\n      if (getZeroFlag$$1() === 1) {\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n        sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter + 2); // 8 cycles\n\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    case 0xcd:\n      // CALL a16\n      // 3  24\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, u16Portable(Cpu.programCounter + 2)); // 8 cycles\n\n      Cpu.programCounter = getConcatenatedDataByte();\n      return 8;\n\n    case 0xce:\n      // ADC A,d8\n      // 2  8\n      // Z 0 H C\n      // 4 cycles\n      addAThroughCarryRegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xcf:\n      // RST 08H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x08;\n      return 8;\n  }\n\n  return -1;\n}\n\nfunction handleOpcodeDx(opcode) {\n  switch (opcode) {\n    case 0xd0:\n      // RET NC\n      // 1  20/8\n      if (getCarryFlag$$1() === 0) {\n        // 8 cycles\n        Cpu.programCounter = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n        return 12;\n      } else {\n        return 8;\n      }\n\n    case 0xd1:\n      // POP DE\n      // 1  12\n      // 8 cycles\n      var registerDE1 = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n      Cpu.registerD = splitHighByte(registerDE1);\n      Cpu.registerE = splitLowByte(registerDE1);\n      return 4;\n\n    case 0xd2:\n      // JP NC,a16\n      // 3  16/12\n      if (getCarryFlag$$1() === 0) {\n        // 8 cycles\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    /* No Opcode for: 0xD3 */\n\n    case 0xd4:\n      // CALL NC,a16\n      // 3  24/12\n      if (getCarryFlag$$1() === 0) {\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n        sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter + 2); // 8 cycles\n\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    case 0xd5:\n      // PUSH DE\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, concatenateBytes(Cpu.registerD, Cpu.registerE));\n      return 8;\n\n    case 0xd6:\n      // SUB d8\n      // 2  8\n      // Z 1 H C\n      // 4 cycles\n      subARegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xd7:\n      // RST 10H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x10;\n      return 8;\n\n    case 0xd8:\n      // RET C\n      // 1  20/8\n      if (getCarryFlag$$1() === 1) {\n        // 8 cycles\n        Cpu.programCounter = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n        return 12;\n      } else {\n        return 8;\n      }\n\n    case 0xd9:\n      // RETI\n      // 1  16\n      // 8 cycles\n      Cpu.programCounter = sixteenBitLoadSyncCycles(Cpu.stackPointer); // Enable interrupts\n\n      setInterrupts(true);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n      return 8;\n\n    case 0xda:\n      // JP C,a16\n      // 3 16/12\n      if (getCarryFlag$$1() === 1) {\n        // 8 cycles\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    /* No Opcode for: 0xDB */\n\n    case 0xdc:\n      // CALL C,a16\n      // 3  24/12\n      if (getCarryFlag$$1() === 1) {\n        Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n        sixteenBitStoreSyncCycles(Cpu.stackPointer, u16Portable(Cpu.programCounter + 2)); // 8 cycles\n\n        Cpu.programCounter = getConcatenatedDataByte();\n        return 8;\n      } else {\n        Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n        return 12;\n      }\n\n    /* No Opcode for: 0xDD */\n\n    case 0xde:\n      // SBC A,d8\n      // 2 8\n      // Z 1 H C\n      // 4 cycles\n      subAThroughCarryRegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xdf:\n      // RST 18H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x18;\n      return 8;\n  }\n\n  return -1;\n}\n\nfunction handleOpcodeEx(opcode) {\n  switch (opcode) {\n    case 0xe0:\n      // LDH (a8),A\n      // 2  12\n      // Store value in high RAM ($FF00 + a8)\n      // 4 cycles\n      var largeDataByteOne = getDataByteOne(); // 4 cycles\n\n      eightBitStoreSyncCycles(0xff00 + largeDataByteOne, Cpu.registerA);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xe1:\n      // POP HL\n      // 1  12\n      // 8 cycles\n      var registerHL1 = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n      Cpu.registerH = splitHighByte(registerHL1);\n      Cpu.registerL = splitLowByte(registerHL1);\n      return 4;\n\n    case 0xe2:\n      // LD (C),A\n      // 1  8\n      // NOTE: Table says 2 Program counter,\n      // But stepping through the boot rom, should be one\n      // Also should change 0xF2\n      // Store value in high RAM ($FF00 + register c)\n      // 4 cycles\n      eightBitStoreSyncCycles(0xff00 + Cpu.registerC, Cpu.registerA);\n      return 4;\n\n    /* No Opcode for: 0xE3, 0xE4 */\n\n    case 0xe5:\n      // PUSH HL\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, concatenateBytes(Cpu.registerH, Cpu.registerL));\n      return 8;\n\n    case 0xe6:\n      // AND d8\n      // 2  8\n      // Z 0 1 0\n      // 4 cycles\n      andARegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xe7:\n      // RST 20H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x20;\n      return 8;\n\n    case 0xe8:\n      // ADD SP, r8\n      // 2 16\n      // 0 0 H C\n      // NOTE: Discoved dataByte is signed\n      // 4 cycles\n      var signedDataByteOne = i8Portable(getDataByteOne());\n      checkAndSetSixteenBitFlagsAddOverflow(Cpu.stackPointer, signedDataByteOne, true);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + signedDataByteOne);\n      setZeroFlag$$1(0);\n      setSubtractFlag(0);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 12;\n\n    case 0xe9:\n      // JP HL\n      // 1 4\n      Cpu.programCounter = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      return 4;\n\n    case 0xea:\n      // LD (a16),A\n      // 3 16\n      // 12 cycles, 4 from store, 8 from concatenated data byte\n      eightBitStoreSyncCycles(getConcatenatedDataByte(), Cpu.registerA);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    /* No Opcode for: 0xEB, 0xEC, 0xED */\n\n    case 0xee:\n      // XOR d8\n      // 2 8\n      // Z 0 0 0\n      // 4 cycles\n      xorARegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xef:\n      // RST 28H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x28;\n      return 8;\n  }\n\n  return -1;\n}\n\nfunction handleOpcodeFx(opcode) {\n  switch (opcode) {\n    case 0xf0:\n      // LDH A,(a8)\n      // 2 12\n      // 4 cycles\n      var largeDataByteOne = getDataByteOne(); // 4 cycles\n\n      Cpu.registerA = u8Portable(eightBitLoadSyncCycles(0xff00 + largeDataByteOne));\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xf1:\n      // POP AF\n      // 1 12\n      // Z N H C (But No work require, flags are already set)\n      // 8 cycles\n      var registerAF1 = sixteenBitLoadSyncCycles(Cpu.stackPointer);\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer + 2);\n      Cpu.registerA = splitHighByte(registerAF1);\n      Cpu.registerF = splitLowByte(registerAF1);\n      return 4;\n\n    case 0xf2:\n      // LD A,(C)\n      // 1 8\n      // 4 cycles\n      Cpu.registerA = u8Portable(eightBitLoadSyncCycles(0xff00 + Cpu.registerC));\n      return 4;\n\n    case 0xf3:\n      // DI\n      // 1 4\n      setInterrupts(false);\n      return 4;\n\n    /* No Opcode for: 0xF4 */\n\n    case 0xf5:\n      // PUSH AF\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, concatenateBytes(Cpu.registerA, Cpu.registerF));\n      return 8;\n\n    case 0xf6:\n      // OR d8\n      // 2 8\n      // Z 0 0 0\n      // 4 cycles\n      orARegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xf7:\n      // RST 30H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x30;\n      return 8;\n\n    case 0xf8:\n      // LD HL,SP+r8\n      // 2 12\n      // 0 0 H C\n      // NOTE: Discoved dataByte is signed\n      // 4 cycles\n      var signedDataByteOne = i8Portable(getDataByteOne()); // First, let's handle flags\n\n      setZeroFlag$$1(0);\n      setSubtractFlag(0);\n      checkAndSetSixteenBitFlagsAddOverflow(Cpu.stackPointer, signedDataByteOne, true);\n      var registerHL = u16Portable(Cpu.stackPointer + signedDataByteOne);\n      Cpu.registerH = splitHighByte(registerHL);\n      Cpu.registerL = splitLowByte(registerHL);\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 8;\n\n    case 0xf9:\n      // LD SP,HL\n      // 1 8\n      Cpu.stackPointer = concatenateBytes(Cpu.registerH, Cpu.registerL);\n      return 8;\n\n    case 0xfa:\n      // LD A,(a16)\n      // 3 16\n      // 12 cycles, 4 from load, 8 from concatenated data byte\n      Cpu.registerA = eightBitLoadSyncCycles(getConcatenatedDataByte());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 2);\n      return 4;\n\n    case 0xfb:\n      // EI\n      // 1 4\n      setInterrupts(true);\n      return 4;\n\n    /* No Opcode for: 0xFC, 0xFD */\n\n    case 0xfe:\n      // CP d8\n      // 2 8\n      // Z 1 H C\n      // 4 cycles\n      cpARegister(getDataByteOne());\n      Cpu.programCounter = u16Portable(Cpu.programCounter + 1);\n      return 4;\n\n    case 0xff:\n      // RST 38H\n      // 1 16\n      Cpu.stackPointer = u16Portable(Cpu.stackPointer - 2); // 8 cycles\n\n      sixteenBitStoreSyncCycles(Cpu.stackPointer, Cpu.programCounter);\n      Cpu.programCounter = 0x38;\n      return 8;\n  }\n\n  return -1;\n} // NOTE: Code is very verbose, and will have some copy pasta'd lines.\n// Syncing and Tracking executed cycles\n\n\nvar Cycles =\n/** @class */\nfunction () {\n  function Cycles() {} // An even number below the max 32 bit integer\n\n\n  Cycles.cyclesPerCycleSet = 2000000000;\n  Cycles.cycleSets = 0;\n  Cycles.cycles = 0;\n  return Cycles;\n}();\n\nfunction getCyclesPerCycleSet() {\n  return Cycles.cyclesPerCycleSet;\n}\n\nfunction getCycleSets() {\n  return Cycles.cycleSets;\n}\n\nfunction getCycles() {\n  return Cycles.cycles;\n}\n\nfunction trackCyclesRan(numberOfCycles) {\n  Cycles.cycles += numberOfCycles;\n\n  if (Cycles.cycles >= Cycles.cyclesPerCycleSet) {\n    Cycles.cycleSets += 1;\n    Cycles.cycles -= Cycles.cyclesPerCycleSet;\n  }\n}\n\nfunction resetCycles() {\n  Cycles.cyclesPerCycleSet = 2000000000;\n  Cycles.cycleSets = 0;\n  Cycles.cycles = 0;\n} // Sync other GB Components with the number of cycles\n\n\nfunction syncCycles(numberOfCycles) {\n  // Check if we did a DMA TRansfer, if we did add the cycles\n  if (Memory.DMACycles > 0) {\n    numberOfCycles += Memory.DMACycles;\n    Memory.DMACycles = 0;\n  } // Finally, Add our number of cycles to the CPU Cycles\n\n\n  Cpu.currentCycles += numberOfCycles; // Check other Gameboy components\n\n  if (!Cpu.isStopped) {\n    if (Config.graphicsBatchProcessing) {\n      // Need to do this, since a lot of things depend on the scanline\n      // Batch processing will simply return if the number of cycles is too low\n      Graphics.currentCycles += numberOfCycles;\n      batchProcessGraphics();\n    } else {\n      updateGraphics(numberOfCycles);\n    }\n\n    if (Config.audioBatchProcessing) {\n      Sound.currentCycles += numberOfCycles;\n    } else {\n      updateSound(numberOfCycles);\n    }\n\n    updateSerial(numberOfCycles);\n  }\n\n  if (Config.timersBatchProcessing) {\n    // Batch processing will simply return if the number of cycles is too low\n    Timers.currentCycles += numberOfCycles;\n    batchProcessTimers();\n  } else {\n    updateTimers(numberOfCycles);\n  }\n\n  trackCyclesRan(numberOfCycles);\n} // Functions involving executing/running the emulator after initializtion\n\n\nvar Execute =\n/** @class */\nfunction () {\n  function Execute() {} // An even number bewlow the max 32 bit integer\n\n\n  Execute.stepsPerStepSet = 2000000000;\n  Execute.stepSets = 0;\n  Execute.steps = 0; // Response Codes from Execute Conditions\n\n  Execute.RESPONSE_CONDITION_ERROR = -1;\n  Execute.RESPONSE_CONDITION_FRAME = 0;\n  Execute.RESPONSE_CONDITION_AUDIO = 1;\n  Execute.RESPONSE_CONDITION_BREAKPOINT = 2;\n  return Execute;\n}();\n\nfunction getStepsPerStepSet() {\n  return Execute.stepsPerStepSet;\n}\n\nfunction getStepSets() {\n  return Execute.stepSets;\n}\n\nfunction getSteps() {\n  return Execute.steps;\n}\n\nfunction trackStepsRan(steps) {\n  Execute.steps += steps;\n\n  if (Execute.steps >= Execute.stepsPerStepSet) {\n    Execute.stepSets += 1;\n    Execute.steps -= Execute.stepsPerStepSet;\n  }\n}\n\nfunction resetSteps() {\n  Execute.stepsPerStepSet = 2000000000;\n  Execute.stepSets = 0;\n  Execute.steps = 0;\n} // // Public funciton to run frames until,\n// the specified number of frames have run or error.\n// Return values:\n// -1 = error\n// 0 = render a frame\n\n\nfunction executeMultipleFrames(numberOfFrames) {\n  var frameResponse = 0;\n  var framesRun = 0;\n\n  while (framesRun < numberOfFrames && frameResponse >= 0) {\n    frameResponse = executeFrame();\n    framesRun += 1;\n  }\n\n  if (frameResponse < 0) {\n    return frameResponse;\n  }\n\n  return 0;\n} // Public funciton to run opcodes until,\n// a frame is ready, or error.\n// Return values:\n// -1 = error\n// 0 = render a frame\n\n\nfunction executeFrame() {\n  return executeUntilCondition(true, -1, -1);\n} // Public Function to run opcodes until,\n// a frame is ready, audio bufer is filled, or error\n\n\nfunction executeFrameAndCheckAudio(maxAudioBuffer) {\n  if (maxAudioBuffer === void 0) {\n    maxAudioBuffer = 0;\n  }\n\n  return executeUntilCondition(true, maxAudioBuffer, -1);\n} // Public function to run opcodes until,\n// a breakpoint is reached\n\n\nfunction executeFrameUntilBreakpoint(breakpoint) {\n  return executeUntilCondition(true, -1, breakpoint);\n} // Public function to run opcodes until,\n// A frame needs to be rendered\n// a breakpoint is reached\n\n\nfunction executeFrameAndCheckAudioUntilBreakpoint(maxAudioBuffer, breakpoint) {\n  return executeUntilCondition(true, maxAudioBuffer, breakpoint);\n} // Base function that executes steps, and checks conditions\n// Return values:\n\n\nfunction executeUntilCondition(checkMaxCyclesPerFrame, maxAudioBuffer, breakpoint) {\n  if (checkMaxCyclesPerFrame === void 0) {\n    checkMaxCyclesPerFrame = true;\n  }\n\n  if (maxAudioBuffer === void 0) {\n    maxAudioBuffer = -1;\n  }\n\n  if (breakpoint === void 0) {\n    breakpoint = -1;\n  } // Common tracking variables\n\n\n  var numberOfCycles = -1;\n  var audioBufferSize = 1024;\n\n  if (maxAudioBuffer > 0) {\n    audioBufferSize = maxAudioBuffer;\n  } else if (maxAudioBuffer < 0) {\n    audioBufferSize = -1;\n  }\n\n  var errorCondition = false;\n  var frameCondition = false;\n  var audioBufferCondition = false;\n  var breakpointCondition = false;\n\n  while (!errorCondition && !frameCondition && !audioBufferCondition && !breakpointCondition) {\n    numberOfCycles = executeStep(); // Error Condition\n\n    if (numberOfCycles < 0) {\n      errorCondition = true;\n    } else if (Cpu.currentCycles >= Cpu.MAX_CYCLES_PER_FRAME()) {\n      frameCondition = true;\n    } else if (audioBufferSize > -1 && getNumberOfSamplesInAudioBuffer() >= audioBufferSize) {\n      audioBufferCondition = true;\n    } else if (breakpoint > -1 && Cpu.programCounter === breakpoint) {\n      breakpointCondition = true;\n    }\n  } // Find our exit reason\n\n\n  if (frameCondition) {\n    // Render a frame\n    // Reset our currentCycles\n    Cpu.currentCycles -= Cpu.MAX_CYCLES_PER_FRAME();\n    return Execute.RESPONSE_CONDITION_FRAME;\n  }\n\n  if (audioBufferCondition) {\n    return Execute.RESPONSE_CONDITION_AUDIO;\n  }\n\n  if (breakpointCondition) {\n    return Execute.RESPONSE_CONDITION_BREAKPOINT;\n  } // TODO: Boot ROM handling\n  // There was an error, return -1, and push the program counter back to grab the error opcode\n\n\n  Cpu.programCounter = u16Portable(Cpu.programCounter - 1);\n  return -1;\n} // Function to execute an opcode, and update other gameboy hardware.\n// http://www.codeslinger.co.uk/pages/projects/gameboy/beginning.html\n\n\nfunction executeStep() {\n  // Set has started to 1 since we ran a emulation step\n  setHasCoreStarted(true); // Check if we are in the halt bug\n\n  if (Cpu.isHaltBug) {\n    // Need to not increment program counter,\n    // thus, running the next opcode twice\n    // E.g\n    // 0x76 - halt\n    // FA 34 12 - ld a,(1234)\n    // Becomes\n    // FA FA 34 ld a,(34FA)\n    // 12 ld (de),a\n    var haltBugOpcode = eightBitLoadFromGBMemory(Cpu.programCounter); // Execute opcode will handle the actual PC behavior\n\n    var haltBugCycles = executeOpcode$$1(haltBugOpcode);\n    syncCycles(haltBugCycles);\n    Cpu.exitHaltAndStop();\n  } // Interrupts should be handled before reading an opcode\n  // https://github.com/Gekkio/mooneye-gb/blob/master/docs/accuracy.markdown#what-is-the-exact-timing-of-cpu-servicing-an-interrupt\n\n\n  var interruptCycles = checkInterrupts();\n\n  if (interruptCycles > 0) {\n    syncCycles(interruptCycles);\n  } // Get the opcode, and additional bytes to be handled\n  // Number of cycles defaults to 4, because while we're halted, we run 4 cycles (according to matt :))\n\n\n  var numberOfCycles = 4;\n  var opcode = 0; // If we are not halted or stopped, run instructions\n  // If we are halted, this will be skipped and just sync the 4 cycles\n\n  if (!Cpu.isHalted() && !Cpu.isStopped) {\n    opcode = eightBitLoadFromGBMemory(Cpu.programCounter);\n    numberOfCycles = executeOpcode$$1(opcode);\n  } // blarggFixes, don't allow register F to have the bottom nibble\n\n\n  Cpu.registerF = Cpu.registerF & 0xf0; // Check if there was an error decoding the opcode\n\n  if (numberOfCycles <= 0) {\n    return numberOfCycles;\n  } // Sync other GB Components with the number of cycles\n\n\n  syncCycles(numberOfCycles); // Update our steps\n\n  trackStepsRan(1);\n  return numberOfCycles;\n} // Imports\n// Grow our memory to the specified size\n\n\nif (memory.size() < WASMBOY_WASM_PAGES) {\n  memory.grow(WASMBOY_WASM_PAGES - memory.size());\n} // Function to track if the core has started\n\n\nvar hasStarted = false;\n\nfunction setHasCoreStarted(value) {\n  hasStarted = value;\n}\n\nfunction hasCoreStarted() {\n  if (hasStarted) {\n    return 1;\n  }\n\n  return 0;\n} // Function to configure & initialize wasmboy\n\n\nfunction config(enableBootRom, useGbcWhenAvailable, audioBatchProcessing, graphicsBatchProcessing, timersBatchProcessing, graphicsDisableScanlineRendering, audioAccumulateSamples, tileRendering, tileCaching, enableAudioDebugging) {\n  // TODO: depending on the boot rom, initialization may be different\n  // From: http://www.codeslinger.co.uk/pages/projects/gameboy/hardware.html\n  // All values default to zero in memory, so not setting them yet\n  // log('initializing (includeBootRom=$0)', 1, enableBootRom);\n  if (enableBootRom > 0) {\n    Config.enableBootRom = true;\n  } else {\n    Config.enableBootRom = false;\n  }\n\n  if (useGbcWhenAvailable > 0) {\n    Config.useGbcWhenAvailable = true;\n  } else {\n    Config.useGbcWhenAvailable = false;\n  }\n\n  if (audioBatchProcessing > 0) {\n    Config.audioBatchProcessing = true;\n  } else {\n    Config.audioBatchProcessing = false;\n  }\n\n  if (graphicsBatchProcessing > 0) {\n    Config.graphicsBatchProcessing = true;\n  } else {\n    Config.graphicsBatchProcessing = false;\n  }\n\n  if (timersBatchProcessing > 0) {\n    Config.timersBatchProcessing = true;\n  } else {\n    Config.timersBatchProcessing = false;\n  }\n\n  if (graphicsDisableScanlineRendering > 0) {\n    Config.graphicsDisableScanlineRendering = true;\n  } else {\n    Config.graphicsDisableScanlineRendering = false;\n  }\n\n  if (audioAccumulateSamples > 0) {\n    Config.audioAccumulateSamples = true;\n  } else {\n    Config.audioAccumulateSamples = false;\n  }\n\n  if (tileRendering > 0) {\n    Config.tileRendering = true;\n  } else {\n    Config.tileRendering = false;\n  }\n\n  if (tileCaching > 0) {\n    Config.tileCaching = true;\n  } else {\n    Config.tileCaching = false;\n  }\n\n  if (enableAudioDebugging > 0) {\n    Config.enableAudioDebugging = true;\n  } else {\n    Config.enableAudioDebugging = false;\n  }\n\n  initialize();\n} // Function to initiialize the core\n\n\nfunction initialize() {\n  // Initialization variables from BGB\n  // First, try to switch to Gameboy Color Mode\n  // Get our GBC support from the cartridge header\n  // http://gbdev.gg8.se/wiki/articles/The_Cartridge_Header\n  var gbcType = eightBitLoadFromGBMemory(0x0143); // Detecting GBC http://bgb.bircd.org/pandocs.htm#cgbregisters\n\n  if (gbcType === 0xc0 || Config.useGbcWhenAvailable && gbcType === 0x80) {\n    Cpu.GBCEnabled = true;\n  } else {\n    Cpu.GBCEnabled = false;\n  } // Call our respective classes intialization\n\n\n  initializeCpu();\n  initializeCartridge();\n  initializeDma();\n  initializeGraphics();\n  initializePalette();\n  initializeSound();\n  initializeInterrupts();\n  initializeTimers();\n  initializeSerial(); // Various Other Registers\n\n  if (Cpu.GBCEnabled) {\n    // Various other registers\n    eightBitStoreIntoGBMemory(0xff70, 0xf8);\n    eightBitStoreIntoGBMemory(0xff4f, 0xfe);\n    eightBitStoreIntoGBMemory(0xff4d, 0x7e);\n    eightBitStoreIntoGBMemory(0xff00, 0xcf);\n    eightBitStoreIntoGBMemory(0xff0f, 0xe1); // 0xFFFF = 0x00\n    // Undocumented from Pandocs\n\n    eightBitStoreIntoGBMemory(0xff6c, 0xfe);\n    eightBitStoreIntoGBMemory(0xff75, 0x8f);\n  } else {\n    eightBitStoreIntoGBMemory(0xff70, 0xff);\n    eightBitStoreIntoGBMemory(0xff4f, 0xff);\n    eightBitStoreIntoGBMemory(0xff4d, 0xff);\n    eightBitStoreIntoGBMemory(0xff00, 0xcf);\n    eightBitStoreIntoGBMemory(0xff0f, 0xe1); // 0xFFFF = 0x00\n  } // Reset hasStarted, since we are now reset\n\n\n  setHasCoreStarted(false); // Reset our cycles ran\n\n  resetCycles();\n  resetSteps();\n} // Function to return if we are currently playing a GBC ROM\n\n\nfunction isGBC() {\n  if (Cpu.GBCEnabled) {\n    return 1;\n  }\n\n  return 0;\n} // Function to return an address to store into save state memory\n// this is to regulate our 20 slots\n// https://docs.google.com/spreadsheets/d/17xrEzJk5-sCB9J2mMJcVnzhbE-XH_NvczVSQH9OHvRk/edit?usp=sharing\n\n\nfunction getSaveStateMemoryOffset(offset, saveStateSlot) {\n  // 50 bytes per save state memory partiton sli32\n  return WASMBOY_STATE_LOCATION + offset + 50 * saveStateSlot;\n} // Function to save state to memory for all of our classes\n\n\nfunction saveState() {\n  Cpu.saveState();\n  Graphics.saveState();\n  Interrupts.saveState();\n  Joypad.saveState();\n  Memory.saveState();\n  Timers.saveState();\n  Sound.saveState();\n  Channel1.saveState();\n  Channel2.saveState();\n  Channel3.saveState();\n  Channel4.saveState(); // Reset hasStarted, since we are now reset\n\n  setHasCoreStarted(false); // Don't want to reset cycles here, as this does not reset the emulator\n} // Function to load state from memory for all of our classes\n\n\nfunction loadState() {\n  Cpu.loadState();\n  Graphics.loadState();\n  Interrupts.loadState();\n  Joypad.loadState();\n  Memory.loadState();\n  Timers.loadState();\n  Sound.loadState();\n  Channel1.loadState();\n  Channel2.loadState();\n  Channel3.loadState();\n  Channel4.loadState(); // Reset hasStarted, since we are now reset\n\n  setHasCoreStarted(false); // Reset our cycles ran\n\n  resetCycles();\n  resetSteps();\n} // Functions to get information about the emulator for debugging purposes\n\n\nfunction getRegisterA() {\n  return Cpu.registerA;\n}\n\nfunction getRegisterB() {\n  return Cpu.registerB;\n}\n\nfunction getRegisterC() {\n  return Cpu.registerC;\n}\n\nfunction getRegisterD() {\n  return Cpu.registerD;\n}\n\nfunction getRegisterE() {\n  return Cpu.registerE;\n}\n\nfunction getRegisterH() {\n  return Cpu.registerH;\n}\n\nfunction getRegisterL() {\n  return Cpu.registerL;\n}\n\nfunction getRegisterF() {\n  return Cpu.registerF;\n}\n\nfunction getProgramCounter() {\n  return Cpu.programCounter;\n}\n\nfunction getStackPointer() {\n  return Cpu.stackPointer;\n}\n\nfunction getOpcodeAtProgramCounter() {\n  return eightBitLoadFromGBMemory(Cpu.programCounter);\n} // Functions to debug graphical output\n// Some Simple internal getters\n\n\nfunction getLY() {\n  return Graphics.scanlineRegister;\n}\n\nfunction drawBackgroundMapToWasmMemory(showColor) {\n  // http://www.codeslinger.co.uk/pages/projects/gameboy/graphics.html\n  // Bit 7 - LCD Display Enable (0=Off, 1=On)\n  // Bit 6 - Window Tile Map Display Select (0=9800-9BFF, 1=9C00-9FFF)\n  // Bit 5 - Window Display Enable (0=Off, 1=On)\n  // Bit 4 - BG & Window Tile Data Select (0=8800-97FF, 1=8000-8FFF)\n  // Bit 3 - BG Tile Map Display Select (0=9800-9BFF, 1=9C00-9FFF)\n  // Bit 2 - OBJ (Sprite) Size (0=8x8, 1=8x16)\n  // Bit 1 - OBJ (Sprite) Display Enable (0=Off, 1=On)\n  // Bit 0 - BG Display (for CGB see below) (0=Off, 1=On)\n  // Get our seleted tile data memory location\n  var tileDataMemoryLocation = Graphics.memoryLocationTileDataSelectZeroStart;\n\n  if (Lcd.bgWindowTileDataSelect) {\n    tileDataMemoryLocation = Graphics.memoryLocationTileDataSelectOneStart;\n  }\n\n  var tileMapMemoryLocation = Graphics.memoryLocationTileMapSelectZeroStart;\n\n  if (Lcd.bgTileMapDisplaySelect) {\n    tileMapMemoryLocation = Graphics.memoryLocationTileMapSelectOneStart;\n  }\n\n  for (var y = 0; y < 256; y++) {\n    for (var x = 0; x < 256; x++) {\n      // Get our current Y\n      var pixelYPositionInMap = y; // Get our Current X position of our pixel on the on the 160x144 camera\n      // this is done by getting the current scroll X position,\n      // and adding it do what X Value the scanline is drawing on the camera.\n\n      var pixelXPositionInMap = x; // Divide our pixel position by 8 to get our tile.\n      // Since, there are 256x256 pixels, and 32x32 tiles.\n      // 256 / 8 = 32.\n      // Also, bitshifting by 3, do do a division by 8\n      // Need to use u16s, as they will be used to compute an address, which will cause weird errors and overflows\n\n      var tileXPositionInMap = pixelXPositionInMap >> 3;\n      var tileYPositionInMap = pixelYPositionInMap >> 3; // Get our tile address on the tileMap\n      // NOTE: (tileMap represents where each tile is displayed on the screen)\n      // NOTE: (tile map represents the entire map, now just what is within the \"camera\")\n      // For instance, if we have y pixel 144. 144 / 8 = 18. 18 * 32 = line address in map memory.\n      // And we have x pixel 160. 160 / 8 = 20.\n      // * 32, because remember, this is NOT only for the camera, the actual map is 32x32. Therefore, the next tile line of the map, is 32 byte offset.\n      // Think like indexing a 2d array, as a 1d array and it make sense :)\n\n      var tileMapAddress = tileMapMemoryLocation + tileYPositionInMap * 32 + tileXPositionInMap; // Get the tile Id on the Tile Map\n\n      var tileIdFromTileMap = loadFromVramBank(tileMapAddress, 0); // Now get our tileDataAddress for the corresponding tileID we found in the map\n      // Read the comments in _getTileDataAddress() to see what's going on.\n      // tl;dr if we had the tile map of \"a b c d\", and wanted tileId 2.\n      // This funcitons returns the start of memory locaiton for the tile 'c'.\n\n      var tileDataAddress = getTileDataAddress(tileDataMemoryLocation, tileIdFromTileMap); // Now we can process the the individual bytes that represent the pixel on a tile\n      // Get the y pixel of the 8 by 8 tile.\n      // Simply modulo the scanline.\n      // For instance, let's say we are printing the first line of pixels on our camera,\n      // And the first line of pixels on our tile.\n      // yPixel = 1. 1 % 8 = 1.\n      // And for the last line\n      // yPixel = 144. 144 % 8 = 0.\n      // 0 Represents last line of pixels in a tile, 1 represents first. 1 2 3 4 5 6 7 0.\n      // Because remember, we are counting lines on the display NOT including zero\n\n      var pixelYInTile = pixelYPositionInMap % 8; // Same logic as pixelYInTile.\n      // However, We need to reverse our byte,\n      // As pixel 0 is on byte 7, and pixel 1 is on byte 6, etc...\n      // Therefore, is pixelX was 2, then really is need to be 5\n      // So 2 - 7 = -5, * 1 = 5\n      // Or to simplify, 7 - 2 = 5 haha!\n\n      var pixelXInTile = pixelXPositionInMap % 8;\n      pixelXInTile = 7 - pixelXInTile; // Get the GB Map Attributes\n      // Bit 0-2  Background Palette number  (BGP0-7)\n      // Bit 3    Tile VRAM Bank number      (0=Bank 0, 1=Bank 1)\n      // Bit 4    Not used\n      // Bit 5    Horizontal Flip            (0=Normal, 1=Mirror horizontally)\n      // Bit 6    Vertical Flip              (0=Normal, 1=Mirror vertically)\n      // Bit 7    BG-to-OAM Priority         (0=Use OAM priority bit, 1=BG Priority)\n\n      var bgMapAttributes = 0;\n\n      if (Cpu.GBCEnabled && showColor > 0) {\n        bgMapAttributes = loadFromVramBank(tileMapAddress, 1);\n      }\n\n      if (checkBitOnByte(6, bgMapAttributes)) {\n        // We are mirroring the tile, therefore, we need to opposite byte\n        // So if our pizel was 0 our of 8, it wild become 7 :)\n        // TODO: This may be wrong :p\n        pixelYInTile = 7 - pixelYInTile;\n      } // Remember to represent a single line of 8 pixels on a tile, we need two bytes.\n      // Therefore, we need to times our modulo by 2, to get the correct line of pixels on the tile.\n      // But we need to load the time from a specific Vram bank\n\n\n      var vramBankId = 0;\n\n      if (checkBitOnByte(3, bgMapAttributes)) {\n        vramBankId = 1;\n      } // Remember to represent a single line of 8 pixels on a tile, we need two bytes.\n      // Therefore, we need to times our modulo by 2, to get the correct line of pixels on the tile.\n      // Again, think like you had to map a 2d array as a 1d.\n\n\n      var byteOneForLineOfTilePixels = loadFromVramBank(tileDataAddress + pixelYInTile * 2, vramBankId);\n      var byteTwoForLineOfTilePixels = loadFromVramBank(tileDataAddress + pixelYInTile * 2 + 1, vramBankId); // Now we can get the color for that pixel\n      // Colors are represented by getting X position of ByteTwo, and X positon of Byte One\n      // To Get the color Id.\n      // For example, the result of the color id is 0000 00[xPixelByteTwo][xPixelByteOne]\n      // See: How to draw a tile/sprite from memory: http://www.codeslinger.co.uk/pages/projects/gameboy/graphics.html\n\n      var paletteColorId = 0;\n\n      if (checkBitOnByte(pixelXInTile, byteTwoForLineOfTilePixels)) {\n        // Byte one represents the second bit in our color id, so bit shift\n        paletteColorId += 1;\n        paletteColorId = paletteColorId << 1;\n      }\n\n      if (checkBitOnByte(pixelXInTile, byteOneForLineOfTilePixels)) {\n        paletteColorId += 1;\n      } // FINALLY, RENDER THAT PIXEL!\n\n\n      var pixelStart = (y * 256 + x) * 3;\n\n      if (Cpu.GBCEnabled && showColor > 0) {\n        // Finally lets add some, C O L O R\n        // Want the botom 3 bits\n        var bgPalette = bgMapAttributes & 0x07; // Call the helper function to grab the correct color from the palette\n\n        var rgbColorPalette = getRgbColorFromPalette(bgPalette, paletteColorId, false); // Split off into red green and blue\n\n        var red = getColorComponentFromRgb(0, rgbColorPalette);\n        var green = getColorComponentFromRgb(1, rgbColorPalette);\n        var blue = getColorComponentFromRgb(2, rgbColorPalette);\n        var offset = BACKGROUND_MAP_LOCATION + pixelStart;\n        store(offset, red);\n        store(offset + 1, green);\n        store(offset + 2, blue);\n      } else {\n        // Only rendering camera for now, so coordinates are for the camera.\n        // Get the rgb value for the color Id, will be repeated into R, G, B\n        var monochromeColor = getMonochromeColorFromPalette(paletteColorId, Graphics.memoryLocationBackgroundPalette);\n\n        for (var i = 0; i < 3; i++) {\n          var offset = BACKGROUND_MAP_LOCATION + pixelStart + i;\n          store(offset, monochromeColor);\n        }\n      }\n    }\n  }\n}\n\nfunction drawTileDataToWasmMemory() {\n  for (var tileDataMapGridY = 0; tileDataMapGridY < 0x17; tileDataMapGridY++) {\n    for (var tileDataMapGridX = 0; tileDataMapGridX < 0x1f; tileDataMapGridX++) {\n      // Get Our VramBankID\n      var vramBankId = 0;\n\n      if (tileDataMapGridX > 0x0f) {\n        vramBankId = 1;\n      } // Get our tile ID\n\n\n      var tileId = tileDataMapGridY;\n\n      if (tileDataMapGridY > 0x0f) {\n        tileId -= 0x0f;\n      }\n\n      tileId = tileId << 4;\n\n      if (tileDataMapGridX > 0x0f) {\n        tileId = tileId + (tileDataMapGridX - 0x0f);\n      } else {\n        tileId = tileId + tileDataMapGridX;\n      } // Finally get our tile Data location\n\n\n      var tileDataMemoryLocation = Graphics.memoryLocationTileDataSelectOneStart;\n\n      if (tileDataMapGridY > 0x0f) {\n        tileDataMemoryLocation = Graphics.memoryLocationTileDataSelectZeroStart;\n      } // Draw each Y line of the tile\n\n\n      for (var tileLineY = 0; tileLineY < 8; tileLineY++) {\n        drawPixelsFromLineOfTile(tileId, // tileId\n        tileDataMemoryLocation, // Graphics.memoryLocationTileDataSelect\n        vramBankId, // Vram Bank\n        0, // Tile Line X Start\n        7, // Tile Line X End\n        tileLineY, // Tile Line Y\n        tileDataMapGridX * 8, // Output line X\n        tileDataMapGridY * 8 + tileLineY, // Output line Y\n        0x1f * 8, // Output Width\n        TILE_DATA_LOCATION, // Wasm Memory Start\n        true, // shouldRepresentMonochromeColorByColorId\n        0, // paletteLocation\n        -1, // bgMapAttributes\n        -1 // spriteAttributes\n        );\n      }\n    }\n  }\n}\n\nfunction drawOamToWasmMemory() {\n  // Draw all 40 sprites\n  // Going to be like BGB and do 8 x 5 sprites\n  for (var spriteRow = 0; spriteRow < 8; spriteRow++) {\n    for (var spriteColumn = 0; spriteColumn < 5; spriteColumn++) {\n      var spriteIndex = spriteColumn * 8 + spriteRow; // Sprites occupy 4 bytes in the sprite attribute table\n\n      var spriteTableIndex = spriteIndex * 4; // Y positon is offset by 16, X position is offset by 8\n\n      var spriteYPosition = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex);\n      var spriteXPosition = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex + 1);\n      var spriteTileId = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex + 2);\n      var tilesToDraw = 1;\n\n      if (Lcd.tallSpriteSize) {\n        // @binji says in 8x16 mode, even tileId always drawn first\n        // This will fix shantae sprites which always uses odd numbered indexes\n        // TODO: Do the actual Pandocs thing:\n        // \"In 8x16 mode, the lower bit of the tile number is ignored. Ie. the upper 8x8 tile is \"NN AND FEh\", and the lower 8x8 tile is \"NN OR 01h\".\"\n        // So just knock off the last bit? :)\n        if (spriteTileId % 2 === 1) {\n          spriteTileId -= 1;\n        }\n\n        tilesToDraw += 1;\n      } // Get our sprite attributes since we know we shall be drawing the tile\n\n\n      var spriteAttributes = eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable + spriteTableIndex + 3); // Find which VRAM Bank to load from\n\n      var vramBankId = 0;\n\n      if (Cpu.GBCEnabled && checkBitOnByte(3, spriteAttributes)) {\n        vramBankId = 1;\n      } // Start Drawing our tiles\n\n\n      for (var i = 0; i < tilesToDraw; i++) {\n        // Draw each Y line of the tile\n        for (var tileLineY = 0; tileLineY < 8; tileLineY++) {\n          drawPixelsFromLineOfTile(spriteTileId + i, // tileId\n          Graphics.memoryLocationTileDataSelectOneStart, // Graphics.memoryLocationTileDataSelect\n          vramBankId, // VRAM Bank\n          0, // Tile Line X Start\n          7, // Tile Line X End\n          tileLineY, // Tile Line Y\n          spriteRow * 8, // Output line X\n          spriteColumn * 16 + tileLineY + i * 8, // Output line Y\n          8 * 8, // Output Width\n          OAM_TILES_LOCATION, // Wasm Memory Start\n          true, // shouldRepresentMonochromeColorByColorId\n          0, // paletteLocation\n          -1, // bgMapAttributes\n          -1 // spriteAttributes\n          );\n        }\n      }\n    }\n  }\n}\n\nfunction getDIV() {\n  return Timers.dividerRegister;\n}\n\nfunction getTIMA() {\n  return Timers.timerCounter;\n}\n\nfunction getTMA() {\n  return Timers.timerModulo;\n}\n\nfunction getTAC() {\n  var response = Timers.timerInputClock;\n\n  if (Timers.timerEnabled) {\n    response = setBitOnByte(2, response);\n  }\n\n  return response;\n} // Functions to debug internal gameboy memory\n\n\nfunction updateDebugGBMemory() {\n  for (var i = 0; i < DEBUG_GAMEBOY_MEMORY_SIZE; i++) {\n    store(DEBUG_GAMEBOY_MEMORY_LOCATION + i, eightBitLoadFromGBMemoryWithTraps(i));\n  }\n} // These are legacy aliases for the original WasmBoy api\n// WasmBoy\n\n\nvar wasmMemorySize = WASMBOY_MEMORY_SIZE;\nvar wasmBoyInternalStateLocation = WASMBOY_STATE_LOCATION;\nvar wasmBoyInternalStateSize = WASMBOY_STATE_SIZE; // Gameboy\n\nvar gameBoyInternalMemoryLocation = GAMEBOY_INTERNAL_MEMORY_LOCATION;\nvar gameBoyInternalMemorySize = GAMEBOY_INTERNAL_MEMORY_SIZE; // Video output\n\nvar videoOutputLocation = GRAPHICS_OUTPUT_LOCATION;\nvar gameboyColorPaletteLocation = GBC_PALETTE_LOCATION;\nvar gameboyColorPaletteSize = GBC_PALETTE_SIZE;\nvar frameInProgressVideoOutputLocation = FRAME_LOCATION;\nvar backgroundMapLocation = BACKGROUND_MAP_LOCATION;\nvar tileDataMap = TILE_DATA_LOCATION; // Sound output\n\nvar soundOutputLocation = AUDIO_BUFFER_LOCATION; // Game Cartridge\n\nvar gameRamBanksLocation = CARTRIDGE_RAM_LOCATION; // Passed in Game backup or ROM from the user\n\nvar gameBytesLocation = CARTRIDGE_ROM_LOCATION; // Public Exports\n\nvar WasmBoyCore = /*#__PURE__*/Object.freeze({\n  memory: memory,\n  config: config,\n  hasCoreStarted: hasCoreStarted,\n  saveState: saveState,\n  loadState: loadState,\n  isGBC: isGBC,\n  getStepsPerStepSet: getStepsPerStepSet,\n  getStepSets: getStepSets,\n  getSteps: getSteps,\n  executeMultipleFrames: executeMultipleFrames,\n  executeFrame: executeFrame,\n  executeFrameAndCheckAudio: executeFrameAndCheckAudio,\n  executeFrameUntilBreakpoint: executeFrameUntilBreakpoint,\n  executeFrameAndCheckAudioUntilBreakpoint: executeFrameAndCheckAudioUntilBreakpoint,\n  executeUntilCondition: executeUntilCondition,\n  executeStep: executeStep,\n  getCyclesPerCycleSet: getCyclesPerCycleSet,\n  getCycleSets: getCycleSets,\n  getCycles: getCycles,\n  setJoypadState: setJoypadState,\n  getNumberOfSamplesInAudioBuffer: getNumberOfSamplesInAudioBuffer,\n  clearAudioBuffer: clearAudioBuffer,\n  WASMBOY_MEMORY_LOCATION: WASMBOY_MEMORY_LOCATION,\n  WASMBOY_MEMORY_SIZE: WASMBOY_MEMORY_SIZE,\n  WASMBOY_WASM_PAGES: WASMBOY_WASM_PAGES,\n  ASSEMBLYSCRIPT_MEMORY_LOCATION: ASSEMBLYSCRIPT_MEMORY_LOCATION,\n  ASSEMBLYSCRIPT_MEMORY_SIZE: ASSEMBLYSCRIPT_MEMORY_SIZE,\n  WASMBOY_STATE_LOCATION: WASMBOY_STATE_LOCATION,\n  WASMBOY_STATE_SIZE: WASMBOY_STATE_SIZE,\n  GAMEBOY_INTERNAL_MEMORY_LOCATION: GAMEBOY_INTERNAL_MEMORY_LOCATION,\n  GAMEBOY_INTERNAL_MEMORY_SIZE: GAMEBOY_INTERNAL_MEMORY_SIZE,\n  VIDEO_RAM_LOCATION: VIDEO_RAM_LOCATION,\n  VIDEO_RAM_SIZE: VIDEO_RAM_SIZE,\n  WORK_RAM_LOCATION: WORK_RAM_LOCATION,\n  WORK_RAM_SIZE: WORK_RAM_SIZE,\n  OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION: OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION,\n  OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE: OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE,\n  GRAPHICS_OUTPUT_LOCATION: GRAPHICS_OUTPUT_LOCATION,\n  GRAPHICS_OUTPUT_SIZE: GRAPHICS_OUTPUT_SIZE,\n  GBC_PALETTE_LOCATION: GBC_PALETTE_LOCATION,\n  GBC_PALETTE_SIZE: GBC_PALETTE_SIZE,\n  BG_PRIORITY_MAP_LOCATION: BG_PRIORITY_MAP_LOCATION,\n  BG_PRIORITY_MAP_SIZE: BG_PRIORITY_MAP_SIZE,\n  FRAME_LOCATION: FRAME_LOCATION,\n  FRAME_SIZE: FRAME_SIZE,\n  BACKGROUND_MAP_LOCATION: BACKGROUND_MAP_LOCATION,\n  BACKGROUND_MAP_SIZE: BACKGROUND_MAP_SIZE,\n  TILE_DATA_LOCATION: TILE_DATA_LOCATION,\n  TILE_DATA_SIZE: TILE_DATA_SIZE,\n  OAM_TILES_LOCATION: OAM_TILES_LOCATION,\n  OAM_TILES_SIZE: OAM_TILES_SIZE,\n  AUDIO_BUFFER_LOCATION: AUDIO_BUFFER_LOCATION,\n  AUDIO_BUFFER_SIZE: AUDIO_BUFFER_SIZE,\n  CHANNEL_1_BUFFER_LOCATION: CHANNEL_1_BUFFER_LOCATION,\n  CHANNEL_1_BUFFER_SIZE: CHANNEL_1_BUFFER_SIZE,\n  CHANNEL_2_BUFFER_LOCATION: CHANNEL_2_BUFFER_LOCATION,\n  CHANNEL_2_BUFFER_SIZE: CHANNEL_2_BUFFER_SIZE,\n  CHANNEL_3_BUFFER_LOCATION: CHANNEL_3_BUFFER_LOCATION,\n  CHANNEL_3_BUFFER_SIZE: CHANNEL_3_BUFFER_SIZE,\n  CHANNEL_4_BUFFER_LOCATION: CHANNEL_4_BUFFER_LOCATION,\n  CHANNEL_4_BUFFER_SIZE: CHANNEL_4_BUFFER_SIZE,\n  CARTRIDGE_RAM_LOCATION: CARTRIDGE_RAM_LOCATION,\n  CARTRIDGE_RAM_SIZE: CARTRIDGE_RAM_SIZE,\n  CARTRIDGE_ROM_LOCATION: CARTRIDGE_ROM_LOCATION,\n  CARTRIDGE_ROM_SIZE: CARTRIDGE_ROM_SIZE,\n  DEBUG_GAMEBOY_MEMORY_LOCATION: DEBUG_GAMEBOY_MEMORY_LOCATION,\n  DEBUG_GAMEBOY_MEMORY_SIZE: DEBUG_GAMEBOY_MEMORY_SIZE,\n  getWasmBoyOffsetFromGameBoyOffset: getWasmBoyOffsetFromGameBoyOffset,\n  getRegisterA: getRegisterA,\n  getRegisterB: getRegisterB,\n  getRegisterC: getRegisterC,\n  getRegisterD: getRegisterD,\n  getRegisterE: getRegisterE,\n  getRegisterH: getRegisterH,\n  getRegisterL: getRegisterL,\n  getRegisterF: getRegisterF,\n  getProgramCounter: getProgramCounter,\n  getStackPointer: getStackPointer,\n  getOpcodeAtProgramCounter: getOpcodeAtProgramCounter,\n  getLY: getLY,\n  drawBackgroundMapToWasmMemory: drawBackgroundMapToWasmMemory,\n  drawTileDataToWasmMemory: drawTileDataToWasmMemory,\n  drawOamToWasmMemory: drawOamToWasmMemory,\n  getDIV: getDIV,\n  getTIMA: getTIMA,\n  getTMA: getTMA,\n  getTAC: getTAC,\n  updateDebugGBMemory: updateDebugGBMemory,\n  update: executeFrame,\n  emulationStep: executeStep,\n  getAudioQueueIndex: getNumberOfSamplesInAudioBuffer,\n  resetAudioQueue: clearAudioBuffer,\n  wasmMemorySize: wasmMemorySize,\n  wasmBoyInternalStateLocation: wasmBoyInternalStateLocation,\n  wasmBoyInternalStateSize: wasmBoyInternalStateSize,\n  gameBoyInternalMemoryLocation: gameBoyInternalMemoryLocation,\n  gameBoyInternalMemorySize: gameBoyInternalMemorySize,\n  videoOutputLocation: videoOutputLocation,\n  frameInProgressVideoOutputLocation: frameInProgressVideoOutputLocation,\n  gameboyColorPaletteLocation: gameboyColorPaletteLocation,\n  gameboyColorPaletteSize: gameboyColorPaletteSize,\n  backgroundMapLocation: backgroundMapLocation,\n  tileDataMap: tileDataMap,\n  soundOutputLocation: soundOutputLocation,\n  gameBytesLocation: gameBytesLocation,\n  gameRamBanksLocation: gameRamBanksLocation\n});\n\nconst getWasmBoyTsCore = async () => {\n  const response = {\n    instance: {\n      exports: WasmBoyCore\n    },\n    byteMemory: memory.wasmByteMemory,\n    type: 'TypeScript'\n  };\n  return response;\n};\n\nexport default getWasmBoyTsCore;\n","// Common Static functions\n\n// Function to get performance timestamp\n// This is to support node vs. Browser\nexport const getPerformanceTimestamp = () => {\n  if (typeof window !== 'undefined') {\n    return performance.now();\n  }\n  return Date.now();\n};\n","import { getPerformanceTimestamp } from '../../common/common';\n\n// Function to add a timestamp to keep track\n// of how fast we are running\nexport function addTimeStamp(libWorker) {\n  // Track our Fps\n  // http://www.growingwiththeweb.com/2017/12/fast-simple-js-fps-counter.html\n  const currentHighResTime = getPerformanceTimestamp();\n  while (libWorker.fpsTimeStamps[0] < currentHighResTime - 1000) {\n    libWorker.fpsTimeStamps.shift();\n  }\n  libWorker.fpsTimeStamps.push(currentHighResTime);\n\n  libWorker.timeStampsUntilReady--;\n  if (libWorker.timeStampsUntilReady < 0) {\n    libWorker.timeStampsUntilReady = 0;\n  }\n\n  return currentHighResTime;\n}\n\n// Function to wait for a specified number,\n// of timestamps before setting the framerate\nexport function waitForTimeStampsForFrameRate(libWorker) {\n  if (libWorker.options.gameboyFrameRate <= 90) {\n    libWorker.timeStampsUntilReady = Math.floor(libWorker.options.gameboyFrameRate) * 1.25;\n  } else {\n    // Fast stretching should be hardcoded, that way it doesn't just say a large number for a long time\n    libWorker.timeStampsUntilReady = 120;\n  }\n}\n","// Imports\nimport { postMessage } from '../../../worker/workerapi';\nimport { getSmartWorkerMessage } from '../../../worker/smartworker';\nimport { WORKER_MESSAGE_TYPE, MEMORY_TYPE } from '../../../worker/constants';\n\nexport function transferGraphics(libWorker) {\n  const graphicsFrameEndIndex = libWorker.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION + libWorker.WASMBOY_CURRENT_FRAME_SIZE;\n  const graphicsFrameBuffer = libWorker.wasmByteMemory.slice(libWorker.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION, graphicsFrameEndIndex).buffer;\n  //libWorker.graphicsWorkerPort.postMessage(graphicsFrameBuffer, [graphicsFrameBuffer]);\n  libWorker.graphicsWorkerPort.postMessage(\n    getSmartWorkerMessage({\n      type: WORKER_MESSAGE_TYPE.UPDATED,\n      graphicsFrameBuffer\n    }),\n    [graphicsFrameBuffer]\n  );\n}\n","// Start our update and render process\n// Can't time by raf, as raf is not garunteed to be 60fps\n// Need to run like a web game, where updates to the state of the core are done a 60 fps\n// but we can render whenever the user would actually see the changes browser side in a raf\n// https://developer.mozilla.org/en-US/docs/Games/Anatomy\n\n// Imports\nimport { postMessage } from '../../worker/workerapi';\nimport { getSmartWorkerMessage } from '../../worker/smartworker';\nimport { WORKER_MESSAGE_TYPE, MEMORY_TYPE } from '../../worker/constants';\n\n// Memory\nimport { getCartridgeRam } from './memory/ram.js';\nimport { getGameBoyMemory } from './memory/gameboymemory.js';\nimport { getPaletteMemory } from './memory/palettememory.js';\nimport { getInternalState } from './memory/internalstate.js';\n\n// Timestamps\nimport { getPerformanceTimestamp } from '../../common/common';\nimport { addTimeStamp, waitForTimeStampsForFrameRate } from './timestamp';\n\n// Transferring\nimport { transferGraphics } from './graphics/transfer';\n\n// Some variables to help with Audio Latency\n// 0.25 (quarter of a second), just felt right from testing :)\nconst MAX_AUDIO_LATENCY = 0.25;\n// Pass over samples once we have enough worth playing:\n// https://www.reddit.com/r/EmuDev/comments/5gkwi5/gb_apu_sound_emulation/\nconst AUDIO_BUFFER_SIZE = 1024;\n\n// FPS measuring\nlet currentHighResTime;\nlet currentFps;\nlet gameboyFrameRateWithSpeed;\n\n// interval to set timeout\nlet intervalRate;\n\nfunction scheduleNextUpdate(libWorker) {\n  // Get our high res time\n  const highResTime = getPerformanceTimestamp();\n\n  // Find how long it has been since the last timestamp\n  const timeSinceLastTimestamp = highResTime - libWorker.fpsTimeStamps[libWorker.fpsTimeStamps.length - 1];\n\n  // Get the next time we should update using our interval rate\n  let nextUpdateTime = intervalRate - timeSinceLastTimestamp;\n  if (nextUpdateTime < 0) {\n    nextUpdateTime = 0;\n  }\n\n  // Lastly, increase by our lib worker speed\n  if (libWorker.speed && libWorker.speed > 0) {\n    nextUpdateTime = nextUpdateTime / libWorker.speed;\n  }\n\n  libWorker.updateId = setTimeout(() => {\n    update(libWorker);\n  }, Math.floor(nextUpdateTime));\n}\n\n// Function to run an update on the emulator itself\nexport function update(libWorker, passedIntervalRate) {\n  // Don't run if paused\n  if (libWorker.paused) {\n    return true;\n  }\n\n  // Set the intervalRate if it was passed\n  if (passedIntervalRate !== undefined) {\n    intervalRate = passedIntervalRate;\n  }\n\n  // Set a timestamp for this moment\n  // And make sure we are on track for FPS\n  currentFps = libWorker.getFPS();\n  gameboyFrameRateWithSpeed = libWorker.options.gameboyFrameRate + 1;\n\n  if (libWorker.speed && libWorker.speed > 0) {\n    gameboyFrameRateWithSpeed = gameboyFrameRateWithSpeed * libWorker.speed;\n  }\n\n  if (currentFps > gameboyFrameRateWithSpeed) {\n    // Pop a timestamp off of the front\n    // This is to avoid infinite loop here on loadstate\n    libWorker.fpsTimeStamps.shift();\n    scheduleNextUpdate(libWorker);\n    return true;\n  } else {\n    currentHighResTime = addTimeStamp(libWorker);\n  }\n\n  // Check if we are outputting audio\n  const shouldCheckAudio = !libWorker.options.headless && !libWorker.pauseFpsThrottle && libWorker.options.isAudioEnabled;\n\n  // Execute\n  // Wrapped in promise to better handle audio slowdowns and things of that sort\n  const executePromise = new Promise(resolve => {\n    // Update (Execute a frame)\n    let response;\n    if (shouldCheckAudio) {\n      executeAndCheckAudio(libWorker, resolve);\n    } else {\n      if (libWorker.breakpoint !== undefined) {\n        response = libWorker.wasmInstance.exports.executeFrameUntilBreakpoint(libWorker.breakpoint);\n      } else {\n        response = libWorker.wasmInstance.exports.executeFrame();\n      }\n      resolve(response);\n    }\n  });\n\n  executePromise.then(response => {\n    // Handle our update() response\n    if (response >= 0) {\n      // Pass messages to everyone\n      postMessage(\n        getSmartWorkerMessage({\n          type: WORKER_MESSAGE_TYPE.UPDATED,\n          fps: currentFps\n        })\n      );\n\n      // Check if we have frameskip\n      let shouldSkipRenderingFrame = false;\n      if (libWorker.options.frameSkip && libWorker.options.frameSkip > 0) {\n        libWorker.frameSkipCounter++;\n\n        if (libWorker.frameSkipCounter <= libWorker.options.frameSkip) {\n          shouldSkipRenderingFrame = true;\n        } else {\n          libWorker.frameSkipCounter = 0;\n        }\n      }\n\n      // Transfer Graphics\n      if (!shouldSkipRenderingFrame) {\n        transferGraphics(libWorker);\n      }\n\n      // Transfer Memory for things like save states\n      const memoryObject = {\n        type: WORKER_MESSAGE_TYPE.UPDATED\n      };\n      memoryObject[MEMORY_TYPE.CARTRIDGE_RAM] = getCartridgeRam(libWorker).buffer;\n      memoryObject[MEMORY_TYPE.GAMEBOY_MEMORY] = getGameBoyMemory(libWorker).buffer;\n      memoryObject[MEMORY_TYPE.PALETTE_MEMORY] = getPaletteMemory(libWorker).buffer;\n      memoryObject[MEMORY_TYPE.INTERNAL_STATE] = getInternalState(libWorker).buffer;\n\n      // Check for any undefined values\n      Object.keys(memoryObject).forEach(key => {\n        if (memoryObject[key] === undefined) {\n          memoryObject[key] = new Uint8Array().buffer;\n        }\n      });\n\n      libWorker.memoryWorkerPort.postMessage(getSmartWorkerMessage(memoryObject), [\n        memoryObject[MEMORY_TYPE.CARTRIDGE_RAM],\n        memoryObject[MEMORY_TYPE.GAMEBOY_MEMORY],\n        memoryObject[MEMORY_TYPE.PALETTE_MEMORY],\n        memoryObject[MEMORY_TYPE.INTERNAL_STATE]\n      ]);\n\n      // Check if we hit a breakpoint\n      if (response === 2) {\n        postMessage(\n          getSmartWorkerMessage({\n            type: WORKER_MESSAGE_TYPE.BREAKPOINT\n          })\n        );\n      } else {\n        scheduleNextUpdate(libWorker);\n      }\n    } else {\n      postMessage(\n        getSmartWorkerMessage({\n          type: WORKER_MESSAGE_TYPE.CRASHED\n        })\n      );\n      libWorker.paused = true;\n    }\n  });\n}\n\n// If audio is enabled, sync by audio\n// Audio will pass us its forward latency, and if it is too far ahead,\n// Then we can wait a little bit to let audio catch up\n// 0.25 (quarter of a second), just felt right from testing :)\nfunction executeAndCheckAudio(libWorker, resolve) {\n  // Get our response\n  let response = -1;\n  if (libWorker.breakpoint !== undefined) {\n    response = libWorker.wasmInstance.exports.executeFrameAndCheckAudioUntilBreakpoint(AUDIO_BUFFER_SIZE, libWorker.breakpoint);\n  } else {\n    response = libWorker.wasmInstance.exports.executeFrameAndCheckAudio(AUDIO_BUFFER_SIZE);\n  }\n\n  // If our response is not 1, simply resolve\n  if (response !== 1) {\n    resolve(response);\n  }\n\n  // Do some audio magic\n  if (response === 1) {\n    // Get our audioQueueIndex\n    const audioQueueIndex = libWorker.wasmInstance.exports.getAudioQueueIndex();\n\n    // Check if we are sending too much audio\n    const isTooMuchLatency = libWorker.currentAudioLatencyInSeconds > MAX_AUDIO_LATENCY;\n    const isRunningFullSpeed = currentFps >= gameboyFrameRateWithSpeed;\n\n    if (isTooMuchLatency && isRunningFullSpeed) {\n      sendAudio(libWorker, audioQueueIndex);\n      // Wait, Set a timeout for when we would like to\n      // Continue executing. * 1000 for seconds -> milli\n      // Wait for half the difference, since it may take time to execute, and things\n      const latencyDifferenceInSeconds = libWorker.currentAudioLatencyInSeconds - MAX_AUDIO_LATENCY;\n      const latencyDifferenceInMilli = Math.floor(latencyDifferenceInSeconds * 1000);\n      setTimeout(() => {\n        waitForTimeStampsForFrameRate(libWorker);\n        executeAndCheckAudio(libWorker, resolve);\n      }, Math.floor(latencyDifferenceInMilli / 10));\n    } else {\n      sendAudio(libWorker, audioQueueIndex);\n      executeAndCheckAudio(libWorker, resolve);\n    }\n  }\n}\n\nfunction sendAudio(libWorker, audioQueueIndex) {\n  // Send out our audio\n  // audioQueueIndex * 2, because audio Queue index represents 1 sample,\n  // for left AND right channel. Therefore the end index is, twice\n  // of the audioQueueIndex\n\n  // Build our message bits\n  const audioBuffer = libWorker.wasmByteMemory.slice(\n    libWorker.WASMBOY_SOUND_OUTPUT_LOCATION,\n    libWorker.WASMBOY_SOUND_OUTPUT_LOCATION + audioQueueIndex * 2\n  ).buffer;\n  const message = {\n    type: WORKER_MESSAGE_TYPE.UPDATED,\n    audioBuffer,\n    numberOfSamples: audioQueueIndex,\n    fps: currentFps,\n    allowFastSpeedStretching: libWorker.options.gameboyFrameRate > 60\n  };\n  const messageTransferrables = [audioBuffer];\n\n  // If audio debugging is enabled, we gotta send a lot more\n  if (libWorker.options && libWorker.options.enableAudioDebugging) {\n    // Channel 1\n    const channel1Buffer = libWorker.wasmByteMemory.slice(\n      libWorker.WASMBOY_CHANNEL_1_OUTPUT_LOCATION,\n      libWorker.WASMBOY_CHANNEL_1_OUTPUT_LOCATION + audioQueueIndex * 2\n    ).buffer;\n    message.channel1Buffer = channel1Buffer;\n    messageTransferrables.push(channel1Buffer);\n\n    // Channel 2\n    const channel2Buffer = libWorker.wasmByteMemory.slice(\n      libWorker.WASMBOY_CHANNEL_2_OUTPUT_LOCATION,\n      libWorker.WASMBOY_CHANNEL_2_OUTPUT_LOCATION + audioQueueIndex * 2\n    ).buffer;\n    message.channel2Buffer = channel2Buffer;\n    messageTransferrables.push(channel2Buffer);\n\n    // Channel 3\n    const channel3Buffer = libWorker.wasmByteMemory.slice(\n      libWorker.WASMBOY_CHANNEL_3_OUTPUT_LOCATION,\n      libWorker.WASMBOY_CHANNEL_3_OUTPUT_LOCATION + audioQueueIndex * 2\n    ).buffer;\n    message.channel3Buffer = channel3Buffer;\n    messageTransferrables.push(channel3Buffer);\n\n    // Channel 4\n    const channel4Buffer = libWorker.wasmByteMemory.slice(\n      libWorker.WASMBOY_CHANNEL_4_OUTPUT_LOCATION,\n      libWorker.WASMBOY_CHANNEL_4_OUTPUT_LOCATION + audioQueueIndex * 2\n    ).buffer;\n    message.channel4Buffer = channel4Buffer;\n    messageTransferrables.push(channel4Buffer);\n  }\n\n  libWorker.audioWorkerPort.postMessage(getSmartWorkerMessage(message), messageTransferrables);\n  libWorker.wasmInstance.exports.resetAudioQueue();\n}\n","// Web worker for wasmboy lib\n// Will be used for running wasm, and controlling child workers.\n\n// Using transferables: https://stackoverflow.com/questions/16071211/using-transferable-objects-from-a-web-worker\n\nimport { postMessage, onMessage } from '../../worker/workerapi';\nimport { WORKER_MESSAGE_TYPE, WORKER_ID } from '../../worker/constants';\nimport { getEventData, isInBrowser } from '../../worker/util';\nimport { getSmartWorkerMessage } from '../../worker/smartworker';\n\n// Post message handlers\nimport { graphicsWorkerOnMessage } from './graphics/onmessage';\nimport { audioWorkerOnMessage } from './audio/onmessage';\nimport { controllerWorkerOnMessage } from './controller/onmessage';\nimport { memoryWorkerOnMessage } from './memory/onmessage';\n\n// Only One response will be used on build time\n// Using Babel plugin to filter imports\nimport getWasmBoyWasmCore from '../../../dist/core/getWasmBoyWasmCore.esm';\nimport getWasmBoyTsCore from '../../../dist/core/getWasmBoyTsCore.esm';\n\n// Update to run the core emulator\nimport { update } from './update';\n\n// Timestamps\nimport { waitForTimeStampsForFrameRate } from './timestamp';\n\n// Transfer\nimport { transferGraphics } from './graphics/transfer';\n\n// Our stateful object\n// Representing our lib worker as a singleton\n// Not using normal classes because:\n// Class functions weren't working for some odd reason, and 'this' was getting wonky\nlet libWorker;\nlibWorker = {\n  // Wasmboy Module Ports\n  graphicsWorkerPort: undefined,\n  memoryWorkerPort: undefined,\n  controllerWorkerPort: undefined,\n  audioWorkerPort: undefined,\n\n  // Wasm Module Properties\n  wasmInstance: undefined,\n  wasmByteMemory: undefined,\n\n  // Lib options\n  options: undefined,\n\n  // Some Constants from the wasm module\n  WASMBOY_GAME_BYTES_LOCATION: 0,\n  WASMBOY_GAME_RAM_BANKS_LOCATION: 0,\n  WASMBOY_INTERNAL_STATE_SIZE: 0,\n  WASMBOY_INTERNAL_STATE_LOCATION: 0,\n  WASMBOY_INTERNAL_MEMORY_SIZE: 0,\n  WASMBOY_INTERNAL_MEMORY_LOCATION: 0,\n  WASMBOY_PALETTE_MEMORY_SIZE: 0,\n  WASMBOY_PALETTE_MEMORY_LOCATION: 0,\n  WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION: 0,\n  WASMBOY_CURRENT_FRAME_SIZE: 0,\n  WASMBOY_SOUND_OUTPUT_LOCATION: 0,\n  WASMBOY_CHANNEL_1_OUTPUT_LOCATION: 0,\n  WASMBOY_CHANNEL_2_OUTPUT_LOCATION: 0,\n  WASMBOY_CHANNEL_3_OUTPUT_LOCATION: 0,\n  WASMBOY_CHANNEL_4_OUTPUT_LOCATION: 0,\n\n  // Playing state\n  paused: true,\n\n  // Our update setTimeout ref\n  updateId: undefined,\n\n  // Our fps timestamps\n  timeStampsUntilReady: 0,\n  fpsTimeStamps: [],\n\n  // Our current speed\n  speed: 0,\n\n  // Frame Skipping\n  frameSkipCounter: 0,\n\n  // Audio latency\n  currentAudioLatencyInSeconds: 0,\n\n  // Break Point\n  breakpoint: undefined,\n\n  // Message Handler from the main thread\n  messageHandler: event => {\n    // Handle our messages from the main thread\n    const eventData = getEventData(event);\n\n    switch (eventData.message.type) {\n      case WORKER_MESSAGE_TYPE.CONNECT: {\n        // Assign our worker ports on connect\n        if (eventData.message.workerId === WORKER_ID.GRAPHICS) {\n          libWorker.graphicsWorkerPort = eventData.message.ports[0];\n          onMessage(graphicsWorkerOnMessage.bind(undefined, libWorker), libWorker.graphicsWorkerPort);\n        } else if (eventData.message.workerId === WORKER_ID.MEMORY) {\n          libWorker.memoryWorkerPort = eventData.message.ports[0];\n          onMessage(memoryWorkerOnMessage.bind(undefined, libWorker), libWorker.memoryWorkerPort);\n        } else if (eventData.message.workerId === WORKER_ID.CONTROLLER) {\n          libWorker.controllerWorkerPort = eventData.message.ports[0];\n          onMessage(controllerWorkerOnMessage.bind(undefined, libWorker), libWorker.controllerWorkerPort);\n        } else if (eventData.message.workerId === WORKER_ID.AUDIO) {\n          libWorker.audioWorkerPort = eventData.message.ports[0];\n          onMessage(audioWorkerOnMessage.bind(undefined, libWorker), libWorker.audioWorkerPort);\n        }\n\n        // Simply post back that we are ready\n        postMessage(getSmartWorkerMessage(undefined, eventData.messageId));\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.INSTANTIATE_WASM: {\n        const instantiateTask = async () => {\n          let response;\n          // Only One response will be used on build time\n          // Using Babel plugin to filter imports\n          response = await getWasmBoyWasmCore(isInBrowser);\n          response = await getWasmBoyTsCore();\n\n          libWorker.wasmInstance = response.instance;\n          libWorker.wasmByteMemory = response.byteMemory;\n          postMessage(\n            getSmartWorkerMessage(\n              {\n                type: response.type\n              },\n              eventData.messageId\n            )\n          );\n          return;\n        };\n        instantiateTask();\n        return;\n      }\n      case WORKER_MESSAGE_TYPE.CONFIG: {\n        // Config will come in as an array, pass in values using apply\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\n        const config = eventData.message.config;\n        libWorker.wasmInstance.exports.config.apply(libWorker, config);\n        libWorker.options = eventData.message.options;\n        postMessage(getSmartWorkerMessage(undefined, eventData.messageId));\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.RESET_AUDIO_QUEUE: {\n        // Reset the audio queue index to stop weird pauses when trying to load a game\n        libWorker.wasmInstance.exports.resetAudioQueue();\n        postMessage(getSmartWorkerMessage(undefined, eventData.messageId));\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.PLAY:\n      case WORKER_MESSAGE_TYPE.PLAY_UNTIL_BREAKPOINT: {\n        if (!libWorker.paused || !libWorker.wasmInstance || !libWorker.wasmByteMemory) {\n          postMessage(getSmartWorkerMessage({ error: true }, eventData.messageId));\n          return;\n        }\n\n        // Re-initialize some of our values\n        libWorker.paused = false;\n        libWorker.fpsTimeStamps = [];\n        waitForTimeStampsForFrameRate(libWorker);\n        libWorker.frameSkipCounter = 0;\n        libWorker.currentAudioLatencyInSeconds = 0;\n        libWorker.breakpoint = undefined;\n\n        // Set our breakpoint if we have one\n        if (eventData.message.breakpoint) {\n          libWorker.breakpoint = eventData.message.breakpoint;\n        }\n\n        // 1000 / 60 = 60fps\n        // Add one to the framerate, as we would rather be slightly faster,\n        // than slightly slower\n        const intervalRate = 1000 / libWorker.options.gameboyFrameRate;\n\n        update(libWorker, intervalRate);\n\n        postMessage(getSmartWorkerMessage(undefined, eventData.messageId));\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.PAUSE: {\n        // Call our update\n        libWorker.paused = true;\n        if (libWorker.updateId) {\n          clearTimeout(libWorker.updateId);\n          libWorker.updateId = undefined;\n        }\n        postMessage(getSmartWorkerMessage(undefined, eventData.messageId));\n        return;\n      }\n\n      // Debugging Messages\n      case WORKER_MESSAGE_TYPE.RUN_WASM_EXPORT: {\n        let response;\n        if (eventData.message.parameters) {\n          response = libWorker.wasmInstance.exports[eventData.message.export].apply(undefined, eventData.message.parameters);\n        } else {\n          response = libWorker.wasmInstance.exports[eventData.message.export]();\n        }\n        postMessage(\n          getSmartWorkerMessage(\n            {\n              type: WORKER_MESSAGE_TYPE.RUN_WASM_EXPORT,\n              response: response\n            },\n            eventData.messageId\n          )\n        );\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.GET_WASM_MEMORY_SECTION: {\n        let start = 0;\n        let end = libWorker.wasmByteMemory.length;\n        if (eventData.message.start) {\n          start = eventData.message.start;\n        }\n        if (eventData.message.end) {\n          end = eventData.message.end;\n        }\n\n        const response = libWorker.wasmByteMemory.slice(start, end).buffer;\n        postMessage(\n          getSmartWorkerMessage(\n            {\n              type: WORKER_MESSAGE_TYPE.RUN_WASM_EXPORT,\n              response: response\n            },\n            eventData.messageId\n          ),\n          [response]\n        );\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.GET_WASM_CONSTANT: {\n        const response = libWorker.wasmInstance.exports[eventData.message.constant].valueOf();\n        postMessage(\n          getSmartWorkerMessage(\n            {\n              type: WORKER_MESSAGE_TYPE.GET_WASM_CONSTANT,\n              response: response\n            },\n            eventData.messageId\n          )\n        );\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.FORCE_OUTPUT_FRAME: {\n        transferGraphics(libWorker);\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.SET_SPEED: {\n        libWorker.speed = eventData.message.speed;\n\n        // Reset all of our fps tracking\n        libWorker.fpsTimeStamps = [];\n        libWorker.timeStampsUntilReady = 60;\n        waitForTimeStampsForFrameRate(libWorker);\n        libWorker.frameSkipCounter = 0;\n        libWorker.currentAudioLatencyInSeconds = 0;\n\n        libWorker.wasmInstance.exports.resetAudioQueue();\n        return;\n      }\n\n      case WORKER_MESSAGE_TYPE.IS_GBC: {\n        const response = libWorker.wasmInstance.exports.isGBC() > 0;\n\n        postMessage(\n          getSmartWorkerMessage(\n            {\n              type: WORKER_MESSAGE_TYPE.IS_GBC,\n              response: response\n            },\n            eventData.messageId\n          )\n        );\n        return;\n      }\n\n      default: {\n        //handle other messages from main\n        console.log('Unknown WasmBoy Worker message:', eventData);\n      }\n    }\n  },\n\n  // Function to return the current FPS\n  // http://www.growingwiththeweb.com/2017/12/fast-simple-js-fps-counter.html\n  getFPS: () => {\n    if (libWorker.timeStampsUntilReady > 0) {\n      if (libWorker.speed && libWorker.speed > 0) {\n        return libWorker.options.gameboyFrameRate * libWorker.speed;\n      }\n      return libWorker.options.gameboyFrameRate;\n    } else if (libWorker.fpsTimeStamps) {\n      return libWorker.fpsTimeStamps.length;\n    }\n\n    return 0;\n  }\n};\n\n// Assign the worker a message handler\nonMessage(libWorker.messageHandler);\n"],"names":["getEventData","event","data","isInBrowser","self","parentPort","require","postMessage","message","transferArray","onMessage","callback","port","console","error","onmessage","on","WORKER_MESSAGE_TYPE","CONNECT","INSTANTIATE_WASM","CLEAR_MEMORY","CLEAR_MEMORY_DONE","GET_MEMORY","SET_MEMORY","SET_MEMORY_DONE","GET_CONSTANTS","GET_CONSTANTS_DONE","CONFIG","RESET_AUDIO_QUEUE","PLAY","PLAY_UNTIL_BREAKPOINT","BREAKPOINT","PAUSE","UPDATED","CRASHED","SET_JOYPAD_STATE","AUDIO_LATENCY","RUN_WASM_EXPORT","GET_WASM_MEMORY_SECTION","GET_WASM_CONSTANT","FORCE_OUTPUT_FRAME","SET_SPEED","IS_GBC","WORKER_ID","LIB","GRAPHICS","MEMORY","CONTROLLER","AUDIO","MEMORY_TYPE","CARTRIDGE_RAM","CARTRIDGE_ROM","CARTRIDGE_HEADER","GAMEBOY_MEMORY","PALETTE_MEMORY","INTERNAL_STATE","idCounter","generateId","randomId","Math","random","toString","replace","substr","id","getSmartWorkerMessage","messageId","workerId","graphicsWorkerOnMessage","libWorker","eventData","type","WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION","wasmInstance","exports","frameInProgressVideoOutputLocation","valueOf","WASMBOY_CURRENT_FRAME_SIZE","FRAME_SIZE","graphicsWorkerPort","audioWorkerOnMessage","WASMBOY_SOUND_OUTPUT_LOCATION","soundOutputLocation","WASMBOY_CHANNEL_1_OUTPUT_LOCATION","CHANNEL_1_BUFFER_LOCATION","WASMBOY_CHANNEL_2_OUTPUT_LOCATION","CHANNEL_2_BUFFER_LOCATION","WASMBOY_CHANNEL_3_OUTPUT_LOCATION","CHANNEL_3_BUFFER_LOCATION","WASMBOY_CHANNEL_4_OUTPUT_LOCATION","CHANNEL_4_BUFFER_LOCATION","audioWorkerPort","currentAudioLatencyInSeconds","latency","controllerWorkerOnMessage","setJoypadStateParamsAsArray","setJoypadState","apply","getCartridgeRom","wasmByteMemory","Uint8Array","cartridgeType","WASMBOY_GAME_BYTES_LOCATION","romSize","undefined","cartridgeRom","slice","getCartridgeRam","ramSize","cartridgeRam","WASMBOY_GAME_RAM_BANKS_LOCATION","getCartridgeHeader","headerLength","headerLocation","headerArray","getGameBoyMemory","WASMBOY_INTERNAL_MEMORY_LOCATION","WASMBOY_INTERNAL_MEMORY_SIZE","getPaletteMemory","WASMBOY_PALETTE_MEMORY_LOCATION","WASMBOY_PALETTE_MEMORY_SIZE","getInternalState","saveState","WASMBOY_INTERNAL_STATE_LOCATION","WASMBOY_INTERNAL_STATE_SIZE","memoryWorkerOnMessage","i","length","memoryWorkerPort","buffer","gameBytesLocation","gameRamBanksLocation","wasmBoyInternalStateSize","wasmBoyInternalStateLocation","gameBoyInternalMemorySize","gameBoyInternalMemoryLocation","gameboyColorPaletteSize","gameboyColorPaletteLocation","memoryKeys","Object","keys","includes","set","loadState","responseMemory","responseTransferrables","memoryTypes","push","cartridgeHeader","gameboyMemory","paletteMemory","internalState","wasmboyMemorySize","Uint8ClampedArray","memory","size","grow","load","offset","store","value","abs","ceil","ASSEMBLYSCRIPT_MEMORY_LOCATION","ASSEMBLYSCRIPT_MEMORY_SIZE","WASMBOY_STATE_LOCATION","WASMBOY_STATE_SIZE","VIDEO_RAM_LOCATION","VIDEO_RAM_SIZE","WORK_RAM_LOCATION","WORK_RAM_SIZE","OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION","OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE","GAMEBOY_INTERNAL_MEMORY_LOCATION","GAMEBOY_INTERNAL_MEMORY_SIZE","GBC_PALETTE_LOCATION","GBC_PALETTE_SIZE","BG_PRIORITY_MAP_LOCATION","BG_PRIORITY_MAP_SIZE","FRAME_LOCATION","BACKGROUND_MAP_LOCATION","BACKGROUND_MAP_SIZE","TILE_DATA_LOCATION","TILE_DATA_SIZE","OAM_TILES_LOCATION","OAM_TILES_SIZE","GRAPHICS_OUTPUT_LOCATION","GRAPHICS_OUTPUT_SIZE","CHANNEL_1_BUFFER_SIZE","CHANNEL_2_BUFFER_SIZE","CHANNEL_3_BUFFER_SIZE","CHANNEL_4_BUFFER_SIZE","AUDIO_BUFFER_LOCATION","AUDIO_BUFFER_SIZE","CARTRIDGE_RAM_LOCATION","CARTRIDGE_RAM_SIZE","CARTRIDGE_ROM_LOCATION","CARTRIDGE_ROM_SIZE","DEBUG_GAMEBOY_MEMORY_LOCATION","DEBUG_GAMEBOY_MEMORY_SIZE","WASMBOY_MEMORY_LOCATION","WASMBOY_MEMORY_SIZE","WASMBOY_WASM_PAGES","Config","enableBootRom","useGbcWhenAvailable","audioBatchProcessing","graphicsBatchProcessing","timersBatchProcessing","graphicsDisableScanlineRendering","audioAccumulateSamples","tileRendering","tileCaching","enableAudioDebugging","concatenateBytes","highByte","lowByte","splitHighByte","groupedByte","splitLowByte","rotateByteLeft","u8Portable","rotateByteLeftThroughCarry","getCarryFlag$$1","rotateByteRight","rotateByteRightThroughCarry","setBitOnByte","bitPosition","byte","resetBitOnByte","checkBitOnByte","param","u16Portable","i8Portable","response","i32Portable","setFlagBit","flagBit","flagValue","bitwiseOperand","Cpu","registerF","setZeroFlag$$1","setSubtractFlag","setHalfCarryFlag","setCarryFlag","getZeroFlag$$1","getSubtractFlag","getHalfCarryFlag","checkAndSetEightBitHalfCarryFlag","amountToAdd","result","checkAndSetEightBitCarryFlag","checkAndSetSixteenBitFlagsAddOverflow","valueOne","valueTwo","useStackPointerBits","signedValueOne","flagXor","halfCarryXor","halfCarryAnd","Palette","memoryLocationBackgroundPaletteIndex","memoryLocationBackgroundPaletteData","memoryLocationSpritePaletteIndex","memoryLocationSpritePaletteData","initializePalette","GBCEnabled","eightBitStoreIntoGBMemory","getMonochromeColorFromPalette","colorId","paletteMemoryLocation","shouldRepresentColorByColorId","color","eightBitLoadFromGBMemory","rgbColor","writeColorPaletteToMemory","paletteIndex","isSprite","storePaletteByteInWasmMemory","incrementPaletteIndexIfSet","getRgbColorFromPalette","paletteId","paletteHighByte","loadPaletteByteFromWasmMemory","paletteLowByte","getColorComponentFromRgb","colorRgb","bitMask","colorValue","paletteIndexByte","addPriorityforPixel","x","y","hasGbcBgPriority","bgPriorityByte","getPixelStart","getPriorityforPixel","clearPriorityMap","TileCache","tileId","horizontalFlip","nextXIndexToPerformCacheCheck","resetTileCache","drawPixelsFromLineOfTile","tileDataMemoryLocation","vramBankId","tileLineXStart","tileLineXEnd","tileLineY","outputLineX","outputLineY","outputWidth","wasmMemoryStart","shouldRepresentMonochromeColorByColorId","paletteLocation","bgMapAttributes","spriteAttributes","pixelsDrawn","tileDataAddress","getTileDataAddress","byteOneForLineOfTilePixels","loadFromVramBank","byteTwoForLineOfTilePixels","iteratedOutputX","pixelXInTile","paletteColorId","red","green","blue","bgPalette","rgbColorPalette","Graphics","memoryLocationBackgroundPalette","monochromeColor","pixelStart","getTilePixelStart","gbcBgPriority","tileIdFromTileMap","memoryLocationTileDataSelectZeroStart","signedTileId","isDutyCycleClockPositiveOrNegativeForWaveform","channelDuty","waveFormPositionOnDuty","Channel1","updateNRx0","NRx0SweepPeriod","NRx0Negate","NRx0SweepShift","updateNRx1","NRx1Duty","NRx1LengthLoad","lengthCounter","updateNRx2","NRx2StartingVolume","NRx2EnvelopeAddMode","NRx2EnvelopePeriod","isDacEnabled","updateNRx3","NRx3FrequencyLSB","frequency","NRx4FrequencyMSB","updateNRx4","NRx4LengthEnabled","storeBooleanDirectlyToWasmMemory","getSaveStateMemoryOffset","saveStateSlot","isEnabled","frequencyTimer","envelopeCounter","volume","dutyCycle","isSweepEnabled","sweepCounter","sweepShadowFrequency","loadBooleanDirectlyFromWasmMemory","initialize","memoryLocationNRx0","memoryLocationNRx1","memoryLocationNRx2","memoryLocationNRx3","memoryLocationNRx4","getSampleFromCycleCounter","accumulatedCycles","cycleCounter","getSample","resetTimer","GBCDoubleSpeed","numberOfCycles","overflowAmount","outputVolume","sample","trigger","calculateSweepAndCheckOverflow","willChannelUpdate","updateSweep","updateLength","updateEnvelope","setFrequency","passedFrequencyHighBits","passedFrequencyLowBits","register4","newRegister4","channelNumber","newFrequency","getNewFrequencyFromSweep","Channel2","Channel3","NRx2VolumeCode","waveTablePosition","volumeCodeChanged","volumeCode","positionIndexToAdd","memoryLocationWaveSample","memoryLocationWaveTable","Channel4","NRx3ClockShift","NRx3WidthMode","NRx3DivisorCode","divisor","linearFeedbackShiftRegister","getNoiseChannelFrequencyPeriod","lfsrBitZero","lfsrBitOne","xorLfsrBitZeroOne","SoundAccumulator","channel1Sample","channel2Sample","channel3Sample","channel4Sample","channel1DacEnabled","channel2DacEnabled","channel3DacEnabled","channel4DacEnabled","leftChannelSampleUnsignedByte","rightChannelSampleUnsignedByte","mixerVolumeChanged","mixerEnabledChanged","needToRemixSamples","initializeSoundAccumulator","accumulateSound","channel1WillUpdate","didChannelDacChange","channel2WillUpdate","channel3WillUpdate","channel4WillUpdate","Sound","downSampleCycleCounter","downSampleCycleMultiplier","maxDownSampleCycles","mixChannelSamples","setLeftAndRightOutputForAudioQueue","audioQueueIndex","maxIndex","wasmBoyMemoryMaxBufferSize","batchProcessCycles","updateNR50","NR50LeftMixerVolume","NR50RightMixerVolume","updateNR51","NR51IsChannel4EnabledOnLeftOutput","NR51IsChannel3EnabledOnLeftOutput","NR51IsChannel2EnabledOnLeftOutput","NR51IsChannel1EnabledOnLeftOutput","NR51IsChannel4EnabledOnRightOutput","NR51IsChannel3EnabledOnRightOutput","NR51IsChannel2EnabledOnRightOutput","NR51IsChannel1EnabledOnRightOutput","updateNR52","NR52IsSoundEnabled","maxFrameSequenceCycles","CLOCK_SPEED","frameSequenceCycleCounter","frameSequencer","clearAudioBuffer","currentCycles","memoryLocationNR50","memoryLocationNR51","memoryLocationNR52","memoryLocationChannel3LoadRegisterStart","initializeSound","batchProcessAudio","updateSound","frameSequencerUpdated","updateFrameSequencer","calculateSound","getNumberOfSamplesInAudioBuffer","mixedSample","leftChannelSample","rightChannelSample","getSampleAsUnsignedByte","mixerVolume","precision","convertedSample","maxDivider","leftVolume","rightVolume","bufferLocation","audioQueueOffset","SoundRegisterWriteTraps","SoundRegisterReadTraps","registerNR52","Interrupts","updateInterruptEnabled","isVBlankInterruptEnabled","bitPositionVBlankInterrupt","isLcdInterruptEnabled","bitPositionLcdInterrupt","isTimerInterruptEnabled","bitPositionTimerInterrupt","isSerialInterruptEnabled","bitPositionSerialInterrupt","isJoypadInterruptEnabled","bitPositionJoypadInterrupt","interruptsEnabledValue","updateInterruptRequested","isVBlankInterruptRequested","isLcdInterruptRequested","isTimerInterruptRequested","isSerialInterruptRequested","isJoypadInterruptRequested","interruptsRequestedValue","areInterruptsPending","masterInterruptSwitch","masterInterruptSwitchDelay","memoryLocationInterruptEnabled","memoryLocationInterruptRequest","initializeInterrupts","checkInterrupts","isAnInterruptRequestedAndEnabledValue","wasInterruptHandled","isHaltNoJump","_handleInterrupt","interuptHandlerCycles","isHalted","exitHaltAndStop","setInterrupts","interruptRequest","stackPointer","sixteenBitStoreIntoGBMemory","programCounter","_requestInterrupt","requestVBlankInterrupt","requestLcdInterrupt","requestTimerInterrupt","requestJoypadInterrupt","requestSerialInterrupt","Timers","updateDividerRegister","oldDividerRegister","dividerRegister","memoryLocationDividerRegister","timerEnabled","_checkDividerRegisterFallingEdgeDetector","_incrementTimerCounter","updateTimerCounter","timerCounterWasReset","timerCounterOverflowDelay","timerCounter","updateTimerModulo","timerModulo","updateTimerControl","oldTimerEnabled","newTimerInputClock","oldTimerCounterMaskBit","_getTimerCounterMaskBit","timerInputClock","newTimerCounterMaskBit","shouldIncrementTimerCounter","memoryLocationTimerCounter","memoryLocationTimerModulo","memoryLocationTimerControl","timerCounterMask","initializeTimers","batchProcessTimers","updateTimers","cyclesIncreased","newDividerRegister","timerCounterMaskBit","Serial","updateTransferControl","isShiftClockInternal","isClockSpeedFast","transferStartFlag","memoryLocationSerialTransferData","memoryLocationSerialTransferControl","numberOfBitsTransferred","initializeSerial","updateSerial","oldCycles","_checkFallingEdgeDetector","transferData","transferControl","newCycles","maskBit","_getFallingEdgeMaskBit","Joypad","updateJoypad","joypadRegisterFlipped","isDpadType","isButtonType","memoryLocationJoypadRegister","up","down","left","right","a","b","select","start","getJoypadState","joypadRegister","_pressJoypadButton","_releaseJoypadButton","buttonId","isStopped","isButtonStateChanging","_getJoypadButtonStateFromButtonId","_setJoypadButtonStateFromButtonId","isDpadTypeButton","shouldRequestInterrupt","isPressed","handleBanking","Memory","isRomOnly","isMBC2","romEnableByte","isRamBankingEnabled","isMBC5","currentRomBank","romBankLowerBits","isMBC1","isMBC3","isMBC1RomModeEnabled","romBankHigherBits","ramBankBits","currentRamBank","getRomBankAddress","gameboyOffset","switchableCartridgeRomLocation","getRamBankAddress","cartridgeRamLocation","initializeDma","startDmaTransfer","sourceAddressOffset","sourceAddress","spriteInformationByte","spriteInformationAddress","spriteInformationTableLocation","DMACycles","startHdmaTransfer","hdmaTriggerByteToBeWritten","isHblankHdmaActive","hdmaTriggerByte","memoryLocationHdmaTrigger","hdmaSource","getHdmaSourceFromMemory","hdmaDestination","getHdmaDestinationFromMemory","transferLength","hblankHdmaTransferLengthRemaining","hblankHdmaSource","hblankHdmaDestination","hdmaTransfer","updateHblankHdma","bytesToTransfer","remainingTransferLength","transferLengthAsByte","sourceByte","eightBitLoadFromGBMemoryWithTraps","hdmaDestinationWithWrapping","eightBitStoreIntoGBMemoryWithTraps","hdmaCycles","hdmaSourceHigh","memoryLocationHdmaSourceHigh","hdmaSourceLow","memoryLocationHdmaSourceLow","hdmaDestinationHigh","memoryLocationHdmaDestinationHigh","hdmaDestinationLow","memoryLocationHdmaDestinationLow","videoRamLocation","checkWriteTraps","memoryLocationSpeedSwitch","echoRamLocation","wramOffset","spriteInformationTableLocationEnd","Lcd","currentLcdMode","unusableMemoryLocation","unusableMemoryEndLocation","memoryLocationLcdControl","memoryLocationWindowX","updateLcdControl","memoryLocationLcdStatus","updateLcdStatus","memoryLocationScanlineRegister","scanlineRegister","memoryLocationCoincidenceCompare","coincidenceCompare","memoryLocationDmaTransfer","memoryLocationScrollX","scrollX","memoryLocationScrollY","scrollY","windowX","memoryLocationWindowY","windowY","memoryLocationGBCWRAMBank","memoryLocationGBCVRAMBank","getWasmBoyOffsetFromGameBoyOffset","gameboyOffsetHighByte","internalRamBankZeroLocation","wramBankId","sixteenBitStoreIntoGBMemoryWithTraps","nextOffset","currentLcdStatus","valueNoBottomBits","lcdStatusOnlyBottomBits","wasLcdEnabled","enabled","windowTileMapDisplaySelect","windowDisplayEnabled","bgWindowTileDataSelect","bgTileMapDisplaySelect","tallSpriteSize","spriteDisplayEnable","bgDisplayEnabled","resetLcd","shouldBlankScreen","scanlineCycleCounter","lcdStatus","setLcdStatus","lcdMode","newLcdMode","MIN_CYCLES_SPRITES_LCD_MODE","MIN_CYCLES_TRANSFER_DATA_LCD_MODE","checkCoincidence","renderBackground","tileMapMemoryLocation","pixelYPositionInMap","drawBackgroundWindowScanline","renderWindow","xOffset","iStart","tileYPositionInMap","pixelXPositionInMap","tileXPositionInMap","tileMapAddress","usedTileCache","drawLineOfTileFromTileCache","drawLineOfTileFromTileId","drawColorPixelFromTileId","drawMonochromePixelFromTileId","xPixel","yPixel","pixelYInTile","setPixelOnFrame","wasLastTileHorizontallyFlipped","isCurrentTileHorizontallyFlipped","tileCacheIndex","previousXPixel","previousTilePixelLocation","getRgbPixelStart","tileCacheRgb","pixelPriority","xOffsetTileWidthRemainder","tileXStart","tileXEnd","renderSprites","useLargerSprites","spriteTableIndex","spriteYPosition","memoryLocationSpriteAttributesTable","spriteXPosition","spriteTileId","spriteHeight","isSpritePriorityBehindWindowAndBackground","flipSpriteY","flipSpriteX","currentSpriteLine","spriteTileAddressStart","memoryLocationTileDataSelectOneStart","spriteTileAddress","spriteDataByteOneForLineOfTilePixels","spriteDataByteTwoForLineOfTilePixels","tilePixel","spritePixelXInTile","spriteColorId","spriteXPixelLocationInCameraView","shouldShowFromLcdcPriority","shouldHideFromOamPriority","shouldHideFromBgPriority","bgColorFromPriorityByte","spritePaletteLocation","memoryLocationSpritePaletteOne","memoryLocationSpritePaletteTwo","spritePixelColorFromPalette","MAX_CYCLES_PER_SCANLINE","memoryLocationTileMapSelectZeroStart","memoryLocationTileMapSelectOneStart","batchProcessGraphics","updateGraphics","initializeGraphics","_drawScanline","_renderEntireFrame","wasmBoyAddress","checkReadTraps","currentSpeedSwitchRegister","upperDividerRegisterBits","readTrapResult","sixteenBitLoadFromGBMemory","lowByteReadTrapResult","highByteReadTrapResult","booleanAsInt","cartridgeRomLocation","internalRamBankOneLocation","initializeCartridge","MAX_CYCLES_PER_FRAME","enableHalt","isHaltNormal","haltTypeValue","isHaltBug","registerA","registerB","registerC","registerD","registerE","registerH","registerL","initializeCpu","addARegister","register","addAThroughCarryRegister","overflowedResult","subARegister","negativeRegister","subAThroughCarryRegister","carryRegisterCheck","andARegister","xorARegister","orARegister","cpARegister","tempResult","rotateRegisterLeft","rotateRegisterRight","rotateRegisterLeftThroughCarry","hasHighbit","rotateRegisterRightThroughCarry","hasLowBit","shiftLeftRegister","shiftRightArithmeticRegister","hasLowbit","swapNibblesOnRegister","highNibble","lowNibble","shiftRightLogicalRegister","testBitOnRegister","testByte","setBitOnRegister","bitValue","setByte","relativeJump","relativeJumpOffset","handleCbOpcode","cbOpcode","handledOpcode","instructionRegisterValue","instructionRegisterResult","registerNumber","eightBitLoadSyncCycles","opcodeHighNibble","eightBitStoreSyncCycles","executeOpcode$$1","opcode","handleOpcode0x","handleOpcode1x","handleOpcode2x","handleOpcode3x","handleOpcode4x","handleOpcode5x","handleOpcode6x","handleOpcode7x","handleOpcode8x","handleOpcode9x","handleOpcodeAx","handleOpcodeBx","handleOpcodeCx","handleOpcodeDx","handleOpcodeEx","handleOpcodeFx","syncCycles","sixteenBitLoadSyncCycles","sixteenBitStoreSyncCycles","getDataByteOne","getDataByteTwo","getConcatenatedDataByte","concatenatedDataByte","registerBC3","registerHL","registerBC9","registerBCB","speedSwitch","registerDE3","registerDE9","registerDEA","registerDEB","sixteenBitDataByte","registerHL2","registerHL3","adjustedRegister","adjustment","registerHL9","registerHLA","registerHLB","registerHL4","valueAtHL4","incrementer","registerHL5","valueAtHL5","valueAtHL6","valueAtHLE","registerBC1","cbCycles","registerDE1","largeDataByteOne","registerHL1","signedDataByteOne","registerAF1","Cycles","cyclesPerCycleSet","cycleSets","cycles","getCyclesPerCycleSet","getCycleSets","getCycles","trackCyclesRan","resetCycles","Execute","stepsPerStepSet","stepSets","steps","RESPONSE_CONDITION_ERROR","RESPONSE_CONDITION_FRAME","RESPONSE_CONDITION_AUDIO","RESPONSE_CONDITION_BREAKPOINT","getStepsPerStepSet","getStepSets","getSteps","trackStepsRan","resetSteps","executeMultipleFrames","numberOfFrames","frameResponse","framesRun","executeFrame","executeUntilCondition","executeFrameAndCheckAudio","maxAudioBuffer","executeFrameUntilBreakpoint","breakpoint","executeFrameAndCheckAudioUntilBreakpoint","checkMaxCyclesPerFrame","audioBufferSize","errorCondition","frameCondition","audioBufferCondition","breakpointCondition","executeStep","setHasCoreStarted","haltBugOpcode","haltBugCycles","interruptCycles","hasStarted","hasCoreStarted","config","gbcType","isGBC","getRegisterA","getRegisterB","getRegisterC","getRegisterD","getRegisterE","getRegisterH","getRegisterL","getRegisterF","getProgramCounter","getStackPointer","getOpcodeAtProgramCounter","getLY","drawBackgroundMapToWasmMemory","showColor","drawTileDataToWasmMemory","tileDataMapGridY","tileDataMapGridX","drawOamToWasmMemory","spriteRow","spriteColumn","spriteIndex","tilesToDraw","getDIV","getTIMA","getTMA","getTAC","updateDebugGBMemory","wasmMemorySize","videoOutputLocation","backgroundMapLocation","tileDataMap","WasmBoyCore","freeze","update","emulationStep","getAudioQueueIndex","resetAudioQueue","getWasmBoyTsCore","instance","byteMemory","getPerformanceTimestamp","window","performance","now","Date","addTimeStamp","currentHighResTime","fpsTimeStamps","shift","timeStampsUntilReady","waitForTimeStampsForFrameRate","options","gameboyFrameRate","floor","transferGraphics","graphicsFrameEndIndex","graphicsFrameBuffer","MAX_AUDIO_LATENCY","currentFps","gameboyFrameRateWithSpeed","intervalRate","scheduleNextUpdate","highResTime","timeSinceLastTimestamp","nextUpdateTime","speed","updateId","setTimeout","passedIntervalRate","paused","getFPS","shouldCheckAudio","headless","pauseFpsThrottle","isAudioEnabled","executePromise","Promise","resolve","executeAndCheckAudio","then","fps","shouldSkipRenderingFrame","frameSkip","frameSkipCounter","memoryObject","forEach","key","isTooMuchLatency","isRunningFullSpeed","sendAudio","latencyDifferenceInSeconds","latencyDifferenceInMilli","audioBuffer","numberOfSamples","allowFastSpeedStretching","messageTransferrables","channel1Buffer","channel2Buffer","channel3Buffer","channel4Buffer","controllerWorkerPort","messageHandler","ports","bind","instantiateTask","clearTimeout","parameters","export","end","constant","log"],"mappings":"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"}
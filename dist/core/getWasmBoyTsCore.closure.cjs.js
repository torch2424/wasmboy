'use strict';let wasmboyMemorySize=9109504,wasmByteMemory=new Uint8ClampedArray(wasmboyMemorySize),memory={size:()=>wasmboyMemorySize,grow:()=>{},wasmByteMemory},load=a=>wasmByteMemory[a],store=(a,b)=>{wasmByteMemory[a]=b},abs=a=>Math.abs(a),ceil=a=>Math.ceil(a);
var ASSEMBLYSCRIPT_MEMORY_LOCATION=0,ASSEMBLYSCRIPT_MEMORY_SIZE=1024,WASMBOY_STATE_LOCATION=ASSEMBLYSCRIPT_MEMORY_LOCATION+ASSEMBLYSCRIPT_MEMORY_SIZE,WASMBOY_STATE_SIZE=1024,VIDEO_RAM_LOCATION=WASMBOY_STATE_LOCATION+WASMBOY_STATE_SIZE,VIDEO_RAM_SIZE=16384,WORK_RAM_LOCATION=VIDEO_RAM_LOCATION+VIDEO_RAM_SIZE,WORK_RAM_SIZE=32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION=WORK_RAM_LOCATION+WORK_RAM_SIZE,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE=16384,GAMEBOY_INTERNAL_MEMORY_LOCATION=VIDEO_RAM_LOCATION,GAMEBOY_INTERNAL_MEMORY_SIZE=
OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION-VIDEO_RAM_LOCATION+OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE,GBC_PALETTE_LOCATION=OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION+OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE,GBC_PALETTE_SIZE=128,BG_PRIORITY_MAP_LOCATION=GBC_PALETTE_LOCATION+GBC_PALETTE_SIZE,BG_PRIORITY_MAP_SIZE=23552,FRAME_LOCATION=BG_PRIORITY_MAP_LOCATION+BG_PRIORITY_MAP_SIZE,FRAME_SIZE=93184,BACKGROUND_MAP_LOCATION=FRAME_LOCATION+FRAME_SIZE,BACKGROUND_MAP_SIZE=196608,TILE_DATA_LOCATION=BACKGROUND_MAP_LOCATION+BACKGROUND_MAP_SIZE,
TILE_DATA_SIZE=147456,OAM_TILES_LOCATION=TILE_DATA_LOCATION+TILE_DATA_SIZE,OAM_TILES_SIZE=15360,GRAPHICS_OUTPUT_LOCATION=GBC_PALETTE_LOCATION,GRAPHICS_OUTPUT_SIZE=OAM_TILES_LOCATION-GBC_PALETTE_LOCATION+OAM_TILES_SIZE,CHANNEL_1_BUFFER_LOCATION=OAM_TILES_LOCATION+OAM_TILES_SIZE,CHANNEL_1_BUFFER_SIZE=131072,CHANNEL_2_BUFFER_LOCATION=CHANNEL_1_BUFFER_LOCATION+CHANNEL_1_BUFFER_SIZE,CHANNEL_2_BUFFER_SIZE=131072,CHANNEL_3_BUFFER_LOCATION=CHANNEL_2_BUFFER_LOCATION+CHANNEL_2_BUFFER_SIZE,CHANNEL_3_BUFFER_SIZE=
131072,CHANNEL_4_BUFFER_LOCATION=CHANNEL_3_BUFFER_LOCATION+CHANNEL_3_BUFFER_SIZE,CHANNEL_4_BUFFER_SIZE=131072,AUDIO_BUFFER_LOCATION=CHANNEL_4_BUFFER_LOCATION+CHANNEL_4_BUFFER_SIZE,AUDIO_BUFFER_SIZE=131072,CARTRIDGE_RAM_LOCATION=AUDIO_BUFFER_LOCATION+AUDIO_BUFFER_SIZE,CARTRIDGE_RAM_SIZE=131072,BOOT_ROM_LOCATION=CARTRIDGE_RAM_LOCATION+CARTRIDGE_RAM_SIZE,BOOT_ROM_SIZE=2560,CARTRIDGE_ROM_LOCATION=BOOT_ROM_LOCATION+BOOT_ROM_SIZE,CARTRIDGE_ROM_SIZE=8258560,DEBUG_GAMEBOY_MEMORY_LOCATION=CARTRIDGE_ROM_LOCATION+
CARTRIDGE_ROM_SIZE,DEBUG_GAMEBOY_MEMORY_SIZE=65535,WASMBOY_MEMORY_LOCATION=0,WASMBOY_MEMORY_SIZE=DEBUG_GAMEBOY_MEMORY_LOCATION+DEBUG_GAMEBOY_MEMORY_SIZE+1,WASMBOY_WASM_PAGES=ceil(WASMBOY_MEMORY_SIZE/1024/64)+1,Config=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=!1;a.enableAudioDebugging=!1;return a}();
function u8Portable(a){return a&255}function u16Portable(a){return a&65535}function i8Portable(a){return a<<24>>24}function i32Portable(a){return a|0}function setFlagBit(a,b){a=u8Portable(1<<a);Cpu.registerF=0<b?Cpu.registerF|a:Cpu.registerF&(255^a);return Cpu.registerF}function setZeroFlag$$1(a){setFlagBit(7,a)}function setSubtractFlag(a){setFlagBit(6,a)}function setHalfCarryFlag(a){setFlagBit(5,a)}function setCarryFlag(a){setFlagBit(4,a)}function getZeroFlag$$1(){return Cpu.registerF>>7&1}
function getSubtractFlag(){return Cpu.registerF>>6&1}function getHalfCarryFlag(){return Cpu.registerF>>5&1}function getCarryFlag$$1(){return Cpu.registerF>>4&1}function checkAndSetEightBitHalfCarryFlag(a,b){0<=b?(a=u8Portable((a&15)+(b&15))&16,setHalfCarryFlag(0!==a)):setHalfCarryFlag((abs(b)&15)>(a&15))}function checkAndSetEightBitCarryFlag(a,b){0<=b?(b=u8Portable(a+b),setCarryFlag(a>b)):setCarryFlag(abs(b)>a)}
function checkAndSetSixteenBitFlagsAddOverflow(a,b,c){c?(a=a^b^a+b,setHalfCarryFlag(0!==(a&16)),setCarryFlag(0!==(a&256))):(c=u16Portable(a+b),setCarryFlag(c<a),a=u16Portable((a^b^c)&4096),setHalfCarryFlag(0!==a))}
var WasmBoyGBColors=function(){function a(){}a.bgWhite=15921906;a.bgLightGrey=10526880;a.bgDarkGrey=5789784;a.bgBlack=526344;a.obj0White=15921906;a.obj0LightGrey=10526880;a.obj0DarkGrey=5789784;a.obj0Black=526344;a.obj1White=15921906;a.obj1LightGrey=10526880;a.obj1DarkGrey=5789784;a.obj1Black=526344;return a}(),GreenColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=5439232;a.bgDarkGrey=16728576;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=5439232;a.obj0DarkGrey=16728576;a.obj0Black=
0;a.obj1White=16777215;a.obj1LightGrey=5439232;a.obj1DarkGrey=16728576;a.obj1Black=0;return a}(),OrangeColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=16711680;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16776960;a.obj0DarkGrey=16711680;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16776960;a.obj1DarkGrey=16711680;a.obj1Black=0;return a}(),BrownColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16756067;a.bgDarkGrey=8663296;a.bgBlack=
0;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),InvertedColors=function(){function a(){}a.bgWhite=0;a.bgLightGrey=33924;a.bgDarkGrey=16768512;a.bgBlack=16777215;a.obj0White=0;a.obj0LightGrey=33924;a.obj0DarkGrey=16768512;a.obj0Black=16777215;a.obj1White=0;a.obj1LightGrey=33924;a.obj1DarkGrey=16768512;a.obj1Black=16777215;return a}(),GrayscaleColors=function(){function a(){}
a.bgWhite=16777215;a.bgLightGrey=10855845;a.bgDarkGrey=5395026;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=10855845;a.obj0DarkGrey=5395026;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=10855845;a.obj1DarkGrey=5395026;a.obj1Black=0;return a}(),PastelMixColors=function(){function a(){}a.bgWhite=16777125;a.bgLightGrey=16749716;a.bgDarkGrey=9737471;a.bgBlack=0;a.obj0White=16777125;a.obj0LightGrey=16749716;a.obj0DarkGrey=9737471;a.obj0Black=0;a.obj1White=16777125;a.obj1LightGrey=16749716;a.obj1DarkGrey=
9737471;a.obj1Black=0;return a}(),DarkBrownColors=function(){function a(){}a.bgWhite=16770757;a.bgLightGrey=13540484;a.bgDarkGrey=8678185;a.bgBlack=5910792;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=8663296;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),DarkGreenColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=8126257;a.bgDarkGrey=25541;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=
9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),DarkBlueColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=9211102;a.bgDarkGrey=5395084;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),RedColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;
a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=33792;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),BlueColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),YellowColors=function(){function a(){}
a.bgWhite=16777215;a.bgLightGrey=16776960;a.bgDarkGrey=8079872;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=6530559;a.obj0DarkGrey=255;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),Table00Entry08Colors=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=10853631;a.obj0LightGrey=16776960;a.obj0DarkGrey=25344;a.obj0Black=0;a.obj1White=10853631;a.obj1LightGrey=16776960;a.obj1DarkGrey=
25344;a.obj1Black=0;return a}(),Table01Entry0BColors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16745604;a.obj0DarkGrey=9714234;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Table01Entry10Colors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=8126257;a.obj0DarkGrey=
33792;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=0;return a}(),Table03Entry0AColors=function(){function a(){}a.bgWhite=11908607;a.bgLightGrey=16777108;a.bgDarkGrey=11360834;a.bgBlack=0;a.obj0White=0;a.obj0LightGrey=16777215;a.obj0DarkGrey=16745604;a.obj0Black=9714234;a.obj1White=0;a.obj1LightGrey=16777215;a.obj1DarkGrey=16745604;a.obj1Black=9714234;return a}(),Table05Entry00Colors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;
a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=5946879;a.obj1DarkGrey=16711680;a.obj1Black=255;return a}(),Table05Entry01Colors=function(){function a(){}a.bgWhite=16777116;a.bgLightGrey=9745919;a.bgDarkGrey=6526067;a.bgBlack=14906;a.obj0White=16762178;a.obj0LightGrey=16766464;a.obj0DarkGrey=9714176;a.obj0Black=4849664;a.obj1White=16777215;a.obj1LightGrey=16745604;a.obj1DarkGrey=9714234;a.obj1Black=
0;return a}(),Table05Entry02Colors=function(){function a(){}a.bgWhite=7077632;a.bgLightGrey=16777215;a.bgDarkGrey=16732746;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16777215;a.obj0DarkGrey=6530559;a.obj0Black=255;a.obj1White=16777215;a.obj1LightGrey=16756067;a.obj1DarkGrey=8663296;a.obj1Black=0;return a}(),Table05Entry08Colors=function(){function a(){}a.bgWhite=10853631;a.bgLightGrey=16776960;a.bgDarkGrey=25344;a.bgBlack=0;a.obj0White=16737106;a.obj0LightGrey=14024704;a.obj0DarkGrey=6488064;
a.obj0Black=0;a.obj1White=255;a.obj1LightGrey=16777215;a.obj1DarkGrey=16777083;a.obj1Black=34047;return a}(),Table05Entry09Colors=function(){function a(){}a.bgWhite=16777166;a.bgLightGrey=6549487;a.bgDarkGrey=10257457;a.bgBlack=5921370;a.obj0White=16777215;a.obj0LightGrey=16741120;a.obj0DarkGrey=9716224;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Table05Entry11Colors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=16745604;a.bgDarkGrey=
9714234;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=65280;a.obj0DarkGrey=3245056;a.obj0Black=18944;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Table05Entry14Colors=function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=6530559;a.bgDarkGrey=255;a.bgBlack=0;a.obj0White=16776960;a.obj0LightGrey=16711680;a.obj0DarkGrey=6488064;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=8126257;a.obj1DarkGrey=33792;a.obj1Black=0;return a}(),Table05Entry15Colors=
function(){function a(){}a.bgWhite=16777215;a.bgLightGrey=11382148;a.bgDarkGrey=4354939;a.bgBlack=0;a.obj0White=16777215;a.obj0LightGrey=16756067;a.obj0DarkGrey=16756067;a.obj0Black=0;a.obj1White=16777215;a.obj1LightGrey=6530559;a.obj1DarkGrey=255;a.obj1Black=0;return a}(),Colors=function(){function a(){}a.bgWhite=WasmBoyGBColors.bgWhite;a.bgLightGrey=WasmBoyGBColors.bgLightGrey;a.bgDarkGrey=WasmBoyGBColors.bgDarkGrey;a.bgBlack=WasmBoyGBColors.bgBlack;a.obj0White=WasmBoyGBColors.obj0White;a.obj0LightGrey=
WasmBoyGBColors.obj0LightGrey;a.obj0DarkGrey=WasmBoyGBColors.obj0DarkGrey;a.obj0Black=WasmBoyGBColors.obj0Black;a.obj1White=WasmBoyGBColors.obj1White;a.obj1LightGrey=WasmBoyGBColors.obj1LightGrey;a.obj1DarkGrey=WasmBoyGBColors.obj1DarkGrey;a.obj1Black=WasmBoyGBColors.obj1Black;return a}();
function initializeColors(){setManualColorizationPalette(0);if(!Cpu.GBCEnabled&&(!Cpu.BootROMEnabled||Cpu.GBCEnabled)){for(var a=0,b=308;323>=b;b++)a+=eightBitLoadFromGBMemory(b);setHashColorizationPalette(a&255)}}function getRedFromHexColor(a){return(a&16711680)>>16}function getGreenFromHexColor(a){return(a&65280)>>8}function getBlueFromHexColor(a){return a&255}
function setManualColorizationPalette(a){switch(a){case 0:Colors.bgWhite=WasmBoyGBColors.bgWhite;Colors.bgLightGrey=WasmBoyGBColors.bgLightGrey;Colors.bgDarkGrey=WasmBoyGBColors.bgDarkGrey;Colors.bgBlack=WasmBoyGBColors.bgBlack;Colors.obj0White=WasmBoyGBColors.obj0White;Colors.obj0LightGrey=WasmBoyGBColors.obj0LightGrey;Colors.obj0DarkGrey=WasmBoyGBColors.obj0DarkGrey;Colors.obj0Black=WasmBoyGBColors.obj0Black;Colors.obj1White=WasmBoyGBColors.obj1White;Colors.obj1LightGrey=WasmBoyGBColors.obj1LightGrey;
Colors.obj1DarkGrey=WasmBoyGBColors.obj1DarkGrey;Colors.obj1Black=WasmBoyGBColors.obj1Black;break;case 1:Colors.bgWhite=BrownColors.bgWhite;Colors.bgLightGrey=BrownColors.bgLightGrey;Colors.bgDarkGrey=BrownColors.bgDarkGrey;Colors.bgBlack=BrownColors.bgBlack;Colors.obj0White=BrownColors.obj0White;Colors.obj0LightGrey=BrownColors.obj0LightGrey;Colors.obj0DarkGrey=BrownColors.obj0DarkGrey;Colors.obj0Black=BrownColors.obj0Black;Colors.obj1White=BrownColors.obj1White;Colors.obj1LightGrey=BrownColors.obj1LightGrey;
Colors.obj1DarkGrey=BrownColors.obj1DarkGrey;Colors.obj1Black=BrownColors.obj1Black;break;case 2:Colors.bgWhite=RedColors.bgWhite;Colors.bgLightGrey=RedColors.bgLightGrey;Colors.bgDarkGrey=RedColors.bgDarkGrey;Colors.bgBlack=RedColors.bgBlack;Colors.obj0White=RedColors.obj0White;Colors.obj0LightGrey=RedColors.obj0LightGrey;Colors.obj0DarkGrey=RedColors.obj0DarkGrey;Colors.obj0Black=RedColors.obj0Black;Colors.obj1White=RedColors.obj1White;Colors.obj1LightGrey=RedColors.obj1LightGrey;Colors.obj1DarkGrey=
RedColors.obj1DarkGrey;Colors.obj1Black=RedColors.obj1Black;break;case 3:Colors.bgWhite=DarkBrownColors.bgWhite;Colors.bgLightGrey=DarkBrownColors.bgLightGrey;Colors.bgDarkGrey=DarkBrownColors.bgDarkGrey;Colors.bgBlack=DarkBrownColors.bgBlack;Colors.obj0White=DarkBrownColors.obj0White;Colors.obj0LightGrey=DarkBrownColors.obj0LightGrey;Colors.obj0DarkGrey=DarkBrownColors.obj0DarkGrey;Colors.obj0Black=DarkBrownColors.obj0Black;Colors.obj1White=DarkBrownColors.obj1White;Colors.obj1LightGrey=DarkBrownColors.obj1LightGrey;
Colors.obj1DarkGrey=DarkBrownColors.obj1DarkGrey;Colors.obj1Black=DarkBrownColors.obj1Black;break;case 4:Colors.bgWhite=GreenColors.bgWhite;Colors.bgLightGrey=GreenColors.bgLightGrey;Colors.bgDarkGrey=GreenColors.bgDarkGrey;Colors.bgBlack=GreenColors.bgBlack;Colors.obj0White=GreenColors.obj0White;Colors.obj0LightGrey=GreenColors.obj0LightGrey;Colors.obj0DarkGrey=GreenColors.obj0DarkGrey;Colors.obj0Black=GreenColors.obj0Black;Colors.obj1White=GreenColors.obj1White;Colors.obj1LightGrey=GreenColors.obj1LightGrey;
Colors.obj1DarkGrey=GreenColors.obj1DarkGrey;Colors.obj1Black=GreenColors.obj1Black;break;case 5:Colors.bgWhite=DarkGreenColors.bgWhite;Colors.bgLightGrey=DarkGreenColors.bgLightGrey;Colors.bgDarkGrey=DarkGreenColors.bgDarkGrey;Colors.bgBlack=DarkGreenColors.bgBlack;Colors.obj0White=DarkGreenColors.obj0White;Colors.obj0LightGrey=DarkGreenColors.obj0LightGrey;Colors.obj0DarkGrey=DarkGreenColors.obj0DarkGrey;Colors.obj0Black=DarkGreenColors.obj0Black;Colors.obj1White=DarkGreenColors.obj1White;Colors.obj1LightGrey=
DarkGreenColors.obj1LightGrey;Colors.obj1DarkGrey=DarkGreenColors.obj1DarkGrey;Colors.obj1Black=DarkGreenColors.obj1Black;break;case 6:Colors.bgWhite=InvertedColors.bgWhite;Colors.bgLightGrey=InvertedColors.bgLightGrey;Colors.bgDarkGrey=InvertedColors.bgDarkGrey;Colors.bgBlack=InvertedColors.bgBlack;Colors.obj0White=InvertedColors.obj0White;Colors.obj0LightGrey=InvertedColors.obj0LightGrey;Colors.obj0DarkGrey=InvertedColors.obj0DarkGrey;Colors.obj0Black=InvertedColors.obj0Black;Colors.obj1White=InvertedColors.obj1White;
Colors.obj1LightGrey=InvertedColors.obj1LightGrey;Colors.obj1DarkGrey=InvertedColors.obj1DarkGrey;Colors.obj1Black=InvertedColors.obj1Black;break;case 7:Colors.bgWhite=PastelMixColors.bgWhite;Colors.bgLightGrey=PastelMixColors.bgLightGrey;Colors.bgDarkGrey=PastelMixColors.bgDarkGrey;Colors.bgBlack=PastelMixColors.bgBlack;Colors.obj0White=PastelMixColors.obj0White;Colors.obj0LightGrey=PastelMixColors.obj0LightGrey;Colors.obj0DarkGrey=PastelMixColors.obj0DarkGrey;Colors.obj0Black=PastelMixColors.obj0Black;
Colors.obj1White=PastelMixColors.obj1White;Colors.obj1LightGrey=PastelMixColors.obj1LightGrey;Colors.obj1DarkGrey=PastelMixColors.obj1DarkGrey;Colors.obj1Black=PastelMixColors.obj1Black;break;case 8:Colors.bgWhite=OrangeColors.bgWhite;Colors.bgLightGrey=OrangeColors.bgLightGrey;Colors.bgDarkGrey=OrangeColors.bgDarkGrey;Colors.bgBlack=OrangeColors.bgBlack;Colors.obj0White=OrangeColors.obj0White;Colors.obj0LightGrey=OrangeColors.obj0LightGrey;Colors.obj0DarkGrey=OrangeColors.obj0DarkGrey;Colors.obj0Black=
OrangeColors.obj0Black;Colors.obj1White=OrangeColors.obj1White;Colors.obj1LightGrey=OrangeColors.obj1LightGrey;Colors.obj1DarkGrey=OrangeColors.obj1DarkGrey;Colors.obj1Black=OrangeColors.obj1Black;break;case 9:Colors.bgWhite=YellowColors.bgWhite;Colors.bgLightGrey=YellowColors.bgLightGrey;Colors.bgDarkGrey=YellowColors.bgDarkGrey;Colors.bgBlack=YellowColors.bgBlack;Colors.obj0White=YellowColors.obj0White;Colors.obj0LightGrey=YellowColors.obj0LightGrey;Colors.obj0DarkGrey=YellowColors.obj0DarkGrey;
Colors.obj0Black=YellowColors.obj0Black;Colors.obj1White=YellowColors.obj1White;Colors.obj1LightGrey=YellowColors.obj1LightGrey;Colors.obj1DarkGrey=YellowColors.obj1DarkGrey;Colors.obj1Black=YellowColors.obj1Black;break;case 10:Colors.bgWhite=BlueColors.bgWhite;Colors.bgLightGrey=BlueColors.bgLightGrey;Colors.bgDarkGrey=BlueColors.bgDarkGrey;Colors.bgBlack=BlueColors.bgBlack;Colors.obj0White=BlueColors.obj0White;Colors.obj0LightGrey=BlueColors.obj0LightGrey;Colors.obj0DarkGrey=BlueColors.obj0DarkGrey;
Colors.obj0Black=BlueColors.obj0Black;Colors.obj1White=BlueColors.obj1White;Colors.obj1LightGrey=BlueColors.obj1LightGrey;Colors.obj1DarkGrey=BlueColors.obj1DarkGrey;Colors.obj1Black=BlueColors.obj1Black;break;case 11:Colors.bgWhite=DarkBlueColors.bgWhite;Colors.bgLightGrey=DarkBlueColors.bgLightGrey;Colors.bgDarkGrey=DarkBlueColors.bgDarkGrey;Colors.bgBlack=DarkBlueColors.bgBlack;Colors.obj0White=DarkBlueColors.obj0White;Colors.obj0LightGrey=DarkBlueColors.obj0LightGrey;Colors.obj0DarkGrey=DarkBlueColors.obj0DarkGrey;
Colors.obj0Black=DarkBlueColors.obj0Black;Colors.obj1White=DarkBlueColors.obj1White;Colors.obj1LightGrey=DarkBlueColors.obj1LightGrey;Colors.obj1DarkGrey=DarkBlueColors.obj1DarkGrey;Colors.obj1Black=DarkBlueColors.obj1Black;break;case 12:Colors.bgWhite=GrayscaleColors.bgWhite,Colors.bgLightGrey=GrayscaleColors.bgLightGrey,Colors.bgDarkGrey=GrayscaleColors.bgDarkGrey,Colors.bgBlack=GrayscaleColors.bgBlack,Colors.obj0White=GrayscaleColors.obj0White,Colors.obj0LightGrey=GrayscaleColors.obj0LightGrey,
Colors.obj0DarkGrey=GrayscaleColors.obj0DarkGrey,Colors.obj0Black=GrayscaleColors.obj0Black,Colors.obj1White=GrayscaleColors.obj1White,Colors.obj1LightGrey=GrayscaleColors.obj1LightGrey,Colors.obj1DarkGrey=GrayscaleColors.obj1DarkGrey,Colors.obj1Black=GrayscaleColors.obj1Black}}
function setHashColorizationPalette(a){switch(a){case 136:Colors.bgWhite=Table00Entry08Colors.bgWhite;Colors.bgLightGrey=Table00Entry08Colors.bgLightGrey;Colors.bgDarkGrey=Table00Entry08Colors.bgDarkGrey;Colors.bgBlack=Table00Entry08Colors.bgBlack;Colors.obj0White=Table00Entry08Colors.obj0White;Colors.obj0LightGrey=Table00Entry08Colors.obj0LightGrey;Colors.obj0DarkGrey=Table00Entry08Colors.obj0DarkGrey;Colors.obj0Black=Table00Entry08Colors.obj0Black;Colors.obj1White=Table00Entry08Colors.obj1White;
Colors.obj1LightGrey=Table00Entry08Colors.obj1LightGrey;Colors.obj1DarkGrey=Table00Entry08Colors.obj1DarkGrey;Colors.obj1Black=Table00Entry08Colors.obj1Black;break;case 97:Colors.bgWhite=Table01Entry0BColors.bgWhite;Colors.bgLightGrey=Table01Entry0BColors.bgLightGrey;Colors.bgDarkGrey=Table01Entry0BColors.bgDarkGrey;Colors.bgBlack=Table01Entry0BColors.bgBlack;Colors.obj0White=Table01Entry0BColors.obj0White;Colors.obj0LightGrey=Table01Entry0BColors.obj0LightGrey;Colors.obj0DarkGrey=Table01Entry0BColors.obj0DarkGrey;
Colors.obj0Black=Table01Entry0BColors.obj0Black;Colors.obj1White=Table01Entry0BColors.obj1White;Colors.obj1LightGrey=Table01Entry0BColors.obj1LightGrey;Colors.obj1DarkGrey=Table01Entry0BColors.obj1DarkGrey;Colors.obj1Black=Table01Entry0BColors.obj1Black;break;case 20:Colors.bgWhite=Table01Entry10Colors.bgWhite;Colors.bgLightGrey=Table01Entry10Colors.bgLightGrey;Colors.bgDarkGrey=Table01Entry10Colors.bgDarkGrey;Colors.bgBlack=Table01Entry10Colors.bgBlack;Colors.obj0White=Table01Entry10Colors.obj0White;
Colors.obj0LightGrey=Table01Entry10Colors.obj0LightGrey;Colors.obj0DarkGrey=Table01Entry10Colors.obj0DarkGrey;Colors.obj0Black=Table01Entry10Colors.obj0Black;Colors.obj1White=Table01Entry10Colors.obj1White;Colors.obj1LightGrey=Table01Entry10Colors.obj1LightGrey;Colors.obj1DarkGrey=Table01Entry10Colors.obj1DarkGrey;Colors.obj1Black=Table01Entry10Colors.obj1Black;break;case 70:Colors.bgWhite=Table03Entry0AColors.bgWhite;Colors.bgLightGrey=Table03Entry0AColors.bgLightGrey;Colors.bgDarkGrey=Table03Entry0AColors.bgDarkGrey;
Colors.bgBlack=Table03Entry0AColors.bgBlack;Colors.obj0White=Table03Entry0AColors.obj0White;Colors.obj0LightGrey=Table03Entry0AColors.obj0LightGrey;Colors.obj0DarkGrey=Table03Entry0AColors.obj0DarkGrey;Colors.obj0Black=Table03Entry0AColors.obj0Black;Colors.obj1White=Table03Entry0AColors.obj1White;Colors.obj1LightGrey=Table03Entry0AColors.obj1LightGrey;Colors.obj1DarkGrey=Table03Entry0AColors.obj1DarkGrey;Colors.obj1Black=Table03Entry0AColors.obj1Black;break;case 89:case 198:Colors.bgWhite=Table05Entry00Colors.bgWhite;
Colors.bgLightGrey=Table05Entry00Colors.bgLightGrey;Colors.bgDarkGrey=Table05Entry00Colors.bgDarkGrey;Colors.bgBlack=Table05Entry00Colors.bgBlack;Colors.obj0White=Table05Entry00Colors.obj0White;Colors.obj0LightGrey=Table05Entry00Colors.obj0LightGrey;Colors.obj0DarkGrey=Table05Entry00Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry00Colors.obj0Black;Colors.obj1White=Table05Entry00Colors.obj1White;Colors.obj1LightGrey=Table05Entry00Colors.obj1LightGrey;Colors.obj1DarkGrey=Table05Entry00Colors.obj1DarkGrey;
Colors.obj1Black=Table05Entry00Colors.obj1Black;break;case 134:case 168:Colors.bgWhite=Table05Entry01Colors.bgWhite;Colors.bgLightGrey=Table05Entry01Colors.bgLightGrey;Colors.bgDarkGrey=Table05Entry01Colors.bgDarkGrey;Colors.bgBlack=Table05Entry01Colors.bgBlack;Colors.obj0White=Table05Entry01Colors.obj0White;Colors.obj0LightGrey=Table05Entry01Colors.obj0LightGrey;Colors.obj0DarkGrey=Table05Entry01Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry01Colors.obj0Black;Colors.obj1White=Table05Entry01Colors.obj1White;
Colors.obj1LightGrey=Table05Entry01Colors.obj1LightGrey;Colors.obj1DarkGrey=Table05Entry01Colors.obj1DarkGrey;Colors.obj1Black=Table05Entry01Colors.obj1Black;break;case 191:case 206:case 209:case 240:Colors.bgWhite=Table05Entry02Colors.bgWhite;Colors.bgLightGrey=Table05Entry02Colors.bgLightGrey;Colors.bgDarkGrey=Table05Entry02Colors.bgDarkGrey;Colors.bgBlack=Table05Entry02Colors.bgBlack;Colors.obj0White=Table05Entry02Colors.obj0White;Colors.obj0LightGrey=Table05Entry02Colors.obj0LightGrey;Colors.obj0DarkGrey=
Table05Entry02Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry02Colors.obj0Black;Colors.obj1White=Table05Entry02Colors.obj1White;Colors.obj1LightGrey=Table05Entry02Colors.obj1LightGrey;Colors.obj1DarkGrey=Table05Entry02Colors.obj1DarkGrey;Colors.obj1Black=Table05Entry02Colors.obj1Black;break;case 39:case 73:case 92:case 179:Colors.bgWhite=Table05Entry08Colors.bgWhite;Colors.bgLightGrey=Table05Entry08Colors.bgLightGrey;Colors.bgDarkGrey=Table05Entry08Colors.bgDarkGrey;Colors.bgBlack=Table05Entry08Colors.bgBlack;
Colors.obj0White=Table05Entry08Colors.obj0White;Colors.obj0LightGrey=Table05Entry08Colors.obj0LightGrey;Colors.obj0DarkGrey=Table05Entry08Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry08Colors.obj0Black;Colors.obj1White=Table05Entry08Colors.obj1White;Colors.obj1LightGrey=Table05Entry08Colors.obj1LightGrey;Colors.obj1DarkGrey=Table05Entry08Colors.obj1DarkGrey;Colors.obj1Black=Table05Entry08Colors.obj1Black;break;case 201:Colors.bgWhite=Table05Entry09Colors.bgWhite;Colors.bgLightGrey=Table05Entry09Colors.bgLightGrey;
Colors.bgDarkGrey=Table05Entry09Colors.bgDarkGrey;Colors.bgBlack=Table05Entry09Colors.bgBlack;Colors.obj0White=Table05Entry09Colors.obj0White;Colors.obj0LightGrey=Table05Entry09Colors.obj0LightGrey;Colors.obj0DarkGrey=Table05Entry09Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry09Colors.obj0Black;Colors.obj1White=Table05Entry09Colors.obj1White;Colors.obj1LightGrey=Table05Entry09Colors.obj1LightGrey;Colors.obj1DarkGrey=Table05Entry09Colors.obj1DarkGrey;Colors.obj1Black=Table05Entry09Colors.obj1Black;
break;case 112:Colors.bgWhite=Table05Entry11Colors.bgWhite;Colors.bgLightGrey=Table05Entry11Colors.bgLightGrey;Colors.bgDarkGrey=Table05Entry11Colors.bgDarkGrey;Colors.bgBlack=Table05Entry11Colors.bgBlack;Colors.obj0White=Table05Entry11Colors.obj0White;Colors.obj0LightGrey=Table05Entry11Colors.obj0LightGrey;Colors.obj0DarkGrey=Table05Entry11Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry11Colors.obj0Black;Colors.obj1White=Table05Entry11Colors.obj1White;Colors.obj1LightGrey=Table05Entry11Colors.obj1LightGrey;
Colors.obj1DarkGrey=Table05Entry11Colors.obj1DarkGrey;Colors.obj1Black=Table05Entry11Colors.obj1Black;break;case 70:Colors.bgWhite=Table05Entry14Colors.bgWhite;Colors.bgLightGrey=Table05Entry14Colors.bgLightGrey;Colors.bgDarkGrey=Table05Entry14Colors.bgDarkGrey;Colors.bgBlack=Table05Entry14Colors.bgBlack;Colors.obj0White=Table05Entry14Colors.obj0White;Colors.obj0LightGrey=Table05Entry14Colors.obj0LightGrey;Colors.obj0DarkGrey=Table05Entry14Colors.obj0DarkGrey;Colors.obj0Black=Table05Entry14Colors.obj0Black;
Colors.obj1White=Table05Entry14Colors.obj1White;Colors.obj1LightGrey=Table05Entry14Colors.obj1LightGrey;Colors.obj1DarkGrey=Table05Entry14Colors.obj1DarkGrey;Colors.obj1Black=Table05Entry14Colors.obj1Black;break;case 211:Colors.bgWhite=Table05Entry15Colors.bgWhite,Colors.bgLightGrey=Table05Entry15Colors.bgLightGrey,Colors.bgDarkGrey=Table05Entry15Colors.bgDarkGrey,Colors.bgBlack=Table05Entry15Colors.bgBlack,Colors.obj0White=Table05Entry15Colors.obj0White,Colors.obj0LightGrey=Table05Entry15Colors.obj0LightGrey,
Colors.obj0DarkGrey=Table05Entry15Colors.obj0DarkGrey,Colors.obj0Black=Table05Entry15Colors.obj0Black,Colors.obj1White=Table05Entry15Colors.obj1White,Colors.obj1LightGrey=Table05Entry15Colors.obj1LightGrey,Colors.obj1DarkGrey=Table05Entry15Colors.obj1DarkGrey,Colors.obj1Black=Table05Entry15Colors.obj1Black}}function concatenateBytes(a,b){return(a&255)<<8|b&255}function splitHighByte(a){return(a&65280)>>8}function splitLowByte(a){return a&255}
function rotateByteLeft(a){return u8Portable(a<<1|a>>7)}function rotateByteLeftThroughCarry(a){return u8Portable(a<<1|getCarryFlag$$1())}function rotateByteRight(a){return u8Portable(a>>1|a<<7)}function rotateByteRightThroughCarry(a){return u8Portable(a>>1|getCarryFlag$$1()<<7)}function setBitOnByte(a,b){return b|1<<a}function resetBitOnByte(a,b){return b&~(1<<a)}function checkBitOnByte(a,b){return 0!=(b&1<<a)}
var Palette=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;return a}();
function initializePalette(){Cpu.GBCEnabled?(eightBitStoreIntoGBMemory(65384,192),eightBitStoreIntoGBMemory(65385,255),eightBitStoreIntoGBMemory(65386,193),eightBitStoreIntoGBMemory(65387,13)):(eightBitStoreIntoGBMemory(65384,255),eightBitStoreIntoGBMemory(65385,255),eightBitStoreIntoGBMemory(65386,255),eightBitStoreIntoGBMemory(65387,255));Cpu.BootROMEnabled&&Cpu.GBCEnabled&&(eightBitStoreIntoGBMemory(65385,32),eightBitStoreIntoGBMemory(65387,138))}
function getMonochromeColorFromPalette(a,b,c){void 0===c&&(c=!1);var d=a;c||(d=eightBitLoadFromGBMemory(b)>>(a<<1)&3);a=242;switch(d){case 1:a=160;break;case 2:a=88;break;case 3:a=8}return a}
function getColorizedGbHexColorFromPalette(a,b){a=eightBitLoadFromGBMemory(b)>>2*a&3;if(b===Palette.memoryLocationSpritePaletteOne)switch(b=Colors.obj0White,a){case 1:b=Colors.obj0LightGrey;break;case 2:b=Colors.obj0DarkGrey;break;case 3:b=Colors.obj0Black}else if(b===Palette.memoryLocationSpritePaletteTwo)switch(b=Colors.obj1White,a){case 1:b=Colors.obj1LightGrey;break;case 2:b=Colors.obj1DarkGrey;break;case 3:b=Colors.obj1Black}else switch(b=Colors.bgWhite,a){case 1:b=Colors.bgLightGrey;break;case 2:b=
Colors.bgDarkGrey;break;case 3:b=Colors.bgBlack}return b}function writeColorPaletteToMemory(a,b){var c=Palette.memoryLocationSpritePaletteData;if(a===Palette.memoryLocationBackgroundPaletteData||a===c){var d=eightBitLoadFromGBMemory(a-1);d=resetBitOnByte(6,d);storePaletteByteInWasmMemory(d,b,a===c);incrementPaletteIndexIfSet(d,a-1)}}function incrementPaletteIndexIfSet(a,b){checkBitOnByte(7,a)&&(a=setBitOnByte(7,a+1),eightBitStoreIntoGBMemory(b,a))}
function getRgbColorFromPalette(a,b,c){b=8*a+2*b;a=loadPaletteByteFromWasmMemory(b+1,c);c=loadPaletteByteFromWasmMemory(b,c);return concatenateBytes(a,c)}function getColorComponentFromRgb(a,b){a*=5;return 8*((b&31<<a)>>a)}function loadPaletteByteFromWasmMemory(a,b){a&=63;b&&(a+=64);return load(GBC_PALETTE_LOCATION+a)}function storePaletteByteInWasmMemory(a,b,c){a&=63;c&&(a+=64);store(GBC_PALETTE_LOCATION+a,b)}
function addPriorityforPixel(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=!1);c&=3;d&&(c=setBitOnByte(2,c));store(BG_PRIORITY_MAP_LOCATION+getPixelStart(a,b),c)}function getPriorityforPixel(a,b){return load(BG_PRIORITY_MAP_LOCATION+getPixelStart(a,b))}function clearPriorityMap(){for(var a=0;144>a;++a)for(var b=0;160>b;++b)store(BG_PRIORITY_MAP_LOCATION+getPixelStart(b,a),0)}function getPixelStart(a,b){return 160*b+a}
var TileCache=function(){function a(){}a.tileId=-1;a.horizontalFlip=!1;a.nextXIndexToPerformCacheCheck=-1;return a}();function resetTileCache(){TileCache.tileId=-1;TileCache.nextXIndexToPerformCacheCheck=-1}
function drawPixelsFromLineOfTile(a,b,c,d,e,f,g,k,h,l,n,m,p,r){var w=0;b=getTileDataAddress(b,a);a=loadFromVramBank(b+2*f,c);c=loadFromVramBank(b+2*f+1,c);for(f=d;f<=e;++f)if(b=g+(f-d),b<h){var q=f;if(0>p||!checkBitOnByte(5,p))q=7-q;var u=0;checkBitOnByte(q,c)&&(u+=1,u<<=1);checkBitOnByte(q,a)&&(u+=1);if(Cpu.GBCEnabled&&(0<=p||0<=r)){q=0<=r;var v=p&7;q&&(v=r&7);var t=getRgbColorFromPalette(v,u,q);q=getColorComponentFromRgb(0,t);v=getColorComponentFromRgb(1,t);t=getColorComponentFromRgb(2,t)}else 0>=
m&&(m=Graphics.memoryLocationBackgroundPalette),n?v=q=t=getMonochromeColorFromPalette(u,m,n):(t=getColorizedGbHexColorFromPalette(u,m),q=getRedFromHexColor(t),v=getGreenFromHexColor(t),t=getBlueFromHexColor(t));var x=getTilePixelStart(b,k,h);store(l+x+0,q);store(l+x+1,v);store(l+x+2,t);q=!1;0<=p&&(q=checkBitOnByte(7,p));addPriorityforPixel(b,k,u,q);w++}return w}function getTilePixelStart(a,b,c){return 3*(b*c+a)}
function getTileDataAddress(a,b){a===Graphics.memoryLocationTileDataSelectZeroStart&&(b=checkBitOnByte(7,b)?b-128:b+128);return a+16*b}function isDutyCycleClockPositiveOrNegativeForWaveform(a,b){switch(a){case 1:return checkBitOnByte(b,129);case 2:return checkBitOnByte(b,135);case 3:return checkBitOnByte(b,126);default:return checkBitOnByte(b,1)}}
var Channel1=function(){function a(){}a.updateNRx0=function(b){var c=a.NRx0Negate;a.NRx0SweepPeriod=(b&112)>>4;a.NRx0Negate=checkBitOnByte(3,b);a.NRx0SweepShift=b&7;c&&!a.NRx0Negate&&a.sweepNegateShouldDisableChannelOnClear&&(a.isEnabled=!1)};a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(b){a.isEnabled&&(0===a.NRx2EnvelopePeriod&&a.isEnvelopeAutomaticUpdating&&(a.volume=a.volume+1&15),a.NRx2EnvelopeAddMode!==checkBitOnByte(3,
b)&&(a.volume=16-a.volume&15));a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=checkBitOnByte(3,b);a.NRx2EnvelopePeriod=b&7;b=0<(b&248);a.isDacEnabled=b;b||(a.isEnabled=!1)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|b};a.updateNRx4=function(b){var c=b&7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB;c=1===(Sound.frameSequencer&1);var d=!a.NRx4LengthEnabled&&checkBitOnByte(6,b);!c&&0<a.lengthCounter&&d&&(--a.lengthCounter,checkBitOnByte(7,b)||0!==
a.lengthCounter||(a.isEnabled=!1));a.NRx4LengthEnabled=checkBitOnByte(6,b);checkBitOnByte(7,b)&&(a.trigger(),!c&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.cycleCounter);store(getSaveStateMemoryOffset(4,a.saveStateSlot),a.NRx0SweepPeriod);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(5,a.saveStateSlot),a.NRx0Negate);store(getSaveStateMemoryOffset(6,a.saveStateSlot),a.NRx0SweepShift);
store(getSaveStateMemoryOffset(7,a.saveStateSlot),a.NRx1Duty);store(getSaveStateMemoryOffset(9,a.saveStateSlot),a.NRx1LengthLoad);store(getSaveStateMemoryOffset(10,a.saveStateSlot),a.NRx2StartingVolume);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot),a.NRx2EnvelopeAddMode);store(getSaveStateMemoryOffset(12,a.saveStateSlot),a.NRx2EnvelopePeriod);store(getSaveStateMemoryOffset(13,a.saveStateSlot),a.NRx3FrequencyLSB);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(14,
a.saveStateSlot),a.NRx4LengthEnabled);store(getSaveStateMemoryOffset(15,a.saveStateSlot),a.NRx4FrequencyMSB);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot),a.isEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot),a.isDacEnabled);store(getSaveStateMemoryOffset(18,a.saveStateSlot),a.frequency);store(getSaveStateMemoryOffset(22,a.saveStateSlot),a.frequencyTimer);store(getSaveStateMemoryOffset(26,a.saveStateSlot),a.envelopeCounter);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(30,
a.saveStateSlot),a.isEnvelopeAutomaticUpdating);store(getSaveStateMemoryOffset(31,a.saveStateSlot),a.lengthCounter);store(getSaveStateMemoryOffset(35,a.saveStateSlot),a.volume);store(getSaveStateMemoryOffset(39,a.saveStateSlot),a.dutyCycle);store(getSaveStateMemoryOffset(40,a.saveStateSlot),a.waveFormPositionOnDuty);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(41,a.saveStateSlot),a.isSweepEnabled);store(getSaveStateMemoryOffset(42,a.saveStateSlot),a.sweepCounter);store(getSaveStateMemoryOffset(46,
a.saveStateSlot),a.sweepShadowFrequency);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(49,a.saveStateSlot),a.sweepNegateShouldDisableChannelOnClear)};a.loadState=function(){a.cycleCounter=load(getSaveStateMemoryOffset(0,a.cycleCounter));a.NRx0SweepPeriod=load(getSaveStateMemoryOffset(4,a.saveStateSlot));a.NRx0Negate=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(5,a.saveStateSlot));a.NRx0SweepShift=load(getSaveStateMemoryOffset(6,a.saveStateSlot));a.NRx1Duty=load(getSaveStateMemoryOffset(7,
a.saveStateSlot));a.NRx1LengthLoad=load(getSaveStateMemoryOffset(9,a.saveStateSlot));a.NRx2StartingVolume=load(getSaveStateMemoryOffset(10,a.saveStateSlot));a.NRx2EnvelopeAddMode=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot));a.NRx2EnvelopePeriod=load(getSaveStateMemoryOffset(12,a.saveStateSlot));a.NRx3FrequencyLSB=load(getSaveStateMemoryOffset(13,a.saveStateSlot));a.NRx4LengthEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(14,a.saveStateSlot));
a.NRx4FrequencyMSB=load(getSaveStateMemoryOffset(15,a.saveStateSlot));a.isEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot));a.isDacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot));a.frequency=load(getSaveStateMemoryOffset(18,a.saveStateSlot));a.frequencyTimer=load(getSaveStateMemoryOffset(22,a.saveStateSlot));a.envelopeCounter=load(getSaveStateMemoryOffset(26,a.saveStateSlot));a.isEnvelopeAutomaticUpdating=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(30,
a.saveStateSlot));a.lengthCounter=load(getSaveStateMemoryOffset(31,a.saveStateSlot));a.volume=load(getSaveStateMemoryOffset(35,a.saveStateSlot));a.dutyCycle=load(getSaveStateMemoryOffset(39,a.saveStateSlot));a.waveFormPositionOnDuty=load(getSaveStateMemoryOffset(40,a.saveStateSlot));a.isSweepEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(41,a.saveStateSlot));a.sweepCounter=load(getSaveStateMemoryOffset(42,a.saveStateSlot));a.sweepShadowFrequency=load(getSaveStateMemoryOffset(46,
a.saveStateSlot));a.sweepNegateShouldDisableChannelOnClear=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(49,a.saveStateSlot))};a.initialize=function(){eightBitStoreIntoGBMemory(a.memoryLocationNRx0,128);eightBitStoreIntoGBMemory(a.memoryLocationNRx1,191);eightBitStoreIntoGBMemory(a.memoryLocationNRx2,243);eightBitStoreIntoGBMemory(a.memoryLocationNRx3,193);eightBitStoreIntoGBMemory(a.memoryLocationNRx4,191);Cpu.BootROMEnabled&&(eightBitStoreIntoGBMemory(a.memoryLocationNRx1,63),eightBitStoreIntoGBMemory(a.memoryLocationNRx2,
0),eightBitStoreIntoGBMemory(a.memoryLocationNRx3,0),eightBitStoreIntoGBMemory(a.memoryLocationNRx4,184))};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){var b=2048-a.frequency<<2;Cpu.GBCDoubleSpeed&&(b<<=2);a.frequencyTimer=b};a.getSample=function(b){var c=a.frequencyTimer;for(c-=b;0>=c;)b=abs(c),a.resetTimer(),c=a.frequencyTimer,c-=b,a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7;a.frequencyTimer=c;if(a.isEnabled&&
a.isDacEnabled)c=a.volume&15;else return 15;b=1;isDutyCycleClockPositiveOrNegativeForWaveform(a.NRx1Duty,a.waveFormPositionOnDuty)||(b=-b);return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=a.MAX_LENGTH);a.resetTimer();a.envelopeCounter=0===a.NRx2EnvelopePeriod?8:a.NRx2EnvelopePeriod;a.isEnvelopeAutomaticUpdating=!0;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=0===a.NRx0SweepPeriod?8:a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod||
0<a.NRx0SweepShift;a.sweepNegateShouldDisableChannelOnClear=!1;0<a.NRx0SweepShift&&didCalculatedSweepOverflow(calculateSweep())&&(a.isEnabled=!1);a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){b=a.cycleCounter+b;a.cycleCounter=b;return!(0<a.frequencyTimer-b)};a.updateSweep=function(){if(a.isEnabled&&a.isSweepEnabled){var b=a.sweepCounter-1;0>=b?0===a.NRx0SweepPeriod?a.sweepCounter=8:(a.sweepCounter=a.NRx0SweepPeriod,b=calculateSweep(),didCalculatedSweepOverflow(b)&&(a.isEnabled=
!1),0<a.NRx0SweepShift&&(a.setFrequency(b),didCalculatedSweepOverflow(calculateSweep())&&(a.isEnabled=!1))):a.sweepCounter=b}};a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&(--b,0===b&&(a.isEnabled=!1));a.lengthCounter=b};a.updateEnvelope=function(){var b=a.envelopeCounter-1;if(0>=b)if(0===a.NRx2EnvelopePeriod)b=8;else if(b=a.NRx2EnvelopePeriod,0!==b&&a.isEnvelopeAutomaticUpdating){var c=a.volume;c=a.NRx2EnvelopeAddMode?c+1:c-1;c&=15;15>c?a.volume=c:a.isEnvelopeAutomaticUpdating=
!1}a.envelopeCounter=b};a.setFrequency=function(b){a.sweepShadowFrequency=b;var c=b>>8&7;b&=255;var d=eightBitLoadFromGBMemory(a.memoryLocationNRx4)&248|c;eightBitStoreIntoGBMemory(a.memoryLocationNRx3,b);eightBitStoreIntoGBMemory(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.MAX_LENGTH=64;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=
0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.isEnvelopeAutomaticUpdating=!1;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=
0;a.sweepNegateShouldDisableChannelOnClear=!1;a.saveStateSlot=7;return a}();function calculateSweep(){var a=Channel1.sweepShadowFrequency,b=a>>Channel1.NRx0SweepShift;Channel1.NRx0Negate?(Channel1.sweepNegateShouldDisableChannelOnClear=!0,b=a-b):b=a+b;return b}function didCalculatedSweepOverflow(a){return 2047<a?!0:!1}
var Channel2=function(){function a(){}a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(b){a.isEnabled&&(0===a.NRx2EnvelopePeriod&&a.isEnvelopeAutomaticUpdating&&(a.volume=a.volume+1&15),a.NRx2EnvelopeAddMode!==checkBitOnByte(3,b)&&(a.volume=16-a.volume&15));a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=checkBitOnByte(3,b);a.NRx2EnvelopePeriod=b&7;b=0<(b&248);a.isDacEnabled=b;b||(a.isEnabled=b)};a.updateNRx3=
function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|b};a.updateNRx4=function(b){var c=b&7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB;c=1===(Sound.frameSequencer&1);var d=!a.NRx4LengthEnabled&&checkBitOnByte(6,b);!c&&0<a.lengthCounter&&d&&(--a.lengthCounter,checkBitOnByte(7,b)||0!==a.lengthCounter||(a.isEnabled=!1));a.NRx4LengthEnabled=checkBitOnByte(6,b);checkBitOnByte(7,b)&&(a.trigger(),!c&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=
function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.cycleCounter);store(getSaveStateMemoryOffset(7,a.saveStateSlot),a.NRx1Duty);store(getSaveStateMemoryOffset(8,a.saveStateSlot),a.NRx1LengthLoad);store(getSaveStateMemoryOffset(10,a.saveStateSlot),a.NRx2StartingVolume);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot),a.NRx2EnvelopeAddMode);store(getSaveStateMemoryOffset(12,a.saveStateSlot),a.NRx2EnvelopePeriod);store(getSaveStateMemoryOffset(13,a.saveStateSlot),
a.NRx3FrequencyLSB);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(14,a.saveStateSlot),a.NRx4LengthEnabled);store(getSaveStateMemoryOffset(15,a.saveStateSlot),a.NRx4FrequencyMSB);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot),a.isEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot),a.isDacEnabled);store(getSaveStateMemoryOffset(18,a.saveStateSlot),a.frequency);store(getSaveStateMemoryOffset(22,a.saveStateSlot),a.frequencyTimer);
store(getSaveStateMemoryOffset(26,a.saveStateSlot),a.envelopeCounter);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(30,a.saveStateSlot),a.isEnvelopeAutomaticUpdating);store(getSaveStateMemoryOffset(31,a.saveStateSlot),a.lengthCounter);store(getSaveStateMemoryOffset(35,a.saveStateSlot),a.volume);store(getSaveStateMemoryOffset(39,a.saveStateSlot),a.dutyCycle);store(getSaveStateMemoryOffset(40,a.saveStateSlot),a.waveFormPositionOnDuty)};a.loadState=function(){a.cycleCounter=load(getSaveStateMemoryOffset(0,
a.cycleCounter));a.NRx1Duty=load(getSaveStateMemoryOffset(7,a.saveStateSlot));a.NRx1LengthLoad=load(getSaveStateMemoryOffset(8,a.saveStateSlot));a.NRx2StartingVolume=load(getSaveStateMemoryOffset(10,a.saveStateSlot));a.NRx2EnvelopeAddMode=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot));a.NRx2EnvelopePeriod=load(getSaveStateMemoryOffset(12,a.saveStateSlot));a.NRx3FrequencyLSB=load(getSaveStateMemoryOffset(13,a.saveStateSlot));a.NRx4LengthEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(14,
a.saveStateSlot));a.NRx4FrequencyMSB=load(getSaveStateMemoryOffset(15,a.saveStateSlot));a.isEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot));a.isDacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot));a.frequency=load(getSaveStateMemoryOffset(18,a.saveStateSlot));a.frequencyTimer=load(getSaveStateMemoryOffset(22,a.saveStateSlot));a.envelopeCounter=load(getSaveStateMemoryOffset(26,a.saveStateSlot));a.isEnvelopeAutomaticUpdating=
loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(30,a.saveStateSlot));a.lengthCounter=load(getSaveStateMemoryOffset(31,a.saveStateSlot));a.volume=load(getSaveStateMemoryOffset(35,a.saveStateSlot));a.dutyCycle=load(getSaveStateMemoryOffset(39,a.saveStateSlot));a.waveFormPositionOnDuty=load(getSaveStateMemoryOffset(40,a.saveStateSlot))};a.initialize=function(){eightBitStoreIntoGBMemory(a.memoryLocationNRx1-1,255);eightBitStoreIntoGBMemory(a.memoryLocationNRx1,63);eightBitStoreIntoGBMemory(a.memoryLocationNRx2,
0);eightBitStoreIntoGBMemory(a.memoryLocationNRx3,0);eightBitStoreIntoGBMemory(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<2<<Cpu.GBCDoubleSpeed};a.getSample=function(b){var c=a.frequencyTimer;for(c-=b;0>=c;)b=abs(c),a.resetTimer(),c=a.frequencyTimer,c-=b,a.waveFormPositionOnDuty=a.waveFormPositionOnDuty+1&7;a.frequencyTimer=c;if(a.isEnabled&&a.isDacEnabled)c=
a.volume&15;else return 15;b=1;isDutyCycleClockPositiveOrNegativeForWaveform(a.NRx1Duty,a.waveFormPositionOnDuty)||(b=-b);return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=a.MAX_LENGTH);a.resetTimer();a.envelopeCounter=0===a.NRx2EnvelopePeriod?8:a.NRx2EnvelopePeriod;a.isEnvelopeAutomaticUpdating=!0;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){b=a.cycleCounter+b;a.cycleCounter=b;return!(0<a.frequencyTimer-b)};
a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.updateEnvelope=function(){var b=a.envelopeCounter-1;if(0>=b)if(0===a.NRx2EnvelopePeriod)b=8;else if(b=a.NRx2EnvelopePeriod,0!==b&&a.isEnvelopeAutomaticUpdating){var c=a.volume;c=a.NRx2EnvelopeAddMode?c+1:c-1;c&=15;15>c?a.volume=c:a.isEnvelopeAutomaticUpdating=!1}a.envelopeCounter=b};a.setFrequency=function(b){var c=b>>8;b&=255;var d=eightBitLoadFromGBMemory(a.memoryLocationNRx4)&
248|c;eightBitStoreIntoGBMemory(a.memoryLocationNRx3,b);eightBitStoreIntoGBMemory(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=c<<8|b};a.cycleCounter=0;a.MAX_LENGTH=64;a.memoryLocationNRx0=65301;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=
0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.isEnvelopeAutomaticUpdating=!1;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),Channel3=function(){function a(){}a.updateNRx0=function(b){b=checkBitOnByte(7,b);!a.isDacEnabled&&b&&(a.sampleBuffer=0);a.isDacEnabled=b;b||(a.isEnabled=b)};a.updateNRx1=function(b){a.NRx1LengthLoad=b;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2VolumeCode=
b>>5&15};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|b};a.updateNRx4=function(b){var c=b&7;a.NRx4FrequencyMSB=c;a.frequency=c<<8|a.NRx3FrequencyLSB;c=1===(Sound.frameSequencer&1);if(!c){var d=!a.NRx4LengthEnabled&&checkBitOnByte(6,b);0<a.lengthCounter&&d&&(--a.lengthCounter,checkBitOnByte(7,b)||0!==a.lengthCounter||(a.isEnabled=!1))}a.NRx4LengthEnabled=checkBitOnByte(6,b);checkBitOnByte(7,b)&&(a.trigger(),!c&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&
--a.lengthCounter)};a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.cycleCounter);store(getSaveStateMemoryOffset(8,a.saveStateSlot),a.NRx1LengthLoad);store(getSaveStateMemoryOffset(10,a.saveStateSlot),a.NRx2VolumeCode);store(getSaveStateMemoryOffset(12,a.saveStateSlot),a.NRx3FrequencyLSB);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot),a.NRx4LengthEnabled);store(getSaveStateMemoryOffset(14,a.saveStateSlot),a.NRx4FrequencyMSB);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(15,
a.saveStateSlot),a.isEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot),a.isDacEnabled);store(getSaveStateMemoryOffset(17,a.saveStateSlot),a.frequency);store(getSaveStateMemoryOffset(21,a.saveStateSlot),a.frequencyTimer);store(getSaveStateMemoryOffset(25,a.saveStateSlot),a.lengthCounter);store(getSaveStateMemoryOffset(33,a.saveStateSlot),a.waveTablePosition);store(getSaveStateMemoryOffset(37,a.saveStateSlot),a.volumeCode);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(38,
a.saveStateSlot),a.volumeCodeChanged);store(getSaveStateMemoryOffset(39,a.saveStateSlot),a.sampleBuffer)};a.loadState=function(){a.cycleCounter=load(getSaveStateMemoryOffset(0,a.cycleCounter));a.NRx1LengthLoad=load(getSaveStateMemoryOffset(8,a.saveStateSlot));a.NRx2VolumeCode=load(getSaveStateMemoryOffset(10,a.saveStateSlot));a.NRx3FrequencyLSB=load(getSaveStateMemoryOffset(12,a.saveStateSlot));a.NRx4LengthEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot));a.NRx4FrequencyMSB=
load(getSaveStateMemoryOffset(14,a.saveStateSlot));a.isEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot));a.isDacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot));a.frequency=load(getSaveStateMemoryOffset(17,a.saveStateSlot));a.frequencyTimer=load(getSaveStateMemoryOffset(21,a.saveStateSlot));a.lengthCounter=load(getSaveStateMemoryOffset(25,a.saveStateSlot));a.waveTablePosition=load(getSaveStateMemoryOffset(33,a.saveStateSlot));
a.volumeCode=load(getSaveStateMemoryOffset(37,a.saveStateSlot));a.volumeCodeChanged=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(38,a.saveStateSlot));a.sampleBuffer=load(getSaveStateMemoryOffset(39,a.saveStateSlot))};a.handleWaveRamRead=function(){return readCurrentSampleByteFromWaveRam()};a.handleWaveRamWrite=function(b){var c=i32Portable(a.waveTablePosition>>1);eightBitStoreIntoGBMemory(a.memoryLocationWaveTable+c,b)};a.initialize=function(){eightBitStoreIntoGBMemory(a.memoryLocationNRx0,
127);eightBitStoreIntoGBMemory(a.memoryLocationNRx1,255);eightBitStoreIntoGBMemory(a.memoryLocationNRx2,159);eightBitStoreIntoGBMemory(a.memoryLocationNRx3,0);eightBitStoreIntoGBMemory(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=2048-a.frequency<<1<<Cpu.GBCDoubleSpeed};a.getSample=function(b){if(!a.isEnabled||!a.isDacEnabled)return 15;var c=a.volumeCode;
a.volumeCodeChanged&&(c=eightBitLoadFromGBMemory(a.memoryLocationNRx2),c=c>>5&15,a.volumeCode=c,a.volumeCodeChanged=!1);var d=getSampleFromSampleBufferForWaveTablePosition(),e=0;switch(c){case 0:d>>=4;break;case 1:e=1;break;case 2:d>>=1;e=2;break;default:d>>=2,e=4}d=(0<e?d/e:0)+15;c=a.frequencyTimer;for(c-=b;0>=c;)b=abs(c),a.resetTimer(),c=a.frequencyTimer,c-=b,advanceWavePositionAndSampleBuffer();a.frequencyTimer=c;return d};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=
a.MAX_LENGTH);a.resetTimer();a.frequencyTimer+=6;a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return!(!a.volumeCodeChanged&&0<a.frequencyTimer-a.cycleCounter)};a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.cycleCounter=0;a.MAX_LENGTH=256;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=
65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.sampleBuffer=0;a.saveStateSlot=9;return a}();
function advanceWavePositionAndSampleBuffer(){var a=Channel3.waveTablePosition;for(a+=1;32<=a;)a-=32;Channel3.waveTablePosition=a;Channel3.sampleBuffer=readCurrentSampleByteFromWaveRam()}function readCurrentSampleByteFromWaveRam(){var a=i32Portable(Channel3.waveTablePosition>>1);return eightBitLoadFromGBMemory(Channel3.memoryLocationWaveTable+a)}function getSampleFromSampleBufferForWaveTablePosition(){var a=Channel3.sampleBuffer;a>>=(0===(Channel3.waveTablePosition&1))<<2;return a&15}
var Channel4=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=a.MAX_LENGTH-a.NRx1LengthLoad};a.updateNRx2=function(b){a.isEnabled&&(0===a.NRx2EnvelopePeriod&&a.isEnvelopeAutomaticUpdating&&(a.volume=a.volume+1&15),a.NRx2EnvelopeAddMode!==checkBitOnByte(3,b)&&(a.volume=16-a.volume&15));a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=checkBitOnByte(3,b);a.NRx2EnvelopePeriod=b&7;b=0<(b&248);a.isDacEnabled=b;b||(a.isEnabled=b)};a.updateNRx3=function(b){var c=
b&7;a.NRx3ClockShift=b>>4;a.NRx3WidthMode=checkBitOnByte(3,b);a.NRx3DivisorCode=c;c<<=1;1>c&&(c=1);a.divisor=c<<3};a.updateNRx4=function(b){var c=1===(Sound.frameSequencer&1),d=!a.NRx4LengthEnabled&&checkBitOnByte(6,b);!c&&0<a.lengthCounter&&d&&(--a.lengthCounter,checkBitOnByte(7,b)||0!==a.lengthCounter||(a.isEnabled=!1));a.NRx4LengthEnabled=checkBitOnByte(6,b);checkBitOnByte(7,b)&&(a.trigger(),!c&&a.lengthCounter===a.MAX_LENGTH&&a.NRx4LengthEnabled&&--a.lengthCounter)};a.saveState=function(){store(getSaveStateMemoryOffset(0,
a.saveStateSlot),a.cycleCounter);store(getSaveStateMemoryOffset(4,a.saveStateSlot),a.NRx1LengthLoad);store(getSaveStateMemoryOffset(6,a.saveStateSlot),a.NRx2StartingVolume);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(7,a.saveStateSlot),a.NRx2EnvelopeAddMode);store(getSaveStateMemoryOffset(8,a.saveStateSlot),a.NRx2EnvelopePeriod);store(getSaveStateMemoryOffset(9,a.saveStateSlot),a.NRx3ClockShift);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(10,a.saveStateSlot),a.NRx3WidthMode);
store(getSaveStateMemoryOffset(11,a.saveStateSlot),a.NRx3DivisorCode);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot),a.NRx4LengthEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot),a.isEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot),a.isDacEnabled);store(getSaveStateMemoryOffset(21,a.saveStateSlot),a.frequencyTimer);store(getSaveStateMemoryOffset(25,a.saveStateSlot),a.envelopeCounter);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(29,
a.saveStateSlot),a.isEnvelopeAutomaticUpdating);store(getSaveStateMemoryOffset(30,a.saveStateSlot),a.lengthCounter);store(getSaveStateMemoryOffset(34,a.saveStateSlot),a.volume);store(getSaveStateMemoryOffset(38,a.saveStateSlot),a.linearFeedbackShiftRegister)};a.loadState=function(){a.cycleCounter=load(getSaveStateMemoryOffset(0,a.cycleCounter));a.NRx1LengthLoad=load(getSaveStateMemoryOffset(4,a.saveStateSlot));a.NRx2StartingVolume=load(getSaveStateMemoryOffset(6,a.saveStateSlot));a.NRx2EnvelopeAddMode=
loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(7,a.saveStateSlot));a.NRx2EnvelopePeriod=load(getSaveStateMemoryOffset(8,a.saveStateSlot));a.NRx3ClockShift=load(getSaveStateMemoryOffset(9,a.saveStateSlot));a.NRx3WidthMode=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(10,a.saveStateSlot));a.NRx3DivisorCode=load(getSaveStateMemoryOffset(11,a.saveStateSlot));a.NRx4LengthEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot));a.isEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(15,
a.saveStateSlot));a.isDacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot));a.frequencyTimer=load(getSaveStateMemoryOffset(21,a.saveStateSlot));a.envelopeCounter=load(getSaveStateMemoryOffset(25,a.saveStateSlot));a.isEnvelopeAutomaticUpdating=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(29,a.saveStateSlot));a.lengthCounter=load(getSaveStateMemoryOffset(30,a.saveStateSlot));a.volume=load(getSaveStateMemoryOffset(34,a.saveStateSlot));a.linearFeedbackShiftRegister=
load(getSaveStateMemoryOffset(38,a.saveStateSlot))};a.initialize=function(){eightBitStoreIntoGBMemory(a.memoryLocationNRx1-1,255);eightBitStoreIntoGBMemory(a.memoryLocationNRx1,255);eightBitStoreIntoGBMemory(a.memoryLocationNRx2,0);eightBitStoreIntoGBMemory(a.memoryLocationNRx3,0);eightBitStoreIntoGBMemory(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.getSample=function(b){var c=a.frequencyTimer;c-=b;if(0>=c){b=abs(c);
c=a.getNoiseChannelFrequencyPeriod();c-=b;b=a.linearFeedbackShiftRegister;var d=b&1^b>>1&1;b=b>>1|d<<14;a.NRx3WidthMode&&(b=b&-65|d<<6);a.linearFeedbackShiftRegister=b}0>c&&(c=0);a.frequencyTimer=c;if(a.isEnabled&&a.isDacEnabled)c=a.volume&15;else return 15;b=checkBitOnByte(0,a.linearFeedbackShiftRegister)?-1:1;return b*c+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=a.MAX_LENGTH);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=0===a.NRx2EnvelopePeriod?
8:a.NRx2EnvelopePeriod;a.isEnvelopeAutomaticUpdating=!0;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return!(0<a.frequencyTimer-a.cycleCounter)};a.getNoiseChannelFrequencyPeriod=function(){return a.divisor<<a.NRx3ClockShift<<Cpu.GBCDoubleSpeed};a.updateLength=function(){var b=a.lengthCounter;0<b&&a.NRx4LengthEnabled&&--b;0===b&&(a.isEnabled=!1);a.lengthCounter=b};a.updateEnvelope=function(){var b=
a.envelopeCounter-1;if(0>=b)if(0===a.NRx2EnvelopePeriod)b=8;else if(b=a.NRx2EnvelopePeriod,0!==b&&a.isEnvelopeAutomaticUpdating){var c=a.volume;c=a.NRx2EnvelopeAddMode?c+1:c-1;c&=15;15>c?a.volume=c:a.isEnvelopeAutomaticUpdating=!1}a.envelopeCounter=b};a.cycleCounter=0;a.MAX_LENGTH=64;a.memoryLocationNRx0=65311;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;
a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=0;a.isEnvelopeAutomaticUpdating=!1;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),SoundAccumulator=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=!1;a.channel2DacEnabled=!1;a.channel3DacEnabled=
!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}();
function initializeSoundAccumulator(){SoundAccumulator.channel1Sample=15;SoundAccumulator.channel2Sample=15;SoundAccumulator.channel3Sample=15;SoundAccumulator.channel4Sample=15;SoundAccumulator.channel1DacEnabled=!1;SoundAccumulator.channel2DacEnabled=!1;SoundAccumulator.channel3DacEnabled=!1;SoundAccumulator.channel4DacEnabled=!1;SoundAccumulator.leftChannelSampleUnsignedByte=127;SoundAccumulator.rightChannelSampleUnsignedByte=127;SoundAccumulator.mixerVolumeChanged=!0;SoundAccumulator.mixerEnabledChanged=
!0;SoundAccumulator.needToRemixSamples=!1}
function accumulateSound(a){var b=Channel1.willChannelUpdate(a)||didChannelDacChange(Channel1.channelNumber),c=Channel2.willChannelUpdate(a)||didChannelDacChange(Channel2.channelNumber),d=Channel3.willChannelUpdate(a)||didChannelDacChange(Channel3.channelNumber),e=Channel4.willChannelUpdate(a)||didChannelDacChange(Channel4.channelNumber);b&&(SoundAccumulator.channel1Sample=Channel1.getSampleFromCycleCounter());c&&(SoundAccumulator.channel2Sample=Channel2.getSampleFromCycleCounter());d&&(SoundAccumulator.channel3Sample=
Channel3.getSampleFromCycleCounter());e&&(SoundAccumulator.channel4Sample=Channel4.getSampleFromCycleCounter());if(b||c||d||e)SoundAccumulator.needToRemixSamples=!0;b=Sound.downSampleCycleCounter;b+=a;a=Sound.maxDownSampleCycles();b>=a&&(b-=a,SoundAccumulator.needToRemixSamples||SoundAccumulator.mixerVolumeChanged||SoundAccumulator.mixerEnabledChanged?mixChannelSamples(SoundAccumulator.channel1Sample,SoundAccumulator.channel2Sample,SoundAccumulator.channel3Sample,SoundAccumulator.channel4Sample):
Sound.downSampleCycleCounter=b,setLeftAndRightOutputForAudioQueue(SoundAccumulator.leftChannelSampleUnsignedByte+1,SoundAccumulator.rightChannelSampleUnsignedByte+1,AUDIO_BUFFER_LOCATION),a=Sound.audioQueueIndex+1,c=i32Portable(Sound.wasmBoyMemoryMaxBufferSize>>1)-1,a>=c&&--a,Sound.audioQueueIndex=a);Sound.downSampleCycleCounter=b}
function didChannelDacChange(a){switch(a){case Channel1.channelNumber:a=Channel1.isDacEnabled;var b=SoundAccumulator.channel1DacEnabled!==a;SoundAccumulator.channel1DacEnabled=a;return b;case Channel2.channelNumber:return a=Channel2.isDacEnabled,b=SoundAccumulator.channel2DacEnabled!==a,SoundAccumulator.channel2DacEnabled=a,b;case Channel3.channelNumber:return a=Channel3.isDacEnabled,b=SoundAccumulator.channel3DacEnabled!==a,SoundAccumulator.channel3DacEnabled=a,b;case Channel4.channelNumber:return a=
Channel4.isDacEnabled,b=SoundAccumulator.channel4DacEnabled!==a,SoundAccumulator.channel4DacEnabled=a,b}return!1}
var Sound=function(){function a(){}a.batchProcessCycles=function(){return 87<<Cpu.GBCDoubleSpeed};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=checkBitOnByte(7,b);a.NR51IsChannel3EnabledOnLeftOutput=checkBitOnByte(6,b);a.NR51IsChannel2EnabledOnLeftOutput=checkBitOnByte(5,b);a.NR51IsChannel1EnabledOnLeftOutput=checkBitOnByte(4,b);a.NR51IsChannel4EnabledOnRightOutput=checkBitOnByte(3,b);a.NR51IsChannel3EnabledOnRightOutput=
checkBitOnByte(2,b);a.NR51IsChannel2EnabledOnRightOutput=checkBitOnByte(1,b);a.NR51IsChannel1EnabledOnRightOutput=checkBitOnByte(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=checkBitOnByte(7,b)};a.maxFrameSequenceCycles=function(){return 8192<<Cpu.GBCDoubleSpeed};a.maxDownSampleCycles=function(){return Cpu.CLOCK_SPEED()/a.sampleRate};a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.NR50LeftMixerVolume);store(getSaveStateMemoryOffset(4,a.saveStateSlot),a.NR50RightMixerVolume);
storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(8,a.saveStateSlot),a.NR51IsChannel1EnabledOnLeftOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(9,a.saveStateSlot),a.NR51IsChannel2EnabledOnLeftOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(10,a.saveStateSlot),a.NR51IsChannel3EnabledOnLeftOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot),a.NR51IsChannel4EnabledOnLeftOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(12,
a.saveStateSlot),a.NR51IsChannel1EnabledOnRightOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot),a.NR51IsChannel2EnabledOnRightOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(14,a.saveStateSlot),a.NR51IsChannel3EnabledOnRightOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot),a.NR51IsChannel4EnabledOnRightOutput);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot),a.NR52IsSoundEnabled);
store(getSaveStateMemoryOffset(17,a.saveStateSlot),a.frameSequenceCycleCounter);store(getSaveStateMemoryOffset(22,a.saveStateSlot),a.frameSequencer);store(getSaveStateMemoryOffset(23,a.saveStateSlot),a.downSampleCycleCounter);store(getSaveStateMemoryOffset(24,a.saveStateSlot),SoundAccumulator.channel1Sample);store(getSaveStateMemoryOffset(25,a.saveStateSlot),SoundAccumulator.channel2Sample);store(getSaveStateMemoryOffset(26,a.saveStateSlot),SoundAccumulator.channel3Sample);store(getSaveStateMemoryOffset(27,
a.saveStateSlot),SoundAccumulator.channel4Sample);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(28,a.saveStateSlot),SoundAccumulator.channel1DacEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(29,a.saveStateSlot),SoundAccumulator.channel2DacEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(30,a.saveStateSlot),SoundAccumulator.channel3DacEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(31,a.saveStateSlot),SoundAccumulator.channel4DacEnabled);
store(getSaveStateMemoryOffset(32,a.saveStateSlot),SoundAccumulator.leftChannelSampleUnsignedByte);store(getSaveStateMemoryOffset(33,a.saveStateSlot),SoundAccumulator.rightChannelSampleUnsignedByte);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(34,a.saveStateSlot),SoundAccumulator.mixerVolumeChanged);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(35,a.saveStateSlot),SoundAccumulator.mixerEnabledChanged)};a.loadState=function(){a.NR50LeftMixerVolume=load(getSaveStateMemoryOffset(0,
a.saveStateSlot));a.NR50RightMixerVolume=load(getSaveStateMemoryOffset(4,a.saveStateSlot));a.NR51IsChannel1EnabledOnLeftOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(8,a.saveStateSlot));a.NR51IsChannel2EnabledOnLeftOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(9,a.saveStateSlot));a.NR51IsChannel3EnabledOnLeftOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(10,a.saveStateSlot));a.NR51IsChannel4EnabledOnLeftOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(11,
a.saveStateSlot));a.NR51IsChannel1EnabledOnRightOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(12,a.saveStateSlot));a.NR51IsChannel2EnabledOnRightOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot));a.NR51IsChannel3EnabledOnRightOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(14,a.saveStateSlot));a.NR51IsChannel4EnabledOnRightOutput=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot));a.NR52IsSoundEnabled=
loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot));a.frameSequenceCycleCounter=load(getSaveStateMemoryOffset(17,a.saveStateSlot));a.frameSequencer=load(getSaveStateMemoryOffset(22,a.saveStateSlot));a.downSampleCycleCounter=load(getSaveStateMemoryOffset(23,a.saveStateSlot));SoundAccumulator.channel1Sample=load(getSaveStateMemoryOffset(24,a.saveStateSlot));SoundAccumulator.channel2Sample=load(getSaveStateMemoryOffset(25,a.saveStateSlot));SoundAccumulator.channel3Sample=
load(getSaveStateMemoryOffset(26,a.saveStateSlot));SoundAccumulator.channel4Sample=load(getSaveStateMemoryOffset(27,a.saveStateSlot));SoundAccumulator.channel1DacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(28,a.saveStateSlot));SoundAccumulator.channel2DacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(29,a.saveStateSlot));SoundAccumulator.channel3DacEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(30,a.saveStateSlot));SoundAccumulator.channel4DacEnabled=
loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(31,a.saveStateSlot));SoundAccumulator.leftChannelSampleUnsignedByte=load(getSaveStateMemoryOffset(32,a.saveStateSlot));SoundAccumulator.rightChannelSampleUnsignedByte=load(getSaveStateMemoryOffset(33,a.saveStateSlot));SoundAccumulator.mixerVolumeChanged=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(34,a.saveStateSlot));SoundAccumulator.mixerEnabledChanged=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(35,a.saveStateSlot));
clearAudioBuffer()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=
!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.frameSequencer=0;a.downSampleCycleCounter=0;a.sampleRate=44100;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}();
function initializeSound(){Sound.currentCycles=0;Sound.NR50LeftMixerVolume=0;Sound.NR50RightMixerVolume=0;Sound.NR51IsChannel1EnabledOnLeftOutput=!0;Sound.NR51IsChannel2EnabledOnLeftOutput=!0;Sound.NR51IsChannel3EnabledOnLeftOutput=!0;Sound.NR51IsChannel4EnabledOnLeftOutput=!0;Sound.NR51IsChannel1EnabledOnRightOutput=!0;Sound.NR51IsChannel2EnabledOnRightOutput=!0;Sound.NR51IsChannel3EnabledOnRightOutput=!0;Sound.NR51IsChannel4EnabledOnRightOutput=!0;Sound.NR52IsSoundEnabled=!0;Sound.frameSequenceCycleCounter=
0;Sound.downSampleCycleCounter=0;Sound.frameSequencer=0;Sound.audioQueueIndex=0;Channel1.initialize();Channel2.initialize();Channel3.initialize();Channel4.initialize();eightBitStoreIntoGBMemory(Sound.memoryLocationNR50,119);Sound.updateNR50(119);eightBitStoreIntoGBMemory(Sound.memoryLocationNR51,243);Sound.updateNR51(243);eightBitStoreIntoGBMemory(Sound.memoryLocationNR52,241);Sound.updateNR52(241);Cpu.BootROMEnabled&&(eightBitStoreIntoGBMemory(Sound.memoryLocationNR50,0),Sound.updateNR50(0),eightBitStoreIntoGBMemory(Sound.memoryLocationNR51,
0),Sound.updateNR51(0),eightBitStoreIntoGBMemory(Sound.memoryLocationNR52,112),Sound.updateNR52(112));initializeSoundAccumulator()}function batchProcessAudio(){for(var a=Sound.batchProcessCycles(),b=Sound.currentCycles;b>=a;)updateSound(a),b-=a;Sound.currentCycles=b}function updateSound(a){var b=updateFrameSequencer(a);Config.audioAccumulateSamples&&!b?accumulateSound(a):calculateSound(a)}function getNumberOfSamplesInAudioBuffer(){return Sound.audioQueueIndex}
function clearAudioBuffer(){Sound.audioQueueIndex=0}
function calculateSound(a){var b=i32Portable(Channel1.getSample(a)),c=i32Portable(Channel2.getSample(a)),d=i32Portable(Channel3.getSample(a)),e=i32Portable(Channel4.getSample(a));SoundAccumulator.channel1Sample=b;SoundAccumulator.channel2Sample=c;SoundAccumulator.channel3Sample=d;SoundAccumulator.channel4Sample=e;a=Sound.downSampleCycleCounter+a;if(a>=Sound.maxDownSampleCycles()){a-=Sound.maxDownSampleCycles();var f=mixChannelSamples(b,c,d,e),g=splitHighByte(f);f=splitLowByte(f);setLeftAndRightOutputForAudioQueue(g+
1,f+1,AUDIO_BUFFER_LOCATION);Config.enableAudioDebugging&&(f=mixChannelSamples(b,15,15,15),g=splitHighByte(f),f=splitLowByte(f),setLeftAndRightOutputForAudioQueue(g+1,f+1,CHANNEL_1_BUFFER_LOCATION),f=mixChannelSamples(15,c,15,15),g=splitHighByte(f),f=splitLowByte(f),setLeftAndRightOutputForAudioQueue(g+1,f+1,CHANNEL_2_BUFFER_LOCATION),f=mixChannelSamples(15,15,d,15),g=splitHighByte(f),f=splitLowByte(f),setLeftAndRightOutputForAudioQueue(g+1,f+1,CHANNEL_3_BUFFER_LOCATION),f=mixChannelSamples(15,15,
15,e),g=splitHighByte(f),f=splitLowByte(f),setLeftAndRightOutputForAudioQueue(g+1,f+1,CHANNEL_4_BUFFER_LOCATION));b=Sound.audioQueueIndex+1;c=i32Portable(Sound.wasmBoyMemoryMaxBufferSize>>1)-1;b>=c&&--b;Sound.audioQueueIndex=b}Sound.downSampleCycleCounter=a}
function updateFrameSequencer(a){var b=Sound.maxFrameSequenceCycles();a=Sound.frameSequenceCycleCounter+a;if(a>=b){Sound.frameSequenceCycleCounter=a-b;b=Sound.frameSequencer+1&7;switch(b){case 0:Channel1.updateLength();Channel2.updateLength();Channel3.updateLength();Channel4.updateLength();break;case 2:Channel1.updateLength();Channel2.updateLength();Channel3.updateLength();Channel4.updateLength();Channel1.updateSweep();break;case 4:Channel1.updateLength();Channel2.updateLength();Channel3.updateLength();
Channel4.updateLength();break;case 6:Channel1.updateLength();Channel2.updateLength();Channel3.updateLength();Channel4.updateLength();Channel1.updateSweep();break;case 7:Channel1.updateEnvelope(),Channel2.updateEnvelope(),Channel4.updateEnvelope()}Sound.frameSequencer=b;return!0}Sound.frameSequenceCycleCounter=a;return!1}
function mixChannelSamples(a,b,c,d){void 0===a&&(a=15);void 0===b&&(b=15);void 0===c&&(c=15);void 0===d&&(d=15);SoundAccumulator.mixerVolumeChanged=!1;var e=0+(Sound.NR51IsChannel1EnabledOnLeftOutput?a:15);e+=Sound.NR51IsChannel2EnabledOnLeftOutput?b:15;e+=Sound.NR51IsChannel3EnabledOnLeftOutput?c:15;e+=Sound.NR51IsChannel4EnabledOnLeftOutput?d:15;a=0+(Sound.NR51IsChannel1EnabledOnRightOutput?a:15);a+=Sound.NR51IsChannel2EnabledOnRightOutput?b:15;a+=Sound.NR51IsChannel3EnabledOnRightOutput?c:15;a+=
Sound.NR51IsChannel4EnabledOnRightOutput?d:15;SoundAccumulator.mixerEnabledChanged=!1;SoundAccumulator.needToRemixSamples=!1;b=getSampleAsUnsignedByte(e,Sound.NR50LeftMixerVolume+1);c=getSampleAsUnsignedByte(a,Sound.NR50RightMixerVolume+1);SoundAccumulator.leftChannelSampleUnsignedByte=b;SoundAccumulator.rightChannelSampleUnsignedByte=c;return concatenateBytes(b,c)}
function getSampleAsUnsignedByte(a,b){if(60===a)return 127;a=1E5*(a-60)*b>>3;a=i32Portable(a/1E5)+60;b=i32Portable(12E6/254);a=i32Portable(1E5*a/b);return a=i32Portable(a)}function setLeftAndRightOutputForAudioQueue(a,b,c){c+=Sound.audioQueueIndex<<1;store(c+0,a+1);store(c+1,b+1)}
function SoundRegisterWriteTraps(a,b){if(a!==Sound.memoryLocationNR52&&!Sound.NR52IsSoundEnabled)return!1;switch(a){case Channel1.memoryLocationNRx0:Channel1.updateNRx0(b);break;case Channel3.memoryLocationNRx0:Channel3.updateNRx0(b);break;case Channel1.memoryLocationNRx1:Channel1.updateNRx1(b);break;case Channel2.memoryLocationNRx1:Channel2.updateNRx1(b);break;case Channel3.memoryLocationNRx1:Channel3.updateNRx1(b);break;case Channel4.memoryLocationNRx1:Channel4.updateNRx1(b);break;case Channel1.memoryLocationNRx2:Channel1.updateNRx2(b);
break;case Channel2.memoryLocationNRx2:Channel2.updateNRx2(b);break;case Channel3.memoryLocationNRx2:Channel3.volumeCodeChanged=!0;Channel3.updateNRx2(b);break;case Channel4.memoryLocationNRx2:Channel4.updateNRx2(b);break;case Channel1.memoryLocationNRx3:Channel1.updateNRx3(b);break;case Channel2.memoryLocationNRx3:Channel2.updateNRx3(b);break;case Channel3.memoryLocationNRx3:Channel3.updateNRx3(b);break;case Channel4.memoryLocationNRx3:Channel4.updateNRx3(b);break;case Channel1.memoryLocationNRx4:Channel1.updateNRx4(b);
break;case Channel2.memoryLocationNRx4:Channel2.updateNRx4(b);break;case Channel3.memoryLocationNRx4:Channel3.updateNRx4(b);break;case Channel4.memoryLocationNRx4:Channel4.updateNRx4(b);break;case Sound.memoryLocationNR50:Sound.updateNR50(b);SoundAccumulator.mixerVolumeChanged=!0;break;case Sound.memoryLocationNR51:Sound.updateNR51(b);SoundAccumulator.mixerEnabledChanged=!0;break;case Sound.memoryLocationNR52:a=Sound.NR52IsSoundEnabled;!a&&checkBitOnByte(7,b)&&(Sound.frameSequencer=7,Channel1.waveFormPositionOnDuty=
0,Channel2.waveFormPositionOnDuty=0);if(a&&!checkBitOnByte(7,b))for(a=65296;65318>a;++a)eightBitStoreIntoGBMemoryWithTraps(a,0);Sound.updateNR52(b)}return!0}
function SoundRegisterReadTraps(a){switch(a){case Channel1.memoryLocationNRx0:return a=eightBitLoadFromGBMemory(Channel1.memoryLocationNRx0),a|128;case Channel2.memoryLocationNRx0:return a=eightBitLoadFromGBMemory(Channel2.memoryLocationNRx0),a|255;case Channel3.memoryLocationNRx0:return a=eightBitLoadFromGBMemory(Channel3.memoryLocationNRx0),a|127;case Channel4.memoryLocationNRx0:return a=eightBitLoadFromGBMemory(Channel4.memoryLocationNRx0),a|255;case Sound.memoryLocationNR50:return a=eightBitLoadFromGBMemory(Sound.memoryLocationNR50),
a|0;case Channel1.memoryLocationNRx1:return a=eightBitLoadFromGBMemory(Channel1.memoryLocationNRx1),a|63;case Channel2.memoryLocationNRx1:return a=eightBitLoadFromGBMemory(Channel2.memoryLocationNRx1),a|63;case Channel3.memoryLocationNRx1:return a=eightBitLoadFromGBMemory(Channel3.memoryLocationNRx1),a|255;case Channel4.memoryLocationNRx1:return a=eightBitLoadFromGBMemory(Channel4.memoryLocationNRx1),a|255;case Sound.memoryLocationNR51:return a=eightBitLoadFromGBMemory(Sound.memoryLocationNR51),a|
0;case Channel1.memoryLocationNRx2:return a=eightBitLoadFromGBMemory(Channel1.memoryLocationNRx2),a|0;case Channel2.memoryLocationNRx2:return a=eightBitLoadFromGBMemory(Channel2.memoryLocationNRx2),a|0;case Channel3.memoryLocationNRx2:return a=eightBitLoadFromGBMemory(Channel3.memoryLocationNRx2),a|159;case Channel4.memoryLocationNRx2:return a=eightBitLoadFromGBMemory(Channel4.memoryLocationNRx2),a|0;case Sound.memoryLocationNR52:return a=0,a=Sound.NR52IsSoundEnabled?setBitOnByte(7,a):resetBitOnByte(7,
a),a=Channel1.isEnabled?setBitOnByte(0,a):resetBitOnByte(0,a),a=Channel2.isEnabled?setBitOnByte(1,a):resetBitOnByte(1,a),a=Channel3.isEnabled?setBitOnByte(2,a):resetBitOnByte(2,a),a=Channel4.isEnabled?setBitOnByte(3,a):resetBitOnByte(3,a),a|112;case Channel1.memoryLocationNRx3:return a=eightBitLoadFromGBMemory(Channel1.memoryLocationNRx3),a|255;case Channel2.memoryLocationNRx3:return a=eightBitLoadFromGBMemory(Channel2.memoryLocationNRx3),a|255;case Channel3.memoryLocationNRx3:return a=eightBitLoadFromGBMemory(Channel3.memoryLocationNRx3),
a|255;case Channel4.memoryLocationNRx3:return a=eightBitLoadFromGBMemory(Channel4.memoryLocationNRx3),a|0;case Channel1.memoryLocationNRx4:return a=eightBitLoadFromGBMemory(Channel1.memoryLocationNRx4),a|191;case Channel2.memoryLocationNRx4:return a=eightBitLoadFromGBMemory(Channel2.memoryLocationNRx4),a|191;case Channel3.memoryLocationNRx4:return a=eightBitLoadFromGBMemory(Channel3.memoryLocationNRx4),a|191;case Channel4.memoryLocationNRx4:return a=eightBitLoadFromGBMemory(Channel4.memoryLocationNRx4),
a|191}return-1}
var Interrupts=function(){function a(){}a.updateInterruptEnabled=function(b){a.isVBlankInterruptEnabled=checkBitOnByte(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=checkBitOnByte(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=checkBitOnByte(a.bitPositionTimerInterrupt,b);a.isSerialInterruptEnabled=checkBitOnByte(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptEnabled=checkBitOnByte(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=
checkBitOnByte(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=checkBitOnByte(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=checkBitOnByte(a.bitPositionTimerInterrupt,b);a.isSerialInterruptRequested=checkBitOnByte(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptRequested=checkBitOnByte(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&31)};a.saveState=function(){storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(0,
a.saveStateSlot),a.masterInterruptSwitch);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(1,a.saveStateSlot),a.masterInterruptSwitchDelay);store(getSaveStateMemoryOffset(16,a.saveStateSlot),a.interruptsEnabledValue);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot),a.isVBlankInterruptEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(18,a.saveStateSlot),a.isLcdInterruptEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(19,a.saveStateSlot),
a.isTimerInterruptEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(20,a.saveStateSlot),a.isSerialInterruptEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(21,a.saveStateSlot),a.isJoypadInterruptEnabled);store(getSaveStateMemoryOffset(32,a.saveStateSlot),a.interruptsRequestedValue);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(33,a.saveStateSlot),a.isVBlankInterruptRequested);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(34,a.saveStateSlot),
a.isLcdInterruptRequested);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(35,a.saveStateSlot),a.isTimerInterruptRequested);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(36,a.saveStateSlot),a.isSerialInterruptRequested);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(37,a.saveStateSlot),a.isJoypadInterruptRequested)};a.loadState=function(){a.masterInterruptSwitch=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(0,a.saveStateSlot));a.masterInterruptSwitchDelay=
loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(1,a.saveStateSlot));a.interruptsEnabledValue=load(getSaveStateMemoryOffset(16,a.saveStateSlot));a.isVBlankInterruptEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot));a.isLcdInterruptEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(18,a.saveStateSlot));a.isTimerInterruptEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(19,a.saveStateSlot));a.isSerialInterruptEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(20,
a.saveStateSlot));a.isJoypadInterruptEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(21,a.saveStateSlot));a.interruptsRequestedValue=load(getSaveStateMemoryOffset(32,a.saveStateSlot));a.isVBlankInterruptRequested=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(33,a.saveStateSlot));a.isLcdInterruptRequested=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(34,a.saveStateSlot));a.isTimerInterruptRequested=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(35,
a.saveStateSlot));a.isSerialInterruptRequested=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(36,a.saveStateSlot));a.isJoypadInterruptRequested=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(37,a.saveStateSlot))};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionSerialInterrupt=3;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=
0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isSerialInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=!1;a.isSerialInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}();
function initializeInterrupts(){Interrupts.updateInterruptEnabled(0);eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptEnabled,Interrupts.interruptsEnabledValue);Interrupts.updateInterruptRequested(225);eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptRequest,Interrupts.interruptsRequestedValue)}
function checkInterrupts(){Interrupts.masterInterruptSwitchDelay&&(Interrupts.masterInterruptSwitch=!0,Interrupts.masterInterruptSwitchDelay=!1);if(0<(Interrupts.interruptsEnabledValue&Interrupts.interruptsRequestedValue&31)){var a=!1;Interrupts.masterInterruptSwitch&&!Cpu.isHaltNoJump&&(Interrupts.isVBlankInterruptEnabled&&Interrupts.isVBlankInterruptRequested?(_handleInterrupt(Interrupts.bitPositionVBlankInterrupt),a=!0):Interrupts.isLcdInterruptEnabled&&Interrupts.isLcdInterruptRequested?(_handleInterrupt(Interrupts.bitPositionLcdInterrupt),
a=!0):Interrupts.isTimerInterruptEnabled&&Interrupts.isTimerInterruptRequested?(_handleInterrupt(Interrupts.bitPositionTimerInterrupt),a=!0):Interrupts.isSerialInterruptEnabled&&Interrupts.isSerialInterruptRequested?(_handleInterrupt(Interrupts.bitPositionSerialInterrupt),a=!0):Interrupts.isJoypadInterruptEnabled&&Interrupts.isJoypadInterruptRequested&&(_handleInterrupt(Interrupts.bitPositionJoypadInterrupt),a=!0));var b=0;a&&(b=20,Cpu.isHalted()&&(Cpu.exitHaltAndStop(),b+=4));Cpu.isHalted()&&Cpu.exitHaltAndStop();
return b}return 0}
function _handleInterrupt(a){setInterrupts(!1);var b=eightBitLoadFromGBMemory(Interrupts.memoryLocationInterruptRequest);b=resetBitOnByte(a,b);Interrupts.interruptsRequestedValue=b;eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptRequest,b);Cpu.stackPointer-=2;Cpu.isHalted();sixteenBitStoreIntoGBMemory(Cpu.stackPointer,Cpu.programCounter);switch(a){case Interrupts.bitPositionVBlankInterrupt:Interrupts.isVBlankInterruptRequested=!1;Cpu.programCounter=64;break;case Interrupts.bitPositionLcdInterrupt:Interrupts.isLcdInterruptRequested=!1;
Cpu.programCounter=72;break;case Interrupts.bitPositionTimerInterrupt:Interrupts.isTimerInterruptRequested=!1;Cpu.programCounter=80;break;case Interrupts.bitPositionSerialInterrupt:Interrupts.isSerialInterruptRequested=!1;Cpu.programCounter=88;break;case Interrupts.bitPositionJoypadInterrupt:Interrupts.isJoypadInterruptRequested=!1,Cpu.programCounter=96}}
function _requestInterrupt(a){var b=eightBitLoadFromGBMemory(Interrupts.memoryLocationInterruptRequest);b=setBitOnByte(a,b);Interrupts.interruptsRequestedValue=b;eightBitStoreIntoGBMemory(Interrupts.memoryLocationInterruptRequest,b)}function setInterrupts(a){a?Interrupts.masterInterruptSwitchDelay=!0:Interrupts.masterInterruptSwitch=!1}function requestVBlankInterrupt(){Interrupts.isVBlankInterruptRequested=!0;_requestInterrupt(Interrupts.bitPositionVBlankInterrupt)}
function requestLcdInterrupt(){Interrupts.isLcdInterruptRequested=!0;_requestInterrupt(Interrupts.bitPositionLcdInterrupt)}function requestTimerInterrupt(){Interrupts.isTimerInterruptRequested=!0;_requestInterrupt(Interrupts.bitPositionTimerInterrupt)}function requestJoypadInterrupt(){Interrupts.isJoypadInterruptRequested=!0;_requestInterrupt(Interrupts.bitPositionJoypadInterrupt)}
function requestSerialInterrupt(){Interrupts.isSerialInterruptRequested=!0;_requestInterrupt(Interrupts.bitPositionSerialInterrupt)}
var Timers=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(){var b=a.dividerRegister;a.dividerRegister=0;eightBitStoreIntoGBMemory(a.memoryLocationDividerRegister,0);a.timerEnabled&&_checkDividerRegisterFallingEdgeDetector(b,0)&&_incrementTimerCounter()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=
b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=b,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=checkBitOnByte(2,b);b&=3;if(!c){c=_getTimerCounterMaskBit(a.timerInputClock);var d=_getTimerCounterMaskBit(b),e=a.dividerRegister;(a.timerEnabled?checkBitOnByte(c,e):checkBitOnByte(c,e)&&checkBitOnByte(d,e))&&_incrementTimerCounter()}a.timerInputClock=b};a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.currentCycles);
store(getSaveStateMemoryOffset(4,a.saveStateSlot),a.dividerRegister);store(getSaveStateMemoryOffset(8,a.saveStateSlot),a.timerCounter);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(12,a.saveStateSlot),a.timerCounterOverflowDelay);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot),a.timerCounterWasReset);store(getSaveStateMemoryOffset(14,a.saveStateSlot),a.timerCounterMask);store(getSaveStateMemoryOffset(18,a.saveStateSlot),a.timerModulo);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(22,
a.saveStateSlot),a.timerEnabled);store(getSaveStateMemoryOffset(23,a.saveStateSlot),a.timerInputClock)};a.loadState=function(){a.currentCycles=load(getSaveStateMemoryOffset(0,a.saveStateSlot));a.dividerRegister=load(getSaveStateMemoryOffset(4,a.saveStateSlot));a.timerCounter=load(getSaveStateMemoryOffset(8,a.saveStateSlot));a.timerCounterOverflowDelay=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(12,a.saveStateSlot));a.timerCounterWasReset=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(13,
a.saveStateSlot));a.timerCounterMask=load(getSaveStateMemoryOffset(14,a.saveStateSlot));a.timerModulo=load(getSaveStateMemoryOffset(18,a.saveStateSlot));a.timerEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(22,a.saveStateSlot));a.timerInputClock=load(getSaveStateMemoryOffset(23,a.saveStateSlot))};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;
a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}();
function initializeTimers(){Timers.currentCycles=0;Timers.dividerRegister=0;Timers.timerCounter=0;Timers.timerModulo=0;Timers.timerEnabled=!1;Timers.timerInputClock=0;Timers.timerCounterOverflowDelay=!1;Timers.timerCounterWasReset=!1;Cpu.GBCEnabled?(eightBitStoreIntoGBMemory(65284,30),Timers.dividerRegister=7840):(eightBitStoreIntoGBMemory(65284,171),Timers.dividerRegister=43980);eightBitStoreIntoGBMemory(65287,248);Timers.timerInputClock=248;Cpu.BootROMEnabled&&!Cpu.GBCEnabled&&(eightBitStoreIntoGBMemory(65284,
0),Timers.dividerRegister=4)}function batchProcessTimers(){updateTimers(Timers.currentCycles);Timers.currentCycles=0}
function updateTimers(a){for(var b=0;b<a;){var c=Timers.dividerRegister,d=c;b+=4;d+=4;d&=65535;Timers.dividerRegister=d;if(Timers.timerEnabled){var e=Timers.timerCounterWasReset;Timers.timerCounterOverflowDelay?(Timers.timerCounter=Timers.timerModulo,requestTimerInterrupt(),Timers.timerCounterOverflowDelay=!1,Timers.timerCounterWasReset=!0):e&&(Timers.timerCounterWasReset=!1);_checkDividerRegisterFallingEdgeDetector(c,d)&&_incrementTimerCounter()}}}
function _incrementTimerCounter(){var a=Timers.timerCounter;255<++a&&(Timers.timerCounterOverflowDelay=!0,a=0);Timers.timerCounter=a}function _checkDividerRegisterFallingEdgeDetector(a,b){var c=_getTimerCounterMaskBit(Timers.timerInputClock);return checkBitOnByte(c,a)&&!checkBitOnByte(c,b)}function _getTimerCounterMaskBit(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}
var Serial=function(){function a(){}a.updateTransferControl=function(b){a.isShiftClockInternal=checkBitOnByte(0,b);a.isClockSpeedFast=checkBitOnByte(1,b);a.transferStartFlag=checkBitOnByte(7,b);return!0};a.currentCycles=0;a.memoryLocationSerialTransferData=65281;a.memoryLocationSerialTransferControl=65282;a.numberOfBitsTransferred=0;a.isShiftClockInternal=!1;a.isClockSpeedFast=!1;a.transferStartFlag=!1;return a}();
function initializeSerial(){Serial.currentCycles=0;Serial.numberOfBitsTransferred=0;Cpu.GBCEnabled?(eightBitStoreIntoGBMemory(65282,124),Serial.updateTransferControl(124)):(eightBitStoreIntoGBMemory(65282,126),Serial.updateTransferControl(126))}
function updateSerial(a){if(Serial.transferStartFlag)for(var b=0;b<a;){var c=Serial.currentCycles,d=c;b+=4;d+=4;65535<d&&(d-=65536);Serial.currentCycles=d;_checkFallingEdgeDetector(c,d)&&(c=Serial.memoryLocationSerialTransferData,d=eightBitLoadFromGBMemory(c),d=(d<<1)+1,d&=255,eightBitStoreIntoGBMemory(c,d),c=Serial.numberOfBitsTransferred,8===++c?(Serial.numberOfBitsTransferred=0,requestSerialInterrupt(),c=Serial.memoryLocationSerialTransferControl,d=eightBitLoadFromGBMemory(c),eightBitStoreIntoGBMemory(c,
resetBitOnByte(7,d)),Serial.transferStartFlag=!1):Serial.numberOfBitsTransferred=c)}}function _checkFallingEdgeDetector(a,b){var c=_getFallingEdgeMaskBit();return checkBitOnByte(c,a)&&!checkBitOnByte(c,b)}function _getFallingEdgeMaskBit(){return Serial.isClockSpeedFast?2:7}
var Joypad=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=b^255;a.isDpadType=checkBitOnByte(4,a.joypadRegisterFlipped);a.isButtonType=checkBitOnByte(5,a.joypadRegisterFlipped)};a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.joypadRegisterFlipped);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(1,a.saveStateSlot),a.isDpadType);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(2,a.saveStateSlot),a.isButtonType)};a.loadState=
function(){a.joypadRegisterFlipped=load(getSaveStateMemoryOffset(0,a.saveStateSlot));a.isDpadType=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(1,a.saveStateSlot));a.isButtonType=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(2,a.saveStateSlot))};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}();
function getJoypadState(){var a=Joypad.joypadRegisterFlipped;Joypad.isDpadType?(a=Joypad.up?resetBitOnByte(2,a):setBitOnByte(2,a),a=Joypad.right?resetBitOnByte(0,a):setBitOnByte(0,a),a=Joypad.down?resetBitOnByte(3,a):setBitOnByte(3,a),a=Joypad.left?resetBitOnByte(1,a):setBitOnByte(1,a)):Joypad.isButtonType&&(a=Joypad.a?resetBitOnByte(0,a):setBitOnByte(0,a),a=Joypad.b?resetBitOnByte(1,a):setBitOnByte(1,a),a=Joypad.select?resetBitOnByte(2,a):setBitOnByte(2,a),a=Joypad.start?resetBitOnByte(3,a):setBitOnByte(3,
a));return a|240}function setJoypadState(a,b,c,d,e,f,g,k){0<a?_pressJoypadButton(0):_releaseJoypadButton(0);0<b?_pressJoypadButton(1):_releaseJoypadButton(1);0<c?_pressJoypadButton(2):_releaseJoypadButton(2);0<d?_pressJoypadButton(3):_releaseJoypadButton(3);0<e?_pressJoypadButton(4):_releaseJoypadButton(4);0<f?_pressJoypadButton(5):_releaseJoypadButton(5);0<g?_pressJoypadButton(6):_releaseJoypadButton(6);0<k?_pressJoypadButton(7):_releaseJoypadButton(7)}
function _pressJoypadButton(a){var b=Cpu.isStopped=!1;_getJoypadButtonStateFromButtonId(a)||(b=!0);_setJoypadButtonStateFromButtonId(a,!0);b&&(b=!1,3>=a&&(b=!0),a=!1,Joypad.isDpadType&&b&&(a=!0),Joypad.isButtonType&&!b&&(a=!0),a&&requestJoypadInterrupt())}function _releaseJoypadButton(a){_setJoypadButtonStateFromButtonId(a,!1)}
function _getJoypadButtonStateFromButtonId(a){switch(a){case 0:return Joypad.up;case 1:return Joypad.right;case 2:return Joypad.down;case 3:return Joypad.left;case 4:return Joypad.a;case 5:return Joypad.b;case 6:return Joypad.select;case 7:return Joypad.start;default:return!1}}
function _setJoypadButtonStateFromButtonId(a,b){switch(a){case 0:Joypad.up=b;break;case 1:Joypad.right=b;break;case 2:Joypad.down=b;break;case 3:Joypad.left=b;break;case 4:Joypad.a=b;break;case 5:Joypad.b=b;break;case 6:Joypad.select=b;break;case 7:Joypad.start=b}}
function handleBanking(a,b){if(!Memory.isRomOnly){var c=Memory.isMBC1,d=Memory.isMBC2;if(8191>=a){if(!d||checkBitOnByte(4,b))b&=15,0===b?Memory.isRamBankingEnabled=!1:10===b&&(Memory.isRamBankingEnabled=!0)}else if(16383>=a){var e=Memory.isMBC5;!e||12287>=a?(a=Memory.currentRomBank,d&&(a=b&15),c?(b&=31,a&=224):Memory.isMBC3?(b&=127,a&=128):e&&(a&=0),Memory.currentRomBank=a|b):(c=splitLowByte(Memory.currentRomBank),Memory.currentRomBank=concatenateBytes(0<b,c))}else!d&&24575>=a?c&&Memory.isMBC1RomModeEnabled?
(a=Memory.currentRomBank&31,Memory.currentRomBank=a|b&224):(b=Memory.isMBC5?b&15:b&3,Memory.currentRamBank=b):!d&&32767>=a&&c&&(Memory.isMBC1RomModeEnabled=checkBitOnByte(0,b))}}function getRomBankAddress(a){var b=Memory.currentRomBank;Memory.isMBC5||0!==b||(b=1);return 16384*b+(a-Memory.switchableCartridgeRomLocation)}function getRamBankAddress(a){return 8192*Memory.currentRamBank+(a-Memory.cartridgeRamLocation)}
function initializeDma(){eightBitStoreIntoGBMemory(65361,255);eightBitStoreIntoGBMemory(65362,255);eightBitStoreIntoGBMemory(65363,255);eightBitStoreIntoGBMemory(65364,255);eightBitStoreIntoGBMemory(65365,255)}function startDmaTransfer(a){a<<=8;for(var b=0;159>=b;++b){var c=eightBitLoadFromGBMemory(a+b);eightBitStoreIntoGBMemory(Memory.spriteInformationTableLocation+b,c)}Memory.DMACycles=644}
function startHdmaTransfer(a){if(Cpu.GBCEnabled)if(Memory.isHblankHdmaActive&&!checkBitOnByte(7,a))Memory.isHblankHdmaActive=!1,a=eightBitLoadFromGBMemory(Memory.memoryLocationHdmaTrigger),eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger,setBitOnByte(7,a));else{var b=getHdmaSourceFromMemory(),c=getHdmaDestinationFromMemory(),d=resetBitOnByte(7,a);d=d+1<<4;checkBitOnByte(7,a)?(Memory.isHblankHdmaActive=!0,Memory.hblankHdmaTransferLengthRemaining=d,Memory.hblankHdmaSource=b,Memory.hblankHdmaDestination=
c,eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger,resetBitOnByte(7,a))):(hdmaTransfer(b,c,d),eightBitStoreIntoGBMemory(Memory.memoryLocationHdmaTrigger,255))}}
function updateHblankHdma(){if(Memory.isHblankHdmaActive){var a=16,b=Memory.hblankHdmaTransferLengthRemaining;b<a&&(a=b);hdmaTransfer(Memory.hblankHdmaSource,Memory.hblankHdmaDestination,a);Memory.hblankHdmaSource+=a;Memory.hblankHdmaDestination+=a;b-=a;Memory.hblankHdmaTransferLengthRemaining=b;a=Memory.memoryLocationHdmaTrigger;0>=b?(Memory.isHblankHdmaActive=!1,eightBitStoreIntoGBMemory(a,255)):eightBitStoreIntoGBMemory(a,resetBitOnByte(7,(b>>4)-1))}}
function hdmaTransfer(a,b,c){for(var d=0;d<c;++d){for(var e=eightBitLoadFromGBMemoryWithTraps(a+d),f=b+d;40959<f;)f-=8192;eightBitStoreIntoGBMemoryWithTraps(f,e)}Memory.DMACycles+=(32<<Cpu.GBCDoubleSpeed)*(c>>4)}function getHdmaSourceFromMemory(){var a=eightBitLoadFromGBMemory(Memory.memoryLocationHdmaSourceHigh),b=eightBitLoadFromGBMemory(Memory.memoryLocationHdmaSourceLow);return concatenateBytes(a,b)&65520}
function getHdmaDestinationFromMemory(){var a=eightBitLoadFromGBMemory(Memory.memoryLocationHdmaDestinationHigh),b=eightBitLoadFromGBMemory(Memory.memoryLocationHdmaDestinationLow);a=concatenateBytes(a,b);return a=(a&8176)+Memory.videoRamLocation}
function checkWriteTraps(a,b){if(a===Cpu.memoryLocationSpeedSwitch)return eightBitStoreIntoGBMemory(Cpu.memoryLocationSpeedSwitch,b&1),!1;if(Cpu.BootROMEnabled&&a===Cpu.memoryLocationBootROMSwitch)return Cpu.BootROMEnabled=!1,Cpu.programCounter=255,!0;var c=Memory.videoRamLocation,d=Memory.spriteInformationTableLocation;if(a<c)return handleBanking(a,b),!1;if(a>=c&&a<Memory.cartridgeRamLocation)return!0;if(a>=Memory.echoRamLocation&&a<d)return eightBitStoreIntoGBMemory(a-8192,b),!0;if(a>=d&&a<=Memory.spriteInformationTableLocationEnd)return 2<=
Lcd.currentLcdMode;if(a>=Memory.unusableMemoryLocation&&a<=Memory.unusableMemoryEndLocation)return!1;if(a===Serial.memoryLocationSerialTransferControl)return Serial.updateTransferControl(b);if(65296<=a&&65318>=a)return batchProcessAudio(),SoundRegisterWriteTraps(a,b);if(65328<=a&&65343>=a)return batchProcessAudio(),Channel3.isEnabled?(Channel3.handleWaveRamWrite(b),!1):!0;if(a>=Lcd.memoryLocationLcdControl&&a<=Graphics.memoryLocationWindowX){if(a===Lcd.memoryLocationLcdControl)return Lcd.updateLcdControl(b),
!0;if(a===Lcd.memoryLocationLcdStatus)return Lcd.updateLcdStatus(b),!1;if(a===Graphics.memoryLocationScanlineRegister)return Graphics.scanlineRegister=0,eightBitStoreIntoGBMemory(a,0),!1;if(a===Lcd.memoryLocationCoincidenceCompare)return Lcd.coincidenceCompare=b,!0;if(a===Graphics.memoryLocationDmaTransfer)return startDmaTransfer(b),!0;switch(a){case Graphics.memoryLocationScrollX:Graphics.scrollX=b;break;case Graphics.memoryLocationScrollY:Graphics.scrollY=b;break;case Graphics.memoryLocationWindowX:Graphics.windowX=
b;break;case Graphics.memoryLocationWindowY:Graphics.windowY=b}return!0}if(a===Memory.memoryLocationHdmaTrigger)return startHdmaTransfer(b),!1;if((a===Memory.memoryLocationGBCWRAMBank||a===Memory.memoryLocationGBCVRAMBank)&&Memory.isHblankHdmaActive&&(c=Memory.hblankHdmaSource,16384<=c&&32767>=c||53248<=c&&57343>=c))return!1;if(a>=Palette.memoryLocationBackgroundPaletteIndex&&a<=Palette.memoryLocationSpritePaletteData)return writeColorPaletteToMemory(a,b),!0;if(a>=Timers.memoryLocationDividerRegister&&
a<=Timers.memoryLocationTimerControl){batchProcessTimers();switch(a){case Timers.memoryLocationDividerRegister:return Timers.updateDividerRegister(),!1;case Timers.memoryLocationTimerCounter:Timers.updateTimerCounter(b);break;case Timers.memoryLocationTimerModulo:Timers.updateTimerModulo(b);break;case Timers.memoryLocationTimerControl:Timers.updateTimerControl(b)}return!0}a===Joypad.memoryLocationJoypadRegister&&Joypad.updateJoypad(b);if(a===Interrupts.memoryLocationInterruptRequest)return Interrupts.updateInterruptRequested(b),
!0;a===Interrupts.memoryLocationInterruptEnabled&&Interrupts.updateInterruptEnabled(b);return!0}
function getWasmBoyOffsetFromGameBoyOffset(a){switch(a>>12){case 0:if(Cpu.BootROMEnabled)if(Cpu.GBCEnabled){if(256>a||511<a&&2304>a)return a+BOOT_ROM_LOCATION}else if(!Cpu.GBCEnabled&&256>a)return a+BOOT_ROM_LOCATION;case 1:case 2:case 3:return a+CARTRIDGE_ROM_LOCATION;case 4:case 5:case 6:case 7:return getRomBankAddress(a)+CARTRIDGE_ROM_LOCATION;case 8:case 9:var b=0;Cpu.GBCEnabled&&(b=eightBitLoadFromGBMemory(Memory.memoryLocationGBCVRAMBank)&1);return a-Memory.videoRamLocation+VIDEO_RAM_LOCATION+
8192*b;case 10:case 11:return getRamBankAddress(a)+CARTRIDGE_RAM_LOCATION;case 12:return a-Memory.internalRamBankZeroLocation+WORK_RAM_LOCATION;case 13:return b=0,Cpu.GBCEnabled&&(b=eightBitLoadFromGBMemory(Memory.memoryLocationGBCWRAMBank)&7),a-Memory.internalRamBankZeroLocation+WORK_RAM_LOCATION+4096*((1>b?1:b)-1);default:return a-Memory.echoRamLocation+OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION}}
var Breakpoints=function(){function a(){}a.programCounter=-1;a.readGbMemory=-1;a.writeGbMemory=-1;a.reachedBreakpoint=!1;return a}();function setProgramCounterBreakpoint(a){Breakpoints.programCounter=a}function resetProgramCounterBreakpoint(){Breakpoints.programCounter=-1}function setReadGbMemoryBreakpoint(a){Breakpoints.readGbMemory=a}function resetReadGbMemoryBreakpoint(){Breakpoints.readGbMemory=-1}function setWriteGbMemoryBreakpoint(a){Breakpoints.writeGbMemory=a}
function resetWriteGbMemoryBreakpoint(){Breakpoints.writeGbMemory=-1}function eightBitStoreIntoGBMemory(a,b){store(getWasmBoyOffsetFromGameBoyOffset(a),b)}function eightBitStoreIntoGBMemoryWithTraps(a,b){a===Breakpoints.writeGbMemory&&(Breakpoints.reachedBreakpoint=!0);checkWriteTraps(a,b)&&eightBitStoreIntoGBMemory(a,b)}
function sixteenBitStoreIntoGBMemoryWithTraps(a,b){var c=splitHighByte(b);b=splitLowByte(b);checkWriteTraps(a,b)&&eightBitStoreIntoGBMemory(a,b);a+=1;checkWriteTraps(a,c)&&eightBitStoreIntoGBMemory(a,c)}function sixteenBitStoreIntoGBMemory(a,b){var c=splitHighByte(b);b=splitLowByte(b);eightBitStoreIntoGBMemory(a+0,b);eightBitStoreIntoGBMemory(a+1,c)}function storeBooleanDirectlyToWasmMemory(a,b){store(a,b)}
var Lcd=function(){function a(){}a.updateLcdStatus=function(b){var c=eightBitLoadFromGBMemory(a.memoryLocationLcdStatus);b=setBitOnByte(7,b&248|c&7);eightBitStoreIntoGBMemory(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){var c=a.enabled;a.enabled=checkBitOnByte(7,b);a.windowTileMapDisplaySelect=checkBitOnByte(6,b);a.windowDisplayEnabled=checkBitOnByte(5,b);a.bgWindowTileDataSelect=checkBitOnByte(4,b);a.bgTileMapDisplaySelect=checkBitOnByte(3,b);a.tallSpriteSize=checkBitOnByte(2,b);
a.spriteDisplayEnable=checkBitOnByte(1,b);a.bgDisplayEnabled=checkBitOnByte(0,b);c&&!a.enabled&&resetLcd(!0);!c&&a.enabled&&resetLcd(!1)};a.memoryLocationLcdStatus=65345;a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}();
function resetLcd(a){Graphics.scanlineCycleCounter=0;Graphics.scanlineRegister=0;eightBitStoreIntoGBMemory(Graphics.memoryLocationScanlineRegister,0);var b=eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus);b=resetBitOnByte(1,b);b=resetBitOnByte(0,b);Lcd.currentLcdMode=0;eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus,b);if(a)for(a=0;a<FRAME_SIZE;++a)store(FRAME_LOCATION+a,255)}
function setLcdStatus(){if(Lcd.enabled){var a=Graphics.scanlineRegister,b=Lcd.currentLcdMode,c=0;if(144<=a)c=1;else{var d=Graphics.scanlineCycleCounter,e=Graphics.MIN_CYCLES_SPRITES_LCD_MODE();d>=e?c=2:d>=e&&(c=3)}if(b!==c){a=eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus);Lcd.currentLcdMode=c;b=!1;switch(c){case 0:a=resetBitOnByte(0,a);a=resetBitOnByte(1,a);b=checkBitOnByte(3,a);break;case 1:a=resetBitOnByte(1,a);a=setBitOnByte(0,a);b=checkBitOnByte(4,a);break;case 2:a=resetBitOnByte(0,a);
a=setBitOnByte(1,a);b=checkBitOnByte(5,a);break;case 3:a=setBitOnByte(0,a),a=setBitOnByte(1,a)}b&&requestLcdInterrupt();0===c&&updateHblankHdma();1===c&&requestVBlankInterrupt();a=checkCoincidence(c,a);eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus,a)}else 153===a&&(a=eightBitLoadFromGBMemory(Lcd.memoryLocationLcdStatus),a=checkCoincidence(c,a),eightBitStoreIntoGBMemory(Lcd.memoryLocationLcdStatus,a))}}
function checkCoincidence(a,b){0!==a&&1!==a||Graphics.scanlineRegister!==Lcd.coincidenceCompare?b=resetBitOnByte(2,b):(b=setBitOnByte(2,b),checkBitOnByte(6,b)&&requestLcdInterrupt());return b}function renderBackground(a,b,c){drawBackgroundWindowScanline(a,b,c,a+Graphics.scrollY&255,0,Graphics.scrollX)}function renderWindow(a,b,c){var d=Graphics.windowX,e=Graphics.windowY;if(!(a<e)){d-=7;e=a-e;var f=i32Portable(-d);drawBackgroundWindowScanline(a,b,c,e,d,f)}}
function drawBackgroundWindowScanline(a,b,c,d,e,f){for(var g=d>>3;160>e;++e){var k=e+f;256<=k&&(k-=256);var h=c+(g<<5)+(k>>3),l=loadFromVramBank(h,0),n=!1;if(Config.tileCaching){var m=drawLineOfTileFromTileCache(e,a,k,d,h,b,l);0<m&&(e+=m-1,n=!0)}Config.tileRendering&&!n?(m=drawLineOfTileFromTileId(e,a,k,d,h,b,l),0<m&&(e+=m-1)):n||(Cpu.GBCEnabled?drawColorPixelFromTileId(e,a,k,d,h,b,l):drawMonochromePixelFromTileId(e,a,k,d,b,l))}}
function drawMonochromePixelFromTileId(a,b,c,d,e,f){e=getTileDataAddress(e,f);f=i32Portable(d&7);d=loadFromVramBank(e+2*f,0);e=loadFromVramBank(e+2*f+1,0);f=i32Portable(c&7);f=7-f;c=0;checkBitOnByte(f,e)&&(c=c+1<<1);checkBitOnByte(f,d)&&(c+=1);d=getColorizedGbHexColorFromPalette(c,Graphics.memoryLocationBackgroundPalette);setPixelOnFrame(a,b,0,getRedFromHexColor(d));setPixelOnFrame(a,b,1,getGreenFromHexColor(d));setPixelOnFrame(a,b,2,getBlueFromHexColor(d));addPriorityforPixel(a,b,c)}
function drawColorPixelFromTileId(a,b,c,d,e,f,g){f=getTileDataAddress(f,g);e=loadFromVramBank(e,1);g=i32Portable(d&7);checkBitOnByte(6,e)&&(g=7-g);var k=i32Portable(checkBitOnByte(3,e));d=loadFromVramBank(f+2*g,k);f=loadFromVramBank(f+2*g+1,k);g=i32Portable(c&7);checkBitOnByte(5,e)||(g=7-g);c=0;checkBitOnByte(g,f)&&(c=c+1<<1);checkBitOnByte(g,d)&&(c+=1);g=getRgbColorFromPalette(e&7,c,!1);d=getColorComponentFromRgb(0,g);f=getColorComponentFromRgb(1,g);g=getColorComponentFromRgb(2,g);setPixelOnFrame(a,
b,0,d);setPixelOnFrame(a,b,1,f);setPixelOnFrame(a,b,2,g);addPriorityforPixel(a,b,c,checkBitOnByte(7,e))}
function drawLineOfTileFromTileCache(a,b,c,d,e,f,g){d=0;f=TileCache.nextXIndexToPerformCacheCheck;if(0<b&&8<a&&g===TileCache.tileId&&a===f){g=checkBitOnByte(5,eightBitLoadFromGBMemory(e-1));e=checkBitOnByte(5,eightBitLoadFromGBMemory(e));for(var k=0;8>k;++k){g!==e&&(k=7-k);var h=a+k;if(160>=h){var l=a-(8-k),n=FRAME_LOCATION+getRgbPixelStart(h,b);setPixelOnFrame(h,b,0,load(n,0));setPixelOnFrame(h,b,1,load(n,1));setPixelOnFrame(h,b,2,load(n,2));l=getPriorityforPixel(l,b);addPriorityforPixel(h,b,resetBitOnByte(2,
l),checkBitOnByte(2,l));d++}}}else TileCache.tileId=g;a>=f&&(f=a+8,b=i32Portable(c&7),a<b&&(f+=b));TileCache.nextXIndexToPerformCacheCheck=f;return d}function drawLineOfTileFromTileId(a,b,c,d,e,f,g){d=i32Portable(d&7);var k=0;0==a&&(k=c-(c>>3<<3));c=7;160<a+8&&(c=160-a);var h=-1,l=0;Cpu.GBCEnabled&&(h=loadFromVramBank(e,1),l=i32Portable(checkBitOnByte(3,h)),checkBitOnByte(6,h)&&(d=7-d));return drawPixelsFromLineOfTile(g,f,l,k,c,d,a,b,160,FRAME_LOCATION,!1,0,h,-1)}
function renderSprites(a,b){for(var c=39;0<=c;--c){var d=4*c,e=Graphics.memoryLocationSpriteAttributesTable+d,f=eightBitLoadFromGBMemory(e+0),g=eightBitLoadFromGBMemory(e+1),k=eightBitLoadFromGBMemory(e+2);f-=16;g-=8;var h=8;b&&(h=16,k-=k&1);if(a>=f&&a<f+h){d=eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+d+3);e=checkBitOnByte(7,d);var l=checkBitOnByte(6,d),n=checkBitOnByte(5,d);f=a-f;l&&(f=h-f,--f);f<<=1;k=getTileDataAddress(Graphics.memoryLocationTileDataSelectOneStart,k);
k+=f;h=Cpu.GBCEnabled&&checkBitOnByte(3,d);f=loadFromVramBank(k+0,h);k=loadFromVramBank(k+1,h);for(h=7;0<=h;--h){l=h;n&&(l-=7,l=-l);var m=0;checkBitOnByte(l,k)&&(m=m+1<<1);checkBitOnByte(l,f)&&(m+=1);if(0!==m&&(l=g+(7-h),0<=l&&160>=l)){var p=Cpu.GBCEnabled&&!Lcd.bgDisplayEnabled,r=!1,w=!1;if(!p){var q=getPriorityforPixel(l,a),u=q&3;e&&0<u?r=!0:Cpu.GBCEnabled&&checkBitOnByte(2,q)&&0<u&&(w=!0)}if(p||!r&&!w)Cpu.GBCEnabled?(r=getRgbColorFromPalette(d&7,m,!0),m=getColorComponentFromRgb(0,r),p=getColorComponentFromRgb(1,
r),r=getColorComponentFromRgb(2,r),setPixelOnFrame(l,a,0,m),setPixelOnFrame(l,a,1,p),setPixelOnFrame(l,a,2,r)):(p=Graphics.memoryLocationSpritePaletteOne,checkBitOnByte(4,d)&&(p=Graphics.memoryLocationSpritePaletteTwo),m=getColorizedGbHexColorFromPalette(m,p),setPixelOnFrame(l,a,0,getRedFromHexColor(m)),setPixelOnFrame(l,a,1,getGreenFromHexColor(m)),setPixelOnFrame(l,a,2,getBlueFromHexColor(m)))}}}}}
var Graphics=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return 153===a.scanlineRegister?4<<Cpu.GBCDoubleSpeed:456<<Cpu.GBCDoubleSpeed};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return 376<<Cpu.GBCDoubleSpeed};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return 249<<Cpu.GBCDoubleSpeed};a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.scanlineCycleCounter);store(getSaveStateMemoryOffset(4,
a.saveStateSlot),a.scanlineRegister);store(getSaveStateMemoryOffset(5,a.saveStateSlot),a.scrollX);store(getSaveStateMemoryOffset(6,a.saveStateSlot),a.scrollY);store(getSaveStateMemoryOffset(7,a.saveStateSlot),a.windowX);store(getSaveStateMemoryOffset(8,a.saveStateSlot),a.windowY);store(getSaveStateMemoryOffset(9,a.saveStateSlot),Lcd.currentLcdMode);store(getSaveStateMemoryOffset(10,a.saveStateSlot),Lcd.coincidenceCompare);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot),
Lcd.enabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(12,a.saveStateSlot),Lcd.windowTileMapDisplaySelect);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(13,a.saveStateSlot),Lcd.windowDisplayEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(14,a.saveStateSlot),Lcd.bgWindowTileDataSelect);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot),Lcd.bgTileMapDisplaySelect);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot),
Lcd.tallSpriteSize);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot),Lcd.spriteDisplayEnable);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(18,a.saveStateSlot),Lcd.bgDisplayEnabled)};a.loadState=function(){a.scanlineCycleCounter=load(getSaveStateMemoryOffset(0,a.saveStateSlot));a.scanlineRegister=load(getSaveStateMemoryOffset(4,a.scanlineRegister));a.scrollX=load(getSaveStateMemoryOffset(5,a.saveStateSlot));a.scrollY=load(getSaveStateMemoryOffset(6,a.saveStateSlot));
a.windowX=load(getSaveStateMemoryOffset(7,a.saveStateSlot));a.windowY=load(getSaveStateMemoryOffset(8,a.saveStateSlot));Lcd.currentLcdMode=load(getSaveStateMemoryOffset(9,a.saveStateSlot));Lcd.coincidenceCompare=load(getSaveStateMemoryOffset(10,a.saveStateSlot));Lcd.enabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(11,a.saveStateSlot));Lcd.windowTileMapDisplaySelect=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(12,a.saveStateSlot));Lcd.windowDisplayEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(13,
a.saveStateSlot));Lcd.bgWindowTileDataSelect=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(14,a.saveStateSlot));Lcd.bgTileMapDisplaySelect=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot));Lcd.tallSpriteSize=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(16,a.saveStateSlot));Lcd.spriteDisplayEnable=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot));Lcd.bgDisplayEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(18,
a.saveStateSlot))};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=34816;a.memoryLocationTileDataSelectOneStart=32768;
a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}();function batchProcessGraphics(){for(var a=Graphics.batchProcessCycles();Graphics.currentCycles>=a;)updateGraphics(a),Graphics.currentCycles-=a}
function initializeGraphics(){Graphics.currentCycles=0;Graphics.scanlineCycleCounter=0;Graphics.scanlineRegister=0;Graphics.scrollX=0;Graphics.scrollY=0;Graphics.windowX=0;Graphics.windowY=0;Graphics.scanlineRegister=144;Cpu.GBCEnabled?(eightBitStoreIntoGBMemory(65345,129),eightBitStoreIntoGBMemory(65348,144),eightBitStoreIntoGBMemory(65351,252)):(eightBitStoreIntoGBMemory(65345,133),eightBitStoreIntoGBMemory(65350,255),eightBitStoreIntoGBMemory(65351,252),eightBitStoreIntoGBMemory(65352,255),eightBitStoreIntoGBMemory(65353,
255));Graphics.scanlineRegister=144;eightBitStoreIntoGBMemory(65344,145);eightBitStoreIntoGBMemory(65359,0);eightBitStoreIntoGBMemory(65392,1);Cpu.BootROMEnabled&&(Cpu.GBCEnabled?(Graphics.scanlineRegister=0,eightBitStoreIntoGBMemory(65344,0),eightBitStoreIntoGBMemory(65345,128),eightBitStoreIntoGBMemory(65348,0)):(Graphics.scanlineRegister=0,eightBitStoreIntoGBMemory(65344,0),eightBitStoreIntoGBMemory(65345,132)));initializeColors()}
function updateGraphics(a){if(Lcd.enabled)for(Graphics.scanlineCycleCounter+=a,a=Config.graphicsDisableScanlineRendering;Graphics.scanlineCycleCounter>=Graphics.MAX_CYCLES_PER_SCANLINE();){Graphics.scanlineCycleCounter-=Graphics.MAX_CYCLES_PER_SCANLINE();var b=Graphics.scanlineRegister;144===b?(a?_renderEntireFrame():_drawScanline(b),clearPriorityMap(),resetTileCache()):144>b&&(a||_drawScanline(b));b=153<b?0:b+1;Graphics.scanlineRegister=b}setLcdStatus()}
function _drawScanline(a){var b=Graphics.memoryLocationTileDataSelectZeroStart;Lcd.bgWindowTileDataSelect&&(b=Graphics.memoryLocationTileDataSelectOneStart);if(Cpu.GBCEnabled||Lcd.bgDisplayEnabled){var c=Graphics.memoryLocationTileMapSelectZeroStart;Lcd.bgTileMapDisplaySelect&&(c=Graphics.memoryLocationTileMapSelectOneStart);renderBackground(a,b,c)}Lcd.windowDisplayEnabled&&(c=Graphics.memoryLocationTileMapSelectZeroStart,Lcd.windowTileMapDisplaySelect&&(c=Graphics.memoryLocationTileMapSelectOneStart),
renderWindow(a,b,c));Lcd.spriteDisplayEnable&&renderSprites(a,Lcd.tallSpriteSize)}function _renderEntireFrame(){for(var a=0;144>=a;++a)_drawScanline(a)}function getRgbPixelStart(a,b){return 3*(160*b+a)}function setPixelOnFrame(a,b,c,d){store(FRAME_LOCATION+getRgbPixelStart(a,b)+c,d)}function loadFromVramBank(a,b){return load(a-Memory.videoRamLocation+GAMEBOY_INTERNAL_MEMORY_LOCATION+8192*(b&1))}
function checkReadTraps(a){var b=Memory.videoRamLocation;return a<b||a>=b&&a<Memory.cartridgeRamLocation?-1:a>=Memory.echoRamLocation&&a<Memory.spriteInformationTableLocation?eightBitLoadFromGBMemory(a-8192):a>=Memory.spriteInformationTableLocation&&a<=Memory.spriteInformationTableLocationEnd?2>Lcd.currentLcdMode?255:-1:a===Cpu.memoryLocationSpeedSwitch?(a=255,b=eightBitLoadFromGBMemory(Cpu.memoryLocationSpeedSwitch),checkBitOnByte(0,b)||(a=resetBitOnByte(0,a)),Cpu.GBCDoubleSpeed||(a=resetBitOnByte(7,
a)),a):a===Graphics.memoryLocationScanlineRegister?(eightBitStoreIntoGBMemory(a,Graphics.scanlineRegister),Graphics.scanlineRegister):65296<=a&&65318>=a?(batchProcessAudio(),SoundRegisterReadTraps(a)):65319<=a&&65327>=a?255:65328<=a&&65343>=a?(batchProcessAudio(),Channel3.isEnabled?Channel3.handleWaveRamRead():-1):a===Timers.memoryLocationDividerRegister?(b=splitHighByte(Timers.dividerRegister),eightBitStoreIntoGBMemory(a,b),b):a===Timers.memoryLocationTimerCounter?(eightBitStoreIntoGBMemory(a,Timers.timerCounter),
Timers.timerCounter):a===Interrupts.memoryLocationInterruptRequest?224|Interrupts.interruptsRequestedValue:a===Joypad.memoryLocationJoypadRegister?getJoypadState():-1}function eightBitLoadFromGBMemory(a){return load(getWasmBoyOffsetFromGameBoyOffset(a))}function eightBitLoadFromGBMemoryWithTraps(a){a===Breakpoints.readGbMemory&&(Breakpoints.reachedBreakpoint=!0);var b=checkReadTraps(a);return-1===b?eightBitLoadFromGBMemory(a):b}
function sixteenBitLoadFromGBMemory(a){var b=checkReadTraps(a);b=-1===b?eightBitLoadFromGBMemory(a):b;a+=1;var c=checkReadTraps(a);a=-1===c?eightBitLoadFromGBMemory(a):c;return concatenateBytes(a,b)}function loadBooleanDirectlyFromWasmMemory(a){return 0<load(a)}
var Memory=function(){function a(){}a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.currentRomBank);store(getSaveStateMemoryOffset(2,a.saveStateSlot),a.currentRamBank);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(4,a.saveStateSlot),a.isRamBankingEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(5,a.saveStateSlot),a.isMBC1RomModeEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(6,a.saveStateSlot),a.isRomOnly);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(7,
a.saveStateSlot),a.isMBC1);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(8,a.saveStateSlot),a.isMBC2);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(9,a.saveStateSlot),a.isMBC3);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(10,a.saveStateSlot),a.isMBC5);store(getSaveStateMemoryOffset(11,a.saveStateSlot),a.DMACycles);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot),a.isHblankHdmaActive);store(getSaveStateMemoryOffset(16,a.saveStateSlot),
a.hblankHdmaTransferLengthRemaining);store(getSaveStateMemoryOffset(20,a.saveStateSlot),a.hblankHdmaSource);store(getSaveStateMemoryOffset(24,a.saveStateSlot),a.hblankHdmaDestination)};a.loadState=function(){a.currentRomBank=load(getSaveStateMemoryOffset(0,a.saveStateSlot));a.currentRamBank=load(getSaveStateMemoryOffset(2,a.saveStateSlot));a.isRamBankingEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(4,a.saveStateSlot));a.isMBC1RomModeEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(5,
a.saveStateSlot));a.isRomOnly=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(6,a.saveStateSlot));a.isMBC1=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(7,a.saveStateSlot));a.isMBC2=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(8,a.saveStateSlot));a.isMBC3=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(9,a.saveStateSlot));a.isMBC5=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(10,a.saveStateSlot));a.DMACycles=load(getSaveStateMemoryOffset(11,
a.saveStateSlot));a.isHblankHdmaActive=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(15,a.saveStateSlot));a.hblankHdmaTransferLengthRemaining=load(getSaveStateMemoryOffset(16,a.saveStateSlot));a.hblankHdmaSource=load(getSaveStateMemoryOffset(20,a.saveStateSlot));a.hblankHdmaDestination=load(getSaveStateMemoryOffset(24,a.saveStateSlot))};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;
a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=
65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}();
function initializeCartridge(){Memory.isRamBankingEnabled=!1;Memory.isMBC1RomModeEnabled=!0;var a=eightBitLoadFromGBMemory(327);Memory.isRomOnly=0===a;Memory.isMBC1=1<=a&&3>=a;Memory.isMBC2=5<=a&&6>=a;Memory.isMBC3=15<=a&&19>=a;Memory.isMBC5=25<=a&&30>=a;Memory.currentRomBank=1;Memory.currentRamBank=0;eightBitStoreIntoGBMemory(Memory.memoryLocationGBCVRAMBank,0);eightBitStoreIntoGBMemory(Memory.memoryLocationGBCWRAMBank,1)}
var Cpu=function(){function a(){}a.CLOCK_SPEED=function(){return 4194304<<a.GBCDoubleSpeed};a.MAX_CYCLES_PER_FRAME=function(){return 70224<<a.GBCDoubleSpeed};a.enableHalt=function(){Interrupts.masterInterruptSwitch?a.isHaltNormal=!0:0===(Interrupts.interruptsEnabledValue&Interrupts.interruptsRequestedValue&31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=!1;a.isHaltBug=!1;a.isStopped=!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump};
a.saveState=function(){store(getSaveStateMemoryOffset(0,a.saveStateSlot),a.registerA);store(getSaveStateMemoryOffset(1,a.saveStateSlot),a.registerB);store(getSaveStateMemoryOffset(2,a.saveStateSlot),a.registerC);store(getSaveStateMemoryOffset(3,a.saveStateSlot),a.registerD);store(getSaveStateMemoryOffset(4,a.saveStateSlot),a.registerE);store(getSaveStateMemoryOffset(5,a.saveStateSlot),a.registerH);store(getSaveStateMemoryOffset(6,a.saveStateSlot),a.registerL);store(getSaveStateMemoryOffset(7,a.saveStateSlot),
a.registerF);store(getSaveStateMemoryOffset(8,a.saveStateSlot),a.stackPointer);store(getSaveStateMemoryOffset(10,a.saveStateSlot),a.programCounter);store(getSaveStateMemoryOffset(12,a.saveStateSlot),a.currentCycles);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot),a.isHaltNormal);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(18,a.saveStateSlot),a.isHaltNoJump);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(19,a.saveStateSlot),a.isHaltBug);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(20,
a.saveStateSlot),a.isStopped);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(21,a.saveStateSlot),a.BootROMEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(22,a.saveStateSlot),a.GBCEnabled);storeBooleanDirectlyToWasmMemory(getSaveStateMemoryOffset(23,a.saveStateSlot),a.GBCDoubleSpeed)};a.loadState=function(){a.registerA=load(getSaveStateMemoryOffset(0,a.saveStateSlot));a.registerB=load(getSaveStateMemoryOffset(1,a.saveStateSlot));a.registerC=load(getSaveStateMemoryOffset(2,
a.saveStateSlot));a.registerD=load(getSaveStateMemoryOffset(3,a.saveStateSlot));a.registerE=load(getSaveStateMemoryOffset(4,a.saveStateSlot));a.registerH=load(getSaveStateMemoryOffset(5,a.saveStateSlot));a.registerL=load(getSaveStateMemoryOffset(6,a.saveStateSlot));a.registerF=load(getSaveStateMemoryOffset(7,a.saveStateSlot));a.stackPointer=load(getSaveStateMemoryOffset(8,a.saveStateSlot));a.programCounter=load(getSaveStateMemoryOffset(10,a.saveStateSlot));a.currentCycles=load(getSaveStateMemoryOffset(12,
a.saveStateSlot));a.isHaltNormal=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(17,a.saveStateSlot));a.isHaltNoJump=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(18,a.saveStateSlot));a.isHaltBug=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(19,a.saveStateSlot));a.isStopped=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(20,a.saveStateSlot));a.BootROMEnabled=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(21,a.saveStateSlot));a.GBCEnabled=
loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(22,a.saveStateSlot));a.GBCDoubleSpeed=loadBooleanDirectlyFromWasmMemory(getSaveStateMemoryOffset(23,a.saveStateSlot))};a.memoryLocationBootROMSwitch=65360;a.BootROMEnabled=!1;a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=
!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}();
function initializeCpu(){Cpu.GBCDoubleSpeed=!1;Cpu.registerA=0;Cpu.registerB=0;Cpu.registerC=0;Cpu.registerD=0;Cpu.registerE=0;Cpu.registerH=0;Cpu.registerL=0;Cpu.registerF=0;Cpu.stackPointer=0;Cpu.programCounter=0;Cpu.currentCycles=0;Cpu.isHaltNormal=!1;Cpu.isHaltNoJump=!1;Cpu.isHaltBug=!1;Cpu.isStopped=!1;Cpu.BootROMEnabled||(Cpu.GBCEnabled?(Cpu.registerA=17,Cpu.registerF=128,Cpu.registerB=0,Cpu.registerC=0,Cpu.registerD=255,Cpu.registerE=86,Cpu.registerH=0,Cpu.registerL=13):(Cpu.registerA=1,Cpu.registerF=
176,Cpu.registerB=0,Cpu.registerC=19,Cpu.registerD=0,Cpu.registerE=216,Cpu.registerH=1,Cpu.registerL=77),Cpu.programCounter=256,Cpu.stackPointer=65534)}function addARegister(a){var b=Cpu.registerA;checkAndSetEightBitHalfCarryFlag(b,a);checkAndSetEightBitCarryFlag(b,a);b=u8Portable(b+a);Cpu.registerA=b;setZeroFlag$$1(0===b);setSubtractFlag(0)}
function addAThroughCarryRegister(a){var b=Cpu.registerA,c=u8Portable(b+a+getCarryFlag$$1());setHalfCarryFlag(0!=(u8Portable(b^a^c)&16));a=u16Portable(b+a+getCarryFlag$$1());setCarryFlag(0<(a&256));Cpu.registerA=c;setZeroFlag$$1(0===c);setSubtractFlag(0)}function subARegister(a){var b=-1*a;var c=Cpu.registerA;checkAndSetEightBitHalfCarryFlag(c,b);checkAndSetEightBitCarryFlag(c,b);c=u8Portable(c-a);Cpu.registerA=c;setZeroFlag$$1(0===c);setSubtractFlag(1)}
function subAThroughCarryRegister(a){var b=Cpu.registerA,c=u8Portable(b-a-getCarryFlag$$1()),d=u8Portable((b^a^c)&16);setHalfCarryFlag(0!=d);a=u16Portable(b-a-getCarryFlag$$1());setCarryFlag(0<(a&256));Cpu.registerA=c;setZeroFlag$$1(0===c);setSubtractFlag(1)}function andARegister(a){a&=Cpu.registerA;Cpu.registerA=a;setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(1);setCarryFlag(0)}
function xorARegister(a){a=u8Portable(Cpu.registerA^a);Cpu.registerA=a;setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);setCarryFlag(0)}function orARegister(a){a|=Cpu.registerA;Cpu.registerA=a;setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);setCarryFlag(0)}function cpARegister(a){var b=Cpu.registerA;a*=-1;checkAndSetEightBitHalfCarryFlag(b,a);checkAndSetEightBitCarryFlag(b,a);setZeroFlag$$1(0===b+a);setSubtractFlag(1)}
function rotateRegisterLeft(a){setCarryFlag(128===(a&128));a=rotateByteLeft(a);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);return a}function rotateRegisterRight(a){setCarryFlag(0<(a&1));a=rotateByteRight(a);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);return a}function rotateRegisterLeftThroughCarry(a){var b=128===(a&128);a=rotateByteLeftThroughCarry(a);setCarryFlag(b);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);return a}
function rotateRegisterRightThroughCarry(a){var b=1===(a&1);a=rotateByteRightThroughCarry(a);setCarryFlag(b);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);return a}function shiftLeftRegister(a){var b=128===(a&128);a=u8Portable(a<<1);setCarryFlag(b);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);return a}
function shiftRightArithmeticRegister(a){var b=128===(a&128),c=1===(a&1);a=u8Portable(a>>1);b&&(a|=128);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);setCarryFlag(c);return a}function swapNibblesOnRegister(a){a=u8Portable((a&15)<<4|(a&240)>>4);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);setCarryFlag(0);return a}
function shiftRightLogicalRegister(a){var b=1===(a&1);a=u8Portable(a>>1);setZeroFlag$$1(0===a);setSubtractFlag(0);setHalfCarryFlag(0);setCarryFlag(b);return a}function testBitOnRegister(a,b){setZeroFlag$$1(0===(b&1<<a));setSubtractFlag(0);setHalfCarryFlag(1);return b}function setBitOnRegister(a,b,c){return 0<b?c|1<<a:c&~(1<<a)}function relativeJump(a){a=i8Portable(a);var b=Cpu.programCounter;b=u16Portable(b+a);b=u16Portable(b+1);Cpu.programCounter=b}
function handleCbOpcode(a){var b=-1,c=!1,d=0,e=0,f=a&7;switch(f){case 0:d=Cpu.registerB;break;case 1:d=Cpu.registerC;break;case 2:d=Cpu.registerD;break;case 3:d=Cpu.registerE;break;case 4:d=Cpu.registerH;break;case 5:d=Cpu.registerL;break;case 6:d=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL));break;case 7:d=Cpu.registerA}var g=(a&240)>>4;switch(g){case 0:7>=a?(e=rotateRegisterLeft(d),c=!0):15>=a&&(e=rotateRegisterRight(d),c=!0);break;case 1:23>=a?(e=rotateRegisterLeftThroughCarry(d),
c=!0):31>=a&&(e=rotateRegisterRightThroughCarry(d),c=!0);break;case 2:39>=a?(e=shiftLeftRegister(d),c=!0):47>=a&&(e=shiftRightArithmeticRegister(d),c=!0);break;case 3:55>=a?(e=swapNibblesOnRegister(d),c=!0):63>=a&&(e=shiftRightLogicalRegister(d),c=!0);break;case 4:71>=a?(e=testBitOnRegister(0,d),c=!0):79>=a&&(e=testBitOnRegister(1,d),c=!0);break;case 5:87>=a?(e=testBitOnRegister(2,d),c=!0):95>=a&&(e=testBitOnRegister(3,d),c=!0);break;case 6:103>=a?(e=testBitOnRegister(4,d),c=!0):111>=a&&(e=testBitOnRegister(5,
d),c=!0);break;case 7:119>=a?(e=testBitOnRegister(6,d),c=!0):127>=a&&(e=testBitOnRegister(7,d),c=!0);break;case 8:135>=a?(e=setBitOnRegister(0,0,d),c=!0):143>=a&&(e=setBitOnRegister(1,0,d),c=!0);break;case 9:151>=a?(e=setBitOnRegister(2,0,d),c=!0):159>=a&&(e=setBitOnRegister(3,0,d),c=!0);break;case 10:167>=a?(e=setBitOnRegister(4,0,d),c=!0):175>=a&&(e=setBitOnRegister(5,0,d),c=!0);break;case 11:183>=a?(e=setBitOnRegister(6,0,d),c=!0):191>=a&&(e=setBitOnRegister(7,0,d),c=!0);break;case 12:199>=a?(e=
setBitOnRegister(0,1,d),c=!0):207>=a&&(e=setBitOnRegister(1,1,d),c=!0);break;case 13:215>=a?(e=setBitOnRegister(2,1,d),c=!0):223>=a&&(e=setBitOnRegister(3,1,d),c=!0);break;case 14:231>=a?(e=setBitOnRegister(4,1,d),c=!0):239>=a&&(e=setBitOnRegister(5,1,d),c=!0);break;case 15:247>=a?(e=setBitOnRegister(6,1,d),c=!0):255>=a&&(e=setBitOnRegister(7,1,d),c=!0)}switch(f){case 0:Cpu.registerB=e;break;case 1:Cpu.registerC=e;break;case 2:Cpu.registerD=e;break;case 3:Cpu.registerE=e;break;case 4:Cpu.registerH=
e;break;case 5:Cpu.registerL=e;break;case 6:(4>g||7<g)&&eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),e);break;case 7:Cpu.registerA=e}c&&(b=4);return b}
function executeOpcode$$1(a){var b=Cpu.programCounter;b=u16Portable(b+1);Cpu.isHaltBug&&(b=u16Portable(b-1));Cpu.programCounter=b;switch((a&240)>>4){case 0:return handleOpcode0x(a);case 1:return handleOpcode1x(a);case 2:return handleOpcode2x(a);case 3:return handleOpcode3x(a);case 4:return handleOpcode4x(a);case 5:return handleOpcode5x(a);case 6:return handleOpcode6x(a);case 7:return handleOpcode7x(a);case 8:return handleOpcode8x(a);case 9:return handleOpcode9x(a);case 10:return handleOpcodeAx(a);
case 11:return handleOpcodeBx(a);case 12:return handleOpcodeCx(a);case 13:return handleOpcodeDx(a);case 14:return handleOpcodeEx(a);default:return handleOpcodeFx(a)}}function eightBitLoadSyncCycles(a){syncCycles(4);return eightBitLoadFromGBMemoryWithTraps(a)}function eightBitStoreSyncCycles(a,b){syncCycles(4);eightBitStoreIntoGBMemoryWithTraps(a,b)}function sixteenBitLoadSyncCycles(a){syncCycles(8);return sixteenBitLoadFromGBMemory(a)}
function sixteenBitStoreSyncCycles(a,b){syncCycles(8);sixteenBitStoreIntoGBMemoryWithTraps(a,b)}function getDataByteOne(){syncCycles(4);return eightBitLoadFromGBMemory(Cpu.programCounter)}function getDataByteTwo(){syncCycles(4);return eightBitLoadFromGBMemory(u16Portable(Cpu.programCounter+1))}function getConcatenatedDataByte(){return concatenateBytes(getDataByteTwo(),getDataByteOne())}
function handleOpcode0x(a){switch(a){case 0:return 4;case 1:return a=getConcatenatedDataByte(),Cpu.registerB=splitHighByte(a),Cpu.registerC=splitLowByte(a),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 2:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerB,Cpu.registerC),Cpu.registerA),4;case 3:return a=concatenateBytes(Cpu.registerB,Cpu.registerC),a++,Cpu.registerB=splitHighByte(a),Cpu.registerC=splitLowByte(a),8;case 4:return a=Cpu.registerB,checkAndSetEightBitHalfCarryFlag(a,
1),a=u8Portable(a+1),Cpu.registerB=a,setZeroFlag$$1(0===a),setSubtractFlag(0),4;case 5:return a=Cpu.registerB,checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-1),Cpu.registerB=a,setZeroFlag$$1(0===a),setSubtractFlag(1),4;case 6:return Cpu.registerB=getDataByteOne(),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 7:return a=Cpu.registerA,setCarryFlag(128===(a&128)),Cpu.registerA=rotateByteLeft(a),setZeroFlag$$1(0),setSubtractFlag(0),setHalfCarryFlag(0),4;case 8:return sixteenBitStoreSyncCycles(getConcatenatedDataByte(),
Cpu.stackPointer),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 9:a=concatenateBytes(Cpu.registerH,Cpu.registerL);var b=concatenateBytes(Cpu.registerB,Cpu.registerC);checkAndSetSixteenBitFlagsAddOverflow(a,b,!1);a=u16Portable(a+b);Cpu.registerH=splitHighByte(a);Cpu.registerL=splitLowByte(a);setSubtractFlag(0);return 8;case 10:return Cpu.registerA=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerB,Cpu.registerC)),4;case 11:return a=concatenateBytes(Cpu.registerB,Cpu.registerC),a=u16Portable(a-
1),Cpu.registerB=splitHighByte(a),Cpu.registerC=splitLowByte(a),8;case 12:return a=Cpu.registerC,checkAndSetEightBitHalfCarryFlag(a,1),a=u8Portable(a+1),Cpu.registerC=a,setZeroFlag$$1(0===a),setSubtractFlag(0),4;case 13:return a=Cpu.registerC,checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-1),Cpu.registerC=a,setZeroFlag$$1(0===a),setSubtractFlag(1),4;case 14:return Cpu.registerC=getDataByteOne(),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 15:return a=Cpu.registerA,setCarryFlag(0<
(a&1)),Cpu.registerA=rotateByteRight(a),setZeroFlag$$1(0),setSubtractFlag(0),setHalfCarryFlag(0),4}return-1}
function handleOpcode1x(a){switch(a){case 16:if(Cpu.GBCEnabled&&(a=eightBitLoadSyncCycles(Cpu.memoryLocationSpeedSwitch),checkBitOnByte(0,a)))return a=resetBitOnByte(0,a),checkBitOnByte(7,a)?(Cpu.GBCDoubleSpeed=!1,a=resetBitOnByte(7,a)):(Cpu.GBCDoubleSpeed=!0,a=setBitOnByte(7,a)),eightBitStoreSyncCycles(Cpu.memoryLocationSpeedSwitch,a),68;Cpu.isStopped=!0;Cpu.programCounter=u16Portable(Cpu.programCounter+1);return 4;case 17:return a=getConcatenatedDataByte(),Cpu.registerD=splitHighByte(a),Cpu.registerE=
splitLowByte(a),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 18:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerD,Cpu.registerE),Cpu.registerA),4;case 19:return a=concatenateBytes(Cpu.registerD,Cpu.registerE),a=u16Portable(a+1),Cpu.registerD=splitHighByte(a),Cpu.registerE=splitLowByte(a),8;case 20:return a=Cpu.registerD,checkAndSetEightBitHalfCarryFlag(a,1),a=u8Portable(a+1),Cpu.registerD=a,setZeroFlag$$1(0===Cpu.registerD),setSubtractFlag(0),4;case 21:return a=Cpu.registerD,
checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-1),Cpu.registerD=a,setZeroFlag$$1(0===Cpu.registerD),setSubtractFlag(1),4;case 22:return Cpu.registerD=getDataByteOne(),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 23:return a=128===(Cpu.registerA&128),Cpu.registerA=rotateByteLeftThroughCarry(Cpu.registerA),setCarryFlag(a),setZeroFlag$$1(0),setSubtractFlag(0),setHalfCarryFlag(0),4;case 24:return relativeJump(getDataByteOne()),8;case 25:a=concatenateBytes(Cpu.registerH,Cpu.registerL);
var b=concatenateBytes(Cpu.registerD,Cpu.registerE);checkAndSetSixteenBitFlagsAddOverflow(a,b,!1);a=u16Portable(a+b);Cpu.registerH=splitHighByte(a);Cpu.registerL=splitLowByte(a);setSubtractFlag(0);return 8;case 26:return a=concatenateBytes(Cpu.registerD,Cpu.registerE),Cpu.registerA=eightBitLoadSyncCycles(a),4;case 27:return a=concatenateBytes(Cpu.registerD,Cpu.registerE),a=u16Portable(a-1),Cpu.registerD=splitHighByte(a),Cpu.registerE=splitLowByte(a),8;case 28:return a=Cpu.registerE,checkAndSetEightBitHalfCarryFlag(a,
1),a=u8Portable(a+1),Cpu.registerE=a,setZeroFlag$$1(0===a),setSubtractFlag(0),4;case 29:return a=Cpu.registerE,checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-1),Cpu.registerE=a,setZeroFlag$$1(0===a),setSubtractFlag(1),4;case 30:return Cpu.registerE=getDataByteOne(),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 31:return a=1===(Cpu.registerA&1),Cpu.registerA=rotateByteRightThroughCarry(Cpu.registerA),setCarryFlag(a),setZeroFlag$$1(0),setSubtractFlag(0),setHalfCarryFlag(0),4}return-1}
function handleOpcode2x(a){switch(a){case 32:return 0===getZeroFlag$$1()?relativeJump(getDataByteOne()):Cpu.programCounter=u16Portable(Cpu.programCounter+1),8;case 33:return a=getConcatenatedDataByte(),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 34:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),eightBitStoreSyncCycles(a,Cpu.registerA),a=u16Portable(a+1),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),
4;case 35:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),a=u16Portable(a+1),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),8;case 36:return a=Cpu.registerH,checkAndSetEightBitHalfCarryFlag(a,1),a=u8Portable(a+1),Cpu.registerH=a,setZeroFlag$$1(0===a),setSubtractFlag(0),4;case 37:return a=Cpu.registerH,checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-1),Cpu.registerH=a,setZeroFlag$$1(0===a),setSubtractFlag(1),4;case 38:return Cpu.registerH=getDataByteOne(),Cpu.programCounter=
u16Portable(Cpu.programCounter+1),4;case 39:a=0;0<getHalfCarryFlag()&&(a|=6);0<getCarryFlag$$1()&&(a|=96);var b=Cpu.registerA;0<getSubtractFlag()?b=u8Portable(b-a):(9<(b&15)&&(a|=6),153<b&&(a|=96),b=u8Portable(b+a));setZeroFlag$$1(0===b);setCarryFlag(0!==(a&96));setHalfCarryFlag(0);Cpu.registerA=b;return 4;case 40:return 0<getZeroFlag$$1()?relativeJump(getDataByteOne()):Cpu.programCounter=u16Portable(Cpu.programCounter+1),8;case 41:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),checkAndSetSixteenBitFlagsAddOverflow(a,
a,!1),a=u16Portable(2*a),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),setSubtractFlag(0),8;case 42:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerA=eightBitLoadSyncCycles(a),a=u16Portable(a+1),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),4;case 43:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),a=u16Portable(a-1),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),8;case 44:return a=Cpu.registerL,checkAndSetEightBitHalfCarryFlag(a,
1),a=u8Portable(a+1),Cpu.registerL=a,setZeroFlag$$1(0===a),setSubtractFlag(0),4;case 45:return a=Cpu.registerL,checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-1),Cpu.registerL=a,setZeroFlag$$1(0===a),setSubtractFlag(1),4;case 46:return Cpu.registerL=getDataByteOne(),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 47:return Cpu.registerA=~Cpu.registerA,setSubtractFlag(1),setHalfCarryFlag(1),4}return-1}
function handleOpcode3x(a){switch(a){case 48:return 0===getCarryFlag$$1()?relativeJump(getDataByteOne()):Cpu.programCounter=u16Portable(Cpu.programCounter+1),8;case 49:return Cpu.stackPointer=getConcatenatedDataByte(),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 50:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),eightBitStoreSyncCycles(a,Cpu.registerA),a=u16Portable(a-1),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),4;case 51:return Cpu.stackPointer=u16Portable(Cpu.stackPointer+
1),8;case 52:a=concatenateBytes(Cpu.registerH,Cpu.registerL);var b=eightBitLoadSyncCycles(a);checkAndSetEightBitHalfCarryFlag(b,1);b=u8Portable(b+1);setZeroFlag$$1(0===b);setSubtractFlag(0);eightBitStoreSyncCycles(a,b);return 4;case 53:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),b=eightBitLoadSyncCycles(a),checkAndSetEightBitHalfCarryFlag(b,-1),b=u8Portable(b-1),setZeroFlag$$1(0===b),setSubtractFlag(1),eightBitStoreSyncCycles(a,b),4;case 54:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,
Cpu.registerL),getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 55:return setSubtractFlag(0),setHalfCarryFlag(0),setCarryFlag(1),4;case 56:return 1===getCarryFlag$$1()?relativeJump(getDataByteOne()):Cpu.programCounter=u16Portable(Cpu.programCounter+1),8;case 57:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),checkAndSetSixteenBitFlagsAddOverflow(a,Cpu.stackPointer,!1),a=u16Portable(a+Cpu.stackPointer),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),
setSubtractFlag(0),8;case 58:return a=concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerA=eightBitLoadSyncCycles(a),a=u16Portable(a-1),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),4;case 59:return Cpu.stackPointer=u16Portable(Cpu.stackPointer-1),8;case 60:return a=Cpu.registerA,checkAndSetEightBitHalfCarryFlag(a,1),a=u8Portable(a+1),Cpu.registerA=a,setZeroFlag$$1(0===a),setSubtractFlag(0),4;case 61:return a=Cpu.registerA,checkAndSetEightBitHalfCarryFlag(a,-1),a=u8Portable(a-
1),Cpu.registerA=a,setZeroFlag$$1(0===a),setSubtractFlag(1),4;case 62:return Cpu.registerA=getDataByteOne(),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 63:return setSubtractFlag(0),setHalfCarryFlag(0),setCarryFlag(0>=getCarryFlag$$1()),4}return-1}
function handleOpcode4x(a){switch(a){case 64:return 4;case 65:return Cpu.registerB=Cpu.registerC,4;case 66:return Cpu.registerB=Cpu.registerD,4;case 67:return Cpu.registerB=Cpu.registerE,4;case 68:return Cpu.registerB=Cpu.registerH,4;case 69:return Cpu.registerB=Cpu.registerL,4;case 70:return Cpu.registerB=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 71:return Cpu.registerB=Cpu.registerA,4;case 72:return Cpu.registerC=Cpu.registerB,4;case 73:return 4;case 74:return Cpu.registerC=
Cpu.registerD,4;case 75:return Cpu.registerC=Cpu.registerE,4;case 76:return Cpu.registerC=Cpu.registerH,4;case 77:return Cpu.registerC=Cpu.registerL,4;case 78:return Cpu.registerC=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 79:return Cpu.registerC=Cpu.registerA,4}return-1}
function handleOpcode5x(a){switch(a){case 80:return Cpu.registerD=Cpu.registerB,4;case 81:return Cpu.registerD=Cpu.registerC,4;case 82:return 4;case 83:return Cpu.registerD=Cpu.registerE,4;case 84:return Cpu.registerD=Cpu.registerH,4;case 85:return Cpu.registerD=Cpu.registerL,4;case 86:return Cpu.registerD=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 87:return Cpu.registerD=Cpu.registerA,4;case 88:return Cpu.registerE=Cpu.registerB,4;case 89:return Cpu.registerE=Cpu.registerC,
4;case 90:return Cpu.registerE=Cpu.registerD,4;case 91:return 4;case 92:return Cpu.registerE=Cpu.registerH,4;case 93:return Cpu.registerE=Cpu.registerL,4;case 94:return Cpu.registerE=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 95:return Cpu.registerE=Cpu.registerA,4}return-1}
function handleOpcode6x(a){switch(a){case 96:return Cpu.registerH=Cpu.registerB,4;case 97:return Cpu.registerH=Cpu.registerC,4;case 98:return Cpu.registerH=Cpu.registerD,4;case 99:return Cpu.registerH=Cpu.registerE,4;case 100:return Cpu.registerH=Cpu.registerH,4;case 101:return Cpu.registerH=Cpu.registerL,4;case 102:return Cpu.registerH=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 103:return Cpu.registerH=Cpu.registerA,4;case 104:return Cpu.registerL=Cpu.registerB,
4;case 105:return Cpu.registerL=Cpu.registerC,4;case 106:return Cpu.registerL=Cpu.registerD,4;case 107:return Cpu.registerL=Cpu.registerE,4;case 108:return Cpu.registerL=Cpu.registerH,4;case 109:return Cpu.registerL=Cpu.registerL,4;case 110:return Cpu.registerL=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 111:return Cpu.registerL=Cpu.registerA,4}return-1}
function handleOpcode7x(a){switch(a){case 112:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerB),4;case 113:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerC),4;case 114:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerD),4;case 115:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerE),4;case 116:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,
Cpu.registerL),Cpu.registerH),4;case 117:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerL),4;case 118:return Memory.isHblankHdmaActive||Cpu.enableHalt(),4;case 119:return eightBitStoreSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL),Cpu.registerA),4;case 120:return Cpu.registerA=Cpu.registerB,4;case 121:return Cpu.registerA=Cpu.registerC,4;case 122:return Cpu.registerA=Cpu.registerD,4;case 123:return Cpu.registerA=Cpu.registerE,4;case 124:return Cpu.registerA=
Cpu.registerH,4;case 125:return Cpu.registerA=Cpu.registerL,4;case 126:return Cpu.registerA=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),4;case 127:return 4}return-1}
function handleOpcode8x(a){switch(a){case 128:return addARegister(Cpu.registerB),4;case 129:return addARegister(Cpu.registerC),4;case 130:return addARegister(Cpu.registerD),4;case 131:return addARegister(Cpu.registerE),4;case 132:return addARegister(Cpu.registerH),4;case 133:return addARegister(Cpu.registerL),4;case 134:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),addARegister(a),4;case 135:return addARegister(Cpu.registerA),4;case 136:return addAThroughCarryRegister(Cpu.registerB),
4;case 137:return addAThroughCarryRegister(Cpu.registerC),4;case 138:return addAThroughCarryRegister(Cpu.registerD),4;case 139:return addAThroughCarryRegister(Cpu.registerE),4;case 140:return addAThroughCarryRegister(Cpu.registerH),4;case 141:return addAThroughCarryRegister(Cpu.registerL),4;case 142:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),addAThroughCarryRegister(a),4;case 143:return addAThroughCarryRegister(Cpu.registerA),4}return-1}
function handleOpcode9x(a){switch(a){case 144:return subARegister(Cpu.registerB),4;case 145:return subARegister(Cpu.registerC),4;case 146:return subARegister(Cpu.registerD),4;case 147:return subARegister(Cpu.registerE),4;case 148:return subARegister(Cpu.registerH),4;case 149:return subARegister(Cpu.registerL),4;case 150:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),subARegister(a),4;case 151:return subARegister(Cpu.registerA),4;case 152:return subAThroughCarryRegister(Cpu.registerB),
4;case 153:return subAThroughCarryRegister(Cpu.registerC),4;case 154:return subAThroughCarryRegister(Cpu.registerD),4;case 155:return subAThroughCarryRegister(Cpu.registerE),4;case 156:return subAThroughCarryRegister(Cpu.registerH),4;case 157:return subAThroughCarryRegister(Cpu.registerL),4;case 158:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),subAThroughCarryRegister(a),4;case 159:return subAThroughCarryRegister(Cpu.registerA),4}return-1}
function handleOpcodeAx(a){switch(a){case 160:return andARegister(Cpu.registerB),4;case 161:return andARegister(Cpu.registerC),4;case 162:return andARegister(Cpu.registerD),4;case 163:return andARegister(Cpu.registerE),4;case 164:return andARegister(Cpu.registerH),4;case 165:return andARegister(Cpu.registerL),4;case 166:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),andARegister(a),4;case 167:return andARegister(Cpu.registerA),4;case 168:return xorARegister(Cpu.registerB),
4;case 169:return xorARegister(Cpu.registerC),4;case 170:return xorARegister(Cpu.registerD),4;case 171:return xorARegister(Cpu.registerE),4;case 172:return xorARegister(Cpu.registerH),4;case 173:return xorARegister(Cpu.registerL),4;case 174:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),xorARegister(a),4;case 175:return xorARegister(Cpu.registerA),4}return-1}
function handleOpcodeBx(a){switch(a){case 176:return orARegister(Cpu.registerB),4;case 177:return orARegister(Cpu.registerC),4;case 178:return orARegister(Cpu.registerD),4;case 179:return orARegister(Cpu.registerE),4;case 180:return orARegister(Cpu.registerH),4;case 181:return orARegister(Cpu.registerL),4;case 182:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),orARegister(a),4;case 183:return orARegister(Cpu.registerA),4;case 184:return cpARegister(Cpu.registerB),4;
case 185:return cpARegister(Cpu.registerC),4;case 186:return cpARegister(Cpu.registerD),4;case 187:return cpARegister(Cpu.registerE),4;case 188:return cpARegister(Cpu.registerH),4;case 189:return cpARegister(Cpu.registerL),4;case 190:return a=eightBitLoadSyncCycles(concatenateBytes(Cpu.registerH,Cpu.registerL)),cpARegister(a),4;case 191:return cpARegister(Cpu.registerA),4}return-1}
function handleOpcodeCx(a){switch(a){case 192:return 0===getZeroFlag$$1()?(a=Cpu.stackPointer,Cpu.programCounter=sixteenBitLoadSyncCycles(a),Cpu.stackPointer=u16Portable(a+2),12):8;case 193:return a=sixteenBitLoadSyncCycles(Cpu.stackPointer),Cpu.stackPointer=u16Portable(Cpu.stackPointer+2),Cpu.registerB=splitHighByte(a),Cpu.registerC=splitLowByte(a),4;case 194:if(0===getZeroFlag$$1())return Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;
case 195:return Cpu.programCounter=getConcatenatedDataByte(),8;case 196:if(0===getZeroFlag$$1())return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,u16Portable(Cpu.programCounter+2)),Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;case 197:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,concatenateBytes(Cpu.registerB,Cpu.registerC)),8;case 198:return addARegister(getDataByteOne()),
Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 199:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=0,8;case 200:return 1===getZeroFlag$$1()?(a=Cpu.stackPointer,Cpu.programCounter=sixteenBitLoadSyncCycles(a),Cpu.stackPointer=u16Portable(a+2),12):8;case 201:return a=Cpu.stackPointer,Cpu.programCounter=sixteenBitLoadSyncCycles(a),Cpu.stackPointer=u16Portable(a+2),8;case 202:if(1===getZeroFlag$$1())return Cpu.programCounter=
getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;case 203:return a=handleCbOpcode(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),a;case 204:if(1===getZeroFlag$$1())return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter+2),Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;case 205:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=
a,sixteenBitStoreSyncCycles(a,u16Portable(Cpu.programCounter+2)),Cpu.programCounter=getConcatenatedDataByte(),8;case 206:return addAThroughCarryRegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 207:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=8}return-1}
function handleOpcodeDx(a){switch(a){case 208:return 0===getCarryFlag$$1()?(a=Cpu.stackPointer,Cpu.programCounter=sixteenBitLoadSyncCycles(a),Cpu.stackPointer=u16Portable(a+2),12):8;case 209:a=Cpu.stackPointer;var b=sixteenBitLoadSyncCycles(a);Cpu.stackPointer=u16Portable(a+2);Cpu.registerD=splitHighByte(b);Cpu.registerE=splitLowByte(b);return 4;case 210:if(0===getCarryFlag$$1())return Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;case 212:if(0===
getCarryFlag$$1())return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter+2),Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;case 213:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,concatenateBytes(Cpu.registerD,Cpu.registerE)),8;case 214:return subARegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 215:return a=
u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=16,8;case 216:return 1===getCarryFlag$$1()?(a=Cpu.stackPointer,Cpu.programCounter=sixteenBitLoadSyncCycles(a),Cpu.stackPointer=u16Portable(a+2),12):8;case 217:return a=Cpu.stackPointer,Cpu.programCounter=sixteenBitLoadSyncCycles(a),setInterrupts(!0),Cpu.stackPointer=u16Portable(a+2),8;case 218:if(1===getCarryFlag$$1())return Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=
u16Portable(Cpu.programCounter+2);return 12;case 220:if(1===getCarryFlag$$1())return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,u16Portable(Cpu.programCounter+2)),Cpu.programCounter=getConcatenatedDataByte(),8;Cpu.programCounter=u16Portable(Cpu.programCounter+2);return 12;case 222:return subAThroughCarryRegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 223:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,
Cpu.programCounter),Cpu.programCounter=24,8}return-1}
function handleOpcodeEx(a){switch(a){case 224:return a=getDataByteOne(),eightBitStoreSyncCycles(65280+a,Cpu.registerA),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 225:a=Cpu.stackPointer;var b=sixteenBitLoadSyncCycles(a);Cpu.stackPointer=u16Portable(a+2);Cpu.registerH=splitHighByte(b);Cpu.registerL=splitLowByte(b);return 4;case 226:return eightBitStoreSyncCycles(65280+Cpu.registerC,Cpu.registerA),4;case 229:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,
concatenateBytes(Cpu.registerH,Cpu.registerL)),8;case 230:return andARegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 231:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=32,8;case 232:return a=i8Portable(getDataByteOne()),checkAndSetSixteenBitFlagsAddOverflow(Cpu.stackPointer,a,!0),Cpu.stackPointer=u16Portable(Cpu.stackPointer+a),setZeroFlag$$1(0),setSubtractFlag(0),Cpu.programCounter=
u16Portable(Cpu.programCounter+1),12;case 233:return Cpu.programCounter=concatenateBytes(Cpu.registerH,Cpu.registerL),4;case 234:return eightBitStoreSyncCycles(getConcatenatedDataByte(),Cpu.registerA),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 238:return xorARegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 239:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=40,8}return-1}
function handleOpcodeFx(a){switch(a){case 240:return a=getDataByteOne(),Cpu.registerA=u8Portable(eightBitLoadSyncCycles(65280+a)),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 241:a=Cpu.stackPointer;var b=sixteenBitLoadSyncCycles(a);Cpu.stackPointer=u16Portable(a+2);Cpu.registerA=splitHighByte(b);Cpu.registerF=splitLowByte(b);return 4;case 242:return Cpu.registerA=u8Portable(eightBitLoadSyncCycles(65280+Cpu.registerC)),4;case 243:return setInterrupts(!1),4;case 245:return a=u16Portable(Cpu.stackPointer-
2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,concatenateBytes(Cpu.registerA,Cpu.registerF)),8;case 246:return orARegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 247:return a=u16Portable(Cpu.stackPointer-2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=48,8;case 248:return b=i8Portable(getDataByteOne()),a=Cpu.stackPointer,setZeroFlag$$1(0),setSubtractFlag(0),checkAndSetSixteenBitFlagsAddOverflow(a,b,!0),a=u16Portable(a+
b),Cpu.registerH=splitHighByte(a),Cpu.registerL=splitLowByte(a),Cpu.programCounter=u16Portable(Cpu.programCounter+1),8;case 249:return Cpu.stackPointer=concatenateBytes(Cpu.registerH,Cpu.registerL),8;case 250:return Cpu.registerA=eightBitLoadSyncCycles(getConcatenatedDataByte()),Cpu.programCounter=u16Portable(Cpu.programCounter+2),4;case 251:return setInterrupts(!0),4;case 254:return cpARegister(getDataByteOne()),Cpu.programCounter=u16Portable(Cpu.programCounter+1),4;case 255:return a=u16Portable(Cpu.stackPointer-
2),Cpu.stackPointer=a,sixteenBitStoreSyncCycles(a,Cpu.programCounter),Cpu.programCounter=56,8}return-1}var Cycles=function(){function a(){}a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=0;return a}();function getCyclesPerCycleSet(){return Cycles.cyclesPerCycleSet}function getCycleSets(){return Cycles.cycleSets}function getCycles(){return Cycles.cycles}
function trackCyclesRan(a){var b=Cycles.cycles;b+=a;b>=Cycles.cyclesPerCycleSet&&(Cycles.cycleSets+=1,b-=Cycles.cyclesPerCycleSet);Cycles.cycles=b}function resetCycles(){Cycles.cyclesPerCycleSet=2E9;Cycles.cycleSets=0;Cycles.cycles=0}
function syncCycles(a){0<Memory.DMACycles&&(a+=Memory.DMACycles,Memory.DMACycles=0);Cpu.currentCycles+=a;Cpu.isStopped||(Config.graphicsBatchProcessing?(Graphics.currentCycles+=a,batchProcessGraphics()):updateGraphics(a),Config.audioBatchProcessing?(Sound.currentCycles+=a,batchProcessAudio()):updateSound(a),updateSerial(a));Config.timersBatchProcessing?(Timers.currentCycles+=a,batchProcessTimers()):updateTimers(a);trackCyclesRan(a)}
var Execute=function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;a.RESPONSE_CONDITION_ERROR=-1;a.RESPONSE_CONDITION_FRAME=0;a.RESPONSE_CONDITION_AUDIO=1;a.RESPONSE_CONDITION_BREAKPOINT=2;return a}();function getStepsPerStepSet(){return Execute.stepsPerStepSet}function getStepSets(){return Execute.stepSets}function getSteps(){return Execute.steps}
function trackStepsRan(a){var b=Execute.steps;b+=a;b>=Execute.stepsPerStepSet&&(Execute.stepSets+=1,b-=Execute.stepsPerStepSet);Execute.steps=b}function resetSteps(){Execute.stepsPerStepSet=2E9;Execute.stepSets=0;Execute.steps=0}function executeMultipleFrames(a){for(var b=0,c=0;c<a&&0<=b;)b=executeFrame(),c+=1;return 0>b?b:0}function executeFrame(){return executeUntilCondition(!0,-1)}function executeFrameAndCheckAudio(a){void 0===a&&(a=0);return executeUntilCondition(!0,a)}
function executeUntilCondition(a,b){void 0===b&&(b=-1);a=1024;0<b?a=b:0>b&&(a=-1);for(var c=!1,d=!1,e=!1;!(c||d||e||Breakpoints.reachedBreakpoint);)b=executeStep(),0>b?c=!0:Cpu.currentCycles>=Cpu.MAX_CYCLES_PER_FRAME()?d=!0:-1<a&&getNumberOfSamplesInAudioBuffer()>=a&&(e=!0);if(d)return Cpu.currentCycles-=Cpu.MAX_CYCLES_PER_FRAME(),Execute.RESPONSE_CONDITION_FRAME;if(e)return Execute.RESPONSE_CONDITION_AUDIO;if(Breakpoints.reachedBreakpoint)return Breakpoints.reachedBreakpoint=!1,Execute.RESPONSE_CONDITION_BREAKPOINT;
Cpu.programCounter=u16Portable(Cpu.programCounter-1);return-1}
function executeStep(){setHasCoreStarted(!0);if(Cpu.isHaltBug){var a=eightBitLoadFromGBMemory(Cpu.programCounter);a=executeOpcode$$1(a);syncCycles(a);Cpu.exitHaltAndStop()}a=checkInterrupts();0<a&&syncCycles(a);a=4;Cpu.isHalted()||Cpu.isStopped||(a=eightBitLoadFromGBMemory(Cpu.programCounter),a=executeOpcode$$1(a));Cpu.registerF&=240;if(0>=a)return a;syncCycles(a);trackStepsRan(1);Cpu.programCounter===Breakpoints.programCounter&&(Breakpoints.reachedBreakpoint=!0);return a}
memory.size()<WASMBOY_WASM_PAGES&&memory.grow(WASMBOY_WASM_PAGES-memory.size());var hasStarted=!1;function setHasCoreStarted(a){hasStarted=a}function hasCoreStarted(){return hasStarted}
function config(a,b,c,d,e,f,g,k,h,l){Config.enableBootRom=0<a;Config.useGbcWhenAvailable=0<b;Config.audioBatchProcessing=0<c;Config.graphicsBatchProcessing=0<d;Config.timersBatchProcessing=0<e;Config.graphicsDisableScanlineRendering=0<f;Config.audioAccumulateSamples=0<g;Config.tileRendering=0<k;Config.tileCaching=0<h;Config.enableAudioDebugging=0<l;initialize()}
function initialize(){var a=eightBitLoadFromGBMemory(323);Cpu.GBCEnabled=192===a||Config.useGbcWhenAvailable&&128===a?!0:!1;setHasCoreStarted(!1);resetCycles();resetSteps();Cpu.BootROMEnabled=Config.enableBootRom?!0:!1;initializeCpu();initializeCartridge();initializeDma();initializeGraphics();initializePalette();initializeSound();initializeInterrupts();initializeTimers();initializeSerial();initializeVarious()}
function initializeVarious(){Cpu.GBCEnabled?(eightBitStoreIntoGBMemory(65392,248),eightBitStoreIntoGBMemory(65359,254),eightBitStoreIntoGBMemory(65357,126),eightBitStoreIntoGBMemory(65280,207),eightBitStoreIntoGBMemory(65295,225),eightBitStoreIntoGBMemory(65388,254),eightBitStoreIntoGBMemory(65397,143)):(eightBitStoreIntoGBMemory(65392,255),eightBitStoreIntoGBMemory(65359,255),eightBitStoreIntoGBMemory(65357,255),eightBitStoreIntoGBMemory(65280,207),eightBitStoreIntoGBMemory(65295,225))}
function isGBC(){return Cpu.GBCEnabled}function getSaveStateMemoryOffset(a,b){return WASMBOY_STATE_LOCATION+a+50*b}function saveState(){Cpu.saveState();Graphics.saveState();Interrupts.saveState();Joypad.saveState();Memory.saveState();Timers.saveState();Sound.saveState();Channel1.saveState();Channel2.saveState();Channel3.saveState();Channel4.saveState();setHasCoreStarted(!1)}
function loadState(){Cpu.loadState();Graphics.loadState();Interrupts.loadState();Joypad.loadState();Memory.loadState();Timers.loadState();Sound.loadState();Channel1.loadState();Channel2.loadState();Channel3.loadState();Channel4.loadState();setHasCoreStarted(!1);resetCycles();resetSteps()}function getRegisterA(){return Cpu.registerA}function getRegisterB(){return Cpu.registerB}function getRegisterC(){return Cpu.registerC}function getRegisterD(){return Cpu.registerD}
function getRegisterE(){return Cpu.registerE}function getRegisterH(){return Cpu.registerH}function getRegisterL(){return Cpu.registerL}function getRegisterF(){return Cpu.registerF}function getProgramCounter(){return Cpu.programCounter}function getStackPointer(){return Cpu.stackPointer}function getOpcodeAtProgramCounter(){return eightBitLoadFromGBMemory(Cpu.programCounter)}function getLY(){return Graphics.scanlineRegister}function getScrollX(){return Graphics.scrollX}
function getScrollY(){return Graphics.scrollY}function getWindowX(){return Graphics.windowX}function getWindowY(){return Graphics.windowY}
function drawBackgroundMapToWasmMemory(a){var b=Graphics.memoryLocationTileDataSelectZeroStart;Lcd.bgWindowTileDataSelect&&(b=Graphics.memoryLocationTileDataSelectOneStart);var c=Graphics.memoryLocationTileMapSelectZeroStart;Lcd.bgTileMapDisplaySelect&&(c=Graphics.memoryLocationTileMapSelectOneStart);for(var d=0;256>d;d++)for(var e=0;256>e;e++){var f=d,g=e,k=c+32*(f>>3)+(g>>3),h=loadFromVramBank(k,0);h=getTileDataAddress(b,h);var l=f%8;f=g%8;f=7-f;g=0;Cpu.GBCEnabled&&0<a&&(g=loadFromVramBank(k,1));
checkBitOnByte(6,g)&&(l=7-l);var n=0;checkBitOnByte(3,g)&&(n=1);k=loadFromVramBank(h+2*l,n);h=loadFromVramBank(h+2*l+1,n);l=0;checkBitOnByte(f,h)&&(l+=1,l<<=1);checkBitOnByte(f,k)&&(l+=1);h=3*(256*d+e);Cpu.GBCEnabled&&0<a?(k=getRgbColorFromPalette(g&7,l,!1),g=getColorComponentFromRgb(0,k),f=getColorComponentFromRgb(1,k),k=getColorComponentFromRgb(2,k),h=BACKGROUND_MAP_LOCATION+h,store(h,g),store(h+1,f),store(h+2,k)):(g=getColorizedGbHexColorFromPalette(l,Graphics.memoryLocationBackgroundPalette),
h=BACKGROUND_MAP_LOCATION+h,store(h+0,getRedFromHexColor(g)),store(h+1,getGreenFromHexColor(g)),store(h+2,getBlueFromHexColor(g)))}}
function drawTileDataToWasmMemory(){for(var a=0;23>a;a++)for(var b=0;31>b;b++){var c=0;15<b&&(c=1);var d=a;15<a&&(d-=15);d<<=4;d=15<b?d+(b-15):d+b;var e=Graphics.memoryLocationTileDataSelectOneStart;15<a&&(e=Graphics.memoryLocationTileDataSelectZeroStart);for(var f=Graphics.memoryLocationBackgroundPalette,g=-1,k=-1,h=0;8>h;h++)for(var l=0;5>l;l++){var n=4*(8*l+h),m=eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+n+2);d===m&&(n=eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+
n+3),m=0,Cpu.GBCEnabled&&checkBitOnByte(3,n)&&(m=1),m===c&&(k=n,h=8,l=5,f=Graphics.memoryLocationSpritePaletteOne,checkBitOnByte(4,k)&&(f=Graphics.memoryLocationSpritePaletteTwo)))}if(Cpu.GBCEnabled&&0>k){h=Graphics.memoryLocationTileMapSelectZeroStart;Lcd.bgTileMapDisplaySelect&&(h=Graphics.memoryLocationTileMapSelectOneStart);l=-1;for(n=0;32>n;n++)for(m=0;32>m;m++){var p=h+32*m+n,r=loadFromVramBank(p,0);d===r&&(l=p,m=n=32)}0<=l&&(g=loadFromVramBank(l,1))}for(h=0;8>h;h++)drawPixelsFromLineOfTile(d,
e,c,0,7,h,8*b,8*a+h,248,TILE_DATA_LOCATION,!1,f,g,k)}}
function drawOamToWasmMemory(){for(var a=0;8>a;a++)for(var b=0;5>b;b++){var c=4*(8*b+a);eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+c);eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+c+1);var d=eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+c+2),e=1;Lcd.tallSpriteSize&&(1===d%2&&--d,e+=1);c=eightBitLoadFromGBMemory(Graphics.memoryLocationSpriteAttributesTable+c+3);var f=0;Cpu.GBCEnabled&&checkBitOnByte(3,c)&&(f=1);var g=Graphics.memoryLocationSpritePaletteOne;
checkBitOnByte(4,c)&&(g=Graphics.memoryLocationSpritePaletteTwo);for(var k=0;k<e;k++)for(var h=0;8>h;h++)drawPixelsFromLineOfTile(d+k,Graphics.memoryLocationTileDataSelectOneStart,f,0,7,h,8*a,16*b+h+8*k,64,OAM_TILES_LOCATION,!1,g,-1,c)}}function getDIV(){return Timers.dividerRegister}function getTIMA(){return Timers.timerCounter}function getTMA(){return Timers.timerModulo}function getTAC(){var a=Timers.timerInputClock;Timers.timerEnabled&&(a=setBitOnByte(2,a));return a}
function updateDebugGBMemory(){for(var a=0;a<DEBUG_GAMEBOY_MEMORY_SIZE;a++)store(DEBUG_GAMEBOY_MEMORY_LOCATION+a,eightBitLoadFromGBMemoryWithTraps(a));Breakpoints.reachedBreakpoint=!1}
var WasmBoyCore=Object.freeze({memory,config,hasCoreStarted,saveState,loadState,isGBC,getStepsPerStepSet,getStepSets,getSteps,executeMultipleFrames,executeFrame,executeFrameAndCheckAudio,executeUntilCondition,executeStep,getCyclesPerCycleSet,getCycleSets,getCycles,setJoypadState,getNumberOfSamplesInAudioBuffer,clearAudioBuffer,setManualColorizationPalette,WASMBOY_MEMORY_LOCATION,WASMBOY_MEMORY_SIZE,WASMBOY_WASM_PAGES,ASSEMBLYSCRIPT_MEMORY_LOCATION,ASSEMBLYSCRIPT_MEMORY_SIZE,WASMBOY_STATE_LOCATION,
WASMBOY_STATE_SIZE,GAMEBOY_INTERNAL_MEMORY_LOCATION,GAMEBOY_INTERNAL_MEMORY_SIZE,VIDEO_RAM_LOCATION,VIDEO_RAM_SIZE,WORK_RAM_LOCATION,WORK_RAM_SIZE,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE,GRAPHICS_OUTPUT_LOCATION,GRAPHICS_OUTPUT_SIZE,GBC_PALETTE_LOCATION,GBC_PALETTE_SIZE,BG_PRIORITY_MAP_LOCATION,BG_PRIORITY_MAP_SIZE,FRAME_LOCATION,FRAME_SIZE,BACKGROUND_MAP_LOCATION,BACKGROUND_MAP_SIZE,TILE_DATA_LOCATION,TILE_DATA_SIZE,OAM_TILES_LOCATION,OAM_TILES_SIZE,AUDIO_BUFFER_LOCATION,
AUDIO_BUFFER_SIZE,CHANNEL_1_BUFFER_LOCATION,CHANNEL_1_BUFFER_SIZE,CHANNEL_2_BUFFER_LOCATION,CHANNEL_2_BUFFER_SIZE,CHANNEL_3_BUFFER_LOCATION,CHANNEL_3_BUFFER_SIZE,CHANNEL_4_BUFFER_LOCATION,CHANNEL_4_BUFFER_SIZE,CARTRIDGE_RAM_LOCATION,CARTRIDGE_RAM_SIZE,BOOT_ROM_LOCATION,BOOT_ROM_SIZE,CARTRIDGE_ROM_LOCATION,CARTRIDGE_ROM_SIZE,DEBUG_GAMEBOY_MEMORY_LOCATION,DEBUG_GAMEBOY_MEMORY_SIZE,getWasmBoyOffsetFromGameBoyOffset,setProgramCounterBreakpoint,resetProgramCounterBreakpoint,setReadGbMemoryBreakpoint,resetReadGbMemoryBreakpoint,
setWriteGbMemoryBreakpoint,resetWriteGbMemoryBreakpoint,getRegisterA,getRegisterB,getRegisterC,getRegisterD,getRegisterE,getRegisterH,getRegisterL,getRegisterF,getProgramCounter,getStackPointer,getOpcodeAtProgramCounter,getLY,getScrollX,getScrollY,getWindowX,getWindowY,drawBackgroundMapToWasmMemory,drawTileDataToWasmMemory,drawOamToWasmMemory,getDIV,getTIMA,getTMA,getTAC,updateDebugGBMemory});let getWasmBoyTsCore=async()=>({instance:{exports:WasmBoyCore},byteMemory:memory.wasmByteMemory,type:"TypeScript"});
module.exports=getWasmBoyTsCore
//# sourceMappingURL=getWasmBoyTsCore.closure.cjs.js.map
